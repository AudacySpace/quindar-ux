angular.module("app").component("dashboard",{transclude:!0,scope:!0,bindToController:!0,templateUrl:"./components/dashboard/dashboard.html",controller:function(e,t,o,n,s,r,a,l,i,c){var u=this;u.clock={utc:"000.00.00.00 UTC"},u.locks=e.getLock(),u.telemetry=e.telemetry,u.name=a.getUserName(),u.email=a.getUserEmail(),u.role=a.userRole;var d=t.getDashboard();u.currentMission=e.getCurrentMission(),u.updateClock=function(){u.clock=e.getTime("UTC")},u.interval=n(u.updateClock,500),u.openLeftNav=function(){r.innerWidth<=1440?s("left").open():(u.locks.lockLeft=!u.locks.lockLeft,e.setLeftLock(u.locks.lockLeft)),o.setMenuStatus(!0),o.setOpenLogo(!0)},u.logout=function(e){c({title:"Do you want to save this layout?",input:!0,label:"Layout Name",value:d.current.name}).then(function(e){t.save(u.email,e).then(function(e){200==e.status&&(r.location.href="/logout")})},function(){r.location.href="/logout"}).catch(function(e){})},u.openRightNav=function(){r.innerWidth<=1440?s("right").open():(u.locks.lockRight=!u.locks.lockRight,e.setRightLock(u.locks.lockRight))},u.showSettings=function(){l.open({templateUrl:"./components/dashboard/roleModal.html",controller:"modalCtrl",controllerAs:"$ctrl",resolve:{mission:function(){return e.getCurrentMission()}}}).result.then(function(e){},function(){})}}}),app.controller("modalCtrl",["$uibModalInstance","userService","mission","$window","$mdDialog",function(o,n,s,r,e){var a=this;a.cRole={},n.getCurrentRole(s.missionName).then(function(e){200==e.status&&(a.cRole=angular.copy(e.data),a.role={currentRole:a.cRole})}),a.close=function(){o.dismiss("cancel")},n.getAllowedRoles(s.missionName).then(function(e){200==e.status&&(a.roles=e.data)}),a.updateRole=function(e){"MD"===a.cRole.callsign&&"Mission Director"!==a.role.currentRole.name?o.close(a.cRole):n.getRoles().then(function(e){if(200==e.status){for(var t in e.data.roles)if(e.data.roles[t].name===a.role.currentRole.name){a.role.currentRole.callsign=e.data.roles[t].callsign;break}n.setCurrentRole(a.role.currentRole,s.missionName).then(function(e){200==e.status?o.close(a.role.currentRole):r.alert("An error occurred.User's role not updated!")})}})}}]),app.controller("missionModalCtrl",["$uibModalInstance","dashboardService","$scope","$window",function(o,n,s,e){var r=this;s.missions=n.missions,r.currentMission={},r.missionName="",s.$watch("missions",function(e,t){r.missions=e},!0),r.setMission=function(){for(var e=s.missions.length,t=0;t<e;t++)if(r.missionName===s.missions[t].missionName&&(r.currentMission=angular.copy(s.missions[t]),!1===n.isEmpty(r.currentMission))){n.setCurrentMission(r.currentMission),o.close(r.currentMission);break}}}]),app.component("deleteMenu",{bindings:{widget:"="},templateUrl:"../components/deleteMenu/delete.html",controller:function(t){this.deleteWidget=function(e){t.remove(e)},this.closedeleteWidget=function(e){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1}}}),app.component("leftSidebar",{templateUrl:"./components/leftSidebar/left_sidebar.html",controller:function(s,n,e,t,r,o,a){var l=this;function u(e){words=e.split(" ");for(var t=0;t<words.length;t++){var o=words[t].split("");o[0]=o[0].toUpperCase(),words[t]=o.join("")}return words.join(" ")}l.searchID="",l.previousTree=[],l.noresultsmsg="",l.interval=e(function(){var e=n.getLock(),t=s.getMenuStatus();if((e.lockLeft||r("left").isOpen())&&t){if(l.telemetry=n.getTelemetryValues(),l.telemetry.hasOwnProperty("data")){var o=function e(t,o){var n=[];for(var s in t)if(t.hasOwnProperty(s)){var r=[],a=!0,l=o?o+"."+s:s,i={value:"",key:""};if("object"==typeof t[s]){for(var c in t[s])if(t[s].hasOwnProperty(c)&&"object"!=typeof t[s][c]){a=!1;break}a&&(r=e(t[s],l))}0!=r.length&&(s=u(s));var i={name:s,nodes:r,value:l,active:!1};n.push(i)}return n.sort(function(e,t){var o=e.name,n=t.name;return o<n?-1:n<o?1:0}),n}(l.telemetry.data);l.dataloading=!1,angular.equals(o,l.previousTree)||(l.previousTree=angular.copy(o),l.dataTree=angular.copy(o)),0===l.searchID.length&&l.noresultsmsg.includes("No results found")&&(l.noresultsmsg="",l.previousTree=angular.copy(o),l.dataTree=angular.copy(o),l.dataloading=!1)}else l.dataTree=[],l.previousTree=angular.copy(l.dataTree),l.noresultsmsg="No Data available",l.dataloading=!1,0===l.searchID.length&&l.noresultsmsg.includes("No results found")&&(l.noresultsmsg="",l.dataTree=[],l.previousTree=angular.copy(l.dataTree),l.dataloading=!1);s.setMenuStatus(!1)}},1e3),l.selectData=function(e){if(s.getOpenLogo())0!=e.nodes.length&&(e.active=!e.active);else if(0==e.nodes.length)s.setVehicleInfo(e.value);else{for(var t=e.nodes,o=0,n=0;n<t.length;n++)0<t[n].nodes.length&&(o+=1);0==o?s.setVehicleInfo(e.value):s.setVehicleInfo(""),e.active=!e.active}},l.filter=function(e){13!==e.which&&"click"!==e.type||(l.dataTree=angular.copy(l.previousTree),l.dataTree=l.dataTree.filter(function e(t){var o=t.name.toLowerCase(),n=l.searchID.toLowerCase();return!!o.includes(n)||(t.nodes?(t.nodes=t.nodes.filter(e),t.nodes.length&&(t.active=!t.active),t.nodes.length):void 0)}),0==l.dataTree.length&&(l.noresultsmsg="No results found for "+l.searchID+" !",l.searchID=""))}}}),angular.module("app").component("grid",{templateUrl:"../components/grid/grid.html",controller:function(e,t){var o=this;o.gridsterOptions=e.gridsterOptions,o.dashboard=e.getDashboard(),o.loadStatus=t.getLoadStatus(),o.loadLayoutloaders=e.getGridLoader(),o.remove=function(e){e.main=!1,e.settings.active=!1,e.saveLoad=!1,e.delete=!0},o.openSettings=function(e){e.main=!1,e.settings.active=!0,e.saveLoad=!1,e.delete=!1},o.openSaveLoadSettings=function(e){e.main=!1,e.settings.active=!1,e.saveLoad=!0,e.delete=!1}}}),app.component("saveMenu",{bindings:{widget:"="},templateUrl:"../components/saveMenu/save.html",controller:function(){this.closeSaveLoadSettings=function(e){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1}}}),angular.module("app").component("statusIcons",{templateUrl:"./components/statusIcons/status_icons.html",controller:function(e,t){var o=this;o.satstatusIconColor="#12C700",o.gsstatusIconColor="#12C700",o.proxystatusIconColor="#12C700",o.dbstatusIconColor="#12C700",t.statusIcons=e.icons;var n={};t.$watch("statusIcons",function(e,t){"grey"===(n=e).sIcon&&"grey"===n.gIcon&&"grey"===n.pIcon&&"red"===n.dIcon?(o.satstatusIconColor="#CFCFD5",o.gsstatusIconColor="#CFCFD5",o.proxystatusIconColor="#CFCFD5",o.dbstatusIconColor="#FF0000"):"grey"===n.sIcon&&"red"===n.gIcon&&"green"===n.pIcon&&"blue"===n.dIcon?(o.satstatusIconColor="#CFCFD5",o.gsstatusIconColor="#FF0000",o.proxystatusIconColor="#12C700",o.dbstatusIconColor="#71A5BC"):"red"===n.sIcon&&"green"===n.gIcon&&"green"===n.pIcon&&"green"===n.dIcon?(o.satstatusIconColor="#FF0000",o.gsstatusIconColor="#12C700",o.proxystatusIconColor="#12C700",o.dbstatusIconColor="#12C700"):"grey"===n.sIcon&&"grey"===n.gIcon&&"red"===n.pIcon&&"green"===n.dIcon?(o.satstatusIconColor="#CFCFD5",o.gsstatusIconColor="#CFCFD5",o.proxystatusIconColor="#FF0000",o.dbstatusIconColor="#12C700"):"green"===n.sIcon&&"green"===n.gIcon&&"green"===n.pIcon&&"green"===n.dIcon&&(o.satstatusIconColor="#12C700",o.gsstatusIconColor="#12C700",o.proxystatusIconColor="#12C700",o.dbstatusIconColor="#12C700")},!0)}}),app.component("rightSidebar",{templateUrl:"./components/rightSidebar/right_sidebar.html",controller:function(o,t,n,s,r,e,a,l){var i=this;i.name=e.getUserName(),i.email=e.getUserEmail();var c=o.getDashboard();function u(){if(s.innerWidth<=1440)r("right").close();else{var e=t.getLock();e.lockRight=!e.lockRight,t.setRightLock(e.lockRight)}}s.innerWidth<=768?i.userRole={cRole:{name:"Observer",callsign:"VIP"}}:i.userRole=e.userRole,i.addWidget=function(){o.addWidget()},i.clear=function(){o.clear()},i.addWidgets=function(e){o.addWidgets(e)},i.widgetDefinitions=o.widgetDefinitions,i.QwidgetMenu=!1,i.addMenu=!1,i.showQwidgetMenu=function(){i.QwidgetMenu=!i.QwidgetMenu},i.showAddMenu=function(){i.addMenu=!i.addMenu},i.save=function(e){n({title:"Save Layout",input:!0,label:"Layout Name",value:c.current.name}).then(function(t){o.save(i.email,t).then(function(e){200==e.status&&(s.document.title="Quindar - "+t)})}).catch(function(e){})},i.load=function(){o.load(i.email).then(function(e){i.layouts=e.data,i.layoutMenu=!i.layoutMenu},function(e){})},i.showLayout=function(e){o.setGridLoader(!0),t.setLoadStatus(!1),o.showLayout(i.layouts,e),s.document.title="Quindar - "+e.name,u()},i.showDoc=function(){i.Doc=!i.Doc},i.showReadme=function(){a.open({templateUrl:"./components/rightSidebar/documentation.html",controller:"docController"}).result.then(function(e){},function(){}),u()},i.showContributing=function(){a.open({templateUrl:"./components/rightSidebar/contributing.html",controller:"docController"}).result.then(function(e){},function(){}),u()},i.showAdminModal=function(){u(),a.open({templateUrl:"./components/rightSidebar/adminModal.html",controller:"adminCtrl",controllerAs:"$ctrl",resolve:{mission:function(){return t.getCurrentMission()}}}).result.then(function(e){},function(){})}}}),app.controller("docController",["$scope","$uibModalInstance",function(e,t){e.close=function(){t.dismiss("cancel")}}]),app.controller("adminCtrl",["$scope","$filter","$uibModalInstance","userService","mission","$window",function(s,r,e,a,t,l){var i=this;i.users=[],i.roles=[],i.mission=t.missionName,s.saveSuccess=!1,a.getRoles().then(function(e){if(200==e.status){var t=e.data.roles;for(var o in t)t.hasOwnProperty(o)&&(t[o].checked=!1,"MD"!=o&&i.roles.push(t[o]))}}),a.getUsers(i.mission).then(function(e){if(200==e.status)for(var t=e.data,o=0;o<t.length;o++)t[o].currentRole&&"MD"!=t[o].currentRole.callsign&&i.users.push(t[o])}),i.close=function(){e.dismiss("cancel")},i.save=function(){if(i.selected)if(r("filter")(i.roles,{checked:!0}).length){for(var e=[],t={},o=0;o<i.roles.length;o++)if(1==i.roles[o].checked){var n=new Object;n.name=i.roles[o].name,n.callsign=i.roles[o].callsign,e.push(n),t[i.roles[o].callsign]=1}i.selected.user.allowedRoles=t,a.setAllowedRoles(i.selected.user,e,i.mission).then(function(e){200==e.status&&(s.saveSuccess=!0,s.successMessage="Success! Roles updated for user: "+i.selected.user.google.name)})}else l.alert("Please choose at least one role");else l.alert("Please select the user from dropdown menu")},s.$watch("$ctrl.selected.user",function(e,t){for(var o=0;o<i.roles.length;o++)i.selected.user.allowedRoles&&(i.roles[o].callsign in i.selected.user.allowedRoles?i.roles[o].checked=!0:i.roles[o].checked=!1)}),i.resetSuccessMessage=function(){s.saveSuccess=!1,s.successMessage=""}}]);