function gridService(t,e,n,r){var i=r.getUserEmail(),o={gridLoader:!1};!function(){e.dashboard&&null!==e.dashboard&&""!==e.dashboard||(e.dashboards={Home:{name:"Home",mission:{missionName:"",missionImage:""},widgets:[{col:0,row:0,sizeY:3,sizeX:4,name:"Line Plot",directive:"graph",directiveSettings:"linesettings",id:"addLine",icon:{id:"l-plot",type:"fa-line-chart"},main:!0,settings:{active:!1,data:{vehicles:[],value:"",key:""},dataArray:[]},saveLoad:!1,delete:!1},{col:4,row:0,sizeY:3,sizeX:4,name:"3D Model",directive:"satellite",directiveSettings:"satellitesettings",id:"satellite",icon:{id:"l-plot",type:"fa-cube"},main:!0,settings:{active:!1,dataArray:[],totalAttitudeArray:[],totalPositionArray:[]},saveLoad:!1,delete:!1}]}},e.dashboard={current:angular.copy(e.dashboards.Home)});n.document.title="Quindar - "+e.dashboard.current.name}();var a="Home";function s(t){r.setMissionForUser(i,t).then(function(t){r.userRole.cRole=t.data.currentRole})}function l(t){return"AZero"===t||"AudacyZero"===t||"Audacy Zero"===t||"A Zero"===t||"A0"===t?"/media/icons/AudacyZero_Logo_White.jpg":"/media/icons/Audacy_Icon_White.svg"}return{gridsterOptions:{margins:[20,20],columns:8,draggable:{enabled:!0,handle:".box-header"}},clear:function(){e.dashboard.current.widgets=[]},addWidget:function(){dashboards[a].widgets.push({name:"New Widget",sizeX:1,sizeY:1})},getDashboard:function(){return e.dashboard},getDashboardId:function(){return a},setDashboard:function(t){e.dashboard.current=t},setDashboardId:function(t){a=t},addWidgets:function(t){var n=angular.copy(t);e.dashboard.current.widgets.push(n)},widgetDefinitions:[{sizeY:3,sizeX:4,name:"Line Plot",directive:"graph",directiveSettings:"linesettings",id:"addLine",icon:{id:"l-plot",type:"fa-line-chart"},main:!0,settings:{active:!1,data:{vehicles:[],value:"",key:""},dataArray:[]},saveLoad:!1,delete:!1},{sizeY:3,sizeX:4,maxSizeY:3,name:"Data Table",directive:"datatable",directiveSettings:"datatablesettings",id:"datatable",icon:{id:"d-table",type:"fa-table"},main:!0,settings:{active:!1,checkedValues:{checkedId:!0,checkedAlow:!0,checkedWlow:!0,checkedValue:!0,checkedWhigh:!0,checkedAhigh:!0,checkedUnits:!0,checkedNotes:!0,checkedChannel:!1},data:[],previous:[],dataArray:[]},saveLoad:!1,delete:!1},{sizeY:3,sizeX:4,name:"3D Model",directive:"satellite",directiveSettings:"satellitesettings",id:"satellite",icon:{id:"l-plot",type:"fa-cube"},main:!0,settings:{active:!1,dataArray:[],totalAttitudeArray:[],totalPositionArray:[]},saveLoad:!1,delete:!1},{sizeY:3,sizeX:4,name:"Ground Track",directive:"groundtrack",directiveSettings:"groundtracksettings",id:"groundtrack",icon:{id:"g-track",type:"fa-globe"},main:!0,settings:{active:!1,vehicles:[],dataArray:[],totalPositionArray:[],totalVelocityArray:[]},saveLoad:!1,delete:!1},{sizeY:3,sizeX:4,name:"Clock",directive:"clock",directiveSettings:"clocksettings",id:"clock",icon:{id:"clock",type:"fa-clock-o"},main:!0,settings:{active:!1},saveLoad:!1,delete:!1},{sizeY:3,sizeX:4,name:"Data Log",directive:"datalog",directiveSettings:"datalogsettings",id:"datalog",icon:{id:"d-log",type:"fa-list-alt"},main:!0,settings:{active:!1,dataArray:[]},saveLoad:!1,delete:!1},{sizeY:3,sizeX:4,name:"Alarm Panel",directive:"alarmpanel",directiveSettings:"alarmpanelsettings",id:"alarmpanel",icon:{id:"alarm",type:"fa-tachometer"},main:!0,settings:{active:!1,statusboard:!0},saveLoad:!1,delete:!1},{sizeY:3,sizeX:8,name:"System Map",directive:"systemmap",directiveSettings:"systemmapsettings",id:"systemmap",icon:{id:"systemmap",type:"fa-map-o"},main:!0,settings:{active:!1},saveLoad:!1,delete:!1},{sizeY:3,sizeX:4,name:"Command",directive:"command",directiveSettings:"commandsettings",id:"command",icon:{id:"alarm",type:"fa-window-maximize"},main:!0,settings:{active:!1,commandlog:!0,dataArray:[]},saveLoad:!1,delete:!1},{sizeY:3,sizeX:8,name:"Timeline",directive:"timeLine",directiveSettings:"timelinesettings",id:"timeline",icon:{id:"timeline",type:"fa-tasks"},main:!0,settings:{active:!1},saveLoad:!1,delete:!1}],setMissionForLayout:function(t){if(e.dashboard.current.mission.missionName=t,""!==e.dashboard.current.mission.missionName){var n=l(e.dashboard.current.mission.missionName);e.dashboard.current.mission.missionImage=n}s(t)},setMissionForUser:s,remove:function(t){e.dashboard.current.widgets.splice(e.dashboard.current.widgets.indexOf(t),1)},save:function(n,r){return e.dashboard.current.name=r,t({url:"/saveLayout",method:"POST",data:{email:n,dashboard:e.dashboard.current}})},load:function(n){return t({url:"/loadLayout",method:"GET",params:{email:n,missionname:e.dashboard.current.mission.missionName}})},showLayout:function(t,n){for(var r=0;r<t.length;r++){var i=t[r].name;e.dashboards[i]=angular.copy(t[r])}e.dashboard.current=angular.copy(e.dashboards[n.name]),a=n.name},getMissionImage:l,loadMaps:function(){return t({url:"/loadSystemMaps",method:"GET",params:{mission:e.dashboard.current.mission.missionName}})},loadTimelineEvents:function(){return t({url:"/loadTimelineEvents",method:"GET",params:{mission:e.dashboard.current.mission.missionName}})},setGridLoader:function(t){o.gridLoader=t},getGridLoader:function(){return o}}}app.factory("commandService",["$http",function(t){return{saveCommand:function(e,n,r){return t({url:"/saveCommand",method:"POST",data:{email:e,command:n,mission:r}})},getCommandLog:function(e){return t({url:"/getCommandLog",method:"GET",params:{mission:e}})},getCommandList:function(e){return t({url:"/getCommandList",method:"GET",params:{mission:e}})}}}]),app.factory("d3Service",[function(){var t={},e=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},n=function(t){var n;return 1===t.length&&(n=t,t=function(t,r){return e(n(t),r)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}};var r=n(e),i=r.right,o=r.left,a=function(t){return null===t?NaN:+t},s=function(t,e){var n,r,i=t.length,o=0,s=0,l=-1,c=0;if(null==e)for(;++l<i;)isNaN(n=a(t[l]))||(s+=(r=n-o)*(n-(o+=r/++c)));else for(;++l<i;)isNaN(n=a(e(t[l],l,t)))||(s+=(r=n-o)*(n-(o+=r/++c)));if(c>1)return s/(c-1)},l=function(t,e){var n=s(t,e);return n?Math.sqrt(n):n},c=function(t,e){var n,r,i,o=-1,a=t.length;if(null==e){for(;++o<a;)if(null!=(r=t[o])&&r>=r){n=i=r;break}for(;++o<a;)null!=(r=t[o])&&(n>r&&(n=r),i<r&&(i=r))}else{for(;++o<a;)if(null!=(r=e(t[o],o,t))&&r>=r){n=i=r;break}for(;++o<a;)null!=(r=e(t[o],o,t))&&(n>r&&(n=r),i<r&&(i=r))}return[n,i]},u=Array.prototype,d=u.slice,h=u.map,f=function(t){return function(){return t}},g=function(t){return t},p=function(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(i);++r<i;)o[r]=t+r*n;return o},v=Math.sqrt(50),m=Math.sqrt(10),y=Math.sqrt(2),_=function(t,e,n){var r=w(t,e,n);return p(Math.ceil(t/r)*r,Math.floor(e/r)*r+r/2,r)};function w(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=v?i*=10:o>=m?i*=5:o>=y&&(i*=2),e<t?-i:i}var b=function(t){return Math.ceil(Math.log(t.length)/Math.LN2)+1},x=function(t,e,n){if(null==n&&(n=a),r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,o=Math.floor(i),s=+n(t[o],o,t);return s+(+n(t[o+1],o+1,t)-s)*(i-o)}},M=function(t){for(var e,n,r,i=t.length,o=-1,a=0;++o<i;)a+=t[o].length;for(n=new Array(a);--i>=0;)for(e=(r=t[i]).length;--e>=0;)n[--a]=r[e];return n},k=function(t,e){var n,r,i=-1,o=t.length;if(null==e){for(;++i<o;)if(null!=(r=t[i])&&r>=r){n=r;break}for(;++i<o;)null!=(r=t[i])&&n>r&&(n=r)}else{for(;++i<o;)if(null!=(r=e(t[i],i,t))&&r>=r){n=r;break}for(;++i<o;)null!=(r=e(t[i],i,t))&&n>r&&(n=r)}return n},S=function(t){if(!(i=t.length))return[];for(var e=-1,n=k(t,A),r=new Array(n);++e<n;)for(var i,o=-1,a=r[e]=new Array(i);++o<i;)a[o]=t[o][e];return r};function A(t){return t.length}function C(){}function E(t,e){var n=new C;if(t instanceof C)t.each(function(t,e){n.set(e,t)});else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==e)for(;++i<o;)n.set(i,t[i]);else for(;++i<o;)n.set(e(r=t[i],i,t),r)}else if(t)for(var a in t)n.set(a,t[a]);return n}C.prototype=E.prototype={constructor:C,has:function(t){return"$"+t in this},get:function(t){return this["$"+t]},set:function(t,e){return this["$"+t]=e,this},remove:function(t){var e="$"+t;return e in this&&delete this[e]},clear:function(){for(var t in this)"$"===t[0]&&delete this[t]},keys:function(){var t=[];for(var e in this)"$"===e[0]&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)"$"===e[0]&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)"$"===e[0]&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)"$"===e[0]&&++t;return t},empty:function(){for(var t in this)if("$"===t[0])return!1;return!0},each:function(t){for(var e in this)"$"===e[0]&&t(this[e],e.slice(1),this)}};function I(){return{}}function T(t,e,n){t[e]=n}function D(){return E()}function L(t,e,n){t.set(e,n)}function N(){}var B=E.prototype;function P(t,e){var n=new N;if(t instanceof N)t.each(function(t){n.add(t)});else if(t){var r=-1,i=t.length;if(null==e)for(;++r<i;)n.add(t[r]);else for(;++r<i;)n.add(e(t[r],r,t))}return n}N.prototype=P.prototype={constructor:N,has:B.has,add:function(t){return this["$"+(t+="")]=t,this},remove:B.remove,clear:B.clear,values:B.keys,size:B.size,empty:B.empty,each:B.each};var V=function(t,e){var n,r;return t=null==t?0:+t,e=null==e?1:+e,function(){var i;if(null!=n)i=n,n=null;else do{n=2*Math.random()-1,i=2*Math.random()-1,r=n*n+i*i}while(!r||r>1);return t+e*i*Math.sqrt(-2*Math.log(r)/r)}},z=function(t){return function(){for(var e=0,n=0;n<t;++n)e+=Math.random();return e}};function O(t){return((t*=2)<=1?t*t:--t*(2-t)+1)/2}function R(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var F=function t(e){function n(t){return Math.pow(t,e)}return e=+e,n.exponent=t,n}(3),U=function t(e){function n(t){return 1-Math.pow(1-t,e)}return e=+e,n.exponent=t,n}(3),q=function t(e){function n(t){return((t*=2)<=1?Math.pow(t,e):2-Math.pow(2-t,e))/2}return e=+e,n.exponent=t,n}(3),$=Math.PI,j=$/2;function H(t){return(1-Math.cos($*t))/2}function G(t){return((t*=2)<=1?Math.pow(2,10*t-10):2-Math.pow(2,10-10*t))/2}function W(t){return((t*=2)<=1?1-Math.sqrt(1-t*t):Math.sqrt(1-(t-=2)*t)+1)/2}var Y=4/11,X=6/11,Z=8/11,J=.75,Q=9/11,K=10/11,tt=.9375,et=21/22,nt=63/64,rt=1/Y/Y;function it(t){return(t=+t)<Y?rt*t*t:t<Z?rt*(t-=X)*t+J:t<K?rt*(t-=Q)*t+tt:rt*(t-=et)*t+nt}var ot=function t(e){function n(t){return t*t*((e+1)*t-e)}return e=+e,n.overshoot=t,n}(1.70158),at=function t(e){function n(t){return--t*t*((e+1)*t+e)+1}return e=+e,n.overshoot=t,n}(1.70158),st=function t(e){function n(t){return((t*=2)<1?t*t*((e+1)*t-e):(t-=2)*t*((e+1)*t+e)+2)/2}return e=+e,n.overshoot=t,n}(1.70158),lt=2*Math.PI,ct=function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=lt);function i(t){return e*Math.pow(2,10*--t)*Math.sin((r-t)/n)}return i.amplitude=function(e){return t(e,n*lt)},i.period=function(n){return t(e,n)},i}(1,.3),ut=function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=lt);function i(t){return 1-e*Math.pow(2,-10*(t=+t))*Math.sin((t+r)/n)}return i.amplitude=function(e){return t(e,n*lt)},i.period=function(n){return t(e,n)},i}(1,.3),dt=function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=lt);function i(t){return((t=2*t-1)<0?e*Math.pow(2,10*t)*Math.sin((r-t)/n):2-e*Math.pow(2,-10*t)*Math.sin((r+t)/n))/2}return i.amplitude=function(e){return t(e,n*lt)},i.period=function(n){return t(e,n)},i}(1,.3),ht=function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])};function ft(t,e){return t[0]-e[0]||t[1]-e[1]}function gt(t){for(var e=t.length,n=[0,1],r=2,i=2;i<e;++i){for(;r>1&&ht(t[n[r-2]],t[n[r-1]],t[i])<=0;)--r;n[r++]=i}return n.slice(0,r)}var pt=Math.PI,vt=2*pt,mt=vt-1e-6;function yt(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function _t(){return new yt}yt.prototype=_t.prototype={constructor:yt,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,i,o){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+o)},arcTo:function(t,e,n,r,i){t=+t,e=+e,n=+n,r=+r,i=+i;var o=this._x1,a=this._y1,s=n-t,l=r-e,c=o-t,u=a-e,d=c*c+u*u;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(d>1e-6)if(Math.abs(u*s-l*c)>1e-6&&i){var h=n-o,f=r-a,g=s*s+l*l,p=h*h+f*f,v=Math.sqrt(g),m=Math.sqrt(d),y=i*Math.tan((pt-Math.acos((g+d-p)/(2*v*m)))/2),_=y/m,w=y/v;Math.abs(_-1)>1e-6&&(this._+="L"+(t+_*c)+","+(e+_*u)),this._+="A"+i+","+i+",0,0,"+ +(u*h>c*f)+","+(this._x1=t+w*s)+","+(this._y1=e+w*l)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,r,i,o){t=+t,e=+e;var a=(n=+n)*Math.cos(r),s=n*Math.sin(r),l=t+a,c=e+s,u=1^o,d=o?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+c:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-c)>1e-6)&&(this._+="L"+l+","+c),n&&(d>mt?this._+="A"+n+","+n+",0,1,"+u+","+(t-a)+","+(e-s)+"A"+n+","+n+",0,1,"+u+","+(this._x1=l)+","+(this._y1=c):(d<0&&(d=d%vt+vt),this._+="A"+n+","+n+",0,"+ +(d>=pt)+","+u+","+(this._x1=t+n*Math.cos(i))+","+(this._y1=e+n*Math.sin(i))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};function wt(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,o,a,s,l,c,u,d,h,f=t._root,g={data:r},p=t._x0,v=t._y0,m=t._x1,y=t._y1;if(!f)return t._root=g,t;for(;f.length;)if((c=e>=(o=(p+m)/2))?p=o:m=o,(u=n>=(a=(v+y)/2))?v=a:y=a,i=f,!(f=f[d=u<<1|c]))return i[d]=g,t;if(s=+t._x.call(null,f.data),l=+t._y.call(null,f.data),e===s&&n===l)return g.next=f,i?i[d]=g:t._root=g,t;do{i=i?i[d]=new Array(4):t._root=new Array(4),(c=e>=(o=(p+m)/2))?p=o:m=o,(u=n>=(a=(v+y)/2))?v=a:y=a}while((d=u<<1|c)==(h=(l>=a)<<1|s>=o));return i[h]=f,i[d]=g,t}var bt=function(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i};function xt(t){return t[0]}function Mt(t){return t[1]}function kt(t,e,n){var r=new St(null==e?xt:e,null==n?Mt:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function St(t,e,n,r,i,o){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function At(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Ct=kt.prototype=St.prototype;Ct.copy=function(){var t,e,n=new St(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=At(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=At(e));return n},Ct.add=function(t){var e=+this._x.call(null,t),n=+this._y.call(null,t);return wt(this.cover(e,n),e,n,t)},Ct.addAll=function(t){var e,n,r,i,o=t.length,a=new Array(o),s=new Array(o),l=1/0,c=1/0,u=-1/0,d=-1/0;for(n=0;n<o;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(a[n]=r,s[n]=i,r<l&&(l=r),r>u&&(u=r),i<c&&(c=i),i>d&&(d=i));for(u<l&&(l=this._x0,u=this._x1),d<c&&(c=this._y0,d=this._y1),this.cover(l,c).cover(u,d),n=0;n<o;++n)wt(this,a[n],s[n],t[n]);return this},Ct.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,o=(r=Math.floor(e))+1;else{if(!(n>t||t>i||r>e||e>o))return this;var a,s,l=i-n,c=this._root;switch(s=(e<(r+o)/2)<<1|t<(n+i)/2){case 0:do{(a=new Array(4))[s]=c,c=a}while(o=r+(l*=2),t>(i=n+l)||e>o);break;case 1:do{(a=new Array(4))[s]=c,c=a}while(o=r+(l*=2),(n=i-l)>t||e>o);break;case 2:do{(a=new Array(4))[s]=c,c=a}while(r=o-(l*=2),t>(i=n+l)||r>e);break;case 3:do{(a=new Array(4))[s]=c,c=a}while(r=o-(l*=2),(n=i-l)>t||r>e)}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this},Ct.data=function(){var t=[];return this.visit(function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)}),t},Ct.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Ct.find=function(t,e,n){var r,i,o,a,s,l,c,u=this._x0,d=this._y0,h=this._x1,f=this._y1,g=[],p=this._root;for(p&&g.push(new bt(p,u,d,h,f)),null==n?n=1/0:(u=t-n,d=e-n,h=t+n,f=e+n,n*=n);l=g.pop();)if(!(!(p=l.node)||(i=l.x0)>h||(o=l.y0)>f||(a=l.x1)<u||(s=l.y1)<d))if(p.length){var v=(i+a)/2,m=(o+s)/2;g.push(new bt(p[3],v,m,a,s),new bt(p[2],i,m,v,s),new bt(p[1],v,o,a,m),new bt(p[0],i,o,v,m)),(c=(e>=m)<<1|t>=v)&&(l=g[g.length-1],g[g.length-1]=g[g.length-1-c],g[g.length-1-c]=l)}else{var y=t-+this._x.call(null,p.data),_=e-+this._y.call(null,p.data),w=y*y+_*_;if(w<n){var b=Math.sqrt(n=w);u=t-b,d=e-b,h=t+b,f=e+b,r=p.data}}return r},Ct.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,r,i,o,a,s,l,c,u,d,h,f=this._root,g=this._x0,p=this._y0,v=this._x1,m=this._y1;if(!f)return this;if(f.length)for(;;){if((c=o>=(s=(g+v)/2))?g=s:v=s,(u=a>=(l=(p+m)/2))?p=l:m=l,e=f,!(f=f[d=u<<1|c]))return this;if(!f.length)break;(e[d+1&3]||e[d+2&3]||e[d+3&3])&&(n=e,h=d)}for(;f.data!==t;)if(r=f,!(f=f.next))return this;return(i=f.next)&&delete f.next,r?(i?r.next=i:delete r.next,this):e?(i?e[d]=i:delete e[d],(f=e[0]||e[1]||e[2]||e[3])&&f===(e[3]||e[2]||e[1]||e[0])&&!f.length&&(n?n[h]=f:this._root=f),this):(this._root=i,this)},Ct.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Ct.root=function(){return this._root},Ct.size=function(){var t=0;return this.visit(function(e){if(!e.length)do{++t}while(e=e.next)}),t},Ct.visit=function(t){var e,n,r,i,o,a,s=[],l=this._root;for(l&&s.push(new bt(l,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(l=e.node,r=e.x0,i=e.y0,o=e.x1,a=e.y1)&&l.length){var c=(r+o)/2,u=(i+a)/2;(n=l[3])&&s.push(new bt(n,c,u,o,a)),(n=l[2])&&s.push(new bt(n,r,u,c,a)),(n=l[1])&&s.push(new bt(n,c,i,o,u)),(n=l[0])&&s.push(new bt(n,r,i,c,u))}return this},Ct.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new bt(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.y0,l=e.x1,c=e.y1,u=(a+l)/2,d=(s+c)/2;(o=i[0])&&n.push(new bt(o,a,s,u,d)),(o=i[1])&&n.push(new bt(o,u,s,l,d)),(o=i[2])&&n.push(new bt(o,a,d,u,c)),(o=i[3])&&n.push(new bt(o,u,d,l,c))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},Ct.x=function(t){return arguments.length?(this._x=t,this):this._x},Ct.y=function(t){return arguments.length?(this._y=t,this):this._y};var Et=[].slice,It={};function Tt(t){if(!(t>=1))throw new Error;this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}function Dt(t){if(!t._start)try{!function(t){for(;t._start=t._waiting&&t._active<t._size;){var e=t._ended+t._active,n=t._tasks[e],r=n.length-1,i=n[r];n[r]=Lt(t,e),--t._waiting,++t._active,n=i.apply(null,n),t._tasks[e]&&(t._tasks[e]=n||It)}}(t)}catch(e){if(t._tasks[t._ended+t._active-1])Nt(t,e);else if(!t._data)throw e}}function Lt(t,e){return function(n,r){t._tasks[e]&&(--t._active,++t._ended,t._tasks[e]=null,null==t._error&&(null!=n?Nt(t,n):(t._data[e]=r,t._waiting?Dt(t):Bt(t))))}}function Nt(t,e){var n,r=t._tasks.length;for(t._error=e,t._data=void 0,t._waiting=NaN;--r>=0;)if((n=t._tasks[r])&&(t._tasks[r]=null,n.abort))try{n.abort()}catch(e){}t._active=NaN,Bt(t)}function Bt(t){if(!t._active&&t._call){var e=t._data;t._data=void 0,t._call(t._error,e)}}function Pt(t){return new Tt(arguments.length?+t:1/0)}Tt.prototype=Pt.prototype={constructor:Tt,defer:function(t){if("function"!=typeof t||this._call)throw new Error;if(null!=this._error)return this;var e=Et.call(arguments,1);return e.push(t),++this._waiting,this._tasks.push(e),Dt(this),this},abort:function(){return null==this._error&&Nt(this,new Error("abort")),this},await:function(t){if("function"!=typeof t||this._call)throw new Error;return this._call=function(e,n){t.apply(null,[e].concat(n))},Bt(this),this},awaitAll:function(t){if("function"!=typeof t||this._call)throw new Error;return this._call=t,Bt(this),this}};var Vt=function(t){return function(){return t}},zt=1e-12,Ot=Math.PI,Rt=Ot/2,Ft=2*Ot;function Ut(t){return t.innerRadius}function qt(t){return t.outerRadius}function $t(t){return t.startAngle}function jt(t){return t.endAngle}function Ht(t){return t&&t.padAngle}function Gt(t){return t>=1?Rt:t<=-1?-Rt:Math.asin(t)}function Wt(t,e,n,r,i,o,a){var s=t-n,l=e-r,c=(a?o:-o)/Math.sqrt(s*s+l*l),u=c*l,d=-c*s,h=t+u,f=e+d,g=n+u,p=r+d,v=(h+g)/2,m=(f+p)/2,y=g-h,_=p-f,w=y*y+_*_,b=i-o,x=h*p-g*f,M=(_<0?-1:1)*Math.sqrt(Math.max(0,b*b*w-x*x)),k=(x*_-y*M)/w,S=(-x*y-_*M)/w,A=(x*_+y*M)/w,C=(-x*y+_*M)/w,E=k-v,I=S-m,T=A-v,D=C-m;return E*E+I*I>T*T+D*D&&(k=A,S=C),{cx:k,cy:S,x01:-u,y01:-d,x11:k*(i/b-1),y11:S*(i/b-1)}}function Yt(t){this._context=t}Yt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var Xt=function(t){return new Yt(t)};function Zt(t){return t[0]}function Jt(t){return t[1]}var Qt=function(){var t=Zt,e=Jt,n=Vt(!0),r=null,i=Xt,o=null;function a(a){var s,l,c,u=a.length,d=!1;for(null==r&&(o=i(c=_t())),s=0;s<=u;++s)!(s<u&&n(l=a[s],s,a))===d&&((d=!d)?o.lineStart():o.lineEnd()),d&&o.point(+t(l,s,a),+e(l,s,a));if(c)return o=null,c+""||null}return a.x=function(e){return arguments.length?(t="function"==typeof e?e:Vt(+e),a):t},a.y=function(t){return arguments.length?(e="function"==typeof t?t:Vt(+t),a):e},a.defined=function(t){return arguments.length?(n="function"==typeof t?t:Vt(!!t),a):n},a.curve=function(t){return arguments.length?(i=t,null!=r&&(o=i(r)),a):i},a.context=function(t){return arguments.length?(null==t?r=o=null:o=i(r=t),a):r},a},Kt=function(){var t=Zt,e=null,n=Vt(0),r=Jt,i=Vt(!0),o=null,a=Xt,s=null;function l(l){var c,u,d,h,f,g=l.length,p=!1,v=new Array(g),m=new Array(g);for(null==o&&(s=a(f=_t())),c=0;c<=g;++c){if(!(c<g&&i(h=l[c],c,l))===p)if(p=!p)u=c,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),d=c-1;d>=u;--d)s.point(v[d],m[d]);s.lineEnd(),s.areaEnd()}p&&(v[c]=+t(h,c,l),m[c]=+n(h,c,l),s.point(e?+e(h,c,l):v[c],r?+r(h,c,l):m[c]))}if(f)return s=null,f+""||null}function c(){return Qt().defined(i).curve(a).context(o)}return l.x=function(n){return arguments.length?(t="function"==typeof n?n:Vt(+n),e=null,l):t},l.x0=function(e){return arguments.length?(t="function"==typeof e?e:Vt(+e),l):t},l.x1=function(t){return arguments.length?(e=null==t?null:"function"==typeof t?t:Vt(+t),l):e},l.y=function(t){return arguments.length?(n="function"==typeof t?t:Vt(+t),r=null,l):n},l.y0=function(t){return arguments.length?(n="function"==typeof t?t:Vt(+t),l):n},l.y1=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:Vt(+t),l):r},l.lineX0=l.lineY0=function(){return c().x(t).y(n)},l.lineY1=function(){return c().x(t).y(r)},l.lineX1=function(){return c().x(e).y(n)},l.defined=function(t){return arguments.length?(i="function"==typeof t?t:Vt(!!t),l):i},l.curve=function(t){return arguments.length?(a=t,null!=o&&(s=a(o)),l):a},l.context=function(t){return arguments.length?(null==t?o=s=null:s=a(o=t),l):o},l},te=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},ee=function(t){return t},ne=ie(Xt);function re(t){this._curve=t}function ie(t){function e(e){return new re(t(e))}return e._curve=t,e}function oe(t){var e=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(t){return arguments.length?e(ie(t)):e()._curve},t}re.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}};var ae={draw:function(t,e){var n=Math.sqrt(e/Ot);t.moveTo(n,0),t.arc(0,0,n,0,Ft)}},se={draw:function(t,e){var n=Math.sqrt(e/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}},le=Math.sqrt(1/3),ce=2*le,ue={draw:function(t,e){var n=Math.sqrt(e/ce),r=n*le;t.moveTo(0,-n),t.lineTo(r,0),t.lineTo(0,n),t.lineTo(-r,0),t.closePath()}},de=Math.sin(Ot/10)/Math.sin(7*Ot/10),he=Math.sin(Ft/10)*de,fe=-Math.cos(Ft/10)*de,ge={draw:function(t,e){var n=Math.sqrt(.8908130915292852*e),r=he*n,i=fe*n;t.moveTo(0,-n),t.lineTo(r,i);for(var o=1;o<5;++o){var a=Ft*o/5,s=Math.cos(a),l=Math.sin(a);t.lineTo(l*n,-s*n),t.lineTo(s*r-l*i,l*r+s*i)}t.closePath()}},pe={draw:function(t,e){var n=Math.sqrt(e),r=-n/2;t.rect(r,r,n,n)}},ve=Math.sqrt(3),me={draw:function(t,e){var n=-Math.sqrt(e/(3*ve));t.moveTo(0,2*n),t.lineTo(-ve*n,-n),t.lineTo(ve*n,-n),t.closePath()}},ye=-.5,_e=Math.sqrt(3)/2,we=1/Math.sqrt(12),be=3*(we/2+1),xe={draw:function(t,e){var n=Math.sqrt(e/be),r=n/2,i=n*we,o=r,a=n*we+n,s=-o,l=a;t.moveTo(r,i),t.lineTo(o,a),t.lineTo(s,l),t.lineTo(ye*r-_e*i,_e*r+ye*i),t.lineTo(ye*o-_e*a,_e*o+ye*a),t.lineTo(ye*s-_e*l,_e*s+ye*l),t.lineTo(ye*r+_e*i,ye*i-_e*r),t.lineTo(ye*o+_e*a,ye*a-_e*o),t.lineTo(ye*s+_e*l,ye*l-_e*s),t.closePath()}},Me=[ae,se,ue,pe,ge,me,xe],ke=function(){};function Se(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function Ae(t){this._context=t}Ae.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Se(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Se(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Ce(t){this._context=t}Ce.prototype={areaStart:ke,areaEnd:ke,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:Se(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Ee(t){this._context=t}Ee.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Se(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Ie(t,e){this._basis=new Ae(t),this._beta=e}Ie.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var r,i=t[0],o=e[0],a=t[n]-i,s=e[n]-o,l=-1;++l<=n;)r=l/n,this._basis.point(this._beta*t[l]+(1-this._beta)*(i+r*a),this._beta*e[l]+(1-this._beta)*(o+r*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var Te=function t(e){function n(t){return 1===e?new Ae(t):new Ie(t,e)}return n.beta=function(e){return t(+e)},n}(.85);function De(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function Le(t,e){this._context=t,this._k=(1-e)/6}Le.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:De(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:De(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Ne=function t(e){function n(t){return new Le(t,e)}return n.tension=function(e){return t(+e)},n}(0);function Be(t,e){this._context=t,this._k=(1-e)/6}Be.prototype={areaStart:ke,areaEnd:ke,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:De(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Pe=function t(e){function n(t){return new Be(t,e)}return n.tension=function(e){return t(+e)},n}(0);function Ve(t,e){this._context=t,this._k=(1-e)/6}Ve.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:De(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var ze=function t(e){function n(t){return new Ve(t,e)}return n.tension=function(e){return t(+e)},n}(0);function Oe(t,e,n){var r=t._x1,i=t._y1,o=t._x2,a=t._y2;if(t._l01_a>zt){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,l=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/l,i=(i*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/l}if(t._l23_a>zt){var c=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,u=3*t._l23_a*(t._l23_a+t._l12_a);o=(o*c+t._x1*t._l23_2a-e*t._l12_2a)/u,a=(a*c+t._y1*t._l23_2a-n*t._l12_2a)/u}t._context.bezierCurveTo(r,i,o,a,t._x2,t._y2)}function Re(t,e){this._context=t,this._alpha=e}Re.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:Oe(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Fe=function t(e){function n(t){return e?new Re(t,e):new Le(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Ue(t,e){this._context=t,this._alpha=e}Ue.prototype={areaStart:ke,areaEnd:ke,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Oe(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var qe=function t(e){function n(t){return e?new Ue(t,e):new Be(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function $e(t,e){this._context=t,this._alpha=e}$e.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Oe(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var je=function t(e){function n(t){return e?new $e(t,e):new Ve(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function He(t){this._context=t}He.prototype={areaStart:ke,areaEnd:ke,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function Ge(t){return t<0?-1:1}function We(t,e,n){var r=t._x1-t._x0,i=e-t._x1,o=(t._y1-t._y0)/(r||i<0&&-0),a=(n-t._y1)/(i||r<0&&-0),s=(o*i+a*r)/(r+i);return(Ge(o)+Ge(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function Ye(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function Xe(t,e,n){var r=t._x0,i=t._y0,o=t._x1,a=t._y1,s=(o-r)/3;t._context.bezierCurveTo(r+s,i+s*e,o-s,a-s*n,o,a)}function Ze(t){this._context=t}function Je(t){this._context=new Qe(t)}function Qe(t){this._context=t}function Ke(t){this._context=t}function tn(t){var e,n,r=t.length-1,i=new Array(r),o=new Array(r),a=new Array(r);for(i[0]=0,o[0]=2,a[0]=t[0]+2*t[1],e=1;e<r-1;++e)i[e]=1,o[e]=4,a[e]=4*t[e]+2*t[e+1];for(i[r-1]=2,o[r-1]=7,a[r-1]=8*t[r-1]+t[r],e=1;e<r;++e)n=i[e]/o[e-1],o[e]-=n,a[e]-=n*a[e-1];for(i[r-1]=a[r-1]/o[r-1],e=r-2;e>=0;--e)i[e]=(a[e]-i[e+1])/o[e];for(o[r-1]=(t[r]+i[r-1])/2,e=0;e<r-1;++e)o[e]=2*t[e+1]-i[e+1];return[i,o]}Ze.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Xe(this,this._t0,Ye(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,Xe(this,Ye(this,n=We(this,t,e)),n);break;default:Xe(this,this._t0,n=We(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(Je.prototype=Object.create(Ze.prototype)).point=function(t,e){Ze.prototype.point.call(this,e,t)},Qe.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,i,o){this._context.bezierCurveTo(e,t,r,n,o,i)}},Ke.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var r=tn(t),i=tn(e),o=0,a=1;a<n;++o,++a)this._context.bezierCurveTo(r[0][o],i[0][o],r[1][o],i[1][o],t[a],e[a]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function en(t,e){this._context=t,this._t=e}en.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};var nn=Array.prototype.slice,rn=function(t,e){if((r=t.length)>1)for(var n,r,i=1,o=t[e[0]],a=o.length;i<r;++i){n=o,o=t[e[i]];for(var s=0;s<a;++s)o[s][1]+=o[s][0]=isNaN(n[s][1])?n[s][0]:n[s][1]}},on=function(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n};function an(t,e){return t[e]}var sn=function(t){var e=t.map(ln);return on(t).sort(function(t,n){return e[t]-e[n]})};function ln(t){for(var e,n=0,r=-1,i=t.length;++r<i;)(e=+t[r][1])&&(n+=e);return n}var cn=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t};function un(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function dn(){}var hn="\\s*([+-]?\\d+)\\s*",fn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",gn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",pn=/^#([0-9a-f]{3})$/,vn=/^#([0-9a-f]{6})$/,mn=new RegExp("^rgb\\("+[hn,hn,hn]+"\\)$"),yn=new RegExp("^rgb\\("+[gn,gn,gn]+"\\)$"),_n=new RegExp("^rgba\\("+[hn,hn,hn,fn]+"\\)$"),wn=new RegExp("^rgba\\("+[gn,gn,gn,fn]+"\\)$"),bn=new RegExp("^hsl\\("+[fn,gn,gn]+"\\)$"),xn=new RegExp("^hsla\\("+[fn,gn,gn,fn]+"\\)$"),Mn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function kn(t){var e;return t=(t+"").trim().toLowerCase(),(e=pn.exec(t))?new In((e=parseInt(e[1],16))>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):(e=vn.exec(t))?Sn(parseInt(e[1],16)):(e=mn.exec(t))?new In(e[1],e[2],e[3],1):(e=yn.exec(t))?new In(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=_n.exec(t))?An(e[1],e[2],e[3],e[4]):(e=wn.exec(t))?An(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=bn.exec(t))?Tn(e[1],e[2]/100,e[3]/100,1):(e=xn.exec(t))?Tn(e[1],e[2]/100,e[3]/100,e[4]):Mn.hasOwnProperty(t)?Sn(Mn[t]):"transparent"===t?new In(NaN,NaN,NaN,0):null}function Sn(t){return new In(t>>16&255,t>>8&255,255&t,1)}function An(t,e,n,r){return r<=0&&(t=e=n=NaN),new In(t,e,n,r)}function Cn(t){return t instanceof dn||(t=kn(t)),t?new In((t=t.rgb()).r,t.g,t.b,t.opacity):new In}function En(t,e,n,r){return 1===arguments.length?Cn(t):new In(t,e,n,null==r?1:r)}function In(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Tn(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Ln(t,e,n,r)}function Dn(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof Ln)return new Ln(t.h,t.s,t.l,t.opacity);if(t instanceof dn||(t=kn(t)),!t)return new Ln;if(t instanceof Ln)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,l=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=l<.5?o+i:2-o-i,a*=60):s=l>0&&l<1?0:a,new Ln(a,s,l,t.opacity)}(t):new Ln(t,e,n,null==r?1:r)}function Ln(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Nn(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}cn(dn,kn,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}}),cn(In,En,un(dn,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new In(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new In(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}})),cn(Ln,Dn,un(dn,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Ln(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Ln(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new In(Nn(t>=240?t-240:t+120,i,r),Nn(t,i,r),Nn(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var Bn=Math.PI/180,Pn=180/Math.PI,Vn=.95047,zn=1,On=1.08883,Rn=4/29,Fn=6/29,Un=3*Fn*Fn,qn=Fn*Fn*Fn;function $n(t){if(t instanceof Hn)return new Hn(t.l,t.a,t.b,t.opacity);if(t instanceof Jn){var e=t.h*Bn;return new Hn(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof In||(t=Cn(t));var n=Xn(t.r),r=Xn(t.g),i=Xn(t.b),o=Gn((.4124564*n+.3575761*r+.1804375*i)/Vn),a=Gn((.2126729*n+.7151522*r+.072175*i)/zn);return new Hn(116*a-16,500*(o-a),200*(a-Gn((.0193339*n+.119192*r+.9503041*i)/On)),t.opacity)}function jn(t,e,n,r){return 1===arguments.length?$n(t):new Hn(t,e,n,null==r?1:r)}function Hn(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function Gn(t){return t>qn?Math.pow(t,1/3):t/Un+Rn}function Wn(t){return t>Fn?t*t*t:Un*(t-Rn)}function Yn(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Xn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Zn(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof Jn)return new Jn(t.h,t.c,t.l,t.opacity);t instanceof Hn||(t=$n(t));var e=Math.atan2(t.b,t.a)*Pn;return new Jn(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}(t):new Jn(t,e,n,null==r?1:r)}function Jn(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}cn(Hn,jn,un(dn,{brighter:function(t){return new Hn(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Hn(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return t=zn*Wn(t),new In(Yn(3.2404542*(e=Vn*Wn(e))-1.5371385*t-.4985314*(n=On*Wn(n))),Yn(-.969266*e+1.8760108*t+.041556*n),Yn(.0556434*e-.2040259*t+1.0572252*n),this.opacity)}})),cn(Jn,Zn,un(dn,{brighter:function(t){return new Jn(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new Jn(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return $n(this).rgb()}}));var Qn=-.14861,Kn=1.78277,tr=-.29227,er=-.90649,nr=1.97294,rr=nr*er,ir=nr*Kn,or=Kn*tr-er*Qn;function ar(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof sr)return new sr(t.h,t.s,t.l,t.opacity);t instanceof In||(t=Cn(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(or*r+rr*e-ir*n)/(or+rr-ir),o=r-i,a=(nr*(n-i)-tr*o)/er,s=Math.sqrt(a*a+o*o)/(nr*i*(1-i)),l=s?Math.atan2(a,o)*Pn-120:NaN;return new sr(l<0?l+360:l,s,i,t.opacity)}(t):new sr(t,e,n,null==r?1:r)}function sr(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function lr(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}cn(sr,ar,un(dn,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new sr(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new sr(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*Bn,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new In(255*(e+n*(Qn*r+Kn*i)),255*(e+n*(tr*r+er*i)),255*(e+n*(nr*r)),this.opacity)}}));var cr=function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return lr((n-r/e)*e,a,i,o,s)}},ur=function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],s=t[(r+2)%e];return lr((n-r/e)*e,i,o,a,s)}},dr=function(t){return function(){return t}};function hr(t,e){return function(n){return t+n*e}}function fr(t,e){var n=e-t;return n?hr(t,n>180||n<-180?n-360*Math.round(n/360):n):dr(isNaN(t)?e:t)}function gr(t){return 1==(t=+t)?pr:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):dr(isNaN(e)?n:e)}}function pr(t,e){var n=e-t;return n?hr(t,n):dr(isNaN(t)?e:t)}var vr=function t(e){var n=gr(e);function r(t,e){var r=n((t=En(t)).r,(e=En(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=n(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function mr(t){return function(e){var n,r,i=e.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=En(e[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=t(o),a=t(a),s=t(s),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=s(t),r+""}}}var yr=mr(cr),_r=mr(ur),wr=function(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(r),a=new Array(r);for(n=0;n<i;++n)o[n]=Dr(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}},br=function(t,e){var n=new Date;return e-=t=+t,function(r){return n.setTime(t+e*r),n}},xr=function(t,e){return e-=t=+t,function(n){return t+e*n}},Mr=function(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=Dr(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}},kr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Sr=new RegExp(kr.source,"g");var Ar,Cr,Er,Ir,Tr=function(t,e){var n,r,i,o=kr.lastIndex=Sr.lastIndex=0,a=-1,s=[],l=[];for(t+="",e+="";(n=kr.exec(t))&&(r=Sr.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,l.push({i:a,x:xr(n,r)})),o=Sr.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,r=0;r<e;++r)s[(n=l[r]).i]=n.x(t);return s.join("")})},Dr=function(t,e){var n,r=typeof e;return null==e||"boolean"===r?dr(e):("number"===r?xr:"string"===r?(n=kn(e))?(e=n,vr):Tr:e instanceof kn?vr:e instanceof Date?br:Array.isArray(e)?wr:isNaN(e)?Mr:xr)(t,e)},Lr=function(t,e){return e-=t=+t,function(n){return Math.round(t+e*n)}},Nr=180/Math.PI,Br={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},Pr=function(t,e,n,r,i,o){var a,s,l;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),t*r<e*n&&(t=-t,e=-e,l=-l,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*Nr,skewX:Math.atan(l)*Nr,scaleX:a,scaleY:s}};function Vr(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(o,a){var s=[],l=[];return o=t(o),a=t(a),function(t,r,i,o,a,s){if(t!==i||r!==o){var l=a.push("translate(",null,e,null,n);s.push({i:l-4,x:xr(t,i)},{i:l-2,x:xr(r,o)})}else(i||o)&&a.push("translate("+i+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,l),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:xr(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(o.rotate,a.rotate,s,l),function(t,e,n,o){t!==e?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:xr(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(o.skewX,a.skewX,s,l),function(t,e,n,r,o,a){if(t!==n||e!==r){var s=o.push(i(o)+"scale(",null,",",null,")");a.push({i:s-4,x:xr(t,n)},{i:s-2,x:xr(e,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,l),o=a=null,function(t){for(var e,n=-1,r=l.length;++n<r;)s[(e=l[n]).i]=e.x(t);return s.join("")}}}var zr=Vr(function(t){return"none"===t?Br:(Ar||(Ar=document.createElement("DIV"),Cr=document.documentElement,Er=document.defaultView),Ar.style.transform=t,t=Er.getComputedStyle(Cr.appendChild(Ar),null).getPropertyValue("transform"),Cr.removeChild(Ar),t=t.slice(7,-1).split(","),Pr(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))},"px, ","px)","deg)"),Or=Vr(function(t){return null==t?Br:(Ir||(Ir=document.createElementNS("http://www.w3.org/2000/svg","g")),Ir.setAttribute("transform",t),(t=Ir.transform.baseVal.consolidate())?(t=t.matrix,Pr(t.a,t.b,t.c,t.d,t.e,t.f)):Br)},", ",")",")"),Rr=Math.SQRT2;function Fr(t){return((t=Math.exp(t))+1/t)/2}var Ur=function(t,e){var n,r,i=t[0],o=t[1],a=t[2],s=e[0],l=e[1],c=e[2],u=s-i,d=l-o,h=u*u+d*d;if(h<1e-12)r=Math.log(c/a)/Rr,n=function(t){return[i+t*u,o+t*d,a*Math.exp(Rr*t*r)]};else{var f=Math.sqrt(h),g=(c*c-a*a+4*h)/(2*a*2*f),p=(c*c-a*a-4*h)/(2*c*2*f),v=Math.log(Math.sqrt(g*g+1)-g),m=Math.log(Math.sqrt(p*p+1)-p);r=(m-v)/Rr,n=function(t){var e,n=t*r,s=Fr(v),l=a/(2*f)*(s*(e=Rr*n+v,((e=Math.exp(2*e))-1)/(e+1))-function(t){return((t=Math.exp(t))-1/t)/2}(v));return[i+l*u,o+l*d,a*s/Fr(Rr*n+v)]}}return n.duration=1e3*r,n};function qr(t){return function(e,n){var r=t((e=Dn(e)).h,(n=Dn(n)).h),i=pr(e.s,n.s),o=pr(e.l,n.l),a=pr(e.opacity,n.opacity);return function(t){return e.h=r(t),e.s=i(t),e.l=o(t),e.opacity=a(t),e+""}}}var $r=qr(fr),jr=qr(pr);function Hr(t){return function(e,n){var r=t((e=Zn(e)).h,(n=Zn(n)).h),i=pr(e.c,n.c),o=pr(e.l,n.l),a=pr(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=i(t),e.l=o(t),e.opacity=a(t),e+""}}}var Gr=Hr(fr),Wr=Hr(pr);function Yr(t){return function e(n){function r(e,r){var i=t((e=ar(e)).h,(r=ar(r)).h),o=pr(e.s,r.s),a=pr(e.l,r.l),s=pr(e.opacity,r.opacity);return function(t){return e.h=i(t),e.s=o(t),e.l=a(Math.pow(t,n)),e.opacity=s(t),e+""}}return n=+n,r.gamma=e,r}(1)}var Xr=Yr(fr),Zr=Yr(pr),Jr={value:function(){}};function Qr(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r)throw new Error("illegal type: "+t);r[t]=[]}return new Kr(r)}function Kr(t){this._=t}function ti(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function ei(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Jr,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}function ni(t){return new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}")}Kr.prototype=Qr.prototype={constructor:Kr,on:function(t,e){var n,r,i=this._,o=(r=i,(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),a=-1,s=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<s;)if(n=(t=o[a]).type)i[n]=ei(i[n],t.name,e);else if(null==e)for(n in i)i[n]=ei(i[n],t.name,null);return this}for(;++a<s;)if((n=(t=o[a]).type)&&(n=ti(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Kr(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var ri=function(t){var e=new RegExp('["'+t+"\n]"),n=t.charCodeAt(0);function r(t,e){var r,i,o={},a={},s=[],l=t.length,c=0,u=0;function d(){if(c>=l)return a;if(i)return i=!1,o;var e,r=c;if(34===t.charCodeAt(r)){for(var s=r;s++<l;)if(34===t.charCodeAt(s)){if(34!==t.charCodeAt(s+1))break;++s}return c=s+2,13===(e=t.charCodeAt(s+1))?(i=!0,10===t.charCodeAt(s+2)&&++c):10===e&&(i=!0),t.slice(r+1,s).replace(/""/g,'"')}for(;c<l;){var u=1;if(10===(e=t.charCodeAt(c++)))i=!0;else if(13===e)i=!0,10===t.charCodeAt(c)&&(++c,++u);else if(e!==n)continue;return t.slice(r,c-u)}return t.slice(r)}for(;(r=d())!==a;){for(var h=[];r!==o&&r!==a;)h.push(r),r=d();e&&null==(h=e(h,u++))||s.push(h)}return s}function i(e){return e.map(o).join(t)}function o(t){return null==t?"":e.test(t+="")?'"'+t.replace(/\"/g,'""')+'"':t}return{parse:function(t,e){var n,i,o=r(t,function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=ni(t);return function(r,i){return e(n(r),i,t)}}(t,e):ni(t)});return o.columns=i,o},parseRows:r,format:function(e,n){return null==n&&(n=function(t){var e=Object.create(null),n=[];return t.forEach(function(t){for(var r in t)r in e||n.push(e[r]=r)}),n}(e)),[n.map(o).join(t)].concat(e.map(function(e){return n.map(function(t){return o(e[t])}).join(t)})).join("\n")},formatRows:function(t){return t.map(i).join("\n")}}},ii=ri(","),oi=ii.parse,ai=ii.parseRows,si=ii.format,li=ii.formatRows,ci=ri("\t"),ui=ci.parse,di=ci.parseRows,hi=ci.format,fi=ci.formatRows,gi=function(t,e){var n,r,i,o,a=Qr("beforesend","progress","load","error"),s=E(),l=new XMLHttpRequest,c=null,u=null,d=0;function h(t){var e,r=l.status;if(!r&&function(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}(l)||r>=200&&r<300||304===r){if(i)try{e=i.call(n,l)}catch(t){return void a.call("error",n,t)}else e=l;a.call("load",n,e)}else a.call("error",n,t)}if("undefined"==typeof XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(t)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=l.ontimeout=h:l.onreadystatechange=function(t){l.readyState>3&&h(t)},l.onprogress=function(t){a.call("progress",n,t)},n={header:function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?s.get(t):(null==e?s.remove(t):s.set(t,e+""),n)},mimeType:function(t){return arguments.length?(r=null==t?null:t+"",n):r},responseType:function(t){return arguments.length?(o=t,n):o},timeout:function(t){return arguments.length?(d=+t,n):d},user:function(t){return arguments.length<1?c:(c=null==t?null:t+"",n)},password:function(t){return arguments.length<1?u:(u=null==t?null:t+"",n)},response:function(t){return i=t,n},get:function(t,e){return n.send("GET",t,e)},post:function(t,e){return n.send("POST",t,e)},send:function(e,i,h){return l.open(e,t,!0,c,u),null==r||s.has("accept")||s.set("accept",r+",*/*"),l.setRequestHeader&&s.each(function(t,e){l.setRequestHeader(e,t)}),null!=r&&l.overrideMimeType&&l.overrideMimeType(r),null!=o&&(l.responseType=o),d>0&&(l.timeout=d),null==h&&"function"==typeof i&&(h=i,i=null),null!=h&&1===h.length&&(h=function(t){return function(e,n){t(null==e?n:null)}}(h)),null!=h&&n.on("error",h).on("load",function(t){h(null,t)}),a.call("beforesend",n,l),l.send(null==i?null:i),n},abort:function(){return l.abort(),n},on:function(){var t=a.on.apply(a,arguments);return t===a?n:t}},null!=e){if("function"!=typeof e)throw new Error("invalid callback: "+e);return n.get(e)}return n};var pi=function(t,e){return function(n,r){var i=gi(n).mimeType(t).response(e);if(null!=r){if("function"!=typeof r)throw new Error("invalid callback: "+r);return i.get(r)}return i}},vi=pi("text/html",function(t){return document.createRange().createContextualFragment(t.responseText)}),mi=pi("application/json",function(t){return JSON.parse(t.responseText)}),yi=pi("text/plain",function(t){return t.responseText}),_i=pi("application/xml",function(t){var e=t.responseXML;if(!e)throw new Error("parse error");return e}),wi=function(t,e){return function(n,r,i){arguments.length<3&&(i=r,r=null);var o=gi(n).mimeType(t);return o.row=function(t){return arguments.length?o.response(function(t,e){return function(n){return t(n.responseText,e)}}(e,r=t)):r},o.row(r),i?o.get(i):o}};var bi,xi,Mi=wi("text/csv",oi),ki=wi("text/tab-separated-values",ui),Si=0,Ai=0,Ci=0,Ei=1e3,Ii=0,Ti=0,Di=0,Li="object"==typeof performance&&performance.now?performance:Date,Ni="function"==typeof requestAnimationFrame?requestAnimationFrame:function(t){setTimeout(t,17)};function Bi(){return Ti||(Ni(Pi),Ti=Li.now()+Di)}function Pi(){Ti=0}function Vi(){this._call=this._time=this._next=null}function zi(t,e,n){var r=new Vi;return r.restart(t,e,n),r}function Oi(){Bi(),++Si;for(var t,e=bi;e;)(t=Ti-e._time)>=0&&e._call.call(null,t),e=e._next;--Si}function Ri(){Ti=(Ii=Li.now())+Di,Si=Ai=0;try{Oi()}finally{Si=0,function(){var t,e,n=bi,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:bi=e);xi=t,Ui(r)}(),Ti=0}}function Fi(){var t=Li.now(),e=t-Ii;e>Ei&&(Di-=e,Ii=t)}function Ui(t){if(!Si){Ai&&(Ai=clearTimeout(Ai));var e=t-Ti;e>24?(t<1/0&&(Ai=setTimeout(Ri,e)),Ci&&(Ci=clearInterval(Ci))):(Ci||(Ci=setInterval(Fi,Ei)),Si=1,Ni(Ri))}}Vi.prototype=zi.prototype={constructor:Vi,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Bi():+n)+(null==e?0:+e),this._next||xi===this||(xi?xi._next=this:bi=this,xi=this),this._call=t,this._time=n,Ui()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ui())}};var qi=function(t,e,n){var r=new Vi;return e=null==e?0:+e,r.restart(function(n){r.stop(),t(n+e)},e,n),r},$i=new Date,ji=new Date;function Hi(t,e,n,r){function i(e){return t(e=new Date(+e)),e}return i.floor=i,i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,o){var a=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return a;do{a.push(new Date(+n))}while(e(n,o),t(n),n<r);return a},i.filter=function(n){return Hi(function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)},function(t,r){if(t>=t)for(;--r>=0;)for(;e(t,1),!n(t););})},n&&(i.count=function(e,r){return $i.setTime(+e),ji.setTime(+r),t($i),t(ji),Math.floor(n($i,ji))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var Gi=Hi(function(){},function(t,e){t.setTime(+t+e)},function(t,e){return e-t});Gi.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?Hi(function(e){e.setTime(Math.floor(e/t)*t)},function(e,n){e.setTime(+e+n*t)},function(e,n){return(n-e)/t}):Gi:null};var Wi=Gi.range,Yi=6e4,Xi=6048e5,Zi=Hi(function(t){t.setTime(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(+t+1e3*e)},function(t,e){return(e-t)/1e3},function(t){return t.getUTCSeconds()}),Ji=Zi.range,Qi=Hi(function(t){t.setTime(Math.floor(t/Yi)*Yi)},function(t,e){t.setTime(+t+e*Yi)},function(t,e){return(e-t)/Yi},function(t){return t.getMinutes()}),Ki=Qi.range,to=Hi(function(t){var e=t.getTimezoneOffset()*Yi%36e5;e<0&&(e+=36e5),t.setTime(36e5*Math.floor((+t-e)/36e5)+e)},function(t,e){t.setTime(+t+36e5*e)},function(t,e){return(e-t)/36e5},function(t){return t.getHours()}),eo=to.range,no=Hi(function(t){t.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Yi)/864e5},function(t){return t.getDate()-1}),ro=no.range;function io(t){return Hi(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+7*e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Yi)/Xi})}var oo=io(0),ao=io(1),so=io(2),lo=io(3),co=io(4),uo=io(5),ho=io(6),fo=oo.range,go=ao.range,po=so.range,vo=lo.range,mo=co.range,yo=uo.range,_o=ho.range,wo=Hi(function(t){t.setDate(1),t.setHours(0,0,0,0)},function(t,e){t.setMonth(t.getMonth()+e)},function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())},function(t){return t.getMonth()}),bo=wo.range,xo=Hi(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t,e){return e.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});xo.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Hi(function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,n){e.setFullYear(e.getFullYear()+n*t)}):null};var Mo=xo.range,ko=Hi(function(t){t.setUTCSeconds(0,0)},function(t,e){t.setTime(+t+e*Yi)},function(t,e){return(e-t)/Yi},function(t){return t.getUTCMinutes()}),So=ko.range,Ao=Hi(function(t){t.setUTCMinutes(0,0,0)},function(t,e){t.setTime(+t+36e5*e)},function(t,e){return(e-t)/36e5},function(t){return t.getUTCHours()}),Co=Ao.range,Eo=Hi(function(t){t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+e)},function(t,e){return(e-t)/864e5},function(t){return t.getUTCDate()-1}),Io=Eo.range;function To(t){return Hi(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+7*e)},function(t,e){return(e-t)/Xi})}var Do=To(0),Lo=To(1),No=To(2),Bo=To(3),Po=To(4),Vo=To(5),zo=To(6),Oo=Do.range,Ro=Lo.range,Fo=No.range,Uo=Bo.range,qo=Po.range,$o=Vo.range,jo=zo.range,Ho=Hi(function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCMonth(t.getUTCMonth()+e)},function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())},function(t){return t.getUTCMonth()}),Go=Ho.range,Wo=Hi(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)},function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()});Wo.every=function(t){return isFinite(t=Math.floor(t))&&t>0?Hi(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)}):null};var Yo,Xo=Wo.range,Zo=function(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]},Jo=function(t){return(t=Zo(Math.abs(t)))?t[1]:NaN},Qo=function(t,e){var n=Zo(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")},Ko={"":function(t,e){t:for(var n,r=(t=t.toPrecision(e)).length,i=1,o=-1;i<r;++i)switch(t[i]){case".":o=n=i;break;case"0":0===o&&(o=i),n=i;break;case"e":break t;default:o>0&&(o=0)}return o>0?t.slice(0,o)+t.slice(n+1):t},"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return Qo(100*t,e)},r:Qo,s:function(t,e){var n=Zo(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(Yo=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Zo(t,Math.max(0,e+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}},ta=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i,ea=function(t){return new na(t)};function na(t){if(!(e=ta.exec(t)))throw new Error("invalid format: "+t);var e,n=e[1]||" ",r=e[2]||">",i=e[3]||"-",o=e[4]||"",a=!!e[5],s=e[6]&&+e[6],l=!!e[7],c=e[8]&&+e[8].slice(1),u=e[9]||"";"n"===u?(l=!0,u="g"):Ko[u]||(u=""),(a||"0"===n&&"="===r)&&(a=!0,n="0",r="="),this.fill=n,this.align=r,this.sign=i,this.symbol=o,this.zero=a,this.width=s,this.comma=l,this.precision=c,this.type=u}na.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+this.type};var ra=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function ia(t){return t}var oa,aa=function(t){var e,n,r=t.grouping&&t.thousands?(e=t.grouping,n=t.thousands,function(t,r){for(var i=t.length,o=[],a=0,s=e[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),o.push(t.substring(i-=s,i+s)),!((l+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}):ia,i=t.currency,o=t.decimal;function a(t){var e=(t=ea(t)).fill,n=t.align,a=t.sign,s=t.symbol,l=t.zero,c=t.width,u=t.comma,d=t.precision,h=t.type,f="$"===s?i[0]:"#"===s&&/[boxX]/.test(h)?"0"+h.toLowerCase():"",g="$"===s?i[1]:/[%p]/.test(h)?"%":"",p=Ko[h],v=!h||/[defgprs%]/.test(h);function m(t){var i,s,m,y=f,_=g;if("c"===h)_=p(t)+_,t="";else{var w=((t=+t)<0||1/t<0)&&(t*=-1,!0);if(t=p(t,d),w)for(i=-1,s=t.length,w=!1;++i<s;)if(48<(m=t.charCodeAt(i))&&m<58||"x"===h&&96<m&&m<103||"X"===h&&64<m&&m<71){w=!0;break}if(y=(w?"("===a?a:"-":"-"===a||"("===a?"":a)+y,_=_+("s"===h?ra[8+Yo/3]:"")+(w&&"("===a?")":""),v)for(i=-1,s=t.length;++i<s;)if(48>(m=t.charCodeAt(i))||m>57){_=(46===m?o+t.slice(i+1):t.slice(i))+_,t=t.slice(0,i);break}}u&&!l&&(t=r(t,1/0));var b=y.length+t.length+_.length,x=b<c?new Array(c-b+1).join(e):"";switch(u&&l&&(t=r(x+t,x.length?c-_.length:1/0),x=""),n){case"<":return y+t+_+x;case"=":return y+x+t+_;case"^":return x.slice(0,b=x.length>>1)+y+t+_+x.slice(b)}return x+y+t+_}return d=null==d?h?6:12:/[gprs]/.test(h)?Math.max(1,Math.min(21,d)):Math.max(0,Math.min(20,d)),m.toString=function(){return t+""},m}return{format:a,formatPrefix:function(t,e){var n=a(((t=ea(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Jo(e)/3))),i=Math.pow(10,-r),o=ra[8+r/3];return function(t){return n(i*t)+o}}}};function sa(e){return oa=aa(e),t.format=oa.format,t.formatPrefix=oa.formatPrefix,oa}sa({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var la=function(t){return Math.max(0,-Jo(Math.abs(t)))},ca=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Jo(e)/3)))-Jo(Math.abs(t)))},ua=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Jo(e)-Jo(t))+1};function da(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function ha(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function fa(t){return{y:t,m:0,d:1,H:0,M:0,S:0,L:0}}function ga(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,s=t.months,l=t.shortMonths,c=xa(i),u=Ma(i),d=xa(o),h=Ma(o),f=xa(a),g=Ma(a),p=xa(s),v=Ma(s),m=xa(l),y=Ma(l),_={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return l[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:Oa,e:Oa,H:Ra,I:Fa,j:Ua,L:qa,m:$a,M:ja,p:function(t){return i[+(t.getHours()>=12)]},S:Ha,U:Ga,w:Wa,W:Ya,x:null,X:null,y:Xa,Y:Za,Z:Ja,"%":hs},w={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return l[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:Qa,e:Qa,H:Ka,I:ts,j:es,L:ns,m:rs,M:is,p:function(t){return i[+(t.getUTCHours()>=12)]},S:os,U:as,w:ss,W:ls,x:null,X:null,y:cs,Y:us,Z:ds,"%":hs},b={a:function(t,e,n){var r=f.exec(e.slice(n));return r?(t.w=g[r[0].toLowerCase()],n+r[0].length):-1},A:function(t,e,n){var r=d.exec(e.slice(n));return r?(t.w=h[r[0].toLowerCase()],n+r[0].length):-1},b:function(t,e,n){var r=m.exec(e.slice(n));return r?(t.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(t,e,n){var r=p.exec(e.slice(n));return r?(t.m=v[r[0].toLowerCase()],n+r[0].length):-1},c:function(t,n,r){return k(t,e,n,r)},d:Da,e:Da,H:Na,I:Na,j:La,L:Va,m:Ta,M:Ba,p:function(t,e,n){var r=c.exec(e.slice(n));return r?(t.p=u[r[0].toLowerCase()],n+r[0].length):-1},S:Pa,U:Sa,w:ka,W:Aa,x:function(t,e,r){return k(t,n,e,r)},X:function(t,e,n){return k(t,r,e,n)},y:Ea,Y:Ca,Z:Ia,"%":za};function x(t,e){return function(n){var r,i,o,a=[],s=-1,l=0,c=t.length;for(n instanceof Date||(n=new Date(+n));++s<c;)37===t.charCodeAt(s)&&(a.push(t.slice(l,s)),null!=(i=va[r=t.charAt(++s)])?r=t.charAt(++s):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),l=s+1);return a.push(t.slice(l,s)),a.join("")}}function M(t,e){return function(n){var r=fa(1900);if(k(r,t,n+="",0)!=n.length)return null;if("p"in r&&(r.H=r.H%12+12*r.p),"W"in r||"U"in r){"w"in r||(r.w="W"in r?1:0);var i="Z"in r?ha(fa(r.y)).getUTCDay():e(fa(r.y)).getDay();r.m=0,r.d="W"in r?(r.w+6)%7+7*r.W-(i+5)%7:r.w+7*r.U-(i+6)%7}return"Z"in r?(r.H+=r.Z/100|0,r.M+=r.Z%100,ha(r)):e(r)}}function k(t,e,n,r){for(var i,o,a=0,s=e.length,l=n.length;a<s;){if(r>=l)return-1;if(37===(i=e.charCodeAt(a++))){if(i=e.charAt(a++),!(o=b[i in va?e.charAt(a++):i])||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=x(n,_),_.X=x(r,_),_.c=x(e,_),w.x=x(n,w),w.X=x(r,w),w.c=x(e,w),{format:function(t){var e=x(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=M(t+="",da);return e.toString=function(){return t},e},utcFormat:function(t){var e=x(t+="",w);return e.toString=function(){return t},e},utcParse:function(t){var e=M(t,ha);return e.toString=function(){return t},e}}}var pa,va={"-":"",_:" ",0:"0"},ma=/^\s*\d+/,ya=/^%/,_a=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;function wa(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function ba(t){return t.replace(_a,"\\$&")}function xa(t){return new RegExp("^(?:"+t.map(ba).join("|")+")","i")}function Ma(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function ka(t,e,n){var r=ma.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function Sa(t,e,n){var r=ma.exec(e.slice(n));return r?(t.U=+r[0],n+r[0].length):-1}function Aa(t,e,n){var r=ma.exec(e.slice(n));return r?(t.W=+r[0],n+r[0].length):-1}function Ca(t,e,n){var r=ma.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function Ea(t,e,n){var r=ma.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Ia(t,e,n){var r=/^(Z)|([+-]\d\d)(?:\:?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Ta(t,e,n){var r=ma.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function Da(t,e,n){var r=ma.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function La(t,e,n){var r=ma.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function Na(t,e,n){var r=ma.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Ba(t,e,n){var r=ma.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function Pa(t,e,n){var r=ma.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function Va(t,e,n){var r=ma.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function za(t,e,n){var r=ya.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function Oa(t,e){return wa(t.getDate(),e,2)}function Ra(t,e){return wa(t.getHours(),e,2)}function Fa(t,e){return wa(t.getHours()%12||12,e,2)}function Ua(t,e){return wa(1+no.count(xo(t),t),e,3)}function qa(t,e){return wa(t.getMilliseconds(),e,3)}function $a(t,e){return wa(t.getMonth()+1,e,2)}function ja(t,e){return wa(t.getMinutes(),e,2)}function Ha(t,e){return wa(t.getSeconds(),e,2)}function Ga(t,e){return wa(oo.count(xo(t),t),e,2)}function Wa(t){return t.getDay()}function Ya(t,e){return wa(ao.count(xo(t),t),e,2)}function Xa(t,e){return wa(t.getFullYear()%100,e,2)}function Za(t,e){return wa(t.getFullYear()%1e4,e,4)}function Ja(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+wa(e/60|0,"0",2)+wa(e%60,"0",2)}function Qa(t,e){return wa(t.getUTCDate(),e,2)}function Ka(t,e){return wa(t.getUTCHours(),e,2)}function ts(t,e){return wa(t.getUTCHours()%12||12,e,2)}function es(t,e){return wa(1+Eo.count(Wo(t),t),e,3)}function ns(t,e){return wa(t.getUTCMilliseconds(),e,3)}function rs(t,e){return wa(t.getUTCMonth()+1,e,2)}function is(t,e){return wa(t.getUTCMinutes(),e,2)}function os(t,e){return wa(t.getUTCSeconds(),e,2)}function as(t,e){return wa(Do.count(Wo(t),t),e,2)}function ss(t){return t.getUTCDay()}function ls(t,e){return wa(Lo.count(Wo(t),t),e,2)}function cs(t,e){return wa(t.getUTCFullYear()%100,e,2)}function us(t,e){return wa(t.getUTCFullYear()%1e4,e,4)}function ds(){return"+0000"}function hs(){return"%"}function fs(e){return pa=ga(e),t.timeFormat=pa.format,t.timeParse=pa.parse,t.utcFormat=pa.utcFormat,t.utcParse=pa.utcParse,pa}fs({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var gs=Date.prototype.toISOString?function(t){return t.toISOString()}:t.utcFormat("%Y-%m-%dT%H:%M:%S.%LZ");var ps=+new Date("2000-01-01T00:00:00.000Z")?function(t){var e=new Date(t);return isNaN(e)?null:e}:t.utcParse("%Y-%m-%dT%H:%M:%S.%LZ"),vs=Array.prototype,ms=vs.map,ys=vs.slice,_s={name:"implicit"};function ws(t){var e=E(),n=[],r=_s;function i(i){var o=i+"",a=e.get(o);if(!a){if(r!==_s)return r;e.set(o,a=n.push(i))}return t[(a-1)%t.length]}return t=null==t?[]:ys.call(t),i.domain=function(t){if(!arguments.length)return n.slice();n=[],e=E();for(var r,o,a=-1,s=t.length;++a<s;)e.has(o=(r=t[a])+"")||e.set(o,n.push(r));return i},i.range=function(e){return arguments.length?(t=ys.call(e),i):t.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return ws().domain(n).range(t).unknown(r)},i}function bs(){var t,e,n=ws().unknown(void 0),r=n.domain,i=n.range,o=[0,1],a=!1,s=0,l=0,c=.5;function u(){var n=r().length,u=o[1]<o[0],d=o[u-0],h=o[1-u];t=(h-d)/Math.max(1,n-s+2*l),a&&(t=Math.floor(t)),d+=(h-d-t*(n-s))*c,e=t*(1-s),a&&(d=Math.round(d),e=Math.round(e));var f=p(n).map(function(e){return d+t*e});return i(u?f.reverse():f)}return delete n.unknown,n.domain=function(t){return arguments.length?(r(t),u()):r()},n.range=function(t){return arguments.length?(o=[+t[0],+t[1]],u()):o.slice()},n.rangeRound=function(t){return o=[+t[0],+t[1]],a=!0,u()},n.bandwidth=function(){return e},n.step=function(){return t},n.round=function(t){return arguments.length?(a=!!t,u()):a},n.padding=function(t){return arguments.length?(s=l=Math.max(0,Math.min(1,t)),u()):s},n.paddingInner=function(t){return arguments.length?(s=Math.max(0,Math.min(1,t)),u()):s},n.paddingOuter=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),u()):l},n.align=function(t){return arguments.length?(c=Math.max(0,Math.min(1,t)),u()):c},n.copy=function(){return bs().domain(r()).range(o).round(a).paddingInner(s).paddingOuter(l).align(c)},u()}var xs=function(t){return function(){return t}},Ms=function(t){return+t},ks=[0,1];function Ss(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:xs(e)}function As(t,e,n,r){var i=t[0],o=t[1],a=e[0],s=e[1];return o<i?(i=n(o,i),a=r(s,a)):(i=n(i,o),a=r(a,s)),function(t){return a(i(t))}}function Cs(t,e,n,r){var o=Math.min(t.length,e.length)-1,a=new Array(o),s=new Array(o),l=-1;for(t[o]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++l<o;)a[l]=n(t[l],t[l+1]),s[l]=r(e[l],e[l+1]);return function(e){var n=i(t,e,1,o)-1;return s[n](a[n](e))}}function Es(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp())}function Is(t,e){var n,r,i,o=ks,a=ks,s=Dr,l=!1;function c(){return n=Math.min(o.length,a.length)>2?Cs:As,r=i=null,u}function u(e){return(r||(r=n(o,a,l?function(t){return function(e,n){var r=t(e=+e,n=+n);return function(t){return t<=e?0:t>=n?1:r(t)}}}(t):t,s)))(+e)}return u.invert=function(t){return(i||(i=n(a,o,Ss,l?function(t){return function(e,n){var r=t(e=+e,n=+n);return function(t){return t<=0?e:t>=1?n:r(t)}}}(e):e)))(+t)},u.domain=function(t){return arguments.length?(o=ms.call(t,Ms),c()):o.slice()},u.range=function(t){return arguments.length?(a=ys.call(t),c()):a.slice()},u.rangeRound=function(t){return a=ys.call(t),s=Lr,c()},u.clamp=function(t){return arguments.length?(l=!!t,c()):l},u.interpolate=function(t){return arguments.length?(s=t,c()):s},c()}var Ts=function(e,n,r){var i,o=e[0],a=e[e.length-1],s=w(o,a,null==n?10:n);switch((r=ea(null==r?",f":r)).type){case"s":var l=Math.max(Math.abs(o),Math.abs(a));return null!=r.precision||isNaN(i=ca(s,l))||(r.precision=i),t.formatPrefix(r,l);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=ua(s,Math.max(Math.abs(o),Math.abs(a))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=la(s))||(r.precision=i-2*("%"===r.type))}return t.format(r)};function Ds(t){var e=t.domain;return t.ticks=function(t){var n=e();return _(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){return Ts(e(),t,n)},t.nice=function(n){var r=e(),i=r.length-1,o=null==n?10:n,a=r[0],s=r[i],l=w(a,s,o);return l&&(l=w(Math.floor(a/l)*l,Math.ceil(s/l)*l,o),r[0]=Math.floor(a/l)*l,r[i]=Math.ceil(s/l)*l,e(r)),t},t}var Ls=function(t,e){var n,r=0,i=(t=t.slice()).length-1,o=t[r],a=t[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t};function Ns(t,e){return(e=Math.log(e/t))?function(n){return Math.log(n/t)/e}:xs(e)}function Bs(t,e){return t<0?function(n){return-Math.pow(-e,n)*Math.pow(-t,1-n)}:function(n){return Math.pow(e,n)*Math.pow(t,1-n)}}function Ps(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Vs(t){return 10===t?Ps:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}function zs(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}function Os(t){return function(e){return-t(-e)}}function Rs(t,e){return t<0?-Math.pow(-t,e):Math.pow(t,e)}function Fs(){var t=1,e=Is(function(e,n){return(n=Rs(n,t)-(e=Rs(e,t)))?function(r){return(Rs(r,t)-e)/n}:xs(n)},function(e,n){return n=Rs(n,t)-(e=Rs(e,t)),function(r){return Rs(e+n*r,1/t)}}),n=e.domain;return e.exponent=function(e){return arguments.length?(t=+e,n(n())):t},e.copy=function(){return Es(e,Fs().exponent(t))},Ds(e)}var Us=1e3,qs=60*Us,$s=60*qs,js=24*$s,Hs=7*js,Gs=30*js,Ws=365*js;function Ys(t){return new Date(t)}function Xs(t){return t instanceof Date?+t:+new Date(+t)}function Zs(t,e,r,i,o,a,s,l,c){var u=Is(Ss,xr),d=u.invert,h=u.domain,f=c(".%L"),g=c(":%S"),p=c("%I:%M"),v=c("%I %p"),m=c("%a %d"),y=c("%b %d"),_=c("%B"),b=c("%Y"),x=[[s,1,Us],[s,5,5*Us],[s,15,15*Us],[s,30,30*Us],[a,1,qs],[a,5,5*qs],[a,15,15*qs],[a,30,30*qs],[o,1,$s],[o,3,3*$s],[o,6,6*$s],[o,12,12*$s],[i,1,js],[i,2,2*js],[r,1,Hs],[e,1,Gs],[e,3,3*Gs],[t,1,Ws]];function M(n){return(s(n)<n?f:a(n)<n?g:o(n)<n?p:i(n)<n?v:e(n)<n?r(n)<n?m:y:t(n)<n?_:b)(n)}function k(e,r,i,o){if(null==e&&(e=10),"number"==typeof e){var a=Math.abs(i-r)/e,s=n(function(t){return t[2]}).right(x,a);s===x.length?(o=w(r/Ws,i/Ws,e),e=t):s?(o=(s=x[a/x[s-1][2]<x[s][2]/a?s-1:s])[1],e=s[0]):(o=w(r,i,e),e=l)}return null==o?e:e.every(o)}return u.invert=function(t){return new Date(d(t))},u.domain=function(t){return arguments.length?h(ms.call(t,Xs)):h().map(Ys)},u.ticks=function(t,e){var n,r=h(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=k(t,i,o,e))?n.range(i,o+1):[],a?n.reverse():n},u.tickFormat=function(t,e){return null==e?M:c(e)},u.nice=function(t,e){var n=h();return(t=k(t,n[0],n[n.length-1],e))?h(Ls(n,t)):u},u.copy=function(){return Es(u,Zs(t,e,r,i,o,a,s,l,c))},u}var Js=function(t){return t.match(/.{6}/g).map(function(t){return"#"+t})},Qs=Js("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Ks=Js("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),tl=Js("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),el=Js("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),nl=Zr(ar(300,.5,0),ar(-240,.5,1)),rl=Zr(ar(-100,.75,.35),ar(80,1.5,.8)),il=Zr(ar(260,.75,.35),ar(80,1.5,.8)),ol=ar();function al(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}var sl=al(Js("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),ll=al(Js("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),cl=al(Js("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),ul=al(Js("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));var dl="http://www.w3.org/1999/xhtml",hl={svg:"http://www.w3.org/2000/svg",xhtml:dl,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},fl=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),hl.hasOwnProperty(e)?{space:hl[e],local:t}:t};var gl=function(t){var e=fl(t);return(e.local?function(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}:function(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===dl&&e.documentElement.namespaceURI===dl?e.createElement(t):e.createElementNS(n,t)}})(e)},pl=0;function vl(){return new ml}function ml(){this._="@"+(++pl).toString(36)}ml.prototype=vl.prototype={constructor:ml,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var yl=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var _l=document.documentElement;if(!_l.matches){var wl=_l.webkitMatchesSelector||_l.msMatchesSelector||_l.mozMatchesSelector||_l.oMatchesSelector;yl=function(t){return function(){return wl.call(this,t)}}}}var bl=yl,xl={};(t.event=null,"undefined"!=typeof document)&&("onmouseenter"in document.documentElement||(xl={mouseenter:"mouseover",mouseleave:"mouseout"}));function Ml(t,e,n){return t=kl(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function kl(e,n,r){return function(i){var o=t.event;t.event=i;try{e.call(this,this.__data__,n,r)}finally{t.event=o}}}function Sl(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?e.length=i:delete this.__on}}}function Al(t,e,n){var r=xl.hasOwnProperty(t.type)?Ml:kl;return function(i,o,a){var s,l=this.__on,c=r(e,o,a);if(l)for(var u=0,d=l.length;u<d;++u)if((s=l[u]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=c,s.capture=n),void(s.value=e);this.addEventListener(t.type,c,n),s={type:t.type,name:t.name,value:e,listener:c,capture:n},l?l.push(s):this.__on=[s]}}function Cl(e,n,r,i){var o=t.event;e.sourceEvent=t.event,t.event=e;try{return n.apply(r,i)}finally{t.event=o}}var El=function(){for(var e,n=t.event;e=n.sourceEvent;)n=e;return n},Il=function(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]},Tl=function(t){var e=El();return e.changedTouches&&(e=e.changedTouches[0]),Il(t,e)};function Dl(){}var Ll=function(t){return null==t?Dl:function(){return this.querySelector(t)}};function Nl(){return[]}var Bl=function(t){return null==t?Nl:function(){return this.querySelectorAll(t)}},Pl=function(t){return new Array(t.length)};function Vl(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Vl.prototype={constructor:Vl,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var zl="$";function Ol(t,e,n,r,i,o){for(var a,s=0,l=e.length,c=o.length;s<c;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new Vl(t,o[s]);for(;s<l;++s)(a=e[s])&&(i[s]=a)}function Rl(t,e,n,r,i,o,a){var s,l,c,u={},d=e.length,h=o.length,f=new Array(d);for(s=0;s<d;++s)(l=e[s])&&(f[s]=c=zl+a.call(l,l.__data__,s,e),c in u?i[s]=l:u[c]=l);for(s=0;s<h;++s)(l=u[c=zl+a.call(t,o[s],s,o)])?(r[s]=l,l.__data__=o[s],u[c]=null):n[s]=new Vl(t,o[s]);for(s=0;s<d;++s)(l=e[s])&&u[f[s]]===l&&(i[s]=l)}function Fl(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var Ul=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function ql(t){return t.trim().split(/^|\s+/)}function $l(t){return t.classList||new jl(t)}function jl(t){this._node=t,this._names=ql(t.getAttribute("class")||"")}function Hl(t,e){for(var n=$l(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Gl(t,e){for(var n=$l(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}jl.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Wl(){this.textContent=""}function Yl(){this.innerHTML=""}function Xl(){this.nextSibling&&this.parentNode.appendChild(this)}function Zl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Jl(){return null}function Ql(){var t=this.parentNode;t&&t.removeChild(this)}function Kl(t,e,n){var r=Ul(t),i=r.CustomEvent;i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}var tc=[null];function ec(t,e){this._groups=t,this._parents=e}function nc(){return new ec([[document.documentElement]],tc)}ec.prototype=nc.prototype={constructor:ec,select:function(t){"function"!=typeof t&&(t=Ll(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a,s=e[i],l=s.length,c=r[i]=new Array(l),u=0;u<l;++u)(o=s[u])&&(a=t.call(o,o.__data__,u,s))&&("__data__"in o&&(a.__data__=o.__data__),c[u]=a);return new ec(r,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=Bl(t));for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a,s=e[o],l=s.length,c=0;c<l;++c)(a=s[c])&&(r.push(t.call(a,a.__data__,c,s)),i.push(a));return new ec(r,i)},filter:function(t){"function"!=typeof t&&(t=bl(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],s=a.length,l=r[i]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new ec(r,this._parents)},data:function(t,e){if(!t)return g=new Array(this.size()),u=-1,this.each(function(t){g[++u]=t}),g;var n,r=e?Rl:Ol,i=this._parents,o=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var a=o.length,s=new Array(a),l=new Array(a),c=new Array(a),u=0;u<a;++u){var d=i[u],h=o[u],f=h.length,g=t.call(d,d&&d.__data__,u,i),p=g.length,v=l[u]=new Array(p),m=s[u]=new Array(p);r(d,h,v,m,c[u]=new Array(f),g,e);for(var y,_,w=0,b=0;w<p;++w)if(y=v[w]){for(w>=b&&(b=w+1);!(_=m[b])&&++b<p;);y._next=_||null}}return(s=new ec(s,i))._enter=l,s._exit=c,s},enter:function(){return new ec(this._enter||this._groups.map(Pl),this._parents)},exit:function(){return new ec(this._exit||this._groups.map(Pl),this._parents)},merge:function(t){for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var l,c=e[s],u=n[s],d=c.length,h=a[s]=new Array(d),f=0;f<d;++f)(l=c[f]||u[f])&&(h[f]=l);for(;s<r;++s)a[s]=e[s];return new ec(a,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&a!==r.nextSibling&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Fl);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,s=n[o],l=s.length,c=i[o]=new Array(l),u=0;u<l;++u)(a=s[u])&&(c[u]=a);c.sort(e)}return new ec(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){var t=0;return this.each(function(){++t}),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,s=o.length;a<s;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:function(t,e){var n=fl(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}}:"function"==typeof e?n.local?function(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}:function(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}:n.local?function(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}:function(t,e){return function(){this.setAttribute(t,e)}})(n,e))},style:function(t,e,n){var r;return arguments.length>1?this.each((null==e?function(t){return function(){this.style.removeProperty(t)}}:"function"==typeof e?function(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}:function(t,e,n){return function(){this.style.setProperty(t,e,n)}})(t,e,null==n?"":n)):Ul(r=this.node()).getComputedStyle(r,null).getPropertyValue(t)},property:function(t,e){return arguments.length>1?this.each((null==e?function(t){return function(){delete this[t]}}:"function"==typeof e?function(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}:function(t,e){return function(){this[t]=e}})(t,e)):this.node()[t]},classed:function(t,e){var n=ql(t+"");if(arguments.length<2){for(var r=$l(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?function(t,e){return function(){(e.apply(this,arguments)?Hl:Gl)(this,t)}}:e?function(t){return function(){Hl(this,t)}}:function(t){return function(){Gl(this,t)}})(n,e))},text:function(t){return arguments.length?this.each(null==t?Wl:("function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}:function(t){return function(){this.textContent=t}})(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Yl:("function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}:function(t){return function(){this.innerHTML=t}})(t)):this.node().innerHTML},raise:function(){return this.each(Xl)},lower:function(){return this.each(Zl)},append:function(t){var e="function"==typeof t?t:gl(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:gl(t),r=null==e?Jl:"function"==typeof e?e:Ll(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(Ql)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,o=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?Al:Sl,null==n&&(n=!1),r=0;r<a;++r)this.each(s(o[r],e,n));return this}var s=this.node().__on;if(s)for(var l,c=0,u=s.length;c<u;++c)for(r=0,l=s[c];r<a;++r)if((i=o[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?function(t,e){return function(){return Kl(this,t,e.apply(this,arguments))}}:function(t,e){return function(){return Kl(this,t,e)}})(t,e))}};var rc=function(t){return"string"==typeof t?new ec([[document.querySelector(t)]],[document.documentElement]):new ec([[t]],tc)},ic=function(t,e,n){arguments.length<3&&(n=e,e=El().changedTouches);for(var r,i=0,o=e?e.length:0;i<o;++i)if((r=e[i]).identifier===n)return Il(t,r);return null},oc=Qr("start","end","interrupt"),ac=[],sc=0,lc=1,cc=2,uc=3,dc=4,hc=5,fc=6,gc=function(t,e,n,r,i,o){var a=t.__transition;if(a){if(n in a)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function o(l){var c,u,d,h;if(n.state!==lc)return s();for(c in i)if((h=i[c]).name===n.name){if(h.state===uc)return qi(o);h.state===dc?(h.state=fc,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete i[c]):+c<e&&(h.state=fc,h.timer.stop(),delete i[c])}if(qi(function(){n.state===uc&&(n.state=dc,n.timer.restart(a,n.delay,n.time),a(l))}),n.state=cc,n.on.call("start",t,t.__data__,n.index,n.group),n.state===cc){for(n.state=uc,r=new Array(d=n.tween.length),c=0,u=-1;c<d;++c)(h=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(r[++u]=h);r.length=u+1}}function a(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=hc,1),o=-1,a=r.length;++o<a;)r[o].call(null,i);n.state===hc&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var r in n.state=fc,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=zi(function(t){n.state=lc,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)},0,n.time)}(t,n,{name:e,index:r,group:i,on:oc,tween:ac,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:sc})};function pc(t,e){var n=t.__transition;if(!n||!(n=n[e])||n.state>sc)throw new Error("too late");return n}function vc(t,e){var n=t.__transition;if(!n||!(n=n[e])||n.state>cc)throw new Error("too late");return n}function mc(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("too late");return n}var yc=function(t,e){var n,r,i,o=t.__transition,a=!0;if(o){for(i in e=null==e?null:e+"",o)(n=o[i]).name===e?(r=n.state>cc&&n.state<hc,n.state=fc,n.timer.stop(),r&&n.on.call("interrupt",t,t.__data__,n.index,n.group),delete o[i]):a=!1;a&&delete t.__transition}};function _c(t,e,n){var r=t._id;return t.each(function(){var t=vc(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return mc(t,r).value[e]}}var wc=function(t,e){var n;return("number"==typeof e?xr:e instanceof kn?vr:(n=kn(e))?(e=n,vr):Tr)(t,e)};var bc=nc.prototype.constructor;var xc=0;function Mc(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function kc(t){return nc().transition(t)}function Sc(){return++xc}var Ac=nc.prototype;Mc.prototype=kc.prototype={constructor:Mc,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Ll(t));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var s,l,c=r[a],u=c.length,d=o[a]=new Array(u),h=0;h<u;++h)(s=c[h])&&(l=t.call(s,s.__data__,h,c))&&("__data__"in s&&(l.__data__=s.__data__),d[h]=l,gc(d[h],e,n,h,d,mc(s,n)));return new Mc(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Bl(t));for(var r=this._groups,i=r.length,o=[],a=[],s=0;s<i;++s)for(var l,c=r[s],u=c.length,d=0;d<u;++d)if(l=c[d]){for(var h,f=t.call(l,l.__data__,d,c),g=mc(l,n),p=0,v=f.length;p<v;++p)(h=f[p])&&gc(h,e,n,p,f,g);o.push(f),a.push(l)}return new Mc(o,a,e,n)},filter:function(t){"function"!=typeof t&&(t=bl(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],s=a.length,l=r[i]=[],c=0;c<s;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&l.push(o);return new Mc(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var l,c=e[s],u=n[s],d=c.length,h=a[s]=new Array(d),f=0;f<d;++f)(l=c[f]||u[f])&&(h[f]=l);for(;s<r;++s)a[s]=e[s];return new Mc(a,this._parents,this._name,this._id)},selection:function(){return new bc(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Sc(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a,s=r[o],l=s.length,c=0;c<l;++c)if(a=s[c]){var u=mc(a,e);gc(a,t,n,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Mc(r,this._parents,t,n)},call:Ac.call,nodes:Ac.nodes,node:Ac.node,size:Ac.size,empty:Ac.empty,each:Ac.each,on:function(t,e){var n=this._id;return arguments.length<2?mc(this.node(),n).on.on(t):this.each(function(t,e,n){var r,i,o=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?pc:vc;return function(){var a=o(this,t),s=a.on;s!==r&&(i=(r=s).copy()).on(e,n),a.on=i}}(n,t,e))},attr:function(t,e){var n=fl(t),r="transform"===n?Or:wc;return this.attrTween(t,"function"==typeof e?(n.local?function(t,e,n){var r,i,o;return function(){var a,s=n(this);if(null!=s)return(a=this.getAttributeNS(t.space,t.local))===s?null:a===r&&s===i?o:o=e(r=a,i=s);this.removeAttributeNS(t.space,t.local)}}:function(t,e,n){var r,i,o;return function(){var a,s=n(this);if(null!=s)return(a=this.getAttribute(t))===s?null:a===r&&s===i?o:o=e(r=a,i=s);this.removeAttribute(t)}})(n,r,_c(this,"attr."+t,e)):null==e?(n.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}})(n):(n.local?function(t,e,n){var r,i;return function(){var o=this.getAttributeNS(t.space,t.local);return o===n?null:o===r?i:i=e(r=o,n)}}:function(t,e,n){var r,i;return function(){var o=this.getAttribute(t);return o===n?null:o===r?i:i=e(r=o,n)}})(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=fl(t);return this.tween(n,(r.local?function(t,e){function n(){var n=this,r=e.apply(n,arguments);return r&&function(e){n.setAttributeNS(t.space,t.local,r(e))}}return n._value=e,n}:function(t,e){function n(){var n=this,r=e.apply(n,arguments);return r&&function(e){n.setAttribute(t,r(e))}}return n._value=e,n})(r,e))},style:function(t,e,n){var r="transform"==(t+="")?zr:wc;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var o=Ul(this).getComputedStyle(this,null),a=o.getPropertyValue(t),s=(this.style.removeProperty(t),o.getPropertyValue(t));return a===s?null:a===n&&s===r?i:i=e(n=a,r=s)}}(t,r)).on("end.style."+t,function(t){return function(){this.style.removeProperty(t)}}(t)):this.styleTween(t,"function"==typeof e?function(t,e,n){var r,i,o;return function(){var a=Ul(this).getComputedStyle(this,null),s=a.getPropertyValue(t),l=n(this);return null==l&&(this.style.removeProperty(t),l=a.getPropertyValue(t)),s===l?null:s===r&&l===i?o:o=e(r=s,i=l)}}(t,r,_c(this,"style."+t,e)):function(t,e,n){var r,i;return function(){var o=Ul(this).getComputedStyle(this,null).getPropertyValue(t);return o===n?null:o===r?i:i=e(r=o,n)}}(t,r,e),n)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){function r(){var r=this,i=e.apply(r,arguments);return i&&function(e){r.style.setProperty(t,i(e),n)}}return r._value=e,r}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(_c(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},remove:function(){return this.on("end.remove",(t=this._id,function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}));var t},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=mc(this.node(),n).tween,o=0,a=i.length;o<a;++o)if((r=i[o]).name===t)return r.value;return null}return this.each((null==e?function(t,e){var n,r;return function(){var i=vc(this,t),o=i.tween;if(o!==n)for(var a=0,s=(r=n=o).length;a<s;++a)if(r[a].name===e){(r=r.slice()).splice(a,1);break}i.tween=r}}:function(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var o=vc(this,t),a=o.tween;if(a!==r){i=(r=a).slice();for(var s={name:e,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===e){i[l]=s;break}l===c&&i.push(s)}o.tween=i}})(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?function(t,e){return function(){pc(this,t).delay=+e.apply(this,arguments)}}:function(t,e){return e=+e,function(){pc(this,t).delay=e}})(e,t)):mc(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?function(t,e){return function(){vc(this,t).duration=+e.apply(this,arguments)}}:function(t,e){return e=+e,function(){vc(this,t).duration=e}})(e,t)):mc(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){vc(this,t).ease=e}}(e,t)):mc(this.node(),e).ease}};var Cc={time:null,delay:0,duration:250,ease:R};function Ec(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))return Cc.time=Bi(),Cc;return n}nc.prototype.interrupt=function(t){return this.each(function(){yc(this,t)})},nc.prototype.transition=function(t){var e,n;t instanceof Mc?(e=t._id,t=t._name):(e=Sc(),(n=Cc).time=Bi(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a,s=r[o],l=s.length,c=0;c<l;++c)(a=s[c])&&gc(a,t,e,c,s,n||Ec(a,e));return new Mc(r,this._parents,t,e)};var Ic=[null],Tc=Array.prototype.slice,Dc=function(t){return t},Lc=1,Nc=2,Bc=3,Pc=4,Vc=1e-6;function zc(t,e,n){var r=t(n);return"translate("+(isFinite(r)?r:e(n))+",0)"}function Oc(t,e,n){var r=t(n);return"translate(0,"+(isFinite(r)?r:e(n))+")"}function Rc(){return!this.__axis}function Fc(t,e){var n=[],r=null,i=null,o=6,a=6,s=3;function l(l){var c,u=null==r?e.ticks?e.ticks.apply(e,n):e.domain():r,d=null==i?e.tickFormat?e.tickFormat.apply(e,n):Dc:i,h=Math.max(o,0)+s,f=t===Lc||t===Bc?zc:Oc,g=e.range(),p=g[0]+.5,v=g[g.length-1]+.5,m=(e.bandwidth?function(t){var e=t.bandwidth()/2;return t.round()&&(e=Math.round(e)),function(n){return t(n)+e}}:Dc)(e.copy()),y=l.selection?l.selection():l,_=y.selectAll(".domain").data([null]),w=y.selectAll(".tick").data(u,e).order(),b=w.exit(),x=w.enter().append("g").attr("class","tick"),M=w.select("line"),k=w.select("text"),S=t===Lc||t===Pc?-1:1,A=t===Pc||t===Nc?(c="x","y"):(c="y","x");_=_.merge(_.enter().insert("path",".tick").attr("class","domain").attr("stroke","#000")),w=w.merge(x),M=M.merge(x.append("line").attr("stroke","#000").attr(c+"2",S*o).attr(A+"1",.5).attr(A+"2",.5)),k=k.merge(x.append("text").attr("fill","#000").attr(c,S*h).attr(A,.5).attr("dy",t===Lc?"0em":t===Bc?"0.71em":"0.32em")),l!==y&&(_=_.transition(l),w=w.transition(l),M=M.transition(l),k=k.transition(l),b=b.transition(l).attr("opacity",Vc).attr("transform",function(t){return f(m,this.parentNode.__axis||m,t)}),x.attr("opacity",Vc).attr("transform",function(t){return f(this.parentNode.__axis||m,m,t)})),b.remove(),_.attr("d",t===Pc||t==Nc?"M"+S*a+","+p+"H0.5V"+v+"H"+S*a:"M"+p+","+S*a+"V0.5H"+v+"V"+S*a),w.attr("opacity",1).attr("transform",function(t){return f(m,m,t)}),M.attr(c+"2",S*o),k.attr(c,S*h).text(d),y.filter(Rc).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===Nc?"start":t===Pc?"end":"middle"),y.each(function(){this.__axis=m})}return l.scale=function(t){return arguments.length?(e=t,l):e},l.ticks=function(){return n=Tc.call(arguments),l},l.tickArguments=function(t){return arguments.length?(n=null==t?[]:Tc.call(t),l):n.slice()},l.tickValues=function(t){return arguments.length?(r=null==t?null:Tc.call(t),l):r&&r.slice()},l.tickFormat=function(t){return arguments.length?(i=t,l):i},l.tickSize=function(t){return arguments.length?(o=a=+t,l):o},l.tickSizeInner=function(t){return arguments.length?(o=+t,l):o},l.tickSizeOuter=function(t){return arguments.length?(a=+t,l):a},l.tickPadding=function(t){return arguments.length?(s=+t,l):s},l}function Uc(t,e){return t.parent===e.parent?1:2}function qc(t,e){return t+e.x}function $c(t,e){return Math.max(t,e.y)}function jc(t,e){var n,r,i,o,a,s=new Yc(t),l=+t.value&&(s.value=t.value),c=[s];for(null==e&&(e=Hc);n=c.pop();)if(l&&(n.value=+n.data.value),(i=e(n.data))&&(a=i.length))for(n.children=new Array(a),o=a-1;o>=0;--o)c.push(r=n.children[o]=new Yc(i[o])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(Wc)}function Hc(t){return t.children}function Gc(t){t.data=t.data.data}function Wc(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function Yc(t){this.data=t,this.depth=this.height=0,this.parent=null}function Xc(t){this._=t,this.next=null}Yc.prototype=jc.prototype={constructor:Yc,each:function(t){var e,n,r,i,o=this,a=[o];do{for(e=a.reverse(),a=[];o=e.pop();)if(t(o),n=o.children)for(r=0,i=n.length;r<i;++r)a.push(n[r])}while(a.length);return this},eachAfter:function(t){for(var e,n,r,i=this,o=[i],a=[];i=o.pop();)if(a.push(i),e=i.children)for(n=0,r=e.length;n<r;++n)o.push(e[n]);for(;i=a.pop();)t(i);return this},eachBefore:function(t){for(var e,n,r=this,i=[r];r=i.pop();)if(t(r),e=r.children)for(n=e.length-1;n>=0;--n)i.push(e[n]);return this},sum:function(t){return this.eachAfter(function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n})},sort:function(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;for(t=n.pop(),e=r.pop();t===e;)i=t,t=n.pop(),e=r.pop();return i}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){var t=[];return this.each(function(e){t.push(e)}),t},leaves:function(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t},links:function(){var t=this,e=[];return t.each(function(n){n!==t&&e.push({source:n.parent,target:n})}),e},copy:function(){return jc(this).eachBefore(Gc)}};var Zc=function(t){return function t(e,n){var r,i,o,a=null,s=e.head;switch(n.length){case 1:l=n[0],r={x:l.x,y:l.y,r:l.r};break;case 2:r=function(t,e){var n=t.x,r=t.y,i=t.r,o=e.x,a=e.y,s=e.r,l=o-n,c=a-r,u=s-i,d=Math.sqrt(l*l+c*c);return{x:(n+o+l/d*u)/2,y:(r+a+c/d*u)/2,r:(d+i+s)/2}}(n[0],n[1]);break;case 3:r=function(t,e,n){var r=t.x,i=t.y,o=t.r,a=e.x,s=e.y,l=e.r,c=n.x,u=n.y,d=n.r,h=2*(r-a),f=2*(i-s),g=2*(l-o),p=r*r+i*i-o*o-a*a-s*s+l*l,v=2*(r-c),m=2*(i-u),y=2*(d-o),_=r*r+i*i-o*o-c*c-u*u+d*d,w=v*f-h*m,b=(f*_-m*p)/w-r,x=(m*g-f*y)/w,M=(v*p-h*_)/w-i,k=(h*y-v*g)/w,S=x*x+k*k-1,A=2*(b*x+M*k+o),C=b*b+M*M-o*o,E=(-A-Math.sqrt(A*A-4*S*C))/(2*S);return{x:b+x*E+r,y:M+k*E+i,r:E}}(n[0],n[1],n[2])}var l;for(;s;)o=s._,i=s.next,r&&Jc(r,o)?a=s:(a?(e.tail=a,a.next=null):e.head=e.tail=null,n.push(o),r=t(e,n),n.pop(),e.head?(s.next=e.head,e.head=s):(s.next=null,e.head=e.tail=s),(a=e.tail).next=i),s=i;e.tail=a;return r}(function(t){for(var e=(t=t.slice()).length,n=null,r=n;e;){var i=new Xc(t[e-1]);r=r?r.next=i:n=i,t[void 0]=t[--e]}return{head:n,tail:r}}(t),[])};function Jc(t,e){var n=e.x-t.x,r=e.y-t.y,i=t.r-e.r;return i*i+1e-6>n*n+r*r}function Qc(t,e,n){var r=t.x,i=t.y,o=e.r+n.r,a=t.r+n.r,s=e.x-r,l=e.y-i,c=s*s+l*l;if(c){var u=.5+((a*=a)-(o*=o))/(2*c),d=Math.sqrt(Math.max(0,2*o*(a+c)-(a-=c)*a-o*o))/(2*c);n.x=r+u*s+d*l,n.y=i+u*l-d*s}else n.x=r+a,n.y=i}function Kc(t,e){var n=e.x-t.x,r=e.y-t.y,i=t.r+e.r;return i*i>n*n+r*r}function tu(t,e,n){var r=t.x-e,i=t.y-n;return r*r+i*i}function eu(t){this._=t,this.next=null,this.previous=null}function nu(t){if(!(i=t.length))return 0;var e,n,r,i;if((e=t[0]).x=0,e.y=0,!(i>1))return e.r;if(n=t[1],e.x=-n.r,n.x=e.r,n.y=0,!(i>2))return e.r+n.r;Qc(n,e,r=t[2]);var o,a,s,l,c,u,d,h=e.r*e.r,f=n.r*n.r,g=r.r*r.r,p=h+f+g,v=h*e.x+f*n.x+g*r.x,m=h*e.y+f*n.y+g*r.y;e=new eu(e),n=new eu(n),r=new eu(r),e.next=r.previous=n,n.next=e.previous=r,r.next=n.previous=e;t:for(s=3;s<i;++s){if(Qc(e._,n._,r=t[s]),r=new eu(r),(c=e.previous)===(l=n.next)){if(Kc(l._,r._)){e=n,n=l,--s;continue t}}else{u=l._.r,d=c._.r;do{if(u<=d){if(Kc(l._,r._)){n=l,e.next=n,n.previous=e,--s;continue t}u+=(l=l.next)._.r}else{if(Kc(c._,r._)){(e=c).next=n,n.previous=e,--s;continue t}d+=(c=c.previous)._.r}}while(l!==c.next)}for(r.previous=e,r.next=n,e.next=n.previous=n=r,p+=g=r._.r*r._.r,v+=g*r._.x,m+=g*r._.y,h=tu(e._,o=v/p,a=m/p);(r=r.next)!==n;)(g=tu(r._,o,a))<h&&(e=r,h=g);n=e.next}for(e=[n._],r=n;(r=r.next)!==n;)e.push(r._);for(r=Zc(e),s=0;s<i;++s)(e=t[s]).x-=r.x,e.y-=r.y;return r.r}function ru(t){if("function"!=typeof t)throw new Error;return t}function iu(){return 0}var ou=function(t){return function(){return t}};function au(t){return Math.sqrt(t.value)}function su(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function lu(t,e){return function(n){if(r=n.children){var r,i,o,a=r.length,s=t(n)*e||0;if(s)for(i=0;i<a;++i)r[i].r+=s;if(o=nu(r),s)for(i=0;i<a;++i)r[i].r-=s;n.r=o+s}}}function cu(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}var uu=function(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)},du=function(t,e,n,r,i){for(var o,a=t.children,s=-1,l=a.length,c=t.value&&(r-e)/t.value;++s<l;)(o=a[s]).y0=n,o.y1=i,o.x0=e,o.x1=e+=o.value*c},hu="$",fu={depth:-1},gu={};function pu(t){return t.id}function vu(t){return t.parentId}function mu(t,e){return t.parent===e.parent?1:2}function yu(t){var e=t.children;return e?e[0]:t.t}function _u(t){var e=t.children;return e?e[e.length-1]:t.t}function wu(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function bu(t,e,n){return t.a.parent===e.parent?t.a:n}function xu(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}xu.prototype=Object.create(Yc.prototype);var Mu=function(t,e,n,r,i){for(var o,a=t.children,s=-1,l=a.length,c=t.value&&(i-n)/t.value;++s<l;)(o=a[s]).x0=e,o.x1=r,o.y0=n,o.y1=n+=o.value*c},ku=(1+Math.sqrt(5))/2;function Su(t,e,n,r,i,o){for(var a,s,l,c,u,d,h,f,g,p,v,m=[],y=e.children,_=0,w=0,b=y.length,x=e.value;_<b;){l=i-n,c=o-r;do{u=y[w++].value}while(!u&&w<b);for(d=h=u,v=u*u*(p=Math.max(c/l,l/c)/(x*t)),g=Math.max(h/v,v/d);w<b;++w){if(u+=s=y[w].value,s<d&&(d=s),s>h&&(h=s),v=u*u*p,(f=Math.max(h/v,v/d))>g){u-=s;break}g=f}m.push(a={value:u,dice:l<c,children:y.slice(_,w)}),a.dice?du(a,n,r,i,x?r+=c*u/x:o):Mu(a,n,r,x?n+=l*u/x:i,o),x-=u,_=w}return m}var Au=function t(e){function n(t,n,r,i,o){Su(e,t,n,r,i,o)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(ku),Cu=function t(e){function n(t,n,r,i,o){if((a=t._squarify)&&a.ratio===e)for(var a,s,l,c,u,d=-1,h=a.length,f=t.value;++d<h;){for(l=(s=a[d]).children,c=s.value=0,u=l.length;c<u;++c)s.value+=l[c].value;s.dice?du(s,n,r,i,r+=(o-r)*s.value/f):Mu(s,n,r,n+=(i-n)*s.value/f,o),f-=s.value}else t._squarify=a=Su(e,t,n,r,i,o),a.ratio=e}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(ku),Eu=function(t){return function(){return t}},Iu=function(){return 1e-6*(Math.random()-.5)};function Tu(t){return t.x+t.vx}function Du(t){return t.y+t.vy}function Lu(t){return t.index}function Nu(t,e){var n=t.get(e);if(!n)throw new Error("missing: "+e);return n}function Bu(t){return t.x}function Pu(t){return t.y}var Vu=10,zu=Math.PI*(3-Math.sqrt(5));function Ou(){t.event.stopImmediatePropagation()}var Ru=function(){t.event.preventDefault(),t.event.stopImmediatePropagation()},Fu=function(t){var e=t.document.documentElement,n=rc(t).on("dragstart.drag",Ru,!0);"onselectstart"in e?n.on("selectstart.drag",Ru,!0):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")};function Uu(t,e){var n=t.document.documentElement,r=rc(t).on("dragstart.drag",null);e&&(r.on("click.drag",Ru,!0),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}var qu=function(t){return function(){return t}};function $u(t,e,n,r,i,o,a,s,l,c){this.target=t,this.type=e,this.subject=n,this.identifier=r,this.active=i,this.x=o,this.y=a,this.dx=s,this.dy=l,this._=c}function ju(){return!t.event.button}function Hu(){return this.parentNode}function Gu(e){return null==e?{x:t.event.x,y:t.event.y}:e}$u.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var Wu=function(t){return function(){return t}};function Yu(t){return t[0]}function Xu(t){return t[1]}function Zu(){this._=null}function Ju(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function Qu(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function Ku(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function td(t){for(;t.L;)t=t.L;return t}function ed(t,e,n,r){var i=[null,null],o=Sd.push(i)-1;return i.left=t,i.right=e,n&&rd(i,t,e,n),r&&rd(i,e,t,r),Md[t.index].halfedges.push(o),Md[e.index].halfedges.push(o),i}function nd(t,e,n){var r=[e,n];return r.left=t,r}function rd(t,e,n,r){t[0]||t[1]?t.left===n?t[1]=r:t[0]=r:(t[0]=r,t.left=e,t.right=n)}function id(t,e,n,r,i){var o,a=t[0],s=t[1],l=a[0],c=a[1],u=0,d=1,h=s[0]-l,f=s[1]-c;if(o=e-l,h||!(o>0)){if(o/=h,h<0){if(o<u)return;o<d&&(d=o)}else if(h>0){if(o>d)return;o>u&&(u=o)}if(o=r-l,h||!(o<0)){if(o/=h,h<0){if(o>d)return;o>u&&(u=o)}else if(h>0){if(o<u)return;o<d&&(d=o)}if(o=n-c,f||!(o>0)){if(o/=f,f<0){if(o<u)return;o<d&&(d=o)}else if(f>0){if(o>d)return;o>u&&(u=o)}if(o=i-c,f||!(o<0)){if(o/=f,f<0){if(o>d)return;o>u&&(u=o)}else if(f>0){if(o<u)return;o<d&&(d=o)}return!(u>0||d<1)||(u>0&&(t[0]=[l+u*h,c+u*f]),d<1&&(t[1]=[l+d*h,c+d*f]),!0)}}}}}function od(t,e,n,r,i){var o=t[1];if(o)return!0;var a,s,l=t[0],c=t.left,u=t.right,d=c[0],h=c[1],f=u[0],g=u[1],p=(d+f)/2,v=(h+g)/2;if(g===h){if(p<e||p>=r)return;if(d>f){if(l){if(l[1]>=i)return}else l=[p,n];o=[p,i]}else{if(l){if(l[1]<n)return}else l=[p,i];o=[p,n]}}else if(s=v-(a=(d-f)/(g-h))*p,a<-1||a>1)if(d>f){if(l){if(l[1]>=i)return}else l=[(n-s)/a,n];o=[(i-s)/a,i]}else{if(l){if(l[1]<n)return}else l=[(i-s)/a,i];o=[(n-s)/a,n]}else if(h<g){if(l){if(l[0]>=r)return}else l=[e,a*e+s];o=[r,a*r+s]}else{if(l){if(l[0]<e)return}else l=[r,a*r+s];o=[e,a*e+s]}return t[0]=l,t[1]=o,!0}function ad(t,e){var n=t.site,r=e.left,i=e.right;return n===i&&(i=r,r=n),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(n===r?(r=e[1],i=e[0]):(r=e[0],i=e[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function sd(t,e){return e[+(e.left!==t.site)]}function ld(t,e){return e[+(e.left===t.site)]}Zu.prototype={constructor:Zu,insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=td(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(Qu(this,n),n=(t=n).U),n.C=!1,r.C=!0,Ku(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(Ku(this,n),n=(t=n).U),n.C=!1,r.C=!0,Qu(this,r)),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,r,i=t.U,o=t.L,a=t.R;if(n=o?a?td(a):o:a,i?i.L===t?i.L=n:i.R=n:this._=n,o&&a?(r=n.C,n.C=t.C,n.L=o,o.U=n,n!==a?(i=n.U,n.U=t.U,t=n.R,i.L=t,n.R=a,a.U=n):(n.U=i,i=n,t=n.R)):(r=t.C,t=n),t&&(t.U=i),!r)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((e=i.R).C&&(e.C=!1,i.C=!0,Qu(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,Ku(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,Qu(this,i),t=this._;break}}else if((e=i.L).C&&(e.C=!1,i.C=!0,Ku(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,Qu(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,Ku(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}};var cd,ud=[];function dd(){Ju(this),this.x=this.y=this.arc=this.site=this.cy=null}function hd(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,o=n.site;if(r!==o){var a=i[0],s=i[1],l=r[0]-a,c=r[1]-s,u=o[0]-a,d=o[1]-s,h=2*(l*d-c*u);if(!(h>=-Cd)){var f=l*l+c*c,g=u*u+d*d,p=(d*f-c*g)/h,v=(l*g-u*f)/h,m=ud.pop()||new dd;m.arc=t,m.site=i,m.x=p+a,m.y=(m.cy=v+s)+Math.sqrt(p*p+v*v),t.circle=m;for(var y=null,_=kd._;_;)if(m.y<_.y||m.y===_.y&&m.x<=_.x){if(!_.L){y=_.P;break}_=_.L}else{if(!_.R){y=_;break}_=_.R}kd.insert(y,m),y||(cd=m)}}}}function fd(t){var e=t.circle;e&&(e.P||(cd=e.N),kd.remove(e),ud.push(e),Ju(e),t.circle=null)}var gd=[];function pd(){Ju(this),this.edge=this.site=this.circle=null}function vd(t){var e=gd.pop()||new pd;return e.site=t,e}function md(t){fd(t),xd.remove(t),gd.push(t),Ju(t)}function yd(t){var e=t.circle,n=e.x,r=e.cy,i=[n,r],o=t.P,a=t.N,s=[t];md(t);for(var l=o;l.circle&&Math.abs(n-l.circle.x)<Ad&&Math.abs(r-l.circle.cy)<Ad;)o=l.P,s.unshift(l),md(l),l=o;s.unshift(l),fd(l);for(var c=a;c.circle&&Math.abs(n-c.circle.x)<Ad&&Math.abs(r-c.circle.cy)<Ad;)a=c.N,s.push(c),md(c),c=a;s.push(c),fd(c);var u,d=s.length;for(u=1;u<d;++u)c=s[u],l=s[u-1],rd(c.edge,l.site,c.site,i);l=s[0],(c=s[d-1]).edge=ed(l.site,c.site,null,i),hd(l),hd(c)}function _d(t){for(var e,n,r,i,o=t[0],a=t[1],s=xd._;s;)if((r=wd(s,a)-o)>Ad)s=s.L;else{if(!((i=o-bd(s,a))>Ad)){r>-Ad?(e=s.P,n=s):i>-Ad?(e=s,n=s.N):e=n=s;break}if(!s.R){e=s;break}s=s.R}!function(t){Md[t.index]={site:t,halfedges:[]}}(t);var l=vd(t);if(xd.insert(e,l),e||n){if(e===n)return fd(e),n=vd(e.site),xd.insert(l,n),l.edge=n.edge=ed(e.site,l.site),hd(e),void hd(n);if(n){fd(e),fd(n);var c=e.site,u=c[0],d=c[1],h=t[0]-u,f=t[1]-d,g=n.site,p=g[0]-u,v=g[1]-d,m=2*(h*v-f*p),y=h*h+f*f,_=p*p+v*v,w=[(v*y-f*_)/m+u,(h*_-p*y)/m+d];rd(n.edge,c,g,w),l.edge=ed(c,t,null,w),n.edge=ed(t,g,null,w),hd(e),hd(n)}else l.edge=ed(e.site,l.site)}}function wd(t,e){var n=t.site,r=n[0],i=n[1],o=i-e;if(!o)return r;var a=t.P;if(!a)return-1/0;var s=(n=a.site)[0],l=n[1],c=l-e;if(!c)return s;var u=s-r,d=1/o-1/c,h=u/c;return d?(-h+Math.sqrt(h*h-2*d*(u*u/(-2*c)-l+c/2+i-o/2)))/d+r:(r+s)/2}function bd(t,e){var n=t.N;if(n)return wd(n,e);var r=t.site;return r[1]===e?r[0]:1/0}var xd,Md,kd,Sd,Ad=1e-6,Cd=1e-12;function Ed(t,e){return e[1]-t[1]||e[0]-t[0]}function Id(t,e){var n,r,i,o=t.sort(Ed).pop();for(Sd=[],Md=new Array(t.length),xd=new Zu,kd=new Zu;;)if(i=cd,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===n&&o[1]===r||(_d(o),n=o[0],r=o[1]),o=t.pop();else{if(!i)break;yd(i.arc)}if(function(){for(var t,e,n,r,i=0,o=Md.length;i<o;++i)if((t=Md[i])&&(r=(e=t.halfedges).length)){var a=new Array(r),s=new Array(r);for(n=0;n<r;++n)a[n]=n,s[n]=ad(t,Sd[e[n]]);for(a.sort(function(t,e){return s[e]-s[t]}),n=0;n<r;++n)s[n]=e[a[n]];for(n=0;n<r;++n)e[n]=s[n]}}(),e){var a=+e[0][0],s=+e[0][1],l=+e[1][0],c=+e[1][1];!function(t,e,n,r){for(var i,o=Sd.length;o--;)od(i=Sd[o],t,e,n,r)&&id(i,t,e,n,r)&&(Math.abs(i[0][0]-i[1][0])>Ad||Math.abs(i[0][1]-i[1][1])>Ad)||delete Sd[o]}(a,s,l,c),function(t,e,n,r){var i,o,a,s,l,c,u,d,h,f,g,p,v=Md.length,m=!0;for(i=0;i<v;++i)if(o=Md[i]){for(a=o.site,s=(l=o.halfedges).length;s--;)Sd[l[s]]||l.splice(s,1);for(s=0,c=l.length;s<c;)g=(f=ld(o,Sd[l[s]]))[0],p=f[1],d=(u=sd(o,Sd[l[++s%c]]))[0],h=u[1],(Math.abs(g-d)>Ad||Math.abs(p-h)>Ad)&&(l.splice(s,0,Sd.push(nd(a,f,Math.abs(g-t)<Ad&&r-p>Ad?[t,Math.abs(d-t)<Ad?h:r]:Math.abs(p-r)<Ad&&n-g>Ad?[Math.abs(h-r)<Ad?d:n,r]:Math.abs(g-n)<Ad&&p-e>Ad?[n,Math.abs(d-n)<Ad?h:e]:Math.abs(p-e)<Ad&&g-t>Ad?[Math.abs(h-e)<Ad?d:t,e]:null))-1),++c);c&&(m=!1)}if(m){var y,_,w,b=1/0;for(i=0,m=null;i<v;++i)(o=Md[i])&&(w=(y=(a=o.site)[0]-t)*y+(_=a[1]-e)*_)<b&&(b=w,m=o);if(m){var x=[t,e],M=[t,r],k=[n,r],S=[n,e];m.halfedges.push(Sd.push(nd(a=m.site,x,M))-1,Sd.push(nd(a,M,k))-1,Sd.push(nd(a,k,S))-1,Sd.push(nd(a,S,x))-1)}}for(i=0;i<v;++i)(o=Md[i])&&(o.halfedges.length||delete Md[i])}(a,s,l,c)}this.edges=Sd,this.cells=Md,xd=kd=Sd=Md=null}Id.prototype={constructor:Id,polygons:function(){var t=this.edges;return this.cells.map(function(e){var n=e.halfedges.map(function(n){return sd(e,t[n])});return n.data=e.site.data,n})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(n,r){for(var i,o,a,s,l=n.site,c=n.halfedges,u=-1,d=c.length,h=e[c[d-1]],f=h.left===l?h.right:h.left;++u<d;)i=f,f=(h=e[c[u]]).left===l?h.right:h.left,i&&f&&r<i.index&&r<f.index&&(a=i,s=f,((o=l)[0]-s[0])*(a[1]-o[1])-(o[0]-a[0])*(s[1]-o[1])<0)&&t.push([l.data,i.data,f.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,n){var r,i=this,o=i._found||0,a=i.cells[o]||i.cells[o=0],s=t-a.site[0],l=e-a.site[1],c=s*s+l*l;do{a=i.cells[r=o],o=null,a.halfedges.forEach(function(n){var r=i.edges[n],s=r.left;if(s!==a.site&&s||(s=r.right)){var l=t-s[0],u=e-s[1],d=l*l+u*u;d<c&&(c=d,o=s.index)}})}while(null!==o);return i._found=r,null==n||c<=n*n?a.site:null}};var Td=function(t){return function(){return t}};function Dd(t,e,n){this.target=t,this.type=e,this.transform=n}function Ld(t,e,n){this.k=t,this.x=e,this.y=n}Ld.prototype={constructor:Ld,scale:function(t){return 1===t?this:new Ld(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Ld(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Nd=new Ld(1,0,0);function Bd(t){return t.__zoom||Nd}function Pd(){t.event.stopImmediatePropagation()}Bd.prototype=Ld.prototype;var Vd=function(){t.event.preventDefault(),t.event.stopImmediatePropagation()};function zd(){return!t.event.button}function Od(){var t,e,n=this;return n instanceof SVGElement?(t=(n=n.ownerSVGElement||n).width.baseVal.value,e=n.height.baseVal.value):(t=n.clientWidth,e=n.clientHeight),[[0,0],[t,e]]}function Rd(){return this.__zoom||Nd}var Fd=function(t){return function(){return t}},Ud=function(t,e,n){this.target=t,this.type=e,this.selection=n};function qd(){t.event.stopImmediatePropagation()}var $d=function(){t.event.preventDefault(),t.event.stopImmediatePropagation()},jd={name:"drag"},Hd={name:"space"},Gd={name:"handle"},Wd={name:"center"},Yd={name:"x",handles:["e","w"].map(nh),input:function(t,e){return t&&[[t[0],e[0][1]],[t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},Xd={name:"y",handles:["n","s"].map(nh),input:function(t,e){return t&&[[e[0][0],t[0]],[e[1][0],t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},Zd={name:"xy",handles:["n","e","s","w","nw","ne","se","sw"].map(nh),input:function(t){return t},output:function(t){return t}},Jd={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Qd={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},Kd={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},th={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},eh={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function nh(t){return{type:t}}function rh(){return!t.event.button}function ih(){var t=this.ownerSVGElement||this;return[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function oh(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function ah(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function sh(e){var n,r=ih,i=rh,o=Qr(s,"start","brush","end"),a=6;function s(t){var n=t.property("__brush",h).selectAll(".overlay").data([nh("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Jd.overlay).merge(n).each(function(){var t=oh(this).extent;rc(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])}),t.selectAll(".selection").data([nh("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Jd.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var r=t.selectAll(".handle").data(e.handles,function(t){return t.type});r.exit().remove(),r.enter().append("rect").attr("class",function(t){return"handle handle--"+t.type}).attr("cursor",function(t){return Jd[t.type]}),t.each(l).attr("fill","none").attr("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush touchstart.brush",d)}function l(){var t=rc(this),e=oh(this).selection;e?(t.selectAll(".selection").style("display",null).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1]),t.selectAll(".handle").style("display",null).attr("x",function(t){return"e"===t.type[t.type.length-1]?e[1][0]-a/2:e[0][0]-a/2}).attr("y",function(t){return"s"===t.type[0]?e[1][1]-a/2:e[0][1]-a/2}).attr("width",function(t){return"n"===t.type||"s"===t.type?e[1][0]-e[0][0]+a:a}).attr("height",function(t){return"e"===t.type||"w"===t.type?e[1][1]-e[0][1]+a:a})):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function c(t,e){return t.__brush.emitter||new u(t,e)}function u(t,e){this.that=t,this.args=e,this.state=t.__brush,this.active=0}function d(){if(t.event.touches){if(t.event.changedTouches.length<t.event.touches.length)return $d()}else if(n)return;if(i.apply(this,arguments)){var r,o,a,s,u,d,h,f,g,p,v,m,y,_=this,w=t.event.target.__data__.type,b="selection"===(t.event.metaKey?w="overlay":w)?jd:t.event.altKey?Wd:Gd,x=e===Xd?null:th[w],M=e===Yd?null:eh[w],k=oh(_),S=k.extent,A=k.selection,C=S[0][0],E=S[0][1],I=S[1][0],T=S[1][1],D=x&&M&&t.event.shiftKey,L=Tl(_),N=L,B=c(_,arguments).beforestart();"overlay"===w?k.selection=A=[[r=e===Xd?C:L[0],a=e===Yd?E:L[1]],[u=e===Xd?I:r,h=e===Yd?T:a]]:(r=A[0][0],a=A[0][1],u=A[1][0],h=A[1][1]),o=r,s=a,d=u,f=h;var P=rc(_).attr("pointer-events","none"),V=P.selectAll(".overlay").attr("cursor",Jd[w]);if(t.event.touches)P.on("touchmove.brush",O,!0).on("touchend.brush touchcancel.brush",F,!0);else{var z=rc(t.event.view).on("keydown.brush",function(){switch(t.event.keyCode){case 16:D=x&&M;break;case 18:b===Gd&&(x&&(u=d-g*x,r=o+g*x),M&&(h=f-p*M,a=s+p*M),b=Wd,R());break;case 32:b!==Gd&&b!==Wd||(x<0?u=d-g:x>0&&(r=o-g),M<0?h=f-p:M>0&&(a=s-p),b=Hd,V.attr("cursor",Jd.selection),R());break;default:return}$d()},!0).on("keyup.brush",function(){switch(t.event.keyCode){case 16:D&&(m=y=D=!1,R());break;case 18:b===Wd&&(x<0?u=d:x>0&&(r=o),M<0?h=f:M>0&&(a=s),b=Gd,R());break;case 32:b===Hd&&(t.event.altKey?(x&&(u=d-g*x,r=o+g*x),M&&(h=f-p*M,a=s+p*M),b=Wd):(x<0?u=d:x>0&&(r=o),M<0?h=f:M>0&&(a=s),b=Gd),V.attr("cursor",Jd[w]),R());break;default:return}$d()},!0).on("mousemove.brush",O,!0).on("mouseup.brush",F,!0);Fu(t.event.view)}qd(),yc(_),l.call(_),B.start()}function O(){var t=Tl(_);!D||m||y||(Math.abs(t[0]-N[0])>Math.abs(t[1]-N[1])?y=!0:m=!0),N=t,v=!0,$d(),R()}function R(){var t;switch(g=N[0]-L[0],p=N[1]-L[1],b){case Hd:case jd:x&&(g=Math.max(C-r,Math.min(I-u,g)),o=r+g,d=u+g),M&&(p=Math.max(E-a,Math.min(T-h,p)),s=a+p,f=h+p);break;case Gd:x<0?(g=Math.max(C-r,Math.min(I-r,g)),o=r+g,d=u):x>0&&(g=Math.max(C-u,Math.min(I-u,g)),o=r,d=u+g),M<0?(p=Math.max(E-a,Math.min(T-a,p)),s=a+p,f=h):M>0&&(p=Math.max(E-h,Math.min(T-h,p)),s=a,f=h+p);break;case Wd:x&&(o=Math.max(C,Math.min(I,r-g*x)),d=Math.max(C,Math.min(I,u+g*x))),M&&(s=Math.max(E,Math.min(T,a-p*M)),f=Math.max(E,Math.min(T,h+p*M)))}d<o&&(x*=-1,t=r,r=u,u=t,t=o,o=d,d=t,w in Qd&&V.attr("cursor",Jd[w=Qd[w]])),f<s&&(M*=-1,t=a,a=h,h=t,t=s,s=f,f=t,w in Kd&&V.attr("cursor",Jd[w=Kd[w]])),k.selection&&(A=k.selection),m&&(o=A[0][0],d=A[1][0]),y&&(s=A[0][1],f=A[1][1]),A[0][0]===o&&A[0][1]===s&&A[1][0]===d&&A[1][1]===f||(k.selection=[[o,s],[d,f]],l.call(_),B.brush())}function F(){if(qd(),t.event.touches){if(t.event.touches.length)return;n&&clearTimeout(n),n=setTimeout(function(){n=null},500),P.on("touchmove.brush touchend.brush touchcancel.brush",null)}else Uu(t.event.view,v),z.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);P.attr("pointer-events","all"),V.attr("cursor",Jd.overlay),k.selection&&(A=k.selection),ah(A)&&(k.selection=null,l.call(_)),B.end()}}function h(){var t=this.__brush||{selection:null};return t.extent=r.apply(this,arguments),t.dim=e,t}return s.move=function(t,n){t.selection?t.on("start.brush",function(){c(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){c(this,arguments).end()}).tween("brush",function(){var t=this,r=t.__brush,i=c(t,arguments),o=r.selection,a=e.input("function"==typeof n?n.apply(this,arguments):n,r.extent),s=Dr(o,a);function u(e){r.selection=1===e&&ah(a)?null:s(e),l.call(t),i.brush()}return o&&a?u:u(1)}):t.each(function(){var t=arguments,r=this.__brush,i=e.input("function"==typeof n?n.apply(this,t):n,r.extent),o=c(this,t).beforestart();yc(this),r.selection=null==i||ah(i)?null:i,l.call(this),o.start().brush().end()})},u.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting&&(this.starting=!1,this.emit("start")),this},brush:function(){return this.emit("brush"),this},end:function(){return 0==--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(t){Cl(new Ud(s,t,e.output(this.state.selection)),o.apply,o,[t,this.that,this.args])}},s.extent=function(t){return arguments.length?(r="function"==typeof t?t:Fd([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),s):r},s.filter=function(t){return arguments.length?(i="function"==typeof t?t:Fd(!!t),s):i},s.handleSize=function(t){return arguments.length?(a=+t,s):a},s.on=function(){var t=o.on.apply(o,arguments);return t===o?s:t},s}var lh=Math.cos,ch=Math.sin,uh=Math.PI,dh=uh/2,hh=2*uh,fh=Math.max;var gh=Array.prototype.slice,ph=function(t){return function(){return t}};function vh(t){return t.source}function mh(t){return t.target}function yh(t){return t.radius}function _h(t){return t.startAngle}function wh(t){return t.endAngle}var bh=function(){return new xh};function xh(){this.reset()}xh.prototype={constructor:xh,reset:function(){this.s=this.t=0},add:function(t){kh(Mh,t,this.t),kh(this,Mh.s,this.s),this.s?this.t+=Mh.t:this.s=Mh.t},valueOf:function(){return this.s}};var Mh=new xh;function kh(t,e,n){var r=t.s=e+n,i=r-e,o=r-i;t.t=e-o+(n-i)}var Sh=1e-6,Ah=Math.PI,Ch=Ah/2,Eh=Ah/4,Ih=2*Ah,Th=180/Ah,Dh=Ah/180,Lh=Math.abs,Nh=Math.atan,Bh=Math.atan2,Ph=Math.cos,Vh=Math.ceil,zh=Math.exp,Oh=Math.log,Rh=Math.pow,Fh=Math.sin,Uh=Math.sign||function(t){return t>0?1:t<0?-1:0},qh=Math.sqrt,$h=Math.tan;function jh(t){return t>1?0:t<-1?Ah:Math.acos(t)}function Hh(t){return t>1?Ch:t<-1?-Ch:Math.asin(t)}function Gh(t){return(t=Fh(t/2))*t}function Wh(){}function Yh(t,e){t&&Zh.hasOwnProperty(t.type)&&Zh[t.type](t,e)}var Xh={Feature:function(t,e){Yh(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)Yh(n[r].geometry,e)}},Zh={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){Jh(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Jh(n[r],e,0)},Polygon:function(t,e){Qh(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Qh(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)Yh(n[r],e)}};function Jh(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function Qh(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)Jh(t[n],e,1);e.polygonEnd()}var Kh,tf,ef,nf,rf,of=function(t,e){t&&Xh.hasOwnProperty(t.type)?Xh[t.type](t,e):Yh(t,e)},af=bh(),sf=bh(),lf={point:Wh,lineStart:Wh,lineEnd:Wh,polygonStart:function(){af.reset(),lf.lineStart=cf,lf.lineEnd=uf},polygonEnd:function(){var t=+af;sf.add(t<0?Ih+t:t),this.lineStart=this.lineEnd=this.point=Wh},sphere:function(){sf.add(Ih)}};function cf(){lf.point=df}function uf(){hf(Kh,tf)}function df(t,e){lf.point=hf,Kh=t,tf=e,ef=t*=Dh,nf=Ph(e=(e*=Dh)/2+Eh),rf=Fh(e)}function hf(t,e){var n=(t*=Dh)-ef,r=n>=0?1:-1,i=r*n,o=Ph(e=(e*=Dh)/2+Eh),a=Fh(e),s=rf*a,l=nf*o+s*Ph(i),c=s*r*Fh(i);af.add(Bh(c,l)),ef=t,nf=o,rf=a}var ff,gf,pf,vf,mf,yf,_f,wf;function bf(t){return[Bh(t[1],t[0]),Hh(t[2])]}function xf(t){var e=t[0],n=t[1],r=Ph(n);return[r*Ph(e),r*Fh(e),Fh(n)]}function Mf(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function kf(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Sf(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Af(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Cf(t){var e=qh(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var Ef,If,Tf=bh(),Df={point:Lf,lineStart:Bf,lineEnd:Pf,polygonStart:function(){Df.point=Vf,Df.lineStart=zf,Df.lineEnd=Of,Tf.reset(),lf.polygonStart()},polygonEnd:function(){lf.polygonEnd(),Df.point=Lf,Df.lineStart=Bf,Df.lineEnd=Pf,af<0?(ff=-(pf=180),gf=-(vf=90)):Tf>Sh?vf=90:Tf<-Sh&&(gf=-90),If[0]=ff,If[1]=pf}};function Lf(t,e){Ef.push(If=[ff=t,pf=t]),e<gf&&(gf=e),e>vf&&(vf=e)}function Nf(t,e){var n=xf([t*Dh,e*Dh]);if(wf){var r=kf(wf,n),i=kf([r[1],-r[0],0],r);Cf(i),i=bf(i);var o,a=t-mf,s=a>0?1:-1,l=i[0]*Th*s,c=Lh(a)>180;c^(s*mf<l&&l<s*t)?(o=i[1]*Th)>vf&&(vf=o):c^(s*mf<(l=(l+360)%360-180)&&l<s*t)?(o=-i[1]*Th)<gf&&(gf=o):(e<gf&&(gf=e),e>vf&&(vf=e)),c?t<mf?Rf(ff,t)>Rf(ff,pf)&&(pf=t):Rf(t,pf)>Rf(ff,pf)&&(ff=t):pf>=ff?(t<ff&&(ff=t),t>pf&&(pf=t)):t>mf?Rf(ff,t)>Rf(ff,pf)&&(pf=t):Rf(t,pf)>Rf(ff,pf)&&(ff=t)}else Lf(t,e);wf=n,mf=t}function Bf(){Df.point=Nf}function Pf(){If[0]=ff,If[1]=pf,Df.point=Lf,wf=null}function Vf(t,e){if(wf){var n=t-mf;Tf.add(Lh(n)>180?n+(n>0?360:-360):n)}else yf=t,_f=e;lf.point(t,e),Nf(t,e)}function zf(){lf.lineStart()}function Of(){Vf(yf,_f),lf.lineEnd(),Lh(Tf)>Sh&&(ff=-(pf=180)),If[0]=ff,If[1]=pf,wf=null}function Rf(t,e){return(e-=t)<0?e+360:e}function Ff(t,e){return t[0]-e[0]}function Uf(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var qf,$f,jf,Hf,Gf,Wf,Yf,Xf,Zf,Jf,Qf,Kf,tg,eg,ng,rg,ig={sphere:Wh,point:og,lineStart:sg,lineEnd:ug,polygonStart:function(){ig.lineStart=dg,ig.lineEnd=hg},polygonEnd:function(){ig.lineStart=sg,ig.lineEnd=ug}};function og(t,e){t*=Dh;var n=Ph(e*=Dh);ag(n*Ph(t),n*Fh(t),Fh(e))}function ag(t,e,n){jf+=(t-jf)/++qf,Hf+=(e-Hf)/qf,Gf+=(n-Gf)/qf}function sg(){ig.point=lg}function lg(t,e){t*=Dh;var n=Ph(e*=Dh);eg=n*Ph(t),ng=n*Fh(t),rg=Fh(e),ig.point=cg,ag(eg,ng,rg)}function cg(t,e){t*=Dh;var n=Ph(e*=Dh),r=n*Ph(t),i=n*Fh(t),o=Fh(e),a=Bh(qh((a=ng*o-rg*i)*a+(a=rg*r-eg*o)*a+(a=eg*i-ng*r)*a),eg*r+ng*i+rg*o);$f+=a,Wf+=a*(eg+(eg=r)),Yf+=a*(ng+(ng=i)),Xf+=a*(rg+(rg=o)),ag(eg,ng,rg)}function ug(){ig.point=og}function dg(){ig.point=fg}function hg(){gg(Kf,tg),ig.point=og}function fg(t,e){Kf=t,tg=e,t*=Dh,e*=Dh,ig.point=gg;var n=Ph(e);eg=n*Ph(t),ng=n*Fh(t),rg=Fh(e),ag(eg,ng,rg)}function gg(t,e){t*=Dh;var n=Ph(e*=Dh),r=n*Ph(t),i=n*Fh(t),o=Fh(e),a=ng*o-rg*i,s=rg*r-eg*o,l=eg*i-ng*r,c=qh(a*a+s*s+l*l),u=eg*r+ng*i+rg*o,d=c&&-jh(u)/c,h=Bh(c,u);Zf+=d*a,Jf+=d*s,Qf+=d*l,$f+=h,Wf+=h*(eg+(eg=r)),Yf+=h*(ng+(ng=i)),Xf+=h*(rg+(rg=o)),ag(eg,ng,rg)}var pg=function(t){return function(){return t}},vg=function(t,e){function n(n,r){return n=t(n,r),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,r){return(n=e.invert(n,r))&&t.invert(n[0],n[1])}),n};function mg(t,e){return[t>Ah?t-Ih:t<-Ah?t+Ih:t,e]}function yg(t,e,n){return(t%=Ih)?e||n?vg(wg(t),bg(e,n)):wg(t):e||n?bg(e,n):mg}function _g(t){return function(e,n){return[(e+=t)>Ah?e-Ih:e<-Ah?e+Ih:e,n]}}function wg(t){var e=_g(t);return e.invert=_g(-t),e}function bg(t,e){var n=Ph(t),r=Fh(t),i=Ph(e),o=Fh(e);function a(t,e){var a=Ph(e),s=Ph(t)*a,l=Fh(t)*a,c=Fh(e),u=c*n+s*r;return[Bh(l*i-u*o,s*n-c*r),Hh(u*i+l*o)]}return a.invert=function(t,e){var a=Ph(e),s=Ph(t)*a,l=Fh(t)*a,c=Fh(e),u=c*i-l*o;return[Bh(l*i+c*o,s*n+u*r),Hh(u*n-s*r)]},a}mg.invert=mg;function xg(t,e,n,r,i,o){if(n){var a=Ph(e),s=Fh(e),l=r*n;null==i?(i=e+r*Ih,o=e-l/2):(i=Mg(a,i),o=Mg(a,o),(r>0?i<o:i>o)&&(i+=r*Ih));for(var c,u=i;r>0?u>o:u<o;u-=l)c=bf([a,-s*Ph(u),-s*Fh(u)]),t.point(c[0],c[1])}}function Mg(t,e){(e=xf(e))[0]-=t,Cf(e);var n=jh(-e[1]);return((-e[2]<0?-n:n)+Ih-Sh)%Ih}var kg=function(){var t,e=[];return{point:function(e,n){t.push([e,n])},lineStart:function(){e.push(t=[])},lineEnd:Wh,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}},Sg=function(t,e,n,r,i,o){var a,s=t[0],l=t[1],c=0,u=1,d=e[0]-s,h=e[1]-l;if(a=n-s,d||!(a>0)){if(a/=d,d<0){if(a<c)return;a<u&&(u=a)}else if(d>0){if(a>u)return;a>c&&(c=a)}if(a=i-s,d||!(a<0)){if(a/=d,d<0){if(a>u)return;a>c&&(c=a)}else if(d>0){if(a<c)return;a<u&&(u=a)}if(a=r-l,h||!(a>0)){if(a/=h,h<0){if(a<c)return;a<u&&(u=a)}else if(h>0){if(a>u)return;a>c&&(c=a)}if(a=o-l,h||!(a<0)){if(a/=h,h<0){if(a>u)return;a>c&&(c=a)}else if(h>0){if(a<c)return;a<u&&(u=a)}return c>0&&(t[0]=s+c*d,t[1]=l+c*h),u<1&&(e[0]=s+u*d,e[1]=l+u*h),!0}}}}},Ag=function(t,e){return Lh(t[0]-e[0])<Sh&&Lh(t[1]-e[1])<Sh};function Cg(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}var Eg=function(t,e,n,r,i){var o,a,s=[],l=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n,r=t[0],a=t[e];if(Ag(r,a)){for(i.lineStart(),o=0;o<e;++o)i.point((r=t[o])[0],r[1]);i.lineEnd()}else s.push(n=new Cg(r,t,null,!0)),l.push(n.o=new Cg(r,null,n,!1)),s.push(n=new Cg(a,t,null,!1)),l.push(n.o=new Cg(a,null,n,!0))}}),s.length){for(l.sort(e),Ig(s),Ig(l),o=0,a=l.length;o<a;++o)l[o].e=n=!n;for(var c,u,d=s[0];;){for(var h=d,f=!0;h.v;)if((h=h.n)===d)return;c=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(f)for(o=0,a=c.length;o<a;++o)i.point((u=c[o])[0],u[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(f)for(c=h.p.z,o=c.length-1;o>=0;--o)i.point((u=c[o])[0],u[1]);else r(h.x,h.p.x,-1,i);h=h.p}c=(h=h.o).z,f=!f}while(!h.v);i.lineEnd()}}};function Ig(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}var Tg=1e9,Dg=-Tg;function Lg(t,e,n,r){function i(i,o){return t<=i&&i<=n&&e<=o&&o<=r}function o(i,o,s,c){var u=0,d=0;if(null==i||(u=a(i,s))!==(d=a(o,s))||l(i,o)<0^s>0)do{c.point(0===u||3===u?t:n,u>1?r:e)}while((u=(u+s+4)%4)!==d);else c.point(o[0],o[1])}function a(r,i){return Lh(r[0]-t)<Sh?i>0?0:3:Lh(r[0]-n)<Sh?i>0?2:1:Lh(r[1]-e)<Sh?i>0?1:0:i>0?3:2}function s(t,e){return l(t.x,e.x)}function l(t,e){var n=a(t,1),r=a(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(a){var l,c,u,d,h,f,g,p,v,m,y,_=a,w=kg(),b={point:x,lineStart:function(){b.point=k,c&&c.push(u=[]);m=!0,v=!1,g=p=NaN},lineEnd:function(){l&&(k(d,h),f&&v&&w.rejoin(),l.push(w.result()));b.point=x,v&&_.lineEnd()},polygonStart:function(){_=w,l=[],c=[],y=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,i=c.length;n<i;++n)for(var o,a,s=c[n],l=1,u=s.length,d=s[0],h=d[0],f=d[1];l<u;++l)o=h,a=f,d=s[l],h=d[0],f=d[1],a<=r?f>r&&(h-o)*(r-a)>(f-a)*(t-o)&&++e:f<=r&&(h-o)*(r-a)<(f-a)*(t-o)&&--e;return e}(),n=y&&e,i=(l=M(l)).length;(n||i)&&(a.polygonStart(),n&&(a.lineStart(),o(null,null,1,a),a.lineEnd()),i&&Eg(l,s,e,o,a),a.polygonEnd());_=a,l=c=u=null}};function x(t,e){i(t,e)&&_.point(t,e)}function k(o,a){var s=i(o,a);if(c&&u.push([o,a]),m)d=o,h=a,f=s,m=!1,s&&(_.lineStart(),_.point(o,a));else if(s&&v)_.point(o,a);else{var l=[g=Math.max(Dg,Math.min(Tg,g)),p=Math.max(Dg,Math.min(Tg,p))],w=[o=Math.max(Dg,Math.min(Tg,o)),a=Math.max(Dg,Math.min(Tg,a))];Sg(l,w,t,e,n,r)?(v||(_.lineStart(),_.point(l[0],l[1])),_.point(w[0],w[1]),s||_.lineEnd(),y=!1):s&&(_.lineStart(),_.point(o,a),y=!1)}g=o,p=a,v=s}return b}}var Ng,Bg,Pg,Vg=bh(),zg={sphere:Wh,point:Wh,lineStart:function(){zg.point=Rg,zg.lineEnd=Og},lineEnd:Wh,polygonStart:Wh,polygonEnd:Wh};function Og(){zg.point=zg.lineEnd=Wh}function Rg(t,e){Ng=t*=Dh,Bg=Fh(e*=Dh),Pg=Ph(e),zg.point=Fg}function Fg(t,e){t*=Dh;var n=Fh(e*=Dh),r=Ph(e),i=Lh(t-Ng),o=Ph(i),a=r*Fh(i),s=Pg*n-Bg*r*o,l=Bg*n+Pg*r*o;Vg.add(Bh(qh(a*a+s*s),l)),Ng=t,Bg=n,Pg=r}var Ug=function(t){return Vg.reset(),of(t,zg),+Vg},qg=[null,null],$g={type:"LineString",coordinates:qg};function jg(t,e,n){var r=p(t,e-Sh,n).concat(e);return function(t){return r.map(function(e){return[t,e]})}}function Hg(t,e,n){var r=p(t,e-Sh,n).concat(e);return function(t){return r.map(function(e){return[e,t]})}}function Gg(){var t,e,n,r,i,o,a,s,l,c,u,d,h=10,f=h,g=90,v=360,m=2.5;function y(){return{type:"MultiLineString",coordinates:_()}}function _(){return p(Vh(r/g)*g,n,g).map(u).concat(p(Vh(s/v)*v,a,v).map(d)).concat(p(Vh(e/h)*h,t,h).filter(function(t){return Lh(t%g)>Sh}).map(l)).concat(p(Vh(o/f)*f,i,f).filter(function(t){return Lh(t%v)>Sh}).map(c))}return y.lines=function(){return _().map(function(t){return{type:"LineString",coordinates:t}})},y.outline=function(){return{type:"Polygon",coordinates:[u(r).concat(d(a).slice(1),u(n).reverse().slice(1),d(s).reverse().slice(1))]}},y.extent=function(t){return arguments.length?y.extentMajor(t).extentMinor(t):y.extentMinor()},y.extentMajor=function(t){return arguments.length?(r=+t[0][0],n=+t[1][0],s=+t[0][1],a=+t[1][1],r>n&&(t=r,r=n,n=t),s>a&&(t=s,s=a,a=t),y.precision(m)):[[r,s],[n,a]]},y.extentMinor=function(n){return arguments.length?(e=+n[0][0],t=+n[1][0],o=+n[0][1],i=+n[1][1],e>t&&(n=e,e=t,t=n),o>i&&(n=o,o=i,i=n),y.precision(m)):[[e,o],[t,i]]},y.step=function(t){return arguments.length?y.stepMajor(t).stepMinor(t):y.stepMinor()},y.stepMajor=function(t){return arguments.length?(g=+t[0],v=+t[1],y):[g,v]},y.stepMinor=function(t){return arguments.length?(h=+t[0],f=+t[1],y):[h,f]},y.precision=function(h){return arguments.length?(m=+h,l=jg(o,i,90),c=Hg(e,t,m),u=jg(s,a,90),d=Hg(r,n,m),y):m},y.extentMajor([[-180,-90+Sh],[180,90-Sh]]).extentMinor([[-180,-80-Sh],[180,80+Sh]])}var Wg,Yg,Xg,Zg,Jg=function(t){return t},Qg=bh(),Kg=bh(),tp={point:Wh,lineStart:Wh,lineEnd:Wh,polygonStart:function(){tp.lineStart=ep,tp.lineEnd=ip},polygonEnd:function(){tp.lineStart=tp.lineEnd=tp.point=Wh,Qg.add(Lh(Kg)),Kg.reset()},result:function(){var t=Qg/2;return Qg.reset(),t}};function ep(){tp.point=np}function np(t,e){tp.point=rp,Wg=Xg=t,Yg=Zg=e}function rp(t,e){Kg.add(Zg*t-Xg*e),Xg=t,Zg=e}function ip(){rp(Wg,Yg)}var op=1/0,ap=op,sp=-op,lp=sp,cp={point:function(t,e){t<op&&(op=t);t>sp&&(sp=t);e<ap&&(ap=e);e>lp&&(lp=e)},lineStart:Wh,lineEnd:Wh,polygonStart:Wh,polygonEnd:Wh,result:function(){var t=[[op,ap],[sp,lp]];return sp=lp=-(ap=op=1/0),t}};var up,dp,hp,fp,gp=0,pp=0,vp=0,mp=0,yp=0,_p=0,wp=0,bp=0,xp=0,Mp={point:kp,lineStart:Sp,lineEnd:Ep,polygonStart:function(){Mp.lineStart=Ip,Mp.lineEnd=Tp},polygonEnd:function(){Mp.point=kp,Mp.lineStart=Sp,Mp.lineEnd=Ep},result:function(){var t=xp?[wp/xp,bp/xp]:_p?[mp/_p,yp/_p]:vp?[gp/vp,pp/vp]:[NaN,NaN];return gp=pp=vp=mp=yp=_p=wp=bp=xp=0,t}};function kp(t,e){gp+=t,pp+=e,++vp}function Sp(){Mp.point=Ap}function Ap(t,e){Mp.point=Cp,kp(hp=t,fp=e)}function Cp(t,e){var n=t-hp,r=e-fp,i=qh(n*n+r*r);mp+=i*(hp+t)/2,yp+=i*(fp+e)/2,_p+=i,kp(hp=t,fp=e)}function Ep(){Mp.point=kp}function Ip(){Mp.point=Dp}function Tp(){Lp(up,dp)}function Dp(t,e){Mp.point=Lp,kp(up=hp=t,dp=fp=e)}function Lp(t,e){var n=t-hp,r=e-fp,i=qh(n*n+r*r);mp+=i*(hp+t)/2,yp+=i*(fp+e)/2,_p+=i,wp+=(i=fp*t-hp*e)*(hp+t),bp+=i*(fp+e),xp+=3*i,kp(hp=t,fp=e)}function Np(t){this._context=t}function Bp(){this._string=[]}function Pp(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}Np.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,Ih)}},result:Wh},Bp.prototype={_circle:Pp(4.5),pointRadius:function(t){return this._circle=Pp(t),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}}};var Vp=bh(),zp=function(t,e,n,r){return function(i,o){var a,s,l,c=e(o),u=i.invert(r[0],r[1]),d=kg(),h=e(d),f=!1,g={point:p,lineStart:m,lineEnd:y,polygonStart:function(){g.point=_,g.lineStart=w,g.lineEnd=b,s=[],a=[]},polygonEnd:function(){g.point=p,g.lineStart=m,g.lineEnd=y,s=M(s);var t=function(t,e){var n=e[0],r=e[1],i=[Fh(n),-Ph(n),0],o=0,a=0;Vp.reset();for(var s=0,l=t.length;s<l;++s)if(u=(c=t[s]).length)for(var c,u,d=c[u-1],h=d[0],f=d[1]/2+Eh,g=Fh(f),p=Ph(f),v=0;v<u;++v,h=y,g=w,p=b,d=m){var m=c[v],y=m[0],_=m[1]/2+Eh,w=Fh(_),b=Ph(_),x=y-h,M=x>=0?1:-1,k=M*x,S=k>Ah,A=g*w;if(Vp.add(Bh(A*M*Fh(k),p*b+A*Ph(k))),o+=S?x+M*Ih:x,S^h>=n^y>=n){var C=kf(xf(d),xf(m));Cf(C);var E=kf(i,C);Cf(E);var I=(S^x>=0?-1:1)*Hh(E[2]);(r>I||r===I&&(C[0]||C[1]))&&(a+=S^x>=0?1:-1)}}return(o<-Sh||o<Sh&&Vp<-Sh)^1&a}(a,u);s.length?(f||(o.polygonStart(),f=!0),Eg(s,Rp,t,n,o)):t&&(f||(o.polygonStart(),f=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),f&&(o.polygonEnd(),f=!1),s=a=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function p(e,n){var r=i(e,n);t(e=r[0],n=r[1])&&o.point(e,n)}function v(t,e){var n=i(t,e);c.point(n[0],n[1])}function m(){g.point=v,c.lineStart()}function y(){g.point=p,c.lineEnd()}function _(t,e){l.push([t,e]);var n=i(t,e);h.point(n[0],n[1])}function w(){h.lineStart(),l=[]}function b(){_(l[0][0],l[0][1]),h.lineEnd();var t,e,n,r,i=h.clean(),c=d.result(),u=c.length;if(l.pop(),a.push(l),l=null,u)if(1&i){if((e=(n=c[0]).length-1)>0){for(f||(o.polygonStart(),f=!0),o.lineStart(),t=0;t<e;++t)o.point((r=n[t])[0],r[1]);o.lineEnd()}}else u>1&&2&i&&c.push(c.pop().concat(c.shift())),s.push(c.filter(Op))}return g}};function Op(t){return t.length>1}function Rp(t,e){return((t=t.x)[0]<0?t[1]-Ch-Sh:Ch-t[1])-((e=e.x)[0]<0?e[1]-Ch-Sh:Ch-e[1])}var Fp=zp(function(){return!0},function(t){var e,n=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,a){var s=o>0?Ah:-Ah,l=Lh(o-n);Lh(l-Ah)<Sh?(t.point(n,r=(r+a)/2>0?Ch:-Ch),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),t.point(o,r),e=0):i!==s&&l>=Ah&&(Lh(n-i)<Sh&&(n-=i*Sh),Lh(o-s)<Sh&&(o-=s*Sh),r=function(t,e,n,r){var i,o,a=Fh(t-n);return Lh(a)>Sh?Nh((Fh(e)*(o=Ph(r))*Fh(n)-Fh(r)*(i=Ph(e))*Fh(t))/(i*o*a)):(e+r)/2}(n,r,o,a),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),e=0),t.point(n=o,r=a),i=s},lineEnd:function(){t.lineEnd(),n=r=NaN},clean:function(){return 2-e}}},function(t,e,n,r){var i;if(null==t)i=n*Ch,r.point(-Ah,i),r.point(0,i),r.point(Ah,i),r.point(Ah,0),r.point(Ah,-i),r.point(0,-i),r.point(-Ah,-i),r.point(-Ah,0),r.point(-Ah,i);else if(Lh(t[0]-e[0])>Sh){var o=t[0]<e[0]?Ah:-Ah;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])},[-Ah,-Ch]);var Up=function(t,e){var n=Ph(t),r=n>0,i=Lh(n)>Sh;function o(t,e){return Ph(t)*Ph(e)>n}function a(t,e,r){var i=[1,0,0],o=kf(xf(t),xf(e)),a=Mf(o,o),s=o[0],l=a-s*s;if(!l)return!r&&t;var c=n*a/l,u=-n*s/l,d=kf(i,o),h=Af(i,c);Sf(h,Af(o,u));var f=d,g=Mf(h,f),p=Mf(f,f),v=g*g-p*(Mf(h,h)-1);if(!(v<0)){var m=qh(v),y=Af(f,(-g-m)/p);if(Sf(y,h),y=bf(y),!r)return y;var _,w=t[0],b=e[0],x=t[1],M=e[1];b<w&&(_=w,w=b,b=_);var k=b-w,S=Lh(k-Ah)<Sh;if(!S&&M<x&&(_=x,x=M,M=_),S||k<Sh?S?x+M>0^y[1]<(Lh(y[0]-w)<Sh?x:M):x<=y[1]&&y[1]<=M:k>Ah^(w<=y[0]&&y[0]<=b)){var A=Af(f,(-g+m)/p);return Sf(A,h),[y,bf(A)]}}}function s(e,n){var i=r?t:Ah-t,o=0;return e<-i?o|=1:e>i&&(o|=2),n<-i?o|=4:n>i&&(o|=8),o}return zp(o,function(t){var e,n,l,c,u;return{lineStart:function(){c=l=!1,u=1},point:function(d,h){var f,g=[d,h],p=o(d,h),v=r?p?0:s(d,h):p?s(d+(d<0?Ah:-Ah),h):0;if(!e&&(c=l=p)&&t.lineStart(),p!==l&&(f=a(e,g),(Ag(e,f)||Ag(g,f))&&(g[0]+=Sh,g[1]+=Sh,p=o(g[0],g[1]))),p!==l)u=0,p?(t.lineStart(),f=a(g,e),t.point(f[0],f[1])):(f=a(e,g),t.point(f[0],f[1]),t.lineEnd()),e=f;else if(i&&e&&r^p){var m;v&n||!(m=a(g,e,!0))||(u=0,r?(t.lineStart(),t.point(m[0][0],m[0][1]),t.point(m[1][0],m[1][1]),t.lineEnd()):(t.point(m[1][0],m[1][1]),t.lineEnd(),t.lineStart(),t.point(m[0][0],m[0][1])))}!p||e&&Ag(e,g)||t.point(g[0],g[1]),e=g,l=p,n=v},lineEnd:function(){l&&t.lineEnd(),e=null},clean:function(){return u|(c&&l)<<1}}},function(n,r,i,o){xg(o,t,e,i,n,r)},r?[0,-t]:[-Ah,t-Ah])};function qp(t){return function(e){var n=new $p;for(var r in t)n[r]=t[r];return n.stream=e,n}}function $p(){}function jp(t,e,n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),null!=o&&t.clipExtent(null),of(n,t.stream(cp));var a=cp.result(),s=Math.min(r/(a[1][0]-a[0][0]),i/(a[1][1]-a[0][1])),l=+e[0][0]+(r-s*(a[1][0]+a[0][0]))/2,c=+e[0][1]+(i-s*(a[1][1]+a[0][1]))/2;return null!=o&&t.clipExtent(o),t.scale(150*s).translate([l,c])}function Hp(t,e,n){return jp(t,[[0,0],e],n)}$p.prototype={constructor:$p,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Gp=16,Wp=Ph(30*Dh),Yp=function(t,e){return+e?function(t,e){function n(r,i,o,a,s,l,c,u,d,h,f,g,p,v){var m=c-r,y=u-i,_=m*m+y*y;if(_>4*e&&p--){var w=a+h,b=s+f,x=l+g,M=qh(w*w+b*b+x*x),k=Hh(x/=M),S=Lh(Lh(x)-1)<Sh||Lh(o-d)<Sh?(o+d)/2:Bh(b,w),A=t(S,k),C=A[0],E=A[1],I=C-r,T=E-i,D=y*I-m*T;(D*D/_>e||Lh((m*I+y*T)/_-.5)>.3||a*h+s*f+l*g<Wp)&&(n(r,i,o,a,s,l,C,E,S,w/=M,b/=M,x,p,v),v.point(C,E),n(C,E,S,w,b,x,c,u,d,h,f,g,p,v))}}return function(e){var r,i,o,a,s,l,c,u,d,h,f,g,p={point:v,lineStart:m,lineEnd:_,polygonStart:function(){e.polygonStart(),p.lineStart=w},polygonEnd:function(){e.polygonEnd(),p.lineStart=m}};function v(n,r){n=t(n,r),e.point(n[0],n[1])}function m(){u=NaN,p.point=y,e.lineStart()}function y(r,i){var o=xf([r,i]),a=t(r,i);n(u,d,c,h,f,g,u=a[0],d=a[1],c=r,h=o[0],f=o[1],g=o[2],Gp,e),e.point(u,d)}function _(){p.point=v,e.lineEnd()}function w(){m(),p.point=b,p.lineEnd=x}function b(t,e){y(r=t,e),i=u,o=d,a=h,s=f,l=g,p.point=y}function x(){n(u,d,c,h,f,g,i,o,r,a,s,l,Gp,e),p.lineEnd=_,_()}return p}}(t,e):function(t){return qp({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)};var Xp=qp({point:function(t,e){this.stream.point(t*Dh,e*Dh)}});function Zp(t){return Jp(function(){return t})()}function Jp(t){var e,n,r,i,o,a,s,l,c,u,d=150,h=480,f=250,g=0,p=0,v=0,m=0,y=0,_=null,w=Fp,b=null,x=Jg,M=.5,k=Yp(C,M);function S(t){return[(t=o(t[0]*Dh,t[1]*Dh))[0]*d+n,r-t[1]*d]}function A(t){return(t=o.invert((t[0]-n)/d,(r-t[1])/d))&&[t[0]*Th,t[1]*Th]}function C(t,i){return[(t=e(t,i))[0]*d+n,r-t[1]*d]}function E(){o=vg(i=yg(v,m,y),e);var t=e(g,p);return n=h-t[0]*d,r=f+t[1]*d,I()}function I(){return c=u=null,S}return S.stream=function(t){return c&&u===t?c:c=Xp(w(i,k(x(u=t))))},S.clipAngle=function(t){return arguments.length?(w=+t?Up(_=t*Dh,6*Dh):(_=null,Fp),I()):_*Th},S.clipExtent=function(t){return arguments.length?(x=null==t?(b=a=s=l=null,Jg):Lg(b=+t[0][0],a=+t[0][1],s=+t[1][0],l=+t[1][1]),I()):null==b?null:[[b,a],[s,l]]},S.scale=function(t){return arguments.length?(d=+t,E()):d},S.translate=function(t){return arguments.length?(h=+t[0],f=+t[1],E()):[h,f]},S.center=function(t){return arguments.length?(g=t[0]%360*Dh,p=t[1]%360*Dh,E()):[g*Th,p*Th]},S.rotate=function(t){return arguments.length?(v=t[0]%360*Dh,m=t[1]%360*Dh,y=t.length>2?t[2]%360*Dh:0,E()):[v*Th,m*Th,y*Th]},S.precision=function(t){return arguments.length?(k=Yp(C,M=t*t),I()):qh(M)},S.fitExtent=function(t,e){return jp(S,t,e)},S.fitSize=function(t,e){return Hp(S,t,e)},function(){return e=t.apply(this,arguments),S.invert=e.invert&&A,E()}}function Qp(t){var e=0,n=Ah/3,r=Jp(t),i=r(e,n);return i.parallels=function(t){return arguments.length?r(e=t[0]*Dh,n=t[1]*Dh):[e*Th,n*Th]},i}function Kp(t,e){var n=Fh(t),r=(n+Fh(e))/2;if(Lh(r)<Sh)return function(t){var e=Ph(t);function n(t,n){return[t*e,Fh(n)/e]}return n.invert=function(t,n){return[t/e,Hh(n*e)]},n}(t);var i=1+n*(2*r-n),o=qh(i)/r;function a(t,e){var n=qh(i-2*r*Fh(e))/r;return[n*Fh(t*=r),o-n*Ph(t)]}return a.invert=function(t,e){var n=o-e;return[Bh(t,Lh(n))/r*Uh(n),Hh((i-(t*t+n*n)*r*r)/(2*r))]},a}var tv=function(){return Qp(Kp).scale(155.424).center([0,33.6442])},ev=function(){return tv().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};function nv(t){return function(e,n){var r=Ph(e),i=Ph(n),o=t(r*i);return[o*i*Fh(e),o*Fh(n)]}}function rv(t){return function(e,n){var r=qh(e*e+n*n),i=t(r),o=Fh(i),a=Ph(i);return[Bh(e*o,r*a),Hh(r&&n*o/r)]}}var iv=nv(function(t){return qh(2/(1+t))});iv.invert=rv(function(t){return 2*Hh(t/2)});var ov=nv(function(t){return(t=jh(t))&&t/Fh(t)});ov.invert=rv(function(t){return t});function av(t,e){return[t,Oh($h((Ch+e)/2))]}av.invert=function(t,e){return[t,2*Nh(zh(e))-Ch]};function sv(t){var e,n=Zp(t),r=n.scale,i=n.translate,o=n.clipExtent;return n.scale=function(t){return arguments.length?(r(t),e&&n.clipExtent(null),n):r()},n.translate=function(t){return arguments.length?(i(t),e&&n.clipExtent(null),n):i()},n.clipExtent=function(t){if(!arguments.length)return e?null:o();if(e=null==t){var a=Ah*r(),s=i();t=[[s[0]-a,s[1]-a],[s[0]+a,s[1]+a]]}return o(t),n},n.clipExtent(null)}function lv(t){return $h((Ch+t)/2)}function cv(t,e){var n=Ph(t),r=t===e?Fh(t):Oh(n/Ph(e))/Oh(lv(e)/lv(t)),i=n*Rh(lv(t),r)/r;if(!r)return av;function o(t,e){i>0?e<-Ch+Sh&&(e=-Ch+Sh):e>Ch-Sh&&(e=Ch-Sh);var n=i/Rh(lv(e),r);return[n*Fh(r*t),i-n*Ph(r*t)]}return o.invert=function(t,e){var n=i-e,o=Uh(r)*qh(t*t+n*n);return[Bh(t,Lh(n))/r*Uh(n),2*Nh(Rh(i/o,1/r))-Ch]},o}function uv(t,e){return[t,e]}uv.invert=uv;function dv(t,e){var n=Ph(t),r=t===e?Fh(t):(n-Ph(e))/(e-t),i=n/r+t;if(Lh(r)<Sh)return uv;function o(t,e){var n=i-e,o=r*t;return[n*Fh(o),i-n*Ph(o)]}return o.invert=function(t,e){var n=i-e;return[Bh(t,Lh(n))/r*Uh(n),i-Uh(r)*qh(t*t+n*n)]},o}function hv(t,e){var n=Ph(e),r=Ph(t)*n;return[n*Fh(t)/r,Fh(e)/r]}hv.invert=rv(Nh);function fv(t,e,n,r){return 1===t&&1===e&&0===n&&0===r?Jg:qp({point:function(i,o){this.stream.point(i*t+n,o*e+r)}})}function gv(t,e){return[Ph(e)*Fh(t),Fh(e)]}gv.invert=rv(Hh);function pv(t,e){var n=Ph(e),r=1+Ph(t)*n;return[n*Fh(t)/r,Fh(e)/r]}pv.invert=rv(function(t){return 2*Nh(t)});function vv(t,e){return[Oh($h((Ch+e)/2)),-t]}vv.invert=function(t,e){return[-e,2*Nh(zh(t))-Ch]};return t.version="4.4.0",t.bisect=i,t.bisectRight=i,t.bisectLeft=o,t.ascending=e,t.bisector=n,t.descending=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},t.deviation=l,t.extent=c,t.histogram=function(){var t=g,e=c,n=b;function r(r){var o,a,s=r.length,l=new Array(s);for(o=0;o<s;++o)l[o]=t(r[o],o,r);var c=e(l),u=c[0],d=c[1],h=n(l,u,d);Array.isArray(h)||(h=_(u,d,h));for(var f=h.length;h[0]<=u;)h.shift(),--f;for(;h[f-1]>=d;)h.pop(),--f;var g,p=new Array(f+1);for(o=0;o<=f;++o)(g=p[o]=[]).x0=o>0?h[o-1]:u,g.x1=o<f?h[o]:d;for(o=0;o<s;++o)u<=(a=l[o])&&a<=d&&p[i(h,a,0,f)].push(r[o]);return p}return r.value=function(e){return arguments.length?(t="function"==typeof e?e:f(e),r):t},r.domain=function(t){return arguments.length?(e="function"==typeof t?t:f([t[0],t[1]]),r):e},r.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:Array.isArray(t)?f(d.call(t)):f(t),r):n},r},t.thresholdFreedmanDiaconis=function(t,n,r){return t=h.call(t,a).sort(e),Math.ceil((r-n)/(2*(x(t,.75)-x(t,.25))*Math.pow(t.length,-1/3)))},t.thresholdScott=function(t,e,n){return Math.ceil((n-e)/(3.5*l(t)*Math.pow(t.length,-1/3)))},t.thresholdSturges=b,t.max=function(t,e){var n,r,i=-1,o=t.length;if(null==e){for(;++i<o;)if(null!=(r=t[i])&&r>=r){n=r;break}for(;++i<o;)null!=(r=t[i])&&r>n&&(n=r)}else{for(;++i<o;)if(null!=(r=e(t[i],i,t))&&r>=r){n=r;break}for(;++i<o;)null!=(r=e(t[i],i,t))&&r>n&&(n=r)}return n},t.mean=function(t,e){var n,r=0,i=t.length,o=-1,s=i;if(null==e)for(;++o<i;)isNaN(n=a(t[o]))?--s:r+=n;else for(;++o<i;)isNaN(n=a(e(t[o],o,t)))?--s:r+=n;if(s)return r/s},t.median=function(t,n){var r,i=[],o=t.length,s=-1;if(null==n)for(;++s<o;)isNaN(r=a(t[s]))||i.push(r);else for(;++s<o;)isNaN(r=a(n(t[s],s,t)))||i.push(r);return x(i.sort(e),.5)},t.merge=M,t.min=k,t.pairs=function(t){for(var e=0,n=t.length-1,r=t[0],i=new Array(n<0?0:n);e<n;)i[e]=[r,r=t[++e]];return i},t.permute=function(t,e){for(var n=e.length,r=new Array(n);n--;)r[n]=t[e[n]];return r},t.quantile=x,t.range=p,t.scan=function(t,n){if(r=t.length){var r,i,o=0,a=0,s=t[a];for(n||(n=e);++o<r;)(n(i=t[o],s)<0||0!==n(s,s))&&(s=i,a=o);return 0===n(s,s)?a:void 0}},t.shuffle=function(t,e,n){for(var r,i,o=(null==n?t.length:n)-(e=null==e?0:+e);o;)i=Math.random()*o--|0,r=t[o+e],t[o+e]=t[i+e],t[i+e]=r;return t},t.sum=function(t,e){var n,r=0,i=t.length,o=-1;if(null==e)for(;++o<i;)(n=+t[o])&&(r+=n);else for(;++o<i;)(n=+e(t[o],o,t))&&(r+=n);return r},t.ticks=_,t.tickStep=w,t.transpose=S,t.variance=s,t.zip=function(){return S(arguments)},t.entries=function(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});return e},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e},t.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},t.map=E,t.set=P,t.nest=function(){var t,e,n,r=[],i=[];function o(n,i,a,s){if(i>=r.length)return null!=e?e(n):null!=t?n.sort(t):n;for(var l,c,u,d=-1,h=n.length,f=r[i++],g=E(),p=a();++d<h;)(u=g.get(l=f(c=n[d])+""))?u.push(c):g.set(l,[c]);return g.each(function(t,e){s(p,e,o(t,i,a,s))}),p}return n={object:function(t){return o(t,0,I,T)},map:function(t){return o(t,0,D,L)},entries:function(t){return function t(n,o){if(++o>r.length)return n;var a,s=i[o-1];return null!=e&&o>=r.length?a=n.entries():(a=[],n.each(function(e,n){a.push({key:n,values:t(e,o)})})),null!=s?a.sort(function(t,e){return s(t.key,e.key)}):a}(o(t,0,D,L),0)},key:function(t){return r.push(t),n},sortKeys:function(t){return i[r.length-1]=t,n},sortValues:function(e){return t=e,n},rollup:function(t){return e=t,n}}},t.randomUniform=function(t,e){return t=null==t?0:+t,e=null==e?1:+e,1===arguments.length?(e=t,t=0):e-=t,function(){return Math.random()*e+t}},t.randomNormal=V,t.randomLogNormal=function(){var t=V.apply(this,arguments);return function(){return Math.exp(t())}},t.randomBates=function(t){var e=z(t);return function(){return e()/t}},t.randomIrwinHall=z,t.randomExponential=function(t){return function(){return-Math.log(1-Math.random())/t}},t.easeLinear=function(t){return+t},t.easeQuad=O,t.easeQuadIn=function(t){return t*t},t.easeQuadOut=function(t){return t*(2-t)},t.easeQuadInOut=O,t.easeCubic=R,t.easeCubicIn=function(t){return t*t*t},t.easeCubicOut=function(t){return--t*t*t+1},t.easeCubicInOut=R,t.easePoly=q,t.easePolyIn=F,t.easePolyOut=U,t.easePolyInOut=q,t.easeSin=H,t.easeSinIn=function(t){return 1-Math.cos(t*j)},t.easeSinOut=function(t){return Math.sin(t*j)},t.easeSinInOut=H,t.easeExp=G,t.easeExpIn=function(t){return Math.pow(2,10*t-10)},t.easeExpOut=function(t){return 1-Math.pow(2,-10*t)},t.easeExpInOut=G,t.easeCircle=W,t.easeCircleIn=function(t){return 1-Math.sqrt(1-t*t)},t.easeCircleOut=function(t){return Math.sqrt(1- --t*t)},t.easeCircleInOut=W,t.easeBounce=it,t.easeBounceIn=function(t){return 1-it(1-t)},t.easeBounceOut=it,t.easeBounceInOut=function(t){return((t*=2)<=1?1-it(1-t):it(t-1)+1)/2},t.easeBack=st,t.easeBackIn=ot,t.easeBackOut=at,t.easeBackInOut=st,t.easeElastic=ut,t.easeElasticIn=ct,t.easeElasticOut=ut,t.easeElasticInOut=dt,t.polygonArea=function(t){for(var e,n=-1,r=t.length,i=t[r-1],o=0;++n<r;)e=i,i=t[n],o+=e[1]*i[0]-e[0]*i[1];return o/2},t.polygonCentroid=function(t){for(var e,n,r=-1,i=t.length,o=0,a=0,s=t[i-1],l=0;++r<i;)e=s,s=t[r],l+=n=e[0]*s[1]-s[0]*e[1],o+=(e[0]+s[0])*n,a+=(e[1]+s[1])*n;return[o/(l*=3),a/l]},t.polygonHull=function(t){if((n=t.length)<3)return null;var e,n,r=new Array(n),i=new Array(n);for(e=0;e<n;++e)r[e]=[+t[e][0],+t[e][1],e];for(r.sort(ft),e=0;e<n;++e)i[e]=[r[e][0],-r[e][1]];var o=gt(r),a=gt(i),s=a[0]===o[0],l=a[a.length-1]===o[o.length-1],c=[];for(e=o.length-1;e>=0;--e)c.push(t[r[o[e]][2]]);for(e=+s;e<a.length-l;++e)c.push(t[r[a[e]][2]]);return c},t.polygonContains=function(t,e){for(var n,r,i=t.length,o=t[i-1],a=e[0],s=e[1],l=o[0],c=o[1],u=!1,d=0;d<i;++d)n=(o=t[d])[0],(r=o[1])>s!=c>s&&a<(l-n)*(s-r)/(c-r)+n&&(u=!u),l=n,c=r;return u},t.polygonLength=function(t){for(var e,n,r=-1,i=t.length,o=t[i-1],a=o[0],s=o[1],l=0;++r<i;)e=a,n=s,e-=a=(o=t[r])[0],n-=s=o[1],l+=Math.sqrt(e*e+n*n);return l},t.path=_t,t.quadtree=kt,t.queue=Pt,t.arc=function(){var t=Ut,e=qt,n=Vt(0),r=null,i=$t,o=jt,a=Ht,s=null;function l(){var l,c,u=+t.apply(this,arguments),d=+e.apply(this,arguments),h=i.apply(this,arguments)-Rt,f=o.apply(this,arguments)-Rt,g=Math.abs(f-h),p=f>h;if(s||(s=l=_t()),d<u&&(c=d,d=u,u=c),d>zt)if(g>Ft-zt)s.moveTo(d*Math.cos(h),d*Math.sin(h)),s.arc(0,0,d,h,f,!p),u>zt&&(s.moveTo(u*Math.cos(f),u*Math.sin(f)),s.arc(0,0,u,f,h,p));else{var v,m,y=h,_=f,w=h,b=f,x=g,M=g,k=a.apply(this,arguments)/2,S=k>zt&&(r?+r.apply(this,arguments):Math.sqrt(u*u+d*d)),A=Math.min(Math.abs(d-u)/2,+n.apply(this,arguments)),C=A,E=A;if(S>zt){var I=Gt(S/u*Math.sin(k)),T=Gt(S/d*Math.sin(k));(x-=2*I)>zt?(w+=I*=p?1:-1,b-=I):(x=0,w=b=(h+f)/2),(M-=2*T)>zt?(y+=T*=p?1:-1,_-=T):(M=0,y=_=(h+f)/2)}var D=d*Math.cos(y),L=d*Math.sin(y),N=u*Math.cos(b),B=u*Math.sin(b);if(A>zt){var P=d*Math.cos(_),V=d*Math.sin(_),z=u*Math.cos(w),O=u*Math.sin(w);if(g<Ot){var R=x>zt?function(t,e,n,r,i,o,a,s){var l=n-t,c=r-e,u=a-i,d=s-o,h=(u*(e-o)-d*(t-i))/(d*l-u*c);return[t+h*l,e+h*c]}(D,L,z,O,P,V,N,B):[N,B],F=D-R[0],U=L-R[1],q=P-R[0],$=V-R[1],j=1/Math.sin(Math.acos((F*q+U*$)/(Math.sqrt(F*F+U*U)*Math.sqrt(q*q+$*$)))/2),H=Math.sqrt(R[0]*R[0]+R[1]*R[1]);C=Math.min(A,(u-H)/(j-1)),E=Math.min(A,(d-H)/(j+1))}}M>zt?E>zt?(v=Wt(z,O,D,L,d,E,p),m=Wt(P,V,N,B,d,E,p),s.moveTo(v.cx+v.x01,v.cy+v.y01),E<A?s.arc(v.cx,v.cy,E,Math.atan2(v.y01,v.x01),Math.atan2(m.y01,m.x01),!p):(s.arc(v.cx,v.cy,E,Math.atan2(v.y01,v.x01),Math.atan2(v.y11,v.x11),!p),s.arc(0,0,d,Math.atan2(v.cy+v.y11,v.cx+v.x11),Math.atan2(m.cy+m.y11,m.cx+m.x11),!p),s.arc(m.cx,m.cy,E,Math.atan2(m.y11,m.x11),Math.atan2(m.y01,m.x01),!p))):(s.moveTo(D,L),s.arc(0,0,d,y,_,!p)):s.moveTo(D,L),u>zt&&x>zt?C>zt?(v=Wt(N,B,P,V,u,-C,p),m=Wt(D,L,z,O,u,-C,p),s.lineTo(v.cx+v.x01,v.cy+v.y01),C<A?s.arc(v.cx,v.cy,C,Math.atan2(v.y01,v.x01),Math.atan2(m.y01,m.x01),!p):(s.arc(v.cx,v.cy,C,Math.atan2(v.y01,v.x01),Math.atan2(v.y11,v.x11),!p),s.arc(0,0,u,Math.atan2(v.cy+v.y11,v.cx+v.x11),Math.atan2(m.cy+m.y11,m.cx+m.x11),p),s.arc(m.cx,m.cy,C,Math.atan2(m.y11,m.x11),Math.atan2(m.y01,m.x01),!p))):s.arc(0,0,u,b,w,p):s.lineTo(N,B)}else s.moveTo(0,0);if(s.closePath(),l)return s=null,l+""||null}return l.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-Ot/2;return[Math.cos(r)*n,Math.sin(r)*n]},l.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:Vt(+e),l):t},l.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:Vt(+t),l):e},l.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:Vt(+t),l):n},l.padRadius=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:Vt(+t),l):r},l.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:Vt(+t),l):i},l.endAngle=function(t){return arguments.length?(o="function"==typeof t?t:Vt(+t),l):o},l.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:Vt(+t),l):a},l.context=function(t){return arguments.length?(s=null==t?null:t,l):s},l},t.area=Kt,t.line=Qt,t.pie=function(){var t=ee,e=te,n=null,r=Vt(0),i=Vt(Ft),o=Vt(0);function a(a){var s,l,c,u,d,h=a.length,f=0,g=new Array(h),p=new Array(h),v=+r.apply(this,arguments),m=Math.min(Ft,Math.max(-Ft,i.apply(this,arguments)-v)),y=Math.min(Math.abs(m)/h,o.apply(this,arguments)),_=y*(m<0?-1:1);for(s=0;s<h;++s)(d=p[g[s]=s]=+t(a[s],s,a))>0&&(f+=d);for(null!=e?g.sort(function(t,n){return e(p[t],p[n])}):null!=n&&g.sort(function(t,e){return n(a[t],a[e])}),s=0,c=f?(m-h*_)/f:0;s<h;++s,v=u)l=g[s],u=v+((d=p[l])>0?d*c:0)+_,p[l]={data:a[l],index:s,value:d,startAngle:v,endAngle:u,padAngle:y};return p}return a.value=function(e){return arguments.length?(t="function"==typeof e?e:Vt(+e),a):t},a.sortValues=function(t){return arguments.length?(e=t,n=null,a):e},a.sort=function(t){return arguments.length?(n=t,e=null,a):n},a.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:Vt(+t),a):r},a.endAngle=function(t){return arguments.length?(i="function"==typeof t?t:Vt(+t),a):i},a.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:Vt(+t),a):o},a},t.radialArea=function(){var t=Kt().curve(ne),e=t.curve,n=t.lineX0,r=t.lineX1,i=t.lineY0,o=t.lineY1;return t.angle=t.x,delete t.x,t.startAngle=t.x0,delete t.x0,t.endAngle=t.x1,delete t.x1,t.radius=t.y,delete t.y,t.innerRadius=t.y0,delete t.y0,t.outerRadius=t.y1,delete t.y1,t.lineStartAngle=function(){return oe(n())},delete t.lineX0,t.lineEndAngle=function(){return oe(r())},delete t.lineX1,t.lineInnerRadius=function(){return oe(i())},delete t.lineY0,t.lineOuterRadius=function(){return oe(o())},delete t.lineY1,t.curve=function(t){return arguments.length?e(ie(t)):e()._curve},t},t.radialLine=function(){return oe(Qt().curve(ne))},t.symbol=function(){var t=Vt(ae),e=Vt(64),n=null;function r(){var r;if(n||(n=r=_t()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),r)return n=null,r+""||null}return r.type=function(e){return arguments.length?(t="function"==typeof e?e:Vt(e),r):t},r.size=function(t){return arguments.length?(e="function"==typeof t?t:Vt(+t),r):e},r.context=function(t){return arguments.length?(n=null==t?null:t,r):n},r},t.symbols=Me,t.symbolCircle=ae,t.symbolCross=se,t.symbolDiamond=ue,t.symbolSquare=pe,t.symbolStar=ge,t.symbolTriangle=me,t.symbolWye=xe,t.curveBasisClosed=function(t){return new Ce(t)},t.curveBasisOpen=function(t){return new Ee(t)},t.curveBasis=function(t){return new Ae(t)},t.curveBundle=Te,t.curveCardinalClosed=Pe,t.curveCardinalOpen=ze,t.curveCardinal=Ne,t.curveCatmullRomClosed=qe,t.curveCatmullRomOpen=je,t.curveCatmullRom=Fe,t.curveLinearClosed=function(t){return new He(t)},t.curveLinear=Xt,t.curveMonotoneX=function(t){return new Ze(t)},t.curveMonotoneY=function(t){return new Je(t)},t.curveNatural=function(t){return new Ke(t)},t.curveStep=function(t){return new en(t,.5)},t.curveStepAfter=function(t){return new en(t,1)},t.curveStepBefore=function(t){return new en(t,0)},t.stack=function(){var t=Vt([]),e=on,n=rn,r=an;function i(i){var o,a,s=t.apply(this,arguments),l=i.length,c=s.length,u=new Array(c);for(o=0;o<c;++o){for(var d,h=s[o],f=u[o]=new Array(l),g=0;g<l;++g)f[g]=d=[0,+r(i[g],h,g,i)],d.data=i[g];f.key=h}for(o=0,a=e(u);o<c;++o)u[a[o]].index=o;return n(u,a),u}return i.keys=function(e){return arguments.length?(t="function"==typeof e?e:Vt(nn.call(e)),i):t},i.value=function(t){return arguments.length?(r="function"==typeof t?t:Vt(+t),i):r},i.order=function(t){return arguments.length?(e=null==t?on:"function"==typeof t?t:Vt(nn.call(t)),i):e},i.offset=function(t){return arguments.length?(n=null==t?rn:t,i):n},i},t.stackOffsetExpand=function(t,e){if((r=t.length)>0){for(var n,r,i,o=0,a=t[0].length;o<a;++o){for(i=n=0;n<r;++n)i+=t[n][o][1]||0;if(i)for(n=0;n<r;++n)t[n][o][1]/=i}rn(t,e)}},t.stackOffsetNone=rn,t.stackOffsetSilhouette=function(t,e){if((n=t.length)>0){for(var n,r=0,i=t[e[0]],o=i.length;r<o;++r){for(var a=0,s=0;a<n;++a)s+=t[a][r][1]||0;i[r][1]+=i[r][0]=-s/2}rn(t,e)}},t.stackOffsetWiggle=function(t,e){if((i=t.length)>0&&(r=(n=t[e[0]]).length)>0){for(var n,r,i,o=0,a=1;a<r;++a){for(var s=0,l=0,c=0;s<i;++s){for(var u=t[e[s]],d=u[a][1]||0,h=(d-(u[a-1][1]||0))/2,f=0;f<s;++f){var g=t[e[f]];h+=(g[a][1]||0)-(g[a-1][1]||0)}l+=d,c+=h*d}n[a-1][1]+=n[a-1][0]=o,l&&(o-=c/l)}n[a-1][1]+=n[a-1][0]=o,rn(t,e)}},t.stackOrderAscending=sn,t.stackOrderDescending=function(t){return sn(t).reverse()},t.stackOrderInsideOut=function(t){var e,n,r=t.length,i=t.map(ln),o=on(t).sort(function(t,e){return i[e]-i[t]}),a=0,s=0,l=[],c=[];for(e=0;e<r;++e)n=o[e],a<s?(a+=i[n],l.push(n)):(s+=i[n],c.push(n));return c.reverse().concat(l)},t.stackOrderNone=on,t.stackOrderReverse=function(t){return on(t).reverse()},t.color=kn,t.rgb=En,t.hsl=Dn,t.lab=jn,t.hcl=Zn,t.cubehelix=ar,t.interpolate=Dr,t.interpolateArray=wr,t.interpolateDate=br,t.interpolateNumber=xr,t.interpolateObject=Mr,t.interpolateRound=Lr,t.interpolateString=Tr,t.interpolateTransformCss=zr,t.interpolateTransformSvg=Or,t.interpolateZoom=Ur,t.interpolateRgb=vr,t.interpolateRgbBasis=yr,t.interpolateRgbBasisClosed=_r,t.interpolateHsl=$r,t.interpolateHslLong=jr,t.interpolateLab=function(t,e){var n=pr((t=jn(t)).l,(e=jn(e)).l),r=pr(t.a,e.a),i=pr(t.b,e.b),o=pr(t.opacity,e.opacity);return function(e){return t.l=n(e),t.a=r(e),t.b=i(e),t.opacity=o(e),t+""}},t.interpolateHcl=Gr,t.interpolateHclLong=Wr,t.interpolateCubehelix=Xr,t.interpolateCubehelixLong=Zr,t.interpolateBasis=cr,t.interpolateBasisClosed=ur,t.quantize=function(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n},t.dispatch=Qr,t.dsvFormat=ri,t.csvParse=oi,t.csvParseRows=ai,t.csvFormat=si,t.csvFormatRows=li,t.tsvParse=ui,t.tsvParseRows=di,t.tsvFormat=hi,t.tsvFormatRows=fi,t.request=gi,t.html=vi,t.json=mi,t.text=yi,t.xml=_i,t.csv=Mi,t.tsv=ki,t.now=Bi,t.timer=zi,t.timerFlush=Oi,t.timeout=qi,t.interval=function(t,e,n){var r=new Vi,i=e;return null==e?(r.restart(t,e,n),r):(e=+e,n=null==n?Bi():+n,r.restart(function o(a){a+=i,r.restart(o,i+=e,n),t(a)},e,n),r)},t.timeInterval=Hi,t.timeMillisecond=Gi,t.timeMilliseconds=Wi,t.timeSecond=Zi,t.timeSeconds=Ji,t.timeMinute=Qi,t.timeMinutes=Ki,t.timeHour=to,t.timeHours=eo,t.timeDay=no,t.timeDays=ro,t.timeWeek=oo,t.timeWeeks=fo,t.timeSunday=oo,t.timeSundays=fo,t.timeMonday=ao,t.timeMondays=go,t.timeTuesday=so,t.timeTuesdays=po,t.timeWednesday=lo,t.timeWednesdays=vo,t.timeThursday=co,t.timeThursdays=mo,t.timeFriday=uo,t.timeFridays=yo,t.timeSaturday=ho,t.timeSaturdays=_o,t.timeMonth=wo,t.timeMonths=bo,t.timeYear=xo,t.timeYears=Mo,t.utcMillisecond=Gi,t.utcMilliseconds=Wi,t.utcSecond=Zi,t.utcSeconds=Ji,t.utcMinute=ko,t.utcMinutes=So,t.utcHour=Ao,t.utcHours=Co,t.utcDay=Eo,t.utcDays=Io,t.utcWeek=Do,t.utcWeeks=Oo,t.utcSunday=Do,t.utcSundays=Oo,t.utcMonday=Lo,t.utcMondays=Ro,t.utcTuesday=No,t.utcTuesdays=Fo,t.utcWednesday=Bo,t.utcWednesdays=Uo,t.utcThursday=Po,t.utcThursdays=qo,t.utcFriday=Vo,t.utcFridays=$o,t.utcSaturday=zo,t.utcSaturdays=jo,t.utcMonth=Ho,t.utcMonths=Go,t.utcYear=Wo,t.utcYears=Xo,t.formatLocale=aa,t.formatDefaultLocale=sa,t.formatSpecifier=ea,t.precisionFixed=la,t.precisionPrefix=ca,t.precisionRound=ua,t.isoFormat=gs,t.isoParse=ps,t.timeFormatLocale=ga,t.timeFormatDefaultLocale=fs,t.scaleBand=bs,t.scalePoint=function(){return function t(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return t(n())},e}(bs().paddingInner(1))},t.scaleIdentity=function t(){var e=[0,1];function n(t){return+t}return n.invert=n,n.domain=n.range=function(t){return arguments.length?(e=ms.call(t,Ms),n):e.slice()},n.copy=function(){return t().domain(e)},Ds(n)},t.scaleLinear=function t(){var e=Is(Ss,xr);return e.copy=function(){return Es(e,t())},Ds(e)},t.scaleLog=function e(){var n=Is(Ns,Bs).domain([1,10]),r=n.domain,i=10,o=zs(10),a=Vs(10);function s(){return o=zs(i),a=Vs(i),r()[0]<0&&(o=Os(o),a=Os(a)),n}return n.base=function(t){return arguments.length?(i=+t,s()):i},n.domain=function(t){return arguments.length?(r(t),s()):r()},n.ticks=function(t){var e,n=r(),s=n[0],l=n[n.length-1];(e=l<s)&&(h=s,s=l,l=h);var c,u,d,h=o(s),f=o(l),g=null==t?10:+t,p=[];if(!(i%1)&&f-h<g){if(h=Math.round(h)-1,f=Math.round(f)+1,s>0){for(;h<f;++h)for(u=1,c=a(h);u<i;++u)if(!((d=c*u)<s)){if(d>l)break;p.push(d)}}else for(;h<f;++h)for(u=i-1,c=a(h);u>=1;--u)if(!((d=c*u)<s)){if(d>l)break;p.push(d)}}else p=_(h,f,Math.min(f-h,g)).map(a);return e?p.reverse():p},n.tickFormat=function(e,r){if(null==r&&(r=10===i?".0e":","),"function"!=typeof r&&(r=t.format(r)),e===1/0)return r;null==e&&(e=10);var s=Math.max(1,i*e/n.ticks().length);return function(t){var e=t/a(Math.round(o(t)));return e*i<i-.5&&(e*=i),e<=s?r(t):""}},n.nice=function(){return r(Ls(r(),{floor:function(t){return a(Math.floor(o(t)))},ceil:function(t){return a(Math.ceil(o(t)))}}))},n.copy=function(){return Es(n,e().base(i))},n},t.scaleOrdinal=ws,t.scaleImplicit=_s,t.scalePow=Fs,t.scaleSqrt=function(){return Fs().exponent(.5)},t.scaleQuantile=function t(){var n=[],r=[],o=[];function a(){var t=0,e=Math.max(1,r.length);for(o=new Array(e-1);++t<e;)o[t-1]=x(n,t/e);return s}function s(t){if(!isNaN(t=+t))return r[i(o,t)]}return s.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?o[e-1]:n[0],e<o.length?o[e]:n[n.length-1]]},s.domain=function(t){if(!arguments.length)return n.slice();n=[];for(var r,i=0,o=t.length;i<o;++i)null==(r=t[i])||isNaN(r=+r)||n.push(r);return n.sort(e),a()},s.range=function(t){return arguments.length?(r=ys.call(t),a()):r.slice()},s.quantiles=function(){return o.slice()},s.copy=function(){return t().domain(n).range(r)},s},t.scaleQuantize=function t(){var e=0,n=1,r=1,o=[.5],a=[0,1];function s(t){if(t<=t)return a[i(o,t,0,r)]}function l(){var t=-1;for(o=new Array(r);++t<r;)o[t]=((t+1)*n-(t-r)*e)/(r+1);return s}return s.domain=function(t){return arguments.length?(e=+t[0],n=+t[1],l()):[e,n]},s.range=function(t){return arguments.length?(r=(a=ys.call(t)).length-1,l()):a.slice()},s.invertExtent=function(t){var i=a.indexOf(t);return i<0?[NaN,NaN]:i<1?[e,o[0]]:i>=r?[o[r-1],n]:[o[i-1],o[i]]},s.copy=function(){return t().domain([e,n]).range(a)},Ds(s)},t.scaleThreshold=function t(){var e=[.5],n=[0,1],r=1;function o(t){if(t<=t)return n[i(e,t,0,r)]}return o.domain=function(t){return arguments.length?(e=ys.call(t),r=Math.min(e.length,n.length-1),o):e.slice()},o.range=function(t){return arguments.length?(n=ys.call(t),r=Math.min(e.length,n.length-1),o):n.slice()},o.invertExtent=function(t){var r=n.indexOf(t);return[e[r-1],e[r]]},o.copy=function(){return t().domain(e).range(n)},o},t.scaleTime=function(){return Zs(xo,wo,oo,no,to,Qi,Zi,Gi,t.timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)])},t.scaleUtc=function(){return Zs(Wo,Ho,Do,Eo,Ao,ko,Zi,Gi,t.utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)])},t.schemeCategory10=Qs,t.schemeCategory20b=Ks,t.schemeCategory20c=tl,t.schemeCategory20=el,t.scaleSequential=function t(e){var n=0,r=1,i=!1;function o(t){var o=(t-n)/(r-n);return e(i?Math.max(0,Math.min(1,o)):o)}return o.domain=function(t){return arguments.length?(n=+t[0],r=+t[1],o):[n,r]},o.clamp=function(t){return arguments.length?(i=!!t,o):i},o.interpolator=function(t){return arguments.length?(e=t,o):e},o.copy=function(){return t(e).domain([n,r]).clamp(i)},Ds(o)},t.interpolateCubehelixDefault=nl,t.interpolateRainbow=function(t){(t<0||t>1)&&(t-=Math.floor(t));var e=Math.abs(t-.5);return ol.h=360*t-100,ol.s=1.5-1.5*e,ol.l=.8-.9*e,ol+""},t.interpolateWarm=rl,t.interpolateCool=il,t.interpolateViridis=sl,t.interpolateMagma=ll,t.interpolateInferno=cl,t.interpolatePlasma=ul,t.creator=gl,t.customEvent=Cl,t.local=vl,t.matcher=bl,t.mouse=Tl,t.namespace=fl,t.namespaces=hl,t.select=rc,t.selectAll=function(t){return"string"==typeof t?new ec([document.querySelectorAll(t)],[document.documentElement]):new ec([null==t?[]:t],tc)},t.selection=nc,t.selector=Ll,t.selectorAll=Bl,t.touch=ic,t.touches=function(t,e){null==e&&(e=El().touches);for(var n=0,r=e?e.length:0,i=new Array(r);n<r;++n)i[n]=Il(t,e[n]);return i},t.window=Ul,t.active=function(t,e){var n,r,i=t.__transition;if(i)for(r in e=null==e?null:e+"",i)if((n=i[r]).state>lc&&n.name===e)return new Mc([[t]],Ic,e,+r);return null},t.interrupt=yc,t.transition=kc,t.axisTop=function(t){return Fc(Lc,t)},t.axisRight=function(t){return Fc(Nc,t)},t.axisBottom=function(t){return Fc(Bc,t)},t.axisLeft=function(t){return Fc(Pc,t)},t.cluster=function(){var t=Uc,e=1,n=1,r=!1;function i(i){var o,a=0;i.eachAfter(function(e){var n=e.children;n?(e.x=function(t){return t.reduce(qc,0)/t.length}(n),e.y=function(t){return 1+t.reduce($c,0)}(n)):(e.x=o?a+=t(e,o):0,e.y=0,o=e)});var s=function(t){for(var e;e=t.children;)t=e[0];return t}(i),l=function(t){for(var e;e=t.children;)t=e[e.length-1];return t}(i),c=s.x-t(s,l)/2,u=l.x+t(l,s)/2;return i.eachAfter(r?function(t){t.x=(t.x-i.x)*e,t.y=(i.y-t.y)*n}:function(t){t.x=(t.x-c)/(u-c)*e,t.y=(1-(i.y?t.y/i.y:1))*n})}return i.separation=function(e){return arguments.length?(t=e,i):t},i.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],i):r?null:[e,n]},i.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],i):r?[e,n]:null},i},t.hierarchy=jc,t.pack=function(){var t=null,e=1,n=1,r=iu;function i(i){return i.x=e/2,i.y=n/2,t?i.eachBefore(su(t)).eachAfter(lu(r,.5)).eachBefore(cu(1)):i.eachBefore(su(au)).eachAfter(lu(iu,1)).eachAfter(lu(r,i.r/Math.min(e,n))).eachBefore(cu(Math.min(e,n)/(2*i.r))),i}return i.radius=function(e){return arguments.length?(t=null==(n=e)?null:ru(n),i):t;var n},i.size=function(t){return arguments.length?(e=+t[0],n=+t[1],i):[e,n]},i.padding=function(t){return arguments.length?(r="function"==typeof t?t:ou(+t),i):r},i},t.packSiblings=function(t){return nu(t),t},t.packEnclose=Zc,t.partition=function(){var t=1,e=1,n=0,r=!1;function i(i){var o=i.height+1;return i.x0=i.y0=n,i.x1=t,i.y1=e/o,i.eachBefore(function(t,e){return function(r){r.children&&du(r,r.x0,t*(r.depth+1)/e,r.x1,t*(r.depth+2)/e);var i=r.x0,o=r.y0,a=r.x1-n,s=r.y1-n;a<i&&(i=a=(i+a)/2),s<o&&(o=s=(o+s)/2),r.x0=i,r.y0=o,r.x1=a,r.y1=s}}(e,o)),r&&i.eachBefore(uu),i}return i.round=function(t){return arguments.length?(r=!!t,i):r},i.size=function(n){return arguments.length?(t=+n[0],e=+n[1],i):[t,e]},i.padding=function(t){return arguments.length?(n=+t,i):n},i},t.stratify=function(){var t=pu,e=vu;function n(n){var r,i,o,a,s,l,c,u=n.length,d=new Array(u),h={};for(i=0;i<u;++i)r=n[i],s=d[i]=new Yc(r),null!=(l=t(r,i,n))&&(l+="")&&(h[c=hu+(s.id=l)]=c in h?gu:s);for(i=0;i<u;++i)if(s=d[i],null!=(l=e(n[i],i,n))&&(l+="")){if(!(a=h[hu+l]))throw new Error("missing: "+l);if(a===gu)throw new Error("ambiguous: "+l);a.children?a.children.push(s):a.children=[s],s.parent=a}else{if(o)throw new Error("multiple roots");o=s}if(!o)throw new Error("no root");if(o.parent=fu,o.eachBefore(function(t){t.depth=t.parent.depth+1,--u}).eachBefore(Wc),o.parent=null,u>0)throw new Error("cycle");return o}return n.id=function(e){return arguments.length?(t=ru(e),n):t},n.parentId=function(t){return arguments.length?(e=ru(t),n):e},n},t.tree=function(){var t=mu,e=1,n=1,r=null;function i(i){var l=function(t){for(var e,n,r,i,o,a=new xu(t,0),s=[a];e=s.pop();)if(r=e._.children)for(e.children=new Array(o=r.length),i=o-1;i>=0;--i)s.push(n=e.children[i]=new xu(r[i],i)),n.parent=e;return(a.parent=new xu(null,0)).children=[a],a}(i);if(l.eachAfter(o),l.parent.m=-l.z,l.eachBefore(a),r)i.eachBefore(s);else{var c=i,u=i,d=i;i.eachBefore(function(t){t.x<c.x&&(c=t),t.x>u.x&&(u=t),t.depth>d.depth&&(d=t)});var h=c===u?1:t(c,u)/2,f=h-c.x,g=e/(u.x+h+f),p=n/(d.depth||1);i.eachBefore(function(t){t.x=(t.x+f)*g,t.y=t.depth*p})}return i}function o(e){var n=e.children,r=e.parent.children,i=e.i?r[e.i-1]:null;if(n){!function(t){for(var e,n=0,r=0,i=t.children,o=i.length;--o>=0;)(e=i[o]).z+=n,e.m+=n,n+=e.s+(r+=e.c)}(e);var o=(n[0].z+n[n.length-1].z)/2;i?(e.z=i.z+t(e._,i._),e.m=e.z-o):e.z=o}else i&&(e.z=i.z+t(e._,i._));e.parent.A=function(e,n,r){if(n){for(var i,o=e,a=e,s=n,l=o.parent.children[0],c=o.m,u=a.m,d=s.m,h=l.m;s=_u(s),o=yu(o),s&&o;)l=yu(l),(a=_u(a)).a=e,(i=s.z+d-o.z-c+t(s._,o._))>0&&(wu(bu(s,e,r),e,i),c+=i,u+=i),d+=s.m,c+=o.m,h+=l.m,u+=a.m;s&&!_u(a)&&(a.t=s,a.m+=d-u),o&&!yu(l)&&(l.t=o,l.m+=c-h,r=e)}return r}(e,i,e.parent.A||r[0])}function a(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function s(t){t.x*=e,t.y=t.depth*n}return i.separation=function(e){return arguments.length?(t=e,i):t},i.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],i):r?null:[e,n]},i.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],i):r?[e,n]:null},i},t.treemap=function(){var t=Au,e=!1,n=1,r=1,i=[0],o=iu,a=iu,s=iu,l=iu,c=iu;function u(t){return t.x0=t.y0=0,t.x1=n,t.y1=r,t.eachBefore(d),i=[0],e&&t.eachBefore(uu),t}function d(e){var n=i[e.depth],r=e.x0+n,u=e.y0+n,d=e.x1-n,h=e.y1-n;d<r&&(r=d=(r+d)/2),h<u&&(u=h=(u+h)/2),e.x0=r,e.y0=u,e.x1=d,e.y1=h,e.children&&(n=i[e.depth+1]=o(e)/2,r+=c(e)-n,u+=a(e)-n,(d-=s(e)-n)<r&&(r=d=(r+d)/2),(h-=l(e)-n)<u&&(u=h=(u+h)/2),t(e,r,u,d,h))}return u.round=function(t){return arguments.length?(e=!!t,u):e},u.size=function(t){return arguments.length?(n=+t[0],r=+t[1],u):[n,r]},u.tile=function(e){return arguments.length?(t=ru(e),u):t},u.padding=function(t){return arguments.length?u.paddingInner(t).paddingOuter(t):u.paddingInner()},u.paddingInner=function(t){return arguments.length?(o="function"==typeof t?t:ou(+t),u):o},u.paddingOuter=function(t){return arguments.length?u.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):u.paddingTop()},u.paddingTop=function(t){return arguments.length?(a="function"==typeof t?t:ou(+t),u):a},u.paddingRight=function(t){return arguments.length?(s="function"==typeof t?t:ou(+t),u):s},u.paddingBottom=function(t){return arguments.length?(l="function"==typeof t?t:ou(+t),u):l},u.paddingLeft=function(t){return arguments.length?(c="function"==typeof t?t:ou(+t),u):c},u},t.treemapBinary=function(t,e,n,r,i){var o,a,s=t.children,l=s.length,c=new Array(l+1);for(c[0]=a=o=0;o<l;++o)c[o+1]=a+=s[o].value;!function t(e,n,r,i,o,a,l){if(e>=n-1){var u=s[e];return u.x0=i,u.y0=o,u.x1=a,void(u.y1=l)}for(var d=c[e],h=r/2+d,f=e+1,g=n-1;f<g;){var p=f+g>>>1;c[p]<h?f=p+1:g=p}var v=c[f]-d,m=r-v;if(l-o>a-i){var y=(o*m+l*v)/r;t(e,f,v,i,o,a,y),t(f,n,m,i,y,a,l)}else{var _=(i*m+a*v)/r;t(e,f,v,i,o,_,l),t(f,n,m,_,o,a,l)}}(0,l,t.value,e,n,r,i)},t.treemapDice=du,t.treemapSlice=Mu,t.treemapSliceDice=function(t,e,n,r,i){(1&t.depth?Mu:du)(t,e,n,r,i)},t.treemapSquarify=Au,t.treemapResquarify=Cu,t.forceCenter=function(t,e){var n;function r(){var r,i,o=n.length,a=0,s=0;for(r=0;r<o;++r)a+=(i=n[r]).x,s+=i.y;for(a=a/o-t,s=s/o-e,r=0;r<o;++r)(i=n[r]).x-=a,i.y-=s}return null==t&&(t=0),null==e&&(e=0),r.initialize=function(t){n=t},r.x=function(e){return arguments.length?(t=+e,r):t},r.y=function(t){return arguments.length?(e=+t,r):e},r},t.forceCollide=function(t){var e,n,r=1,i=1;function o(){for(var t,o,s,l,c,u,d,h=e.length,f=0;f<i;++f)for(o=kt(e,Tu,Du).visitAfter(a),t=0;t<h;++t)s=e[t],u=n[s.index],d=u*u,l=s.x+s.vx,c=s.y+s.vy,o.visit(g);function g(t,e,n,i,o){var a=t.data,h=t.r,f=u+h;if(!a)return e>l+f||i<l-f||n>c+f||o<c-f;if(a.index>s.index){var g=l-a.x-a.vx,p=c-a.y-a.vy,v=g*g+p*p;v<f*f&&(0===g&&(v+=(g=Iu())*g),0===p&&(v+=(p=Iu())*p),v=(f-(v=Math.sqrt(v)))/v*r,s.vx+=(g*=v)*(f=(h*=h)/(d+h)),s.vy+=(p*=v)*f,a.vx-=g*(f=1-f),a.vy-=p*f)}}}function a(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function s(){if(e){var r,i,o=e.length;for(n=new Array(o),r=0;r<o;++r)i=e[r],n[i.index]=+t(i,r,e)}}return"function"!=typeof t&&(t=Eu(null==t?1:+t)),o.initialize=function(t){e=t,s()},o.iterations=function(t){return arguments.length?(i=+t,o):i},o.strength=function(t){return arguments.length?(r=+t,o):r},o.radius=function(e){return arguments.length?(t="function"==typeof e?e:Eu(+e),s(),o):t},o},t.forceLink=function(t){var e,n,r,i,o,a=Lu,s=function(t){return 1/Math.min(i[t.source.index],i[t.target.index])},l=Eu(30),c=1;function u(r){for(var i=0,a=t.length;i<c;++i)for(var s,l,u,d,h,f,g,p=0;p<a;++p)l=(s=t[p]).source,d=(u=s.target).x+u.vx-l.x-l.vx||Iu(),h=u.y+u.vy-l.y-l.vy||Iu(),d*=f=((f=Math.sqrt(d*d+h*h))-n[p])/f*r*e[p],h*=f,u.vx-=d*(g=o[p]),u.vy-=h*g,l.vx+=d*(g=1-g),l.vy+=h*g}function d(){if(r){var s,l,c=r.length,u=t.length,d=E(r,a);for(s=0,i=new Array(c);s<u;++s)(l=t[s]).index=s,"object"!=typeof l.source&&(l.source=Nu(d,l.source)),"object"!=typeof l.target&&(l.target=Nu(d,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(s=0,o=new Array(u);s<u;++s)l=t[s],o[s]=i[l.source.index]/(i[l.source.index]+i[l.target.index]);e=new Array(u),h(),n=new Array(u),f()}}function h(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+s(t[n],n,t)}function f(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+l(t[e],e,t)}return null==t&&(t=[]),u.initialize=function(t){r=t,d()},u.links=function(e){return arguments.length?(t=e,d(),u):t},u.id=function(t){return arguments.length?(a=t,u):a},u.iterations=function(t){return arguments.length?(c=+t,u):c},u.strength=function(t){return arguments.length?(s="function"==typeof t?t:Eu(+t),h(),u):s},u.distance=function(t){return arguments.length?(l="function"==typeof t?t:Eu(+t),f(),u):l},u},t.forceManyBody=function(){var t,e,n,r,i=Eu(-30),o=1,a=1/0,s=.81;function l(r){var i,o=t.length,a=kt(t,Bu,Pu).visitAfter(u);for(n=r,i=0;i<o;++i)e=t[i],a.visit(d)}function c(){if(t){var e,n,o=t.length;for(r=new Array(o),e=0;e<o;++e)n=t[e],r[n.index]=+i(n,e,t)}}function u(t){var e,n,i,o,a,s=0;if(t.length){for(i=o=a=0;a<4;++a)(e=t[a])&&(n=e.value)&&(s+=n,i+=n*e.x,o+=n*e.y);t.x=i/s,t.y=o/s}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=r[e.data.index]}while(e=e.next)}t.value=s}function d(t,i,l,c){if(!t.value)return!0;var u=t.x-e.x,d=t.y-e.y,h=c-i,f=u*u+d*d;if(h*h/s<f)return f<a&&(0===u&&(f+=(u=Iu())*u),0===d&&(f+=(d=Iu())*d),f<o&&(f=Math.sqrt(o*f)),e.vx+=u*t.value*n/f,e.vy+=d*t.value*n/f),!0;if(!(t.length||f>=a)){(t.data!==e||t.next)&&(0===u&&(f+=(u=Iu())*u),0===d&&(f+=(d=Iu())*d),f<o&&(f=Math.sqrt(o*f)));do{t.data!==e&&(h=r[t.data.index]*n/f,e.vx+=u*h,e.vy+=d*h)}while(t=t.next)}}return l.initialize=function(e){t=e,c()},l.strength=function(t){return arguments.length?(i="function"==typeof t?t:Eu(+t),c(),l):i},l.distanceMin=function(t){return arguments.length?(o=t*t,l):Math.sqrt(o)},l.distanceMax=function(t){return arguments.length?(a=t*t,l):Math.sqrt(a)},l.theta=function(t){return arguments.length?(s=t*t,l):Math.sqrt(s)},l},t.forceSimulation=function(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,s=E(),l=zi(u),c=Qr("tick","end");function u(){d(),c.call("tick",e),n<r&&(l.stop(),c.call("end",e))}function d(){var e,r,l=t.length;for(n+=(o-n)*i,s.each(function(t){t(n)}),e=0;e<l;++e)null==(r=t[e]).fx?r.x+=r.vx*=a:(r.x=r.fx,r.vx=0),null==r.fy?r.y+=r.vy*=a:(r.y=r.fy,r.vy=0)}function h(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,isNaN(e.x)||isNaN(e.y)){var i=Vu*Math.sqrt(n),o=n*zu;e.x=i*Math.cos(o),e.y=i*Math.sin(o)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function f(e){return e.initialize&&e.initialize(t),e}return null==t&&(t=[]),h(),e={tick:d,restart:function(){return l.restart(u),e},stop:function(){return l.stop(),e},nodes:function(n){return arguments.length?(t=n,h(),s.each(f),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(i=+t,e):+i},alphaTarget:function(t){return arguments.length?(o=+t,e):o},velocityDecay:function(t){return arguments.length?(a=1-t,e):1-a},force:function(t,n){return arguments.length>1?(null==n?s.remove(t):s.set(t,f(n)),e):s.get(t)},find:function(e,n,r){var i,o,a,s,l,c=0,u=t.length;for(null==r?r=1/0:r*=r,c=0;c<u;++c)(a=(i=e-(s=t[c]).x)*i+(o=n-s.y)*o)<r&&(l=s,r=a);return l},on:function(t,n){return arguments.length>1?(c.on(t,n),e):c.on(t)}}},t.forceX=function(t){var e,n,r,i=Eu(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vx+=(r[o]-i.x)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=Eu(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:Eu(+t),a(),o):i},o.x=function(e){return arguments.length?(t="function"==typeof e?e:Eu(+e),a(),o):t},o},t.forceY=function(t){var e,n,r,i=Eu(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vy+=(r[o]-i.y)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=Eu(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:Eu(+t),a(),o):i},o.y=function(e){return arguments.length?(t="function"==typeof e?e:Eu(+e),a(),o):t},o},t.drag=function(){var e,n,r=ju,i=Hu,o=Gu,a={},s=Qr("start","drag","end"),l=0;function c(t){t.on("mousedown.drag",u).on("touchstart.drag",f).on("touchmove.drag",g).on("touchend.drag touchcancel.drag",p).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function u(){if(!n&&r.apply(this,arguments)){var o=v("mouse",i.apply(this,arguments),Tl,this,arguments);o&&(rc(t.event.view).on("mousemove.drag",d,!0).on("mouseup.drag",h,!0),Fu(t.event.view),Ou(),e=!1,o("start"))}}function d(){Ru(),e=!0,a.mouse("drag")}function h(){rc(t.event.view).on("mousemove.drag mouseup.drag",null),Uu(t.event.view,e),Ru(),a.mouse("end")}function f(){if(r.apply(this,arguments)){var e,n,o=t.event.changedTouches,a=i.apply(this,arguments),s=o.length;for(e=0;e<s;++e)(n=v(o[e].identifier,a,ic,this,arguments))&&(Ou(),n("start"))}}function g(){var e,n,r=t.event.changedTouches,i=r.length;for(e=0;e<i;++e)(n=a[r[e].identifier])&&(Ru(),n("drag"))}function p(){var e,r,i=t.event.changedTouches,o=i.length;for(n&&clearTimeout(n),n=setTimeout(function(){n=null},500),e=0;e<o;++e)(r=a[i[e].identifier])&&(Ou(),r("end"))}function v(e,n,r,i,u){var d,h,f,g=r(n,e),p=s.copy();if(Cl(new $u(c,"beforestart",d,e,l,g[0],g[1],0,0,p),function(){return null!=(t.event.subject=d=o.apply(i,u))&&(h=d.x-g[0]||0,f=d.y-g[1]||0,!0)}))return function t(o){var s,v=g;switch(o){case"start":a[e]=t,s=l++;break;case"end":delete a[e],--l;case"drag":g=r(n,e),s=l}Cl(new $u(c,o,d,e,s,g[0]+h,g[1]+f,g[0]-v[0],g[1]-v[1],p),p.apply,p,[o,i,u])}}return c.filter=function(t){return arguments.length?(r="function"==typeof t?t:qu(!!t),c):r},c.container=function(t){return arguments.length?(i="function"==typeof t?t:qu(t),c):i},c.subject=function(t){return arguments.length?(o="function"==typeof t?t:qu(t),c):o},c.on=function(){var t=s.on.apply(s,arguments);return t===s?c:t},c},t.dragDisable=Fu,t.dragEnable=Uu,t.voronoi=function(){var t=Yu,e=Xu,n=null;function r(r){return new Id(r.map(function(n,i){var o=[Math.round(t(n,i,r)/Ad)*Ad,Math.round(e(n,i,r)/Ad)*Ad];return o.index=i,o.data=n,o}),n)}return r.polygons=function(t){return r(t).polygons()},r.links=function(t){return r(t).links()},r.triangles=function(t){return r(t).triangles()},r.x=function(e){return arguments.length?(t="function"==typeof e?e:Wu(+e),r):t},r.y=function(t){return arguments.length?(e="function"==typeof t?t:Wu(+t),r):e},r.extent=function(t){return arguments.length?(n=null==t?null:[[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]],r):n&&[[n[0][0],n[0][1]],[n[1][0],n[1][1]]]},r.size=function(t){return arguments.length?(n=null==t?null:[[0,0],[+t[0],+t[1]]],r):n&&[n[1][0]-n[0][0],n[1][1]-n[0][1]]},r},t.zoom=function(){var e,n,r=zd,i=Od,o=0,a=1/0,s=-a,l=a,c=s,u=l,d=250,h=Ur,f=[],g=Qr("start","zoom","end"),p=500,v=150;function m(t){t.on("wheel.zoom",S).on("mousedown.zoom",A).on("dblclick.zoom",C).on("touchstart.zoom",E).on("touchmove.zoom",I).on("touchend.zoom touchcancel.zoom",T).style("-webkit-tap-highlight-color","rgba(0,0,0,0)").property("__zoom",Rd)}function y(t,e){return(e=Math.max(o,Math.min(a,e)))===t.k?t:new Ld(e,t.x,t.y)}function _(t,e,n){var r=e[0]-n[0]*t.k,i=e[1]-n[1]*t.k;return r===t.x&&i===t.y?t:new Ld(t.k,r,i)}function w(t,e){var n=t.invertX(e[0][0])-s,r=t.invertX(e[1][0])-l,i=t.invertY(e[0][1])-c,o=t.invertY(e[1][1])-u;return t.translate(r>n?(n+r)/2:Math.min(0,n)||Math.max(0,r),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function b(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function x(t,e,n){t.on("start.zoom",function(){M(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){M(this,arguments).end()}).tween("zoom",function(){var t=arguments,r=M(this,t),o=i.apply(this,t),a=n||b(o),s=Math.max(o[1][0]-o[0][0],o[1][1]-o[0][1]),l=this.__zoom,c="function"==typeof e?e.apply(this,t):e,u=h(l.invert(a).concat(s/l.k),c.invert(a).concat(s/c.k));return function(t){if(1===t)t=c;else{var e=u(t),n=s/e[2];t=new Ld(n,a[0]-e[0]*n,a[1]-e[1]*n)}r.zoom(null,t)}})}function M(t,e){for(var n,r=0,i=f.length;r<i;++r)if((n=f[r]).that===t)return n;return new k(t,e)}function k(t,e){this.that=t,this.args=e,this.index=-1,this.active=0,this.extent=i.apply(t,e)}function S(){if(r.apply(this,arguments)){var e=M(this,arguments),n=this.__zoom,i=Math.max(o,Math.min(a,n.k*Math.pow(2,-t.event.deltaY*(t.event.deltaMode?120:1)/500))),s=Tl(this);if(e.wheel)e.mouse[0][0]===s[0]&&e.mouse[0][1]===s[1]||(e.mouse[1]=n.invert(e.mouse[0]=s)),clearTimeout(e.wheel);else{if(n.k===i)return;e.mouse=[s,n.invert(s)],yc(this),e.start()}Vd(),e.wheel=setTimeout(function(){e.wheel=null,e.end()},v),e.zoom("mouse",w(_(y(n,i),e.mouse[0],e.mouse[1]),e.extent))}}function A(){if(!n&&r.apply(this,arguments)){var e=M(this,arguments),i=rc(t.event.view).on("mousemove.zoom",function(){Vd(),e.moved=!0,e.zoom("mouse",w(_(e.that.__zoom,e.mouse[0]=Tl(e.that),e.mouse[1]),e.extent))},!0).on("mouseup.zoom",function(){i.on("mousemove.zoom mouseup.zoom",null),Uu(t.event.view,e.moved),Vd(),e.end()},!0),o=Tl(this);Fu(t.event.view),Pd(),e.mouse=[o,this.__zoom.invert(o)],yc(this),e.start()}}function C(){if(r.apply(this,arguments)){var e=this.__zoom,n=Tl(this),o=e.invert(n),a=w(_(y(e,e.k*(t.event.shiftKey?.5:2)),n,o),i.apply(this,arguments));Vd(),d>0?rc(this).transition().duration(d).call(x,a,n):rc(this).call(m.transform,a)}}function E(){if(r.apply(this,arguments)){var n,i,o,a=M(this,arguments),s=t.event.changedTouches,l=s.length;for(Pd(),n=0;n<l;++n)i=s[n],o=[o=ic(this,s,i.identifier),this.__zoom.invert(o),i.identifier],a.touch0?a.touch1||(a.touch1=o):a.touch0=o;if(e&&(e=clearTimeout(e),!a.touch1))return a.end(),void((o=rc(this).on("dblclick.zoom"))&&o.apply(this,arguments));t.event.touches.length===l&&(e=setTimeout(function(){e=null},p),yc(this),a.start())}}function I(){var n,r,i,o,a=M(this,arguments),s=t.event.changedTouches,l=s.length;for(Vd(),e&&(e=clearTimeout(e)),n=0;n<l;++n)r=s[n],i=ic(this,s,r.identifier),a.touch0&&a.touch0[2]===r.identifier?a.touch0[0]=i:a.touch1&&a.touch1[2]===r.identifier&&(a.touch1[0]=i);if(r=a.that.__zoom,a.touch1){var c=a.touch0[0],u=a.touch0[1],d=a.touch1[0],h=a.touch1[1],f=(f=d[0]-c[0])*f+(f=d[1]-c[1])*f,g=(g=h[0]-u[0])*g+(g=h[1]-u[1])*g;r=y(r,Math.sqrt(f/g)),i=[(c[0]+d[0])/2,(c[1]+d[1])/2],o=[(u[0]+h[0])/2,(u[1]+h[1])/2]}else{if(!a.touch0)return;i=a.touch0[0],o=a.touch0[1]}a.zoom("touch",w(_(r,i,o),a.extent))}function T(){var e,r,i=M(this,arguments),o=t.event.changedTouches,a=o.length;for(Pd(),n&&clearTimeout(n),n=setTimeout(function(){n=null},p),e=0;e<a;++e)r=o[e],i.touch0&&i.touch0[2]===r.identifier?delete i.touch0:i.touch1&&i.touch1[2]===r.identifier&&delete i.touch1;i.touch1&&!i.touch0&&(i.touch0=i.touch1,delete i.touch1),i.touch0||i.end()}return m.transform=function(t,e){var n=t.selection?t.selection():t;n.property("__zoom",Rd),t!==n?x(t,e):n.interrupt().each(function(){M(this,arguments).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()})},m.scaleBy=function(t,e){m.scaleTo(t,function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)})},m.scaleTo=function(t,e){m.transform(t,function(){var t=i.apply(this,arguments),n=this.__zoom,r=b(t),o=n.invert(r);return w(_(y(n,"function"==typeof e?e.apply(this,arguments):e),r,o),t)})},m.translateBy=function(t,e,n){m.transform(t,function(){return w(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments))})},k.prototype={start:function(){return 1==++this.active&&(this.index=f.push(this)-1,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(f.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(t){Cl(new Dd(m,t,this.that.__zoom),g.apply,g,[t,this.that,this.args])}},m.filter=function(t){return arguments.length?(r="function"==typeof t?t:Td(!!t),m):r},m.extent=function(t){return arguments.length?(i="function"==typeof t?t:Td([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),m):i},m.scaleExtent=function(t){return arguments.length?(o=+t[0],a=+t[1],m):[o,a]},m.translateExtent=function(t){return arguments.length?(s=+t[0][0],l=+t[1][0],c=+t[0][1],u=+t[1][1],m):[[s,c],[l,u]]},m.duration=function(t){return arguments.length?(d=+t,m):d},m.interpolate=function(t){return arguments.length?(h=t,m):h},m.on=function(){var t=g.on.apply(g,arguments);return t===g?m:t},m},t.zoomIdentity=Nd,t.zoomTransform=Bd,t.brush=function(){return sh(Zd)},t.brushX=function(){return sh(Yd)},t.brushY=function(){return sh(Xd)},t.brushSelection=function(t){var e=t.__brush;return e?e.dim.output(e.selection):null},t.chord=function(){var t=0,e=null,n=null,r=null;function i(i){var o,a,s,l,c,u,d=i.length,h=[],f=p(d),g=[],v=[],m=v.groups=new Array(d),y=new Array(d*d);for(o=0,c=-1;++c<d;){for(a=0,u=-1;++u<d;)a+=i[c][u];h.push(a),g.push(p(d)),o+=a}for(e&&f.sort(function(t,n){return e(h[t],h[n])}),n&&g.forEach(function(t,e){t.sort(function(t,r){return n(i[e][t],i[e][r])})}),l=(o=fh(0,hh-t*d)/o)?t:hh/d,a=0,c=-1;++c<d;){for(s=a,u=-1;++u<d;){var _=f[c],w=g[_][u],b=i[_][w],x=a,M=a+=b*o;y[w*d+_]={index:_,subindex:w,startAngle:x,endAngle:M,value:b}}m[_]={index:_,startAngle:s,endAngle:a,value:h[_]},a+=l}for(c=-1;++c<d;)for(u=c-1;++u<d;){var k=y[u*d+c],S=y[c*d+u];(k.value||S.value)&&v.push(k.value<S.value?{source:S,target:k}:{source:k,target:S})}return r?v.sort(r):v}return i.padAngle=function(e){return arguments.length?(t=fh(0,e),i):t},i.sortGroups=function(t){return arguments.length?(e=t,i):e},i.sortSubgroups=function(t){return arguments.length?(n=t,i):n},i.sortChords=function(t){return arguments.length?(null==t?r=null:(e=t,r=function(t,n){return e(t.source.value+t.target.value,n.source.value+n.target.value)})._=t,i):r&&r._;var e},i},t.ribbon=function(){var t=vh,e=mh,n=yh,r=_h,i=wh,o=null;function a(){var a,s=gh.call(arguments),l=t.apply(this,s),c=e.apply(this,s),u=+n.apply(this,(s[0]=l,s)),d=r.apply(this,s)-dh,h=i.apply(this,s)-dh,f=u*lh(d),g=u*ch(d),p=+n.apply(this,(s[0]=c,s)),v=r.apply(this,s)-dh,m=i.apply(this,s)-dh;if(o||(o=a=_t()),o.moveTo(f,g),o.arc(0,0,u,d,h),d===v&&h===m||(o.quadraticCurveTo(0,0,p*lh(v),p*ch(v)),o.arc(0,0,p,v,m)),o.quadraticCurveTo(0,0,f,g),o.closePath(),a)return o=null,a+""||null}return a.radius=function(t){return arguments.length?(n="function"==typeof t?t:ph(+t),a):n},a.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:ph(+t),a):r},a.endAngle=function(t){return arguments.length?(i="function"==typeof t?t:ph(+t),a):i},a.source=function(e){return arguments.length?(t=e,a):t},a.target=function(t){return arguments.length?(e=t,a):e},a.context=function(t){return arguments.length?(o=null==t?null:t,a):o},a},t.geoAlbers=ev,t.geoAlbersUsa=function(){var t,e,n,r,i,o,a=ev(),s=tv().rotate([154,0]).center([-2,58.5]).parallels([55,65]),l=tv().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(t,e){o=[t,e]}};function u(t){var e=t[0],a=t[1];return o=null,n.point(e,a),o||(r.point(e,a),o)||(i.point(e,a),o)}function d(){return t=e=null,u}return u.invert=function(t){var e=a.scale(),n=a.translate(),r=(t[0]-n[0])/e,i=(t[1]-n[1])/e;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?s:i>=.166&&i<.234&&r>=-.214&&r<-.115?l:a).invert(t)},u.stream=function(n){return t&&e===n?t:(r=[a.stream(e=n),s.stream(n),l.stream(n)],i=r.length,t={point:function(t,e){for(var n=-1;++n<i;)r[n].point(t,e)},sphere:function(){for(var t=-1;++t<i;)r[t].sphere()},lineStart:function(){for(var t=-1;++t<i;)r[t].lineStart()},lineEnd:function(){for(var t=-1;++t<i;)r[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<i;)r[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<i;)r[t].polygonEnd()}});var r,i},u.precision=function(t){return arguments.length?(a.precision(t),s.precision(t),l.precision(t),d()):a.precision()},u.scale=function(t){return arguments.length?(a.scale(t),s.scale(.35*t),l.scale(t),u.translate(a.translate())):a.scale()},u.translate=function(t){if(!arguments.length)return a.translate();var e=a.scale(),o=+t[0],u=+t[1];return n=a.translate(t).clipExtent([[o-.455*e,u-.238*e],[o+.455*e,u+.238*e]]).stream(c),r=s.translate([o-.307*e,u+.201*e]).clipExtent([[o-.425*e+Sh,u+.12*e+Sh],[o-.214*e-Sh,u+.234*e-Sh]]).stream(c),i=l.translate([o-.205*e,u+.212*e]).clipExtent([[o-.214*e+Sh,u+.166*e+Sh],[o-.115*e-Sh,u+.234*e-Sh]]).stream(c),d()},u.fitExtent=function(t,e){return jp(u,t,e)},u.fitSize=function(t,e){return Hp(u,t,e)},u.scale(1070)},t.geoArea=function(t){return sf.reset(),of(t,lf),2*sf},t.geoAzimuthalEqualArea=function(){return Zp(iv).scale(124.75).clipAngle(179.999)},t.geoAzimuthalEqualAreaRaw=iv,t.geoAzimuthalEquidistant=function(){return Zp(ov).scale(79.4188).clipAngle(179.999)},t.geoAzimuthalEquidistantRaw=ov,t.geoBounds=function(t){var e,n,r,i,o,a,s;if(vf=pf=-(ff=gf=1/0),Ef=[],of(t,Df),n=Ef.length){for(Ef.sort(Ff),e=1,o=[r=Ef[0]];e<n;++e)Uf(r,(i=Ef[e])[0])||Uf(r,i[1])?(Rf(r[0],i[1])>Rf(r[0],r[1])&&(r[1]=i[1]),Rf(i[0],r[1])>Rf(r[0],r[1])&&(r[0]=i[0])):o.push(r=i);for(a=-1/0,e=0,r=o[n=o.length-1];e<=n;r=i,++e)i=o[e],(s=Rf(r[1],i[0]))>a&&(a=s,ff=i[0],pf=r[1])}return Ef=If=null,ff===1/0||gf===1/0?[[NaN,NaN],[NaN,NaN]]:[[ff,gf],[pf,vf]]},t.geoCentroid=function(t){qf=$f=jf=Hf=Gf=Wf=Yf=Xf=Zf=Jf=Qf=0,of(t,ig);var e=Zf,n=Jf,r=Qf,i=e*e+n*n+r*r;return i<1e-12&&(e=Wf,n=Yf,r=Xf,$f<Sh&&(e=jf,n=Hf,r=Gf),(i=e*e+n*n+r*r)<1e-12)?[NaN,NaN]:[Bh(n,e)*Th,Hh(r/qh(i))*Th]},t.geoCircle=function(){var t,e,n=pg([0,0]),r=pg(90),i=pg(6),o={point:function(n,r){t.push(n=e(n,r)),n[0]*=Th,n[1]*=Th}};function a(){var a=n.apply(this,arguments),s=r.apply(this,arguments)*Dh,l=i.apply(this,arguments)*Dh;return t=[],e=yg(-a[0]*Dh,-a[1]*Dh,0).invert,xg(o,s,l,1),a={type:"Polygon",coordinates:[t]},t=e=null,a}return a.center=function(t){return arguments.length?(n="function"==typeof t?t:pg([+t[0],+t[1]]),a):n},a.radius=function(t){return arguments.length?(r="function"==typeof t?t:pg(+t),a):r},a.precision=function(t){return arguments.length?(i="function"==typeof t?t:pg(+t),a):i},a},t.geoClipExtent=function(){var t,e,n,r=0,i=0,o=960,a=500;return n={stream:function(n){return t&&e===n?t:t=Lg(r,i,o,a)(e=n)},extent:function(s){return arguments.length?(r=+s[0][0],i=+s[0][1],o=+s[1][0],a=+s[1][1],t=e=null,n):[[r,i],[o,a]]}}},t.geoConicConformal=function(){return Qp(cv).scale(109.5).parallels([30,30])},t.geoConicConformalRaw=cv,t.geoConicEqualArea=tv,t.geoConicEqualAreaRaw=Kp,t.geoConicEquidistant=function(){return Qp(dv).scale(131.154).center([0,13.9389])},t.geoConicEquidistantRaw=dv,t.geoDistance=function(t,e){return qg[0]=t,qg[1]=e,Ug($g)},t.geoEquirectangular=function(){return Zp(uv).scale(152.63)},t.geoEquirectangularRaw=uv,t.geoGnomonic=function(){return Zp(hv).scale(144.049).clipAngle(60)},t.geoGnomonicRaw=hv,t.geoGraticule=Gg,t.geoGraticule10=function(){return Gg()()},t.geoIdentity=function(){var t,e,n,r,i,o,a=1,s=0,l=0,c=1,u=1,d=Jg,h=null,f=Jg;function g(){return r=i=null,o}return o={stream:function(t){return r&&i===t?r:r=d(f(i=t))},clipExtent:function(r){return arguments.length?(f=null==r?(h=t=e=n=null,Jg):Lg(h=+r[0][0],t=+r[0][1],e=+r[1][0],n=+r[1][1]),g()):null==h?null:[[h,t],[e,n]]},scale:function(t){return arguments.length?(d=fv((a=+t)*c,a*u,s,l),g()):a},translate:function(t){return arguments.length?(d=fv(a*c,a*u,s=+t[0],l=+t[1]),g()):[s,l]},reflectX:function(t){return arguments.length?(d=fv(a*(c=t?-1:1),a*u,s,l),g()):c<0},reflectY:function(t){return arguments.length?(d=fv(a*c,a*(u=t?-1:1),s,l),g()):u<0},fitExtent:function(t,e){return jp(o,t,e)},fitSize:function(t,e){return Hp(o,t,e)}}},t.geoInterpolate=function(t,e){var n=t[0]*Dh,r=t[1]*Dh,i=e[0]*Dh,o=e[1]*Dh,a=Ph(r),s=Fh(r),l=Ph(o),c=Fh(o),u=a*Ph(n),d=a*Fh(n),h=l*Ph(i),f=l*Fh(i),g=2*Hh(qh(Gh(o-r)+a*l*Gh(i-n))),p=Fh(g),v=g?function(t){var e=Fh(t*=g)/p,n=Fh(g-t)/p,r=n*u+e*h,i=n*d+e*f,o=n*s+e*c;return[Bh(i,r)*Th,Bh(o,qh(r*r+i*i))*Th]}:function(){return[n*Th,r*Th]};return v.distance=g,v},t.geoLength=Ug,t.geoMercator=function(){return sv(av).scale(961/Ih)},t.geoMercatorRaw=av,t.geoOrthographic=function(){return Zp(gv).scale(249.5).clipAngle(90+Sh)},t.geoOrthographicRaw=gv,t.geoPath=function(t,e){var n,r,i=4.5;function o(t){return t&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),of(t,n(r))),r.result()}return o.area=function(t){return of(t,n(tp)),tp.result()},o.bounds=function(t){return of(t,n(cp)),cp.result()},o.centroid=function(t){return of(t,n(Mp)),Mp.result()},o.projection=function(e){return arguments.length?(n=null==e?(t=null,Jg):(t=e).stream,o):t},o.context=function(t){return arguments.length?(r=null==t?(e=null,new Bp):new Np(e=t),"function"!=typeof i&&r.pointRadius(i),o):e},o.pointRadius=function(t){return arguments.length?(i="function"==typeof t?t:(r.pointRadius(+t),+t),o):i},o.projection(t).context(e)},t.geoProjection=Zp,t.geoProjectionMutator=Jp,t.geoRotation=function(t){function e(e){return(e=t(e[0]*Dh,e[1]*Dh))[0]*=Th,e[1]*=Th,e}return t=yg(t[0]*Dh,t[1]*Dh,t.length>2?t[2]*Dh:0),e.invert=function(e){return(e=t.invert(e[0]*Dh,e[1]*Dh))[0]*=Th,e[1]*=Th,e},e},t.geoStereographic=function(){return Zp(pv).scale(250).clipAngle(142)},t.geoStereographicRaw=pv,t.geoStream=of,t.geoTransform=function(t){return{stream:qp(t)}},t.geoTransverseMercator=function(){var t=sv(vv),e=t.center,n=t.rotate;return t.center=function(t){return arguments.length?e([-t[1],t[0]]):[(t=e())[1],-t[0]]},t.rotate=function(t){return arguments.length?n([t[0],t[1],t.length>2?t[2]+90:90]):[(t=n())[0],t[1],t[2]-90]},n([0,0,90]).scale(159.155)},t.geoTransverseMercatorRaw=vv,t}]),app.factory("dashboardService",["$interval","$http","$uibModal","gridService",function(t,e,n,r){var i,o,a,s={lockLeft:!1,lockRight:!1},l={},c="",u=[],d={missionName:"",missionImage:""},h={sIcon:"",gIcon:"",pIcon:"",dIcon:""},f=0,g={value:!0};function p(n){var o="";0===f&&!0!==i&&(g.value=!0),t(function(){e({url:"/getTelemetry",method:"GET",params:{mission:n}}).then(function(t){if(t.data){for(var e in t.data.telemetry)l[e]=t.data.telemetry[e];l.data=t.data.telemetry,l.time=t.data.timestamp,c=t.data.timestamp,f++,g.value=!1,!0===r.getGridLoader().gridLoader&&r.setGridLoader(!1)}else l={},f++,g.value=!1,!0===r.getGridLoader().gridLoader&&r.setGridLoader(!1);!1===y(t.data)?o===t.data._id?(h.sIcon="grey",h.gIcon="red",h.pIcon="green",h.dIcon="blue",f++,g.value=!1,!0===r.getGridLoader().gridLoader&&r.setGridLoader(!1)):(h.sIcon="green",h.gIcon="green",h.pIcon="green",h.dIcon="green",o=t.data._id,f++,g.value=!1,!0===r.getGridLoader().gridLoader&&r.setGridLoader(!1)):(h.sIcon="red",h.gIcon="green",h.pIcon="green",h.dIcon="green",f++,g.value=!1,!0===r.getGridLoader().gridLoader&&r.setGridLoader(!1))},function(t){h.sIcon="grey",h.gIcon="grey",h.pIcon="grey",h.dIcon="red",f++,g.value=!1,!0===r.getGridLoader().gridLoader&&r.setGridLoader(!1)})},1e3)}function v(t){return t<10&&(t="0"+t),t}function m(t){return t<10?t="00"+t:t<100&&(t="0"+t),t}function y(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function _(t){d.missionName=t.missionName,d.missionImage=t.missionImage}return""!==(o=r.getDashboard()).current.mission.missionName?(r.setMissionForUser(o.current.mission.missionName),_(o.current.mission),p(o.current.mission.missionName)):function(t){g.value=!1,e({url:"/getMissions",method:"GET",params:{}}).then(function(e){for(var o=0;o<e.data.length;o++){var a=r.getMissionImage(e.data[o].mission);t.push({missionName:e.data[o].mission,missionImage:a})}n.open({templateUrl:"./components/dashboard/missionModal.html",controller:"missionModalCtrl",controllerAs:"$ctrl",backdrop:"static"}).result.then(function(t){t&&(i=!0,r.setMissionForLayout(t.missionName),p(t.missionName))},function(){alert("No mission selected!Reload the page for options.")})},function(t){alert("No mission available!")})}(u),a=0,t(function(){e({url:"/getProxyStatus",method:"GET",params:{}}).then(function(t){""!==t.data?a!==t.data.proxytimestamp?(h.pIcon="green",a=t.data.proxytimestamp):(h.sIcon="grey",h.gIcon="grey",h.pIcon="red",h.dIcon="green"):h.pIcon="grey"},function(t){h.sIcon="grey",h.gIcon="grey",h.pIcon="grey",h.dIcon="red"})},5e3),{locks:s,telemetry:l,missions:u,icons:h,getLock:function(){return s},setLeftLock:function(t){s.lockLeft=t},setRightLock:function(t){s.lockRight=t},getTime:function(t){var e="000",n="00",r="00",i="00",o=e+"."+n+":"+r+":"+i+" UTC";if(""!=c){var a=moment(c).tz(t),s=a.toDate();o=(e=m(a.dayOfYear()))+"."+(n=v(a.hours()))+":"+(r=v(a.minutes()))+":"+(i=v(a.seconds()))+" UTC"}return{today:s,days:e,hours:n,minutes:r,seconds:i,utc:o}},countdown:function(t){var e,n="000",r="00",i="00",o="00",a="";if(""!=c){var s=moment(t).tz("UTC"),l=moment(c).tz("UTC");l.isAfter(s)?(e=l.diff(s),a="+"):(e=s.diff(l),a="-");var u=moment.duration(e);n=Math.floor(u.asDays()),r=u.hours(),i=u.minutes(),o=u.seconds(),n=m(n),r=v(r),i=v(i),o=v(o)}return{days:n,hours:r,minutes:i,seconds:o,sign:a}},isEmpty:y,sortObject:function(t){var e,n={},r=[];for(e in t)t.hasOwnProperty(e)&&r.push(e);for(r.sort(),e=0;e<r.length;e++)n[r[e]]=t[r[e]];return n},getData:function(t){var e=t.split("."),n=l.data;if(t&&n){for(var r=0;r<e.length;++r){if(null==n[e[r]])return;n=n[e[r]]}return n}return null},setCurrentMission:_,getCurrentMission:function(){return d},getConfig:function(t){return e({url:"/getConfig",method:"GET",params:{mission:t}})},getTelemetryValues:function(){return l},getLoadStatus:function(){return g},setLoadStatus:function(t){g.value=t}}}]),app.factory("datastatesService",function(){var t={colorAlarm:"red",colorCaution:"orange",colorHealthy:"green"},e={alarm:{color:"#FF0000",alert:"ALARM",bound:""},caution:{color:"#FFFF00",alert:"CAUTION",bound:""},healthy:{color:"#12C700",alert:"",bound:"NORMAL"}};return{getDataColor:function(e,n,r,i,o,a){var s,l,c,u,d;return"number"===a?(s=parseFloat(e),l=parseFloat(n),c=parseFloat(r),u=parseFloat(i),d=parseFloat(o)):(s=new Date(e),l=new Date(n),c=new Date(r),u=new Date(i),d=new Date(o)),null!==e&&null!==n&&null!==i&&null!==o?c<s||c>l?t.colorAlarm:c<u||c>d?t.colorCaution:t.colorHealthy:null===e&&null===n&&null===i&&null===o?t.colorHealthy:null===e||null===n||null===i||null===o?null!==e&&null===n&&null===i&&null===o?c<s?t.colorAlarm:t.colorHealthy:null===e&&null!==n&&null===i&&null===o?c>l?t.colorAlarm:t.colorHealthy:null===e&&null===n&&null!==i&&null===o?c<u?t.colorCaution:t.colorHealthy:null===e&&null===n&&null===i&&null!==o?c>d?t.colorCaution:t.colorHealthy:null!==e&&null!==n&&null===i&&null===o?c<s||c>l?t.colorAlarm:t.colorHealthy:null!==e&&null===n&&null!==i&&null===o?c<s?t.colorAlarm:c<u?t.colorCaution:t.colorHealthy:null===e&&null!==n&&null===i&&null!==o?c>l?t.colorAlarm:c>d?t.colorCaution:t.colorHealthy:null===e&&null===n&&null!==i&&null!==o&&(c<u||c>d)?t.colorCaution:t.colorHealthy:t.colorHealthy},colorValues:{alarmcolor:{color:"#FF0000"},cautioncolor:{color:"#FF6D00"},stalecolor:{color:"#71A5BC"},healthycolor:{color:"#12C700"},disconnectedcolor:{color:"#CFCFD5"},defaultcolor:{color:"#000000"}},colorBoundObj:e,getDataColorBound:function(t,n,r,i,o,a){var s,l,c,u,d;return"number"===a?(s=parseFloat(t),l=parseFloat(n),c=parseFloat(r),u=parseFloat(i),d=parseFloat(o)):(s=new Date(t),l=new Date(n),c=new Date(r),u=new Date(i),d=new Date(o)),null!==t&&null!==n&&null!==i&&null!==o?c<s||c>l?(c<s&&c<l?e.alarm.bound="LOW":c>l&&c>s&&(e.alarm.bound="HIGH"),e.alarm):c<u||c>d?(c<u&&c<d?e.caution.bound="LOW":c>d&&c>u&&(e.caution.bound="HIGH"),e.caution):e.healthy:null===t&&null===n&&null===i&&null===o?e.healthy:null===t||null===n||null===i||null===o?null!==t&&null===n&&null===i&&null===o?c<s?(e.alarm.bound="LOW",e.alarm):e.healthy:null===t&&null!==n&&null===i&&null===o?c>l?(e.alarm.bound="HIGH",e.alarm):e.healthy:null===t&&null===n&&null!==i&&null===o?c<u?(e.caution.bound="LOW",e.caution):e.healthy:null===t&&null===n&&null===i&&null!==o?c>d?(e.caution.bound="HIGH",e.caution):e.healthy:null!==t&&null!==n&&null===i&&null===o?c<s||c>l?(c<s&&c<l?e.alarm.bound="LOW":c>l&&c>s&&(e.alarm.bound="HIGH"),e.alarm):e.healthy:null!==t&&null===n&&null!==i&&null===o?c<s?(e.alarm.bound="LOW",e.alarm):c<u?(e.caution.bound="LOW",e.caution):e.healthy:null===t&&null!==n&&null===i&&null!==o?c>l?(e.alarm.bound="HIGH",e.alarm):c>d?(e.caution.bound="HIGH",e.caution):e.healthy:null===t&&null===n&&null!==i&&null!==o&&(c<u||c>d)?(c<u&&c<d?e.caution.bound="LOW":c>d&&c>u&&(e.caution.bound="HIGH"),e.caution):e.healthy:e.healthy}}}),app.factory("gridService",gridService),app.factory("odeService",[function(){function t(t,e,n,r){return Math.abs(n)+Math.abs(e*r)+1e-32}function e(t,e,n){return Math.max(e,Math.abs(n))}function n(t){return t}function r(t,e){return(t>0?Math.min:Math.max)(t,e)}function i(t,e){return(t>0?Math.max:Math.min)(t,e)}var o=function(r,i,o,a,s){var l=s||{};this.tol=void 0===l.tol?1e-8:l.tol,this.maxIncreaseFactor=void 0===l.maxIncreaseFactor?10:l.maxIncreaseFactor,this.maxDecreaseFactor=void 0===l.maxDecreaseFactor?10:l.maxDecreaseFactor,this.dtMinMag=void 0===l.dtMinMag?0:Math.abs(l.dtMinMag),this.dtMaxMag=void 0===l.dtMaxMag?void 0:Math.abs(l.dtMaxMag),this.verbose=void 0===l.verbose||!!l.verbose;var c=0,u=!1;this.__log=function(t,e){this.verbose&&(c<10?(console.log("ode45-cash-karp::"+t+"(): "+e),c++):u||(console.log("ode45-cash-karp: too many warnings. Silencing further output"),u=!0))}.bind(this),this.errorScaleFunction=void 0===l.errorScaleFunction?t:l.errorScaleFunction,this.errorReduceFunction=void 0===l.errorReduceFunction?e:l.errorReduceFunction,this.errorPostFunction=void 0===l.errorPostFunction?n:l.errorPostFunction,this.safetyFactor=void 0===l.safetyFactor?.9:l.safetyFactor,this.deriv=i,this.y=r,this.n=this.y.length,this.dt=a,this.t=o,this._ctor=this.y.constructor,this._errorScale=new this._ctor(this.n),this._w=new this._ctor(this.n),this._k1=new this._ctor(this.n),this._k2=new this._ctor(this.n),this._k3=new this._ctor(this.n),this._k4=new this._ctor(this.n),this._k5=new this._ctor(this.n),this._k6=new this._ctor(this.n)};return o.prototype._calculateK1=function(){return this.deriv(this._k1,this.y,this.t),this},o.prototype._calculateKs=function(t){var e;for(e=0;e<this.n;e++)this._w[e]=this.y[e]+t*(.2*this._k1[e]);for(this.deriv(this._k2,this._w,this.t+.2*t),e=0;e<this.n;e++)this._w[e]=this.y[e]+t*(.075*this._k1[e]+.225*this._k2[e]);for(this.deriv(this._k3,this._w,this.t+.3*t),e=0;e<this.n;e++)this._w[e]=this.y[e]+t*(.3*this._k1[e]+-.9*this._k2[e]+1.2*this._k3[e]);for(this.deriv(this._k4,this._w,this.t+.6*t),e=0;e<this.n;e++)this._w[e]=this.y[e]+t*(-.2037037037037037*this._k1[e]+2.5*this._k2[e]+-2.5925925925925926*this._k3[e]+1.2962962962962963*this._k4[e]);for(this.deriv(this._k5,this._w,this.t+t),e=0;e<this.n;e++)this._w[e]=this.y[e]+t*(.029495804398148147*this._k1[e]+.341796875*this._k2[e]+.041594328703703706*this._k3[e]+.40034541377314814*this._k4[e]+.061767578125*this._k5[e]);return this.deriv(this._k6,this._w,this.t+.875*t),this},o.prototype._calculateError=function(t){for(var e=0,n=0;n<this.n;n++)e=this.errorReduceFunction(n,e,t*(.004293774801587301*this._k1[n]+-.018668586093857832*this._k3[n]+.03415502683080808*this._k4[n]+.019321986607142856*this._k5[n]+-.03910220214568041*this._k6[n])/this._errorScale[n]);return this.errorPostFunction(e)},o.prototype._update=function(t){for(var e=0;e<this.n;e++)this.y[e]+=t*(.09788359788359788*this._k1[e]+.4025764895330113*this._k3[e]+.21043771043771042*this._k4[e]+.2891022021456804*this._k6[e]);return this.t+=t,this},o.prototype._calculateErrorScale=function(t){for(var e=0;e<this.n;e++)this._errorScale[e]=this.errorScaleFunction(e,t,this.y[e],this._k1[e]);return this},o.prototype.step=function(t){if(Math.abs(this.t-t)<1e-10*this.dt)return!1;var e=this.dt;void 0!==t&&(e=e>0?Math.min(t-this.t,e):Math.max(t-this.t,e)),void 0!==this.dtMaxMag&&Math.abs(e)>this.dtMaxMag&&(this.__log("step","step greater than maximum stepsize requested. dt magnitude has been limited."),e=e>0?this.dtMaxMag:-this.dtMaxMag),void 0!==this.dtMinMag&&Math.abs(e)<this.dtMinMag&&(this.__log("step","step smaller than minimum stepsize requested. dt magnitude has been limited."),e=e>0?this.dtMinMag:-this.dtMinMag),this._calculateK1(),this._calculateErrorScale(e);for(var n,o=1/0,a=!1;this._calculateKs(e),!((o=this._calculateError(e))<this.tol||a);){if(!Number.isFinite(o))throw new Error("ode45-cash-karp::step() NaN encountered while integrating.");n=this.safetyFactor*e*Math.pow(this.tol/o,.2),e=i(e/this.maxDecreaseFactor,n),void 0!==this.dtMinMag&&Math.abs(e)<this.dtMinMag&&(e=this.dtMinMag*(e>0?1:-1),this.__log("step","minimum stepsize reached."),a=!0)}return this._update(e),n=this.safetyFactor*e*Math.pow(this.tol/o,.25),this.dt=i(this.dt/this.maxDecreaseFactor,r(this.dt*this.maxIncreaseFactor,n)),void 0===t||Math.abs(this.t-t)>1e-8*this.dt},o.prototype.steps=function(t,e){for(var n=0;n<t;n++)if(!this.step(e))return!1},{defaultErrorScaleFunction:t,defaultErrorReduceFunction:e,defaultErrorPostFunction:n,minMag:r,maxMag:i,Integrator:o,IntegratorFactory:function(t,e,n,r,i){return new o(t,e,n,r,i)}}}]),app.factory("sidebarService",["dashboardService",function(t){var e,n,r=!1,i=!1;return{setVehicleInfo:function(r){var i={vehicle:"",id:"",key:"",category:""};if(r){if(e&&n){var o=r.split(".");i.vehicle=o[0],i.id=o[o.length-1],i.category=o[o.length-2],i.key=r;var a=i;e.settings.dataArray.push(a);var s=t.getData(a.key);s&&s.hasOwnProperty("value")?n.getValue(!1):n.getValue(!0)}}else i={vehicle:"",id:"",key:"",category:""}},setMenuStatus:function(t){r=t},getMenuStatus:function(){return r},setTempWidget:function(t,r){e=t,n=r},setOpenLogo:function(t){i=t},getOpenLogo:function(){return i}}}]),app.factory("solarService",["d3Service",function(t){var e=Math.PI,n=e/180,r=180/e;function i(t){var e=f(t),n=l(t),r=c(t),i=Math.tan(d(t)/2);return(i*=i)*Math.sin(2*r)-2*e*Math.sin(n)+4*e*i*Math.sin(n)*Math.cos(2*r)-.5*i*i*Math.sin(4*r)-1.25*e*e*Math.sin(2*n)}function o(t){return Math.asin(Math.sin(d(t))*Math.sin(a(t)))}function a(t){return s(t)-(.00569+.00478*Math.sin((125.04-1934.136*t)*n))*n}function s(t){return c(t)+u(t)}function l(t){return(357.52911+t*(35999.05029-1537e-7*t))*n}function c(t){var n=(280.46646+t*(36000.76983+3032e-7*t))%360;return(n<0?n+360:n)/180*e}function u(t){var e=l(t);return(Math.sin(e)*(1.914602-t*(.004817+14e-6*t))+Math.sin(e+e)*(.019993-101e-6*t)+289e-6*Math.sin(e+e+e))*n}function d(t){return h(t)+.00256*Math.cos((125.04-1934.136*t)*n)*n}function h(t){return(23+(26+(21.448-t*(46.815+t*(59e-5-.001813*t)))/60)/60)*n}function f(t){return.016708634-t*(42037e-9+1.267e-7*t)}return{solarPosition:function(e){var n=(e-Date.UTC(2e3,0,1,12))/864e5/36525;return[(t.utcDay.floor(e)-e)/864e5*360-180-i(n)*r,o(n)*r]},equationOfTime:i,solarDeclination:o,solarApparentLongitude:a,solarTrueLongitude:s,solarGeometricMeanAnomaly:l,solarGeometricMeanLongitude:c,solarEquationOfCenter:u,obliquityCorrection:d,meanObliquityOfEcliptic:h,eccentricityEarthOrbit:f,longLat2ECEF:function(t,e){return[Math.cos(t),Math.sin(t),Math.sin(e)]},date2JulianDate:function(t){var e=t.getUTCFullYear(),n=t.getUTCMonth()+1,r=t.getUTCDate(),i=t.getUTCHours(),o=t.getUTCMinutes(),a=t.getUTCSeconds(),s=7*(e+Math.floor((n+9)/12)),l=(a/60+o)/60+i;return 367*e-Math.floor(s/4)+Math.floor(275*n/9)+r+1721013.5+l/24}}}]),app.factory("statusboardService",["$http","dashboardService","datastatesService",function(t,e,n){var r={statustable:[]},i={alarmcolor:{background:"#FF0000"},cautioncolor:{background:"#FFFF00"},stalecolor:{background:"#71A5BC"},healthycolor:{background:"#12C700"},inactivecolor:{color:"#CFCFD5"},defaultcolor:{background:"#000000"},activecolor:{color:"#000000"}},o=[],a={colorclasses:[],checkedstatus:[]},s=e.getCurrentMission(),l={};function c(){return t({url:"/loadAlerts",method:"GET",params:{missionname:s.missionName}})}function u(t){var e,r,o=n.colorBoundObj;return e=h(t,o.alarm.color),r=h(t,o.caution.color),h(t,o.healthy.color),e>=1?i.alarmcolor:0===e&&r>=1?i.cautioncolor:0===e&&0===r?i.healthycolor:void 0}function d(t,n,r,i){c().then(function(r){if(l=r.data,!e.isEmpty(l)){var o=l.vehiclecolors;o.length>0&&("#FF0000"===t.background?(a.checkedstatus[n]=!1,!0===o[n].status?(i[n].ackStatus=!0,a.colorclasses[n]="buttonNone"):a.colorclasses[n]="buttonred"):"#FFFF00"===t.background?(a.checkedstatus[n]=!1,!0===o[n].status?(i[n].ackStatus=!0,a.colorclasses[n]="buttonNone"):a.colorclasses[n]="buttonyellow"):(a.colorclasses[n]="buttonNone",a.checkedstatus[n]=!0))}})}function h(t,e){for(var n=0,r=0;r<t.length;r++)t[r]===e&&n++;return n}return{getStatusTable:function(){return r},setSubSystemColors:function(t){for(var e=0;e<t.length;e++)for(var n=0;n<t[e].categories.length;n++)t[e].categoryColors[n]=u(t[e].subCategoryColors);!function(t){o=[];for(var e=0;e<t.length;e++){var n=[];a.colorclasses[e]="";for(var r=0;r<t[e].categoryColors.length;r++){n.push(t[e].categoryColors[r].background);var i=u(n);t[e].vehicleColor=i,o.push({vehicle:t[e].vehicle,color:i}),d(t[e].vehicleColor,e,t[e].vehicle,t)}}}(t)},getMasterAlarmColors:function(){return a},setAlertsTable:function(){if(!e.isEmpty(l)){var t=l.statusboard;if(t.length>0){var n=(c=t,u=JSON.stringify,d={},c.filter(function(t){var e=u(t);return!d.hasOwnProperty(e)&&(d[e]=!0)})).slice(0);n.sort(function(t,e){return e.timestamp-t.timestamp});for(var a=0;a<o.length;a++)for(var s=0;s<n.length;s++)o[a].vehicle===n[s].vehicle&&o[a].color===i.healthycolor&&(n[s].rowstyle=i.inactivecolor);r.statustable=n}else r.statustable=[]}var c,u,d},saveAlerts:function(e,n){return t({url:"/saveAlerts",method:"POST",data:{missionname:s.missionName,statusdata:e,vehicleColors:n}})},loadAlerts:c}}]),app.factory("userService",["$http","$window",function(t,e){var n={cRole:e.user.currentRole};function r(){return e.user.google&&e.user.google.email?e.user.google.email:""}return{userRole:n,getUserName:function(){return e.user.google&&e.user.google.name?e.user.google.name:""},getUserEmail:r,getCurrentRole:function(n){return t({url:"/getCurrentRole",method:"GET",params:{email:e.user.google.email,mission:n}})},getAllowedRoles:function(n){return t({url:"/getAllowedRoles",method:"GET",params:{email:e.user.google.email,mission:n}})},setCurrentRole:function(e,i){n.cRole=e;var o=r();return t({url:"/setUserRole",method:"POST",data:{email:o,role:e,mission:i}})},getUsers:function(e){return t({url:"/getUsers",method:"GET",params:{mission:e}})},getRoles:function(){return t({url:"/getRoles",method:"GET"})},setAllowedRoles:function(e,n,r){return t({url:"/setAllowedRoles",method:"POST",data:{email:e.google.email,roles:n,mission:r}})},setMissionForUser:function(e,n){return t({url:"/setMissionForUser",method:"POST",data:{email:e,mission:n}})}}}]),app.directive("quindarwidget",["$compile",function(t){return{restrict:"AE",scope:{quindarwidget:"@",widget:"=widget"},replace:!0,controller:["$scope",function(t){t.$watch("quindarwidget",function(e){t.buildView(e)})}],link:function(e,n,r){e.buildView=function(r){var i=t("<"+r+"></"+r+">")(e);n.append(i)}}}}]),app.directive("alarmpanel",function(){return{restrict:"E",templateUrl:"./directives/alarmpanel/alarmpanel.html",controller:"AlarmPanelCtrl",controllerAs:"vm",bindToController:!0}}),app.controller("AlarmPanelCtrl",["$scope","$interval","dashboardService","datastatesService","userService","statusboardService",function(t,e,n,r,i,o){t.telemetry=n.telemetry;var a=100;t.alarmpanel=o.getStatusTable();var s,l="";t.name=i.getUserName(),t.role=i.userRole,t.contents=[],t.masteralarmstatus=o.getMasterAlarmColors(),t.class=[],t.vehicleColors=[],t.configInterval=e(function(){var e=n.telemetry;if(!n.isEmpty(e)){var r=n.sortObject(e.data);for(var i in r)if(r.hasOwnProperty(i)){var o=t.contents.findIndex(t=>t.vehicle===i);-1==o?(t.contents.push({vehicle:i,flexprop:"",categories:Object.keys(r[i]),vehicleColor:"",categoryColors:[],tableArray:[],subCategoryColors:[],ackStatus:!1}),t.vehicleColors.push({vehicle:i,status:!1})):t.contents[o].categories=Object.keys(r[i])}if(t.contents.length>0)for(var s=0;s<t.contents.length;s++)t.contents[s].flexprop=a/t.contents.length}},1e3),t.updateColors=function(){var e,i,a,c,u,d,h=[];s=n.getTime("UTC");for(var f=0;f<t.contents.length;f++){if(t.contents[f].tableArray=[],t.contents[f].subCategoryColors=[],t.contents[f].vehicle&&!1===n.isEmpty(t.telemetry)){var g=t.contents[f].vehicle;if(t.contents[f].categories.length>0)for(var p=t.contents[f].categories,v=0;v<p.length;v++)for(var m in t.telemetry[g][p[v]])if(t.telemetry[g][p[v]].hasOwnProperty(m))for(var y in t.telemetry[g][p[v]][m])if(t.telemetry[g][p[v]][m].hasOwnProperty(y)){var _=t.telemetry[g][p[v]][m][y];e=_.alarm_low,i=_.alarm_high,a=_.value,c=_.warn_low,u=_.warn_high,d=typeof _.value;var w=r.getDataColorBound(e,i,a,c,u,d);t.contents[f].subCategoryColors.push(w.color);var b=g+"."+p[v]+"."+m+"."+y,x=Math.round(s.today/1e3);l="","ALARM"!==w.alert&&"CAUTION"!==w.alert||(t.contents[f].ackStatus=!1,t.contents[f].tableArray.push({alert:w.alert,bound:w.bound,vehicle:g,time:s.utc,channel:b,ack:l,timestamp:x}))}h=h.concat(t.contents[f].tableArray)}t.vehicleColors[f].status=!1}h.length>0&&t.vehicleColors.length>0&&o.saveAlerts(h,t.vehicleColors),t.contents.length>0&&(o.setSubSystemColors(t.contents),o.setAlertsTable())},t.addtablerow=function(e,n,r){var i=[];l=t.name+" - "+t.role.cRole.callsign;var a=t.contents[n].tableArray.length;"#FF0000"!==r.background&&"#FFFF00"!==r.background||(t.contents[n].ackStatus=!0,t.class[n]="buttonNone");for(var s=0;s<t.contents.length;s++)s===n&&(t.vehicleColors[s].status=!0);for(var c=0;c<a;c++)t.contents[n].tableArray[c].ack=l,i.push(t.contents[n].tableArray[c]);o.saveAlerts(i,t.vehicleColors)},t.interval=e(t.updateColors,1e3,0,!1),t.$on("$destroy",function(n){e.cancel(t.interval),e.cancel(t.configInterval)})}]),app.directive("alarmpanelsettings",function(){return{restrict:"E",templateUrl:"./directives/alarmpanel/alarmpanelsettings.html",controller:"AlarmSettingsCtrl"}}),app.controller("AlarmSettingsCtrl",["$scope",function(t){t.statusboard=t.widget.settings.statusboard,t.saveAlarmPanelSettings=function(e){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,e.settings.statusboard=t.statusboard},t.closeAlarmPanelSettings=function(e){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,t.statusboard=e.settings.statusboard}}]),app.directive("clock",function(){return{restrict:"E",templateUrl:"./directives/clock/clock.html",controller:"ClockCtrl"}}),app.controller("ClockCtrl",["$scope","dashboardService","datastatesService","$interval",function(t,e,n,r){var i="",o={},a=n.colorValues.alarmcolor,s=n.colorValues.cautioncolor,l=n.colorValues.healthycolor,c=n.colorValues.stalecolor,u=n.colorValues.disconnectedcolor,d=n.colorValues.defaultcolor;t.statusIcons=e.icons,t.$watch("statusIcons",function(t,e){o=t},!0),t.checkForClockData=function(){t.widget.settings.clocks||(t.widget.settings.clocks=[{name:"UTC",timezone:"UTC"}]),t.clocks=new Array;for(var e=0;e<t.widget.settings.clocks.length;e++)t.clocks[e]={name:t.widget.settings.clocks[e].name,delta:"",time:{days:"000",minutes:"00",hours:"00",seconds:"00"},style:d}},t.checkForClockData(),t.updateClock=function(){for(var n=0;n<t.widget.settings.clocks.length;n++)"object"!=typeof t.clocks[n]&&(t.clocks[n]=new Object),t.widget.settings.clocks[n].hasOwnProperty("timezone")?(t.clocks[n].name=t.widget.settings.clocks[n].name,t.clocks[n].time=e.getTime(t.widget.settings.clocks[n].timezone),t.clocks[n].delta="","green"===o.sIcon&&"green"===o.gIcon&&"green"===o.pIcon&&"green"===o.dIcon?t.clocks[n].style=l:t.clocks[n].style=c):(i=e.countdown(t.widget.settings.clocks[n].reference),t.clocks[n].name=t.widget.settings.clocks[n].name,t.clocks[n].time=i,t.clocks[n].delta=i.sign,"green"===o.sIcon&&"green"===o.gIcon&&"green"===o.pIcon&&"green"===o.dIcon?"-"==i.sign&&"000"==i.days&&"00"==i.hours?(i.minutes<="59"&&i.minutes>"10"&&(t.clocks[n].style=s),i.minutes<="10"&&(t.clocks[n].style=a)):t.clocks[n].style=l:t.clocks[n].style=c),"red"===o.dIcon&&(t.clocks[n].style=u)},t.interval=r(t.updateClock,500),t.remove=function(e){t.widget.settings.clocks.splice(e,1),t.clocks.splice(e,1)},t.$on("$destroy",function(e){r.cancel(t.interval)})}]),app.directive("clocksettings",function(){return{restrict:"E",templateUrl:"./directives/clock/clocksettings.html",controller:"ClockSettingsCtrl"}}),app.controller("ClockSettingsCtrl",["$scope",function(t){t.closeSettings=function(e){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,t.selected={},t.reference="",t.name=""},t.saveSettings=function(e){t.selected.type&&("Clock"==t.selected.type.value?t.selected.timezone&&(e.settings.clocks.push({name:t.selected.timezone.value,timezone:t.selected.timezone.zone}),e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,t.selected={}):"Timer"==t.selected.type.value&&t.reference&&t.name&&(e.settings.clocks.push({name:t.name,reference:t.reference}),e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,t.selected={},t.name="",t.reference=""))},t.selected={},t.isLoaded=!1,t.types=[{key:1,value:"Clock"},{key:2,value:"Timer"}],t.timezones=[{key:1,value:"UTC",zone:"UTC"},{key:2,value:"San Francisco",zone:"America/Los_Angeles"},{key:3,value:"Singapore",zone:"Asia/Singapore"},{key:4,value:"Luxembourg",zone:"Europe/Luxembourg"}]}]),app.directive("command",function(){return{restrict:"E",templateUrl:"./directives/command/command.html",controller:"CommandCtrl"}}),app.controller("CommandCtrl",["$scope","userService","commandService","dashboardService","$interval","$window",function(t,e,n,r,i,o){function a(t,e){for(var n=[],r=t.length,i=0;i<r;i++){var o=moment(t[i][e]).tz("UTC");n.push(o.valueOf())}return Math.max.apply(null,n)}t.email=e.getUserEmail(),t.mission=r.getCurrentMission(),t.isLoaded=!1,t.sent=!1,t.initialise=function(){t.cmd="",t.arguments="",t.entered=!1,t.locked=!1,t.disableEnter=!1,t.disableInput=!1,t.disableLock=!0,t.command={name:"",arguments:"",sent_timestamp:"",time:""}},t.enter=function(){t.cmd&&t.arguments&&(t.command.name=t.cmd,t.command.arguments=t.arguments,t.entered=!0,t.disableEnter=!0)},t.lockCommand=function(){t.command.name&&t.entered?(t.locked=!0,t.disableInput=!0,t.disableLock=!0):o.alert("Please enter the commands before locking")},t.changeInput=function(){t.entered?(t.entered=!1,t.disableEnter=!1):(t.disableEnter=!1,t.disableLock=!1)},t.sendCommand=function(){var e=r.getTime("UTC"),i=(new Date).getTime();t.command.sent_timestamp=i,t.command.time=e.utc,n.saveCommand(t.email,t.command,t.mission.missionName).then(function(e){200==e.status&&(t.initialise(),t.commandForm.$setPristine(),t.commandForm.$setUntouched())})},t.updateCommandlog=function(){n.getCommandLog(t.mission.missionName).then(function(e){if(200==e.status){t.commandLog=e.data;for(var n=t.commandLog.length,r=0;r<n;r++)for(var i=a(t.commandLog[r].response,"gwp_timestamp"),o=t.commandLog[r].response.length,s=0;s<o;s++){moment(t.commandLog[r].response[s].gwp_timestamp).tz("UTC").valueOf()===i&&(t.commandLog[r].responseStatus=t.commandLog[r].response[s].status,t.commandLog[r].responseData=t.commandLog[r].response[s].metadata_data)}}})},t.initialise(),t.interval=i(t.updateCommandlog,1e3),t.$on("$destroy",function(e){i.cancel(t.interval)})}]),app.directive("commandsettings",function(){return{restrict:"E",templateUrl:"./directives/command/commandsettings.html",controller:"CommandSettingsCtrl"}}),app.controller("CommandSettingsCtrl",["$scope",function(t){t.commandlog=t.widget.settings.commandlog,t.closeSettings=function(e){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,t.commandlog=t.widget.settings.commandlog},t.saveSettings=function(e){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,t.widget.settings.commandlog=t.commandlog}}]),app.directive("datalog",function(){return{restrict:"E",templateUrl:"./directives/datalog/datalog.html",controller:"DataLogCtrl",controllerAs:"vm",bindToController:!0}}),app.controller("DataLogCtrl",["$scope","$interval","dashboardService","datastatesService","gridService",function(t,e,n,r,i){t.telemetry=n.telemetry;var o=r.colorValues.alarmcolor,a=r.colorValues.cautioncolor,s=r.colorValues.healthycolor,l=r.colorValues.stalecolor,c=r.colorValues.disconnectedcolor,u=(r.colorValues.defaultcolor,[]),d={};t.dataStatus=n.icons,t.logData=[];var h={key:""},f="",g=$("grid").find("div.box-content")[i.getDashboard().current.widgets.indexOf(t.widget)];t.boxReference=angular.element(g),t.box=t.boxReference[0],t.scrollToBottom=!0,t.$watch("dataStatus",function(t,e){d=t},!0),t.updateLog=function(){if(t.widget.settings.data&&""!==t.widget.settings.data.id&&""!==t.widget.settings.data.vehicle){if(h.key!==t.widget.settings.data.key)for(;t.logData.length>0;)t.logData.pop();if(function(){if(t.logData.length>999)for(;t.logData.length>0;)t.logData.pop();var e=n.getData(t.widget.settings.data.key);if(e){var i=typeof e.value;if("number"===i&&(e.value=parseFloat(e.value.toFixed(4))),u[u.length-1]===e.value)f="green"===d.sIcon&&"green"===d.gIcon&&"green"===d.pIcon&&"green"===d.dIcon?s:l;else{var c=r.getDataColor(e.alarm_low,e.alarm_high,e.value,e.warn_low,e.warn_high,i);f="red"===c?o:"orange"===c?a:s,u.push(e.value)}t.logData.push({parameter:t.widget.settings.data.id,value:e.value,timestamp:t.telemetry.time,style:f,vehicle:t.widget.settings.data.vehicle})}}(),"red"===d.dIcon)for(var e=0;e<=t.logData.length-1;e++)t.logData[e].style=c;h.key=t.widget.settings.data.key}},t.boxReference.scroll=function(){t.box.scrollHeight==Math.floor(t.box.scrollTop)+t.box.clientHeight?t.scrollToBottom=!0:t.scrollToBottom=!1,t.autoScroll()},t.autoScroll=function(){t.scrollToBottom&&(t.box.scrollTop=t.box.scrollHeight)},t.interval=e(t.updateLog,1e3,0,!1),t.$on("$destroy",function(n){e.cancel(t.interval)})}]),app.directive("datalogsettings",function(){return{restrict:"E",templateUrl:"./directives/datalog/datalogsettings.html",controller:"DataLogSettingsCtrl"}}),app.controller("DataLogSettingsCtrl",["$scope","$window","$mdSidenav","sidebarService","dashboardService",function(t,e,n,r,i){var o;t.tempParameterSelection=new Object,t.inputFieldStyles={},t.parametersErrMsg="",t.widget.settings.data?(t.data=angular.copy(t.widget.settings.data),t.widget.settings.dataArray=[t.widget.settings.data],t.tempParameterSelection=angular.copy(t.widget.settings.data),o=!0):(t.data={id:"",vehicle:"",key:""},t.tempParameterSelection=angular.copy(t.data)),t.saveDataLogSettings=function(n){t.parametersErrMsg="",t.inputFieldStyles={};var r=angular.copy(t.tempParameterSelection);if(r&&""!==r.vehicle&&""!==r.id&&o){t.data=angular.copy(r);var a=i.getData(r.key);if(a)if(a.hasOwnProperty("value")){n.main=!0,n.settings.active=!1,n.saveLoad=!1,n.delete=!1,e.innerWidth>1440&&(t.lock=i.getLock(),t.lock.lockLeft=!1,i.setLeftLock(t.lock.lockLeft)),t.widget.settings.data=angular.copy(t.data);var s=t.widget.settings.dataArray[t.widget.settings.dataArray.length-1];t.widget.settings.dataArray=[s],t.parametersErrMsg="",t.inputFieldStyles={}}else t.parametersErrMsg="Selected parameter has no data!",t.inputFieldStyles={"border-color":"#dd2c00"};else t.data=angular.copy(r),t.parametersErrMsg="Currently there is no data available for this parameter.",t.inputFieldStyles={"border-color":"#dd2c00"}}else t.parametersErrMsg="Please fill out this field.",t.inputFieldStyles={"border-color":"#dd2c00"}},t.closeDataLogSettings=function(n){t.lock=i.getLock(),t.lock.lockLeft=!1,i.setLeftLock(t.lock.lockLeft),n.main=!0,n.settings.active=!1,n.saveLoad=!1,n.delete=!1,t.data=angular.copy(t.widget.settings.data),t.widget.settings.dataArray=[t.data],t.tempParameterSelection=angular.copy(t.widget.settings.data),e.innerWidth>1440&&(t.lock=i.getLock(),t.lock.lockLeft=!1,i.setLeftLock(t.lock.lockLeft)),t.inputFieldStyles={},t.parametersErrMsg=""},t.getTelemetrydata=function(){r.setTempWidget(t.widget,this),e.innerWidth<=1440?n("left").open():(t.lock=i.getLock(),t.lock.lockLeft=!0,i.setLeftLock(t.lock.lockLeft)),r.setMenuStatus(!0),r.setOpenLogo(!1)},t.readValue=function(){var e=t.widget.settings.dataArray[t.widget.settings.dataArray.length-1];return e&&""!==e.id&&t.tempParameterSelection?t.tempParameterSelection.id:""},t.getValue=function(e){var n=t.widget.settings.dataArray[t.widget.settings.dataArray.length-1];n&&""!==n.vehicle&&""!==n.id?e?o=!1:(o=!0,t.tempParameterSelection=angular.copy(n)):o=!1}}]),app.directive("datatable",function(){return{restrict:"E",templateUrl:"./directives/datatable/datatable.html",controller:"DataTableCtrl",controllerAs:"vm",bindToController:!0}}),app.controller("DataTableCtrl",["$scope","$mdSidenav","$window","$interval","$timeout","dashboardService","sidebarService","datastatesService",function(t,e,n,r,i,o,a,s){t.checkedValues=t.widget.settings.checkedValues;var l=[],c=[];t.dataStatus=o.icons;var u={},d=s.colorValues.alarmcolor,h=s.colorValues.cautioncolor,f=s.colorValues.healthycolor,g=s.colorValues.stalecolor,p=s.colorValues.disconnectedcolor,v=(s.colorValues.defaultcolor,{"text-align":"left"}),m={"text-align":"right"},y={"background-color":"#CFCFD5",animation:"background-fade 0.5s forwards","-webkit-animation":"background-fade 0.5s forwards","-moz-animation":"background-fade 0.5s forwards"};t.arrow;function _(e,n){var r="";n&&(r=n.data),t.table.rows[e]={contents:[{datavalue:"",headervalue:{data:r},checked:"false",style:"text-align:right;background-color:#1072A4;",colshow:"true",colspan:"9",class:"header",placeholder:"Click here to edit",active:"true"}],disabled:!0},t.widget.settings.data[e].type="header",t.widget.settings.data[e].value=t.table.rows[e].contents[0].headervalue}function w(e){if(t.widget.settings.data[e])return t.widget.settings.data[e].hasOwnProperty("value")?(t.widget.settings.previous[e].type=t.widget.settings.data[e].type,t.widget.settings.previous[e].value=t.widget.settings.data[e].value,!1):(t.widget.settings.previous[e].type="",t.widget.settings.previous[e].value="",!0)}t.currentIndex,t.askedForGroup,t.$watch("dataStatus",function(t,e){u=t},!0),t.badSelectionErrMsg="",t.errMsgStyles={},function(){var e={contents:[{datavalue:"",checked:"true",style:v,colshow:"checkedValues.checkedId",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedAlow",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedWlow",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedValue",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedWhigh",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedAhigh",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:v,colshow:"checkedValues.checkedUnits",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:v,colshow:"checkedValues.checkedNotes",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:v,colshow:"checkedValues.checkedChannel",active:"false",datacolor:"",headervalue:""}],disabled:!1};if(0===t.widget.settings.data.length)for(var n=0;n<120;n++)l.push(angular.copy(e)),t.widget.settings.data[n]=new Object,t.widget.settings.previous[n]=new Object;else for(var n=0;n<t.widget.settings.data.length;n++)t.widget.settings.data[n].hasOwnProperty("value")?(e.value=t.widget.settings.data[n].value,e.type=t.widget.settings.data[n].type,e.undone=t.widget.settings.data[n].undone,l.push(angular.copy(e))):l.push(angular.copy(e))}(),t.getTelemetrydata=function(r,i,s){a.setTempWidget(t.widget,this),t.arrow=r.target.parentElement.parentElement.parentElement.firstElementChild.firstElementChild,t.arrow.style.color="#07D1EA",t.currentIndex=i,t.askedForGroup=s,n.innerWidth<=1440?e("left").open():(t.lock=o.getLock(),t.lock.lockLeft=!0,o.setLeftLock(t.lock.lockLeft)),a.setMenuStatus(!0),a.setOpenLogo(!1)},t.getValue=function(e){e&&t.askedForGroup?(t.applyGroup(),t.arrow.style.color="#b3b3b3",t.errMsgStyles={},t.badSelectionErrMsg=""):e||t.askedForGroup?!e&&t.askedForGroup&&(t.arrow.style.color="#07D1EA",t.badSelectionErrMsg="Select a group from the data menu!",t.errMsgStyles={padding:"5px","margin-bottom":"0px",opacity:"1","border-radius":"0px",position:"absolute",top:"35px",left:"0%",right:"0%","z-index":100}):(t.applyValue(),t.arrow.style.color="#b3b3b3",t.errMsgStyles={},t.badSelectionErrMsg=""),t.widget.settings.dataArray=[]},t.applyValue=function(){var e=t.widget.settings.dataArray[t.widget.settings.dataArray.length-1];if(e&&e.key){var r=o.getData(e.key);r&&r.hasOwnProperty("value")&&(w(t.currentIndex)&&(t.widget.settings.data[t.currentIndex]=new Object),t.widget.settings.data[t.currentIndex].type="data",t.widget.settings.data[t.currentIndex].value=e.key,t.widget.settings.data[t.currentIndex].undone=!1,t.arrow.style.color="#b3b3b3",n.innerWidth>1440&&(t.lock=o.getLock(),t.lock.lockLeft=!1,o.setLeftLock(t.lock.lockLeft)))}},t.applyGroup=function(){var e=t.widget.settings.dataArray[t.widget.settings.dataArray.length-1];if(e&&e.key){var r=o.getData(e.key);if(r&&!r.hasOwnProperty("value")){var i=Object.keys(r);if(t.table.rows[t.currentIndex])for(var a=1;a<i.length;a++)t.table.rows[t.currentIndex+a]||t.addRowBelow(t.currentIndex);for(var s=0;s<i.length;s++)w(t.currentIndex+s)&&(t.widget.settings.data[t.currentIndex+s]=new Object),t.widget.settings.data[t.currentIndex+s].type="data",t.widget.settings.data[t.currentIndex+s].value=e.key+"."+i[s],t.widget.settings.data[t.currentIndex+s].undone=!1;t.arrow.style.color="#b3b3b3",n.innerWidth>1440&&(t.lock=o.getLock(),t.lock.lockLeft=!1,o.setLeftLock(t.lock.lockLeft))}}},t.addRowAbove=function(e){t.table.rows.splice(e,0,{contents:[{datavalue:"",headervalue:"",checked:"true",style:v,colshow:"checkedValues.checkedId",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedAlow",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedWlow",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedValue",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedWhigh",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedAhigh",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:v,colshow:"checkedValues.checkedUnits",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:v,colshow:"checkedValues.checkedNotes",active:"false"},{datavalue:"",checked:"true",style:v,colshow:"checkedValues.checkedChannel",active:"false",datacolor:"",headervalue:""}],disabled:!1}),t.widget.settings.data.splice(e,0,{}),t.widget.settings.previous.splice(e,0,{})},t.addRowBelow=function(e){t.table.rows.splice(e+1,0,{contents:[{datavalue:"",headervalue:"",checked:"true",style:v,colshow:"checkedValues.checkedId",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedAlow",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedWlow",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedValue",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedWhigh",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedAhigh",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:v,colshow:"checkedValues.checkedUnits",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:v,colshow:"checkedValues.checkedNotes",active:"false"},{datavalue:"",checked:"true",style:v,colshow:"checkedValues.checkedChannel",active:"false",datacolor:"",headervalue:""}],disabled:!1}),t.widget.settings.data.splice(e+1,0,{}),t.widget.settings.previous.splice(e+1,0,{})},t.deleteRow=function(e){0===e&&1===t.table.rows.length?n.alert("Please do not delete this row!Add row above to delete this row."):(t.table.rows.splice(e,1),t.widget.settings.data.splice(e,1),t.widget.settings.previous.splice(e,1))},t.moveRowUp=function(e){e>0?(t.table.rows[e-1]=t.table.rows.splice(e,1,t.table.rows[e-1])[0],t.widget.settings.data[e-1]=t.widget.settings.data.splice(e,1,t.widget.settings.data[e-1])[0],t.table.rows[e-1].colorin=y,t.widget.settings.previous[e-1]=t.widget.settings.previous.splice(e,1,t.widget.settings.previous[e-1])[0],i(function(){t.table.rows[e-1].colorin=""},500)):n.alert("This row cannot be moved further up!")},t.moveRowDown=function(e){e<t.table.rows.length-1&&(t.table.rows[e+1]=t.table.rows.splice(e,1,t.table.rows[e+1])[0],t.widget.settings.data[e+1]=t.widget.settings.data.splice(e,1,t.widget.settings.data[e+1])[0],t.table.rows[e+1].colorin=y,t.widget.settings.previous[e+1]=t.widget.settings.previous.splice(e,1,t.widget.settings.previous[e+1])[0],i(function(){t.table.rows[e+1].colorin=""},500))},t.convertHeader=function(e,n){w(e)&&(t.widget.settings.data[e]=new Object),_(e,n),t.widget.settings.data[e].undone=!1},function(){if(t.table={rows:l},0!=t.widget.settings.data.length)for(var e=0;e<t.widget.settings.data.length;e++)t.widget.settings.data[e]&&"header"==t.widget.settings.data[e].type&&_(e,t.widget.settings.data[e].value)}(),t.undo=function(e){var n=t.widget.settings.previous[e].type,r=t.widget.settings.previous[e].value;t.widget.settings.previous[e]=new Object,t.widget.settings.previous[e].type=t.widget.settings.data[e].type,t.widget.settings.previous[e].value=t.widget.settings.data[e].value,t.widget.settings.data[e]=new Object,t.widget.settings.data[e].type=n,t.widget.settings.data[e].value=r;var i={contents:[{datavalue:"",checked:"true",style:v,colshow:"checkedValues.checkedId",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedAlow",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedWlow",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedValue",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedWhigh",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedAhigh",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:v,colshow:"checkedValues.checkedUnits",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:v,colshow:"checkedValues.checkedNotes",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:v,colshow:"checkedValues.checkedChannel",active:"false",datacolor:"",headervalue:""}],disabled:!1};"header"==n?_(e,r):t.table.rows[e]=angular.copy(i),t.widget.settings.data[e].undone=!0},t.updateRow=function(){for(var e=0;e<t.table.rows.length;e++){var n=t.table.rows[e],r=t.widget.settings.data[e];if(r){if("data"==r.type){var i=r.value;n.contents[8].datavalue=i;try{var a=i.split(".").slice(-1)[0],l=o.getData(i);if(l){var v=typeof l.value;if("number"===v&&(l.value=parseFloat(l.value.toFixed(4))),n.contents[0].datavalue=a,l.alarm_low?n.contents[1].datavalue=l.alarm_low:n.contents[1].datavalue="N/A",l.warn_low?n.contents[2].datavalue=l.warn_low:n.contents[2].datavalue="N/A",n.contents[3].datavalue=l.value,c[e]===l.value)"green"===u.sIcon&&"green"===u.gIcon&&"green"===u.pIcon&&"green"===u.dIcon?n.contents[3].datacolor=f:n.contents[3].datacolor=g;else{var m=s.getDataColor(l.alarm_low,l.alarm_high,l.value,l.warn_low,l.warn_high,v);n.contents[3].datacolor="red"===m?d:"orange"===m?h:f,c[e]=l.value}l.warn_high?n.contents[4].datavalue=l.warn_high:n.contents[4].datavalue="N/A",l.alarm_high?n.contents[5].datavalue=l.alarm_high:n.contents[5].datavalue="N/A",n.contents[6].datavalue=l.units,""!==l.notes?n.contents[7].datavalue=l.notes:n.contents[7].datavalue="N/A"}}catch(t){}}}else"red"===u.dIcon&&(n.contents[0].datacolor=p,n.contents[1].datacolor=p,n.contents[2].datacolor=p,n.contents[3].datacolor=p,n.contents[4].datacolor=p,n.contents[5].datacolor=p,n.contents[6].datacolor=p,n.contents[7].datacolor=p)}},t.interval=r(t.updateRow,1e3,0,!1),t.$on("$destroy",function(e){r.cancel(t.interval)})}]),app.directive("datatablesettings",function(){return{restrict:"E",templateUrl:"./directives/datatable/datatablesettings.html",controller:"DatatableSettingsCtrl"}}),app.controller("DatatableSettingsCtrl",["$scope","$window",function(t,e){t.checkedValues=angular.copy(t.widget.settings.checkedValues);var n=angular.copy(t.checkedValues);function r(t,e){t.settings.checkedValues.checkedId=e.checkedId,t.settings.checkedValues.checkedAlow=e.checkedAlow,t.settings.checkedValues.checkedWlow=e.checkedWlow,t.settings.checkedValues.checkedValue=e.checkedValue,t.settings.checkedValues.checkedWhigh=e.checkedWhigh,t.settings.checkedValues.checkedAhigh=e.checkedAhigh,t.settings.checkedValues.checkedUnits=e.checkedUnits,t.settings.checkedValues.checkedNotes=e.checkedNotes,t.settings.checkedValues.checkedChannel=e.checkedChannel}t.columnSelectionErrMsg="",t.saveDataTableSettings=function(e){var i=angular.copy(t.checkedValues),o=0;for(obj in i)i[obj]&&(o+=1);o>0?(e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,n=angular.copy(t.checkedValues),t.columnSelectionErrMsg="",r(e,n)):t.columnSelectionErrMsg="Please select atleast one column."},t.closeDataTableSettings=function(e){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,r(e,n),t.checkedValues.checkedId=n.checkedId,t.checkedValues.checkedAlow=n.checkedAlow,t.checkedValues.checkedWlow=n.checkedWlow,t.checkedValues.checkedValue=n.checkedValue,t.checkedValues.checkedWhigh=n.checkedWhigh,t.checkedValues.checkedAhigh=n.checkedAhigh,t.checkedValues.checkedUnits=n.checkedUnits,t.checkedValues.checkedNotes=n.checkedNotes,t.checkedValues.checkedChannel=n.checkedChannel,t.columnSelectionErrMsg=""}}]),app.directive("graph",function(){return{restrict:"EA",templateUrl:"./directives/line/line.html",controller:"LineCtrl"}}),app.controller("LineCtrl",["$scope","$element","$interval","$window","dashboardService","d3Service",function(t,e,n,r,i,o){var a,s=i.telemetry,l=o.timeParse("%Y-%m-%dT%H:%M:%S.%LZ"),c=70,u=e[0].children[0].children[1],d=e[0].children[0].children[0];r.innerWidth>=600&&r.innerWidth<=768?c=50:r.innerWidth<600&&(c=40),t.data=[[0]],t.opts={axes:{x:{drawGrid:!0},y:{drawAxis:!0}},legend:"always",xlabel:"timestamp",ylabel:"",axisLabelWidth:c,xLabelHeight:16,yLabelWidth:16,labelsDiv:u,labels:["time"]};var h=new Dygraph(d,t.data,t.opts);t.interval=n(function(){if(h.resize(),t.widget.settings.data&&""!==t.widget.settings.data.value&&t.widget.settings.data.vehicles.length>0){var e=t.widget.settings.data.value,n=t.widget.settings.data.vehicles,r=["time"],o={},u=!1;if(s.time){var d=l(s.time),f=[d];for(var g in JSON.stringify(a)!==JSON.stringify(t.widget.settings.data)&&(t.plotData?t.plotData=[]:t.plotData=new Array,t.stringDataErrMsg=""),n){var p=n[g];if(void 0!==s[p.name]){var v=i.getData(p.key);if(v){if("number"!=typeof v.value){u=!0;break}var m=parseFloat(v.value.toFixed(4)),y=v.units;f.push(m)}}t.plotData.push(f),r.push(p.name),o[p.name]={color:p.color},t.plotData.length>100&&t.plotData.shift()}if(e){if(y)var _=" [ "+y+" ] ";else var _="";var w=e+_}u?(h.updateOptions({file:[[0]],axes:{x:{drawGrid:!0},y:{drawAxis:!0}},legend:"always",xlabel:"timestamp",ylabel:"",axisLabelWidth:c,xLabelHeight:16,yLabelWidth:16,labels:r,series:o}),t.widget.settings.data={vehicles:[],value:"",key:""},t.stringDataErrMsg="'"+e+"' has no numeric data. Please select another ID from data menu."):h.updateOptions({file:t.plotData,ylabel:w,xlabel:"timestamp",labels:r,axes:{y:{drawGrid:!0,valueFormatter:function(t){return parseFloat(t.toFixed(4))},axisLabelFormatter:function(t){return parseFloat(t.toFixed(4))}},x:{valueFormatter:function(t){return i.getTime("UTC").utc}}},drawPoints:!0,series:o,axisLabelWidth:c})}a=angular.copy(t.widget.settings.data)}},1e3),t.plotData=[],t.$on("$destroy",function(e){n.cancel(t.interval)})}]),app.directive("linesettings",function(){return{restrict:"EA",templateUrl:"./directives/line/linesettings.html",controller:"LineSettingsCtrl"}}),app.controller("LineSettingsCtrl",["$scope","$mdSidenav","$window","dashboardService","sidebarService","$interval",function(t,e,n,r,i,o){var a,s=["#0AACCF","#FF9100","#64DD17","#07D1EA","#0D8DB8","#172168","#228B22","#12C700","#C6FF00"];function l(t,e){var n=e.split(".");return t===n[0]?e:t+"."+n.slice(1).join(".")}t.previousSettings,t.interval,t.settings={vehicles:[],data:{id:"",vehicle:"",key:""}},t.tempParameterSelection=new Object,t.inputFieldStyles={},t.parametersErrMsg="",t.vehicleMsg="",t.getTelemetrydata=function(){i.setTempWidget(t.widget,this),n.innerWidth<=1440?e("left").open():(t.lock=r.getLock(),t.lock.lockLeft=!0,r.setLeftLock(t.lock.lockLeft)),i.setMenuStatus(!0),i.setOpenLogo(!1)},t.readValue=function(){var e=t.widget.settings.dataArray[t.widget.settings.dataArray.length-1];return e&&""!==e.id&&t.tempParameterSelection?t.tempParameterSelection.id:""},t.getValue=function(e){var n=t.widget.settings.dataArray[t.widget.settings.dataArray.length-1];if(n&&""!==n.key&&!e){for(var r=0;r<t.settings.vehicles.length;r++)t.settings.vehicles[r].value===n.vehicle?(t.settings.vehicles[r].checked=!0,t.tempParameterSelection=angular.copy(n)):t.settings.vehicles[r].checked=!1;a=!0}else a=!1},t.saveWidget=function(e){t.vehicleMsg="",t.parametersErrMsg="";var i=angular.copy(t.tempParameterSelection);if(i&&""!==i.key&&a){t.settings.data=angular.copy(i);var o=r.getData(i.key);if(o)if(o.hasOwnProperty("value")){var s=0;if(t.settings.data.key){0!=e.settings.data.vehicles.length&&(e.settings.data.vehicles=[]),e.settings.data.value=t.settings.data.id,e.settings.data.key=t.settings.data.key;for(var c=t.settings.vehicles,u=0;u<c.length;u++)if(!0===c[u].checked){var d=l(c[u].value,t.settings.data.key),h={name:c[u].value,color:c[u].color,key:d};e.settings.data.vehicles.push(h),s++}if(n.innerWidth>1440&&(t.lock=r.getLock(),t.lock.lockLeft=!1,r.setLeftLock(t.lock.lockLeft)),0!=s){e.main=!0,e.settings.active=!1,t.previousSettings=angular.copy(t.settings);var f=t.widget.settings.dataArray[t.widget.settings.dataArray.length-1];t.widget.settings.dataArray=[f],t.inputFieldStyles={}}else t.vehicleMsg="Please choose the vehicle."}}else t.parametersErrMsg="Selected parameter has no data!",t.inputFieldStyles={"border-color":"#dd2c00"};else t.settings.data=angular.copy(i),t.parametersErrMsg="Currently there is no data available for this parameter.",t.inputFieldStyles={"border-color":"#dd2c00"}}else t.parametersErrMsg="Please fill out this field.",t.inputFieldStyles={"border-color":"#dd2c00"}},t.closeWidget=function(e){t.lock=r.getLock(),t.lock.lockLeft=!1,r.setLeftLock(t.lock.lockLeft),e.main=!0,e.settings.active=!1,t.settings=angular.copy(t.previousSettings),t.widget.settings.dataArray=[angular.copy(t.settings.data)],t.tempParameterSelection=angular.copy(t.settings.data),n.innerWidth>1440&&(t.lock=r.getLock(),t.lock.lockLeft=!1,r.setLeftLock(t.lock.lockLeft)),t.parametersErrMsg="",t.vehicleMsg="",t.inputFieldStyles={}},t.createVehicleData=function(e){t.interval||(t.interval=o(function(){var n=r.telemetry;if(!r.isEmpty(n)){var i=r.sortObject(n.data),a=t.settings.vehicles.length,l=!1;for(var c in i)if(i.hasOwnProperty(c)){for(var u=0;u<t.settings.vehicles.length;u++)if(c==t.settings.vehicles[u].value){l=!0;break}l&&0!=t.settings.vehicles.length||(a+=1,t.settings.vehicles.push({key:a,value:c,checked:!1,color:s[a-1]})),l=!1}o.cancel(t.interval),t.interval=null,e&&e(!0)}},1e3))},t.createVehicleData(function(e){if(e){if(t.widget.settings.data.vehicles.length>0){t.settings.data.id=t.widget.settings.data.value,t.settings.data.key=t.widget.settings.data.key;for(var n=0;n<t.settings.vehicles.length;n++)for(var r=0;r<t.widget.settings.data.vehicles.length;r++)t.settings.vehicles[n].value==t.widget.settings.data.vehicles[r].name&&(t.settings.vehicles[n].checked=!0,t.settings.vehicles[n].color=t.widget.settings.data.vehicles[r].color)}t.previousSettings=angular.copy(t.settings),t.tempParameterSelection=angular.copy(t.settings.data),t.widget.settings.dataArray=[angular.copy(t.settings.data)],a=!0}}),t.$on("$destroy",function(e){o.cancel(t.interval)})}]),app.directive("groundtrack",function(){return{restrict:"EA",templateUrl:"./directives/groundtrack/groundtrack.html",controller:"GroundTrackCtrl",controllerAs:"vm",bindToController:!0}}),app.controller("GroundTrackCtrl",["$scope","d3Service","$element","$interval","dashboardService","gridService","solarService","odeService",function(t,e,n,o,a,s,l,c){var u,d,h,f=a.telemetry,g=n[0].getElementsByTagName("div")[0].getElementsByTagName("div")[1],p={},v={},m={},y={},_={},w={},b={};t.dataStatus=a.icons,t.$watch("dataStatus",function(t,e){y=t},!0),t.timeObj={},t.checkboxModel={value1:!0};var x=6378.16,M=85,k=Math.PI,S=k/180,A=180/k,C=e.geoEquirectangular().precision(.1),E=e.geoPath().projection(C),I=e.geoGraticule(),T=e.geoCircle(),D=e.zoom().scaleExtent([1,10]).translateExtent([[0,0],[900,600]]).on("zoom",H),L=e.select(g).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","-20 10 1000 500").attr("width","100%").attr("height","100%").classed("gt-svg-content",!0),N=(e.zoomTransform(L.node()),L.append("g")),B=["GS1","GS2"],P=[[-122.4,37.7],[103.8,1.4]],V=["Ground Station 01 - San Francisco ","Ground Station 02 - Singapore"];function z(){var e;d=a.getTime("UTC"),h=d.today,t.night&&t.night.datum(T.center((e=l.solarPosition(h),[e[0]+180,-e[1]])).radius(90)).attr("d",E)}function O(t,e){covAng=function(t,e){return alpha=Math.asin(x*Math.sin((180-e)*S)/t),180-(180-e)-alpha*A}(e,M);L.select("#g").append("path").datum(T.center(t).radius(covAng)).attr("class","gslos").attr("d",E)}function R(t,e,n,r){if(t&&e&&n&&r){var i=Math.acos(x/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])),o=Math.acos(x/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]));if(Math.acos(U(t,e)/(q(t)*q(e)))<i+o)N.append("path").datum({type:"LineString",coordinates:[[n[0]+6,n[1]-2],[r[0]+6,r[1]-2]]}).attr("class","link").attr("d",E)}}function F(t,e,n,r){if(t&&e&&n&&r){var i=x*Math.sin(t[1]*S),o=x*Math.cos(t[1]*S),a=o*Math.sin(t[0]*S),s=[o*Math.cos(t[0]*S),a,i],l=[n[0]-s[0],n[1]-s[1],n[2]-s[2]];if(Math.acos(U(l,s)/(q(l)*q(s)))*A<r)N.append("path").datum({type:"LineString",coordinates:[[t[0],t[1]],[e[0]+6,e[1]-2]]}).attr("class","gslink").attr("d",E)}}function U(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function q(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}function H(){N.attr("transform",e.event.transform)}function G(t){return C(t)}N.attr("id","g").attr("x",0).attr("y",0),L.call(D),$(window).width()>=screen.width&&(D=e.zoom().scaleExtent([1,10]).translateExtent([[0,0],[1300,1e3]]).on("zoom",H)),e.json("./directives/groundtrack/d3-maps/world-50m.json",function(e,n){if(e)throw e;for(N.append("path").datum(I).attr("d",E).attr("class","graticule"),N.append("path").datum(topojson.feature(n,n.objects.land)).attr("class","land").style("fill","#fff").attr("d",E),N.append("g").attr("class","boundary").selectAll("boundary").data(topojson.feature(n,n.objects.countries).features).enter().append("path").style("fill","#ccc").attr("name",function(t){return t.properties.name}).attr("id",function(t){return t.id}).attr("d",E),j=0;j<P.length;j++)r=P[j],i=V[j],void 0,void 0,o=G(r),L.select("#g").append("svg:image").attr("xlink:href","/icons/groundtrack-widget/aud_target_02_orange.svg").attr("id","gs").attr("x",o[0]-10).attr("y",o[1]-16).attr("width",30).attr("height",30).append("svg:title").text(i);var r,i,o;t.night=N.append("path").attr("class","night").attr("d",E),z()}),t.resetted=function(){L.transition().duration(500).call(D.transform,e.zoomIdentity)},t.zoomIn=function(){D.scaleBy(L,2)},t.zoomOut=function(){D.scaleBy(L,.5)},t.interval=o(function(){N.selectAll("path.route").remove(),N.selectAll("path.est_route").remove(),N.selectAll("#craft").remove(),N.selectAll("path.link").remove(),N.selectAll("line").remove(),N.selectAll("path.gslink").remove(),z();var e=t.widget.settings.vehicles;if(JSON.stringify(u)!==JSON.stringify(e))for(t.timeObj={},i=0;i<e.length;i++)v[i]=[],p[i]=[],m[i]=[],b[i]="",w[i]="",_[i]=!1;for(i=0;i<e.length;i++)if(null==f[e[i].name]);else if(!0===e[i].dataStatus){if(N.selectAll("path.gslos").remove(),t.timeObj[i]||(t.timeObj[i]=new Array),"green"===y.sIcon&&"green"===y.gIcon&&"green"===y.pIcon&&"green"===y.dIcon){e[i].pdata.length>0&&(a.getData(e[i].pdata[0].key).hasOwnProperty("value")&&(s=a.getData(e[i].pdata[0].key).value),a.getData(e[i].pdata[1].key).hasOwnProperty("value")&&(l=a.getData(e[i].pdata[1].key).value),a.getData(e[i].pdata[2].key).hasOwnProperty("value")&&(d=a.getData(e[i].pdata[2].key).value)),e[i].vdata.length>0&&(a.getData(e[i].vdata[0].key).hasOwnProperty("value")&&(h=a.getData(e[i].vdata[0].key).value),a.getData(e[i].vdata[1].key).hasOwnProperty("value")&&(g=a.getData(e[i].vdata[1].key).value),a.getData(e[i].vdata[2].key).hasOwnProperty("value")&&(x=a.getData(e[i].vdata[2].key).value));var n=new Date(f.time),o=n.getTime();_[i]=!1}else{if(""!=v[i])var s=v[i][v[i].length-1][0],l=v[i][v[i].length-1][1],d=v[i][v[i].length-1][2],h=v[i][v[i].length-1][3],g=v[i][v[i].length-1][4],x=v[i][v[i].length-1][5];else e[i].pdata.length>0&&(a.getData(e[i].pdata[0].key).hasOwnProperty("value")&&(s=a.getData(e[i].pdata[0].key).value),a.getData(e[i].pdata[1].key).hasOwnProperty("value")&&(l=a.getData(e[i].pdata[1].key).value),a.getData(e[i].pdata[2].key).hasOwnProperty("value")&&(d=a.getData(e[i].pdata[2].key).value)),e[i].vdata.length>0&&(a.getData(e[i].vdata[0].key).hasOwnProperty("value")&&(h=a.getData(e[i].vdata[0].key).value),a.getData(e[i].vdata[1].key).hasOwnProperty("value")&&(g=a.getData(e[i].vdata[1].key).value),a.getData(e[i].vdata[2].key).hasOwnProperty("value")&&(x=a.getData(e[i].vdata[2].key).value));for(var k=[s,l,d,h,g,x],S=c.IntegratorFactory(k,function(t,e,n){var i=398600.435436096;r=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)),t[0]=e[3],t[1]=e[4],t[2]=e[5],t[3]=-i/Math.pow(r,3)*e[0],t[4]=-i/Math.pow(r,3)*e[1],t[5]=-i/Math.pow(r,3)*e[2]},0,1e-10),A=[],C=[];S.step(1);)A.push(S.t),C.push(S.y);if(s=C.pop()[0],l=C.pop()[1],d=C.pop()[2],h=C.pop()[3],g=C.pop()[4],x=C.pop()[5],null!=t.timeObj[i][t.timeObj[i].length-1])var o=t.timeObj[i][t.timeObj[i].length-1].timestamp+1e3;else var o="";_[i]=!0}if(""!=o){var I={timestamp:o,est:_[i]};t.timeObj[i].push(I);var T=Math.round((t.timeObj[i][t.timeObj[i].length-1].timestamp-t.timeObj[i][0].timestamp)/6e4);if(T>=90){var D=t.timeObj[i].splice(0,1);D[0].est?(m[i][0].splice(0,1),0==m[i][0].length&&m[i].splice(0,1)):(p[i][0].splice(0,1),0==p[i][0].length&&p[i].splice(0,1))}r=Math.sqrt(Math.pow(s,2)+Math.pow(l,2)+Math.pow(d,2)),longitude=Math.atan2(l,s)/Math.PI*180,latitude=Math.asin(d/r)/Math.PI*180;var L=G([longitude,latitude]);for(j=0;j<B.length;j++)O(P[j],r);_[i]!==w[i]?flag=!0:flag=!1;var V=[longitude,latitude];b[i]=V,_[i]?(flag&&(m[i][m[i].length]=new Array),m[i][m[i].length-1].push(V)):(flag&&(p[i][p[i].length]=new Array),p[i][p[i].length-1].push(V));var U=[s,l,d,h,g,x];if(v[i].push(U),!0===e[i].orbitStatus)N.append("path").datum({type:"MultiLineString",coordinates:p[i]}).attr("class","route").attr("stroke",e[i].color).attr("d",E),N.append("path").datum({type:"MultiLineString",coordinates:m[i]}).attr("class","est_route").attr("stroke",e[i].color).attr("d",E);if(!0===e[i].iconStatus){N.append("svg:image").attr("xlink:href","/icons/groundtrack-widget/satellite.svg").attr("id","craft").attr("fill","#000000").attr("x",L[0]).attr("y",L[1]-15).attr("width",30).attr("height",30).append("svg:title").text(e[i].name);for(kk=i+1;kk<e.length;kk++)!0===e[kk].iconStatus&&R(v[i][v[i].length-1],v[kk][v[kk].length-1],b[i],b[kk]);for(kk=0;kk<B.length;kk++)F(P[kk],b[i],v[i][v[i].length-1],M)}w[i]=_[i]}}u=angular.copy(t.widget.settings.vehicles)},1e3),t.$on("$destroy",function(e){o.cancel(t.interval)})}]),app.directive("groundtracksettings",function(){return{restrict:"EA",templateUrl:"./directives/groundtrack/groundtracksettings.html",controller:"GroundSettingsCtrl"}}),app.controller("GroundSettingsCtrl",["$scope","dashboardService","$interval","$mdSidenav","$window","sidebarService","$uibModal",function(t,e,n,r,i,o,a){var s,l=["#07D1EA","#0D8DB8","#172168","#228B22","#12C700","#C6FF00"];function c(t,e){for(var n=[],r=t.length,i=r-e;i<r;i++)n.push(t[i]);return n}function u(t){for(var n=[],r=t.length,i=0;i<r;i++){var o=e.getData(t[i].key);o&&o.hasOwnProperty("value")&&n.push(t[i])}return n}function d(t,e){for(var n=t.length,r=0,i=0;i<n;i++)t[i].vehicle!==e&&r++;return r>0}t.settings=new Object,t.settings.vehicles=[],t.settings.pdata=[],t.settings.vdata=[],t.settings.orbitstatus=[],t.settings.iconstatus=[],t.firstScreen=!0,t.secondScreen=!1,t.positionData=[],t.velocityData=[],t.vehicle=[],t.iconstatus=[],t.orbitstatus=[],t.checkedValues=[],t.velocityBooleans=[!0,!0,!0,!0],t.positionBooleans=[!0,!0,!0,!0],t.totalVelocityArray=[],t.totalPositionArray=[],t.chosenCategory,t.vehicleMsg="",t.sortableOptionsPosition={containment:"#scrollable-containerPositionValues",scrollableContainer:"#scrollable-containerPositionValues",accept:function(t,e){return t.itemScope.sortableScope.$id===e.$id}},t.sortableOptionsVelocity={containment:"#scrollable-containerVelocityValues",scrollableContainer:"#scrollable-containerVelocityValues",accept:function(t,e){return t.itemScope.sortableScope.$id===e.$id}},t.positionInputStyles={},t.velocityInputStyles={},t.positionBtnStyles={},t.velocityBtnStyles={},t.positionparametersErrMsg="",t.velocityparametersErrMsg="",t.closeWidget=function(e){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,t.checkedValues=angular.copy(s);var n=angular.copy(t.settings);if(n.vehicles.length>0)for(var r=0;r<n.vehicles.length;r++)t.iconstatus[r]=n.iconstatus[r],t.orbitstatus[r]=n.orbitstatus[r],t.positionData[r]=angular.copy(n.pdata[r]),t.velocityData[r]=angular.copy(n.vdata[r]);t.vehicleMsg=""},t.saveWidget=function(e){e.saveLoad=!1,e.delete=!1,t.widget.settings.vehicles=[];for(var n=0,r=0,i=0;i<t.settings.vehicles.length;i++)if(!0===t.checkedValues[i].status){if(r++,t.settings.pdata&&t.settings.pdata[i]&&(n+=t.settings.pdata[i].length),t.settings.vdata&&t.settings.vdata[i]&&(n+=t.settings.vdata[i].length),n!==6*r){t.vehicleMsg="Please select all coordinates for selected vehicles.";break}var o={name:t.settings.vehicles[i].label,dataStatus:t.checkedValues[i].status,orbitStatus:t.settings.orbitstatus[i],iconStatus:t.settings.iconstatus[i],color:l[i],pdata:t.settings.pdata[i],vdata:t.settings.vdata[i]};t.widget.settings.vehicles.push(o)}else{o={name:t.settings.vehicles[i].label,dataStatus:t.checkedValues[i].status,orbitStatus:t.settings.orbitstatus[i],iconStatus:t.settings.iconstatus[i],color:l[i],pdata:t.settings.pdata[i],vdata:t.settings.vdata[i]};t.widget.settings.vehicles.push(o),t.vehicleMsg=""}r>0?n===6*r?(e.main=!0,e.settings.active=!1,t.vehicleMsg="",s=angular.copy(t.checkedValues)):(e.main=!1,e.settings.active=!0):(e.main=!0,e.settings.active=!1,t.vehicleMsg="",s=angular.copy(t.checkedValues))},t.createVehicles=function(r){t.interval||(t.interval=n(function(){var i=e.telemetry;if(!e.isEmpty(i)){var o=e.sortObject(i.data),a=!1;for(var s in o)if(o.hasOwnProperty(s)){for(var l=0;l<t.settings.vehicles.length;l++)if(s==t.settings.vehicles[l].label){a=!0;break}if(!a||0==t.settings.vehicles.length){var c=t.settings.vehicles.length;t.settings.vehicles[c]={id:c,label:s},t.iconstatus[c]=!0,t.orbitstatus[c]=!0,t.positionData[c]=[],t.velocityData[c]=[],t.settings.pdata[c]=[],t.settings.vdata[c]=[],t.settings.orbitstatus[c]=!0,t.settings.iconstatus[c]=!0,t.checkedValues[c]={status:!1},t.totalPositionArray[c]=[],t.totalVelocityArray[c]=[]}a=!1}n.cancel(t.interval),t.interval=null,r&&r(!0)}},1e3))},t.createVehicles(function(e){if(e){if(t.widget.settings.vehicles.length>0)for(var n=0;n<t.settings.vehicles.length;n++)for(var r=0;r<t.widget.settings.vehicles.length;r++)t.settings.vehicles[n].label==t.widget.settings.vehicles[r].name&&(t.checkedValues[n]={status:t.widget.settings.vehicles[r].dataStatus},t.orbitstatus[n]=t.widget.settings.vehicles[r].orbitStatus,t.settings.orbitstatus[n]=t.widget.settings.vehicles[r].orbitStatus,t.iconstatus[n]=t.widget.settings.vehicles[r].iconStatus,t.settings.iconstatus[n]=t.widget.settings.vehicles[r].iconStatus,t.positionData[n]=angular.copy(t.widget.settings.vehicles[r].pdata),t.settings.pdata[n]=angular.copy(t.widget.settings.vehicles[r].pdata),t.totalPositionArray[r]=angular.copy(t.widget.settings.vehicles[r].pdata),t.velocityData[n]=angular.copy(t.widget.settings.vehicles[r].vdata),t.settings.vdata[n]=angular.copy(t.widget.settings.vehicles[r].vdata),t.totalVelocityArray[r]=angular.copy(t.widget.settings.vehicles[r].vdata));var i=t.checkedValues.findIndex(t=>!0===t.status);t.vehicleSelected=-1!=i,s=angular.copy(t.checkedValues)}}),t.alertUser=function(e,n,r,i){if(!0===i)e.stopPropagation(),t.firstScreen=!1,t.secondScreen=!0,t.currentScreenVehicle=n,t.currentVehicleId=r,t.vehicleSelected=!0;else{var o=0;t.checkedValues[r].status=!1;for(var a=0;a<t.settings.vehicles.length;a++)!0===t.checkedValues[a].status&&o++;t.vehicleSelected=o>0}},t.getValue=function(e){angular.copy(t.widget.settings.dataArray).length;var n=t.widget.settings.dataArray[t.widget.settings.dataArray.length-1];if(!e&&n&&""!==n.id){"velocity"==t.chosenCategory?t.totalVelocityArray[t.currentVehicleId].push(t.widget.settings.dataArray[t.widget.settings.dataArray.length-1]):"position"==t.chosenCategory&&t.totalPositionArray[t.currentVehicleId].push(t.widget.settings.dataArray[t.widget.settings.dataArray.length-1]);var r,i=[];if(3===(i=(r=angular.copy(t.totalPositionArray[t.currentVehicleId])).length>3?c(r,3):r).length){var o=u(i),a=d(o,t.currentScreenVehicle);!1===a&&3===o.length?3===o.length&&(t.positionData[t.currentVehicleId]=angular.copy(o),t.vehicle[t.currentVehicleId]=o[0].vehicle,t.totalPositionArray[t.currentVehicleId]=angular.copy(o),t.positionBooleans[0]=!0,t.positionBooleans[1]=!0,t.positionBooleans[2]=!0,t.positionBooleans[3]=!0):o.length<3?(t.vehicle[t.currentVehicleId]="",t.positionData[t.currentVehicleId]=[],t.positionBooleans[0]=!1,t.positionBooleans[1]=!0,t.positionBooleans[2]=!0,t.positionBooleans[3]=!0):!1===a?(t.vehicle[t.currentVehicleId]="",t.positionData[t.currentVehicleId]=[],t.positionBooleans[1]=!1,t.positionBooleans[0]=!0,t.positionBooleans[2]=!0,t.positionBooleans[3]=!0):!0===a&&3===o.length?(t.vehicle[t.currentVehicleId]="",t.positionData[t.currentVehicleId]=[],t.positionBooleans[2]=!1,t.positionBooleans[0]=!0,t.positionBooleans[1]=!0,t.positionBooleans[3]=!0):!0===a&&3!==o.length&&(t.vehicle[t.currentVehicleId]="",t.positionData[t.currentVehicleId]=[],t.positionBooleans[2]=!1,t.positionBooleans[0]=!0,t.positionBooleans[1]=!0,t.positionBooleans[3]=!0)}else t.vehicle[t.currentVehicleId]="",t.positionData[t.currentVehicleId]=[],t.positionBooleans[3]=!1,t.positionBooleans[0]=!0,t.positionBooleans[1]=!0,t.positionBooleans[2]=!0;var s,l=[];if(3===(l=(s=angular.copy(t.totalVelocityArray[t.currentVehicleId])).length>3?c(s,3):s).length){var h=u(l),f=d(h,t.currentScreenVehicle);!1===f&&3===h.length?3===h.length&&(t.velocityData[t.currentVehicleId]=angular.copy(h),t.vehicle[t.currentVehicleId]=h[0].vehicle,t.totalVelocityArray[t.currentVehicleId]=angular.copy(h),t.velocityBooleans[0]=!0,t.velocityBooleans[1]=!0,t.velocityBooleans[2]=!0,t.velocityBooleans[3]=!0):h.length<3?(t.vehicle[t.currentVehicleId]="",t.velocityData[t.currentVehicleId]=[],t.velocityBooleans[0]=!1,t.velocityBooleans[1]=!0,t.velocityBooleans[2]=!0,t.velocityBooleans[3]=!0):!1===f?(t.vehicle[t.currentVehicleId]="",t.velocityData[t.currentVehicleId]=[],t.velocityBooleans[1]=!1,t.velocityBooleans[0]=!0,t.velocityBooleans[2]=!0,t.velocityBooleans[3]=!0):!0===f&&3===h.length?(t.vehicle[t.currentVehicleId]="",t.velocityData[t.currentVehicleId]=[],t.velocityBooleans[2]=!1,t.velocityBooleans[0]=!0,t.velocityBooleans[1]=!0,t.velocityBooleans[3]=!0):!0===f&&3!==h.length&&(t.vehicle[t.currentVehicleId]="",t.velocityData[t.currentVehicleId]=[],t.velocityBooleans[2]=!1,t.velocityBooleans[0]=!0,t.velocityBooleans[1]=!0,t.velocityBooleans[3]=!0)}else t.vehicle[t.currentVehicleId]="",t.velocityData[t.currentVehicleId]=[],t.velocityBooleans[3]=!1,t.velocityBooleans[0]=!0,t.velocityBooleans[1]=!0,t.velocityBooleans[2]=!0}else t.velocityData[t.currentVehicleId]=null,t.positionData[t.currentVehicleId]=null},t.getTelemetrydata=function(n,a){t.chosenCategory=n,t.currentVehicleId=a,o.setTempWidget(t.widget,this),i.innerWidth<=1440?r("left").open():(t.lock=e.getLock(),t.lock.lockLeft=!0,e.setLeftLock(t.lock.lockLeft)),o.setMenuStatus(!0),o.setOpenLogo(!1)},t.readValues=function(e){var n=[];if(t.stringPositionData="",t.stringVelocityData="","velocity"==e){t.totalVelocityArray[t.currentVehicleId]&&(n=c(t.totalVelocityArray[t.currentVehicleId],3));for(var r=0;r<n.length;r++)n[r]&&(r==n.length-1?t.stringVelocityData+=n[r].id:t.stringVelocityData+=n[r].id+", ");return t.stringVelocityData?t.stringVelocityData:""}if("position"==e){t.totalPositionArray[t.currentVehicleId]&&(n=c(t.totalPositionArray[t.currentVehicleId],3));for(r=0;r<n.length;r++)n[r]&&(r==n.length-1?t.stringPositionData+=n[r].id:t.stringPositionData+=n[r].id+", ");return t.stringPositionData?t.stringPositionData:""}},t.saveParameters=function(n){t.vehicleMsg="",t.positionparametersErrMsg="",t.velocityparametersErrMsg="",t.positionInputStyles={},t.positionBtnStyles={},t.velocityInputStyles={},t.velocityBtnStyles={},0===t.totalPositionArray[t.currentVehicleId].length?(t.positionparametersErrMsg="Please fill out this field.",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"},0===t.totalVelocityArray[t.currentVehicleId].length?(t.velocityparametersErrMsg="Please fill out this field.",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"}):t.velocityBooleans[3]?t.velocityBooleans[2]||(t.velocityparametersErrMsg="Select velocity coordinates from vehicle: "+t.currentScreenVehicle+"!",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"}):(t.velocityparametersErrMsg="Required: All velocity coordinates(x,y,z)!",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"})):t.positionBooleans[3]?t.positionBooleans[2]?t.positionBooleans[0]?0===t.totalVelocityArray[t.currentVehicleId].length?(t.velocityparametersErrMsg="Please fill out this field.",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"},0===t.totalPositionArray[t.currentVehicleId].length?(t.positionparametersErrMsg="Please fill out this field.",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):t.positionBooleans[3]?t.positionBooleans[2]||(t.positionparametersErrMsg="Select position coordinates from vehicle: "+t.currentScreenVehicle+"!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):(t.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"})):t.velocityBooleans[3]?t.velocityBooleans[2]?t.velocityBooleans[0]?3===t.positionData[t.currentVehicleId].length&&3===t.velocityData[t.currentVehicleId].length&&a.open({templateUrl:"./directives/groundtrack/confirmParameter.html",controller:"confirmParametersCtrl",controllerAs:"$ctrl",bindToController:!0,scope:t,resolve:{dataLabel:function(){return"Did you select position coordinates(x,y,z) and velocity coordinates(x,y,z)?"},dataItems:function(){return t.settings}}}).result.then(function(n){t.secondScreen=!1,t.firstScreen=!0,t.settings.pdata[t.currentVehicleId]=angular.copy(t.positionData[t.currentVehicleId]),t.settings.vdata[t.currentVehicleId]=angular.copy(t.velocityData[t.currentVehicleId]),t.settings.iconstatus[t.currentVehicleId]=angular.copy(t.iconstatus[t.currentVehicleId]),t.settings.orbitstatus[t.currentVehicleId]=angular.copy(t.orbitstatus[t.currentVehicleId]),t.totalVelocityArray[t.currentVehicleId]=c(t.totalVelocityArray[t.currentVehicleId],3),t.totalPositionArray[t.currentVehicleId]=c(t.totalPositionArray[t.currentVehicleId],3),t.widget.settings.dataArray=[],i.innerWidth>1440&&(t.lock=e.getLock(),t.lock.lockLeft=!1,e.setLeftLock(t.lock.lockLeft)),t.velocityBooleans=[!0,!0,!0,!0],t.positionBooleans=[!0,!0,!0,!0],t.velocityInputStyles={},t.velocityBtnStyles={},t.positionInputStyles={},t.positionBtnStyles={},t.velocityparametersErrMsg="",t.positionparametersErrMsg=""},function(){t.firstScreen=!1,t.secondScreen=!0,t.velocityBooleans=[!0,!0,!0,!0],t.positionBooleans=[!0,!0,!0,!0],t.velocityInputStyles={},t.velocityBtnStyles={},t.positionInputStyles={},t.positionBtnStyles={},t.velocityparametersErrMsg="",t.positionparametersErrMsg=""}):(t.velocityparametersErrMsg="Required: All velocity values(x,y,z)!",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"},0===t.totalPositionArray[t.currentVehicleId].length?(t.positionparametersErrMsg="Please fill out this field.",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):t.positionBooleans[3]?t.positionBooleans[2]||(t.positionparametersErrMsg="Select position coordinates from vehicle: "+t.currentScreenVehicle+"!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):(t.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"})):(t.velocityparametersErrMsg="Select velocity coordinates from vehicle: "+t.currentScreenVehicle+"!",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"},0===t.totalPositionArray[t.currentVehicleId].length?(t.positionparametersErrMsg="Please fill out this field.",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):t.positionBooleans[3]?t.positionBooleans[2]||(t.positionparametersErrMsg="Select position coordinates from vehicle: "+t.currentScreenVehicle+"!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):(t.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"})):(t.velocityparametersErrMsg="Required: All velocity values(x,y,z)!",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"},0===t.totalPositionArray[t.currentVehicleId].length?(t.positionparametersErrMsg="Please fill out this field.",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):t.positionBooleans[3]?t.positionBooleans[2]||(t.positionparametersErrMsg="Select position coordinates from vehicle: "+t.currentScreenVehicle+"!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):(t.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"})):(t.positionparametersErrMsg="Required: All position values(x,y,z)!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"},0===t.totalVelocityArray[t.currentVehicleId].length?(t.velocityparametersErrMsg="Please fill out this field.",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"}):t.velocityBooleans[3]?t.velocityBooleans[2]||(t.velocityparametersErrMsg="Select velocity coordinates from vehicle: "+t.currentScreenVehicle+"!",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"}):(t.velocityparametersErrMsg="Required: All velocity coordinates(x,y,z)!",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"})):(t.positionparametersErrMsg="Select position coordinates from vehicle: "+t.currentScreenVehicle+"!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"},0===t.totalVelocityArray[t.currentVehicleId].length?(t.velocityparametersErrMsg="Please fill out this field.",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"}):t.velocityBooleans[3]?t.velocityBooleans[2]||(t.velocityparametersErrMsg="Select velocity coordinates from vehicle: "+t.currentScreenVehicle+"!",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"}):(t.velocityparametersErrMsg="Required: All velocity coordinates(x,y,z)!",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"})):(t.positionparametersErrMsg="Required: All position values(x,y,z)!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"},0===t.totalVelocityArray[t.currentVehicleId].length?(t.velocityparametersErrMsg="Please fill out this field.",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"}):t.velocityBooleans[3]?t.velocityBooleans[2]||(t.velocityparametersErrMsg="Select velocity coordinates from vehicle: "+t.currentScreenVehicle+"!",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"}):(t.velocityparametersErrMsg="Required: All velocity coordinates(x,y,z)!",t.velocityInputStyles={"border-color":"#dd2c00"},t.velocityBtnStyles={"border-left-color":"#dd2c00"}))},t.closeParameters=function(n){t.secondScreen=!1,t.firstScreen=!0,t.positionData[t.currentVehicleId]=angular.copy(t.settings.pdata[t.currentVehicleId]),t.totalPositionArray[t.currentVehicleId]=t.positionData[t.currentVehicleId],t.iconstatus[t.currentVehicleId]=angular.copy(t.settings.iconstatus[t.currentVehicleId]),t.orbitstatus[t.currentVehicleId]=angular.copy(t.settings.orbitstatus[t.currentVehicleId]),t.velocityData[t.currentVehicleId]=angular.copy(t.settings.vdata[t.currentVehicleId]),t.totalVelocityArray[t.currentVehicleId]=t.velocityData[t.currentVehicleId],t.positionparametersErrMsg="",t.velocityparametersErrMsg="",0===t.settings.pdata[t.currentVehicleId].length&&0===t.settings.vdata[t.currentVehicleId].length&&(t.orbitstatus[t.currentVehicleId]=!0,t.iconstatus[t.currentVehicleId]=!0),i.innerWidth>1440&&(t.lock=e.getLock(),t.lock.lockLeft=!1,e.setLeftLock(t.lock.lockLeft)),t.vehicleMsg="",t.velocityBooleans=[!0,!0,!0,!0],t.positionBooleans=[!0,!0,!0,!0],t.velocityInputStyles={},t.velocityBtnStyles={},t.positionInputStyles={},t.positionBtnStyles={},t.velocityparametersErrMsg="",t.positionparametersErrMsg=""},t.openPositionList=function(e){t.settings.tempPositions=angular.copy(t.totalPositionArray),t.settings.tempPositions[e]=angular.copy(c(t.totalPositionArray[e],3)),a.open({templateUrl:"./directives/groundtrack/positionList.html",controller:"positionParametersCtrl",controllerAs:"$ctrl",resolve:{positionItems:function(){return t.settings},vehicleId:function(){return t.currentVehicleId}}}).result.then(function(n){3===n.tempPositions[e].length&&(t.positionData[e]=angular.copy(n.tempPositions[e]),t.totalPositionArray[e]=angular.copy(n.tempPositions[e]))},function(){})},t.openVelocityList=function(e){t.settings.tempVelocities=angular.copy(t.totalVelocityArray),t.settings.tempVelocities[e]=angular.copy(c(t.totalVelocityArray[e],3)),a.open({templateUrl:"./directives/groundtrack/velocityList.html",controller:"velocityParametersCtrl",controllerAs:"$ctrl",resolve:{velocityItems:function(){return t.settings},vehicleId:function(){return t.currentVehicleId}}}).result.then(function(n){3===n.tempVelocities[e].length&&(t.velocityData[e]=angular.copy(n.tempVelocities[e]),t.totalVelocityArray[e]=angular.copy(n.tempVelocities[e]))},function(){})},t.$on("$destroy",function(e){n.cancel(t.interval)})}]),app.controller("positionParametersCtrl",["$scope","$uibModalInstance","positionItems","$uibModal","vehicleId",function(t,e,n,r,i){var o=this;o.data=n,o.currentVehicleId=i;var a=angular.copy(n);o.close=function(){o.data.tempPositions=a.tempPositions,e.dismiss("cancel")},o.save=function(){r.open({templateUrl:"./directives/groundtrack/confirmParameter.html",controller:"confirmParametersCtrl",controllerAs:"$ctrl",resolve:{dataLabel:function(){return"Is the position coordinates selected order is:x,y,z?"},dataItems:function(){return o.data}}}).result.then(function(t){e.close(t)},function(){})}}]),app.controller("velocityParametersCtrl",["$scope","$uibModalInstance","velocityItems","$uibModal","vehicleId",function(t,e,n,r,i){var o=this;o.data=n,o.currentVehicleId=i;var a=angular.copy(n);o.close=function(){o.data.tempVelocities=a.tempVelocities,e.dismiss("cancel")},o.save=function(){r.open({templateUrl:"./directives/groundtrack/confirmParameter.html",controller:"confirmParametersCtrl",controllerAs:"$ctrl",resolve:{dataLabel:function(){return"Is the velocity coordinates selected order is:x,y,z?"},dataItems:function(){return o.data}}}).result.then(function(t){e.close(t)},function(){})}}]),app.controller("confirmParametersCtrl",["$scope","$uibModalInstance","dataLabel","dataItems",function(t,e,n,r){var i=this;i.modalLabel=n,i.finalData=r,i.close=function(){e.dismiss("cancel")},i.save=function(){e.close(i.finalData)}}]),app.directive("sample",function(){return{restrict:"E",template:"<p>This is a Sample Widget</p>"}}),app.directive("samplesettings",function(){return{restrict:"EA",template:'<div class="savestyles"><form class="form-inline"><div class="row"><div class="col-sm-5"><label for="SampleSettings">This is a Sample Settings Page.</label></div></div><div class="row"><div class="col-sm-11"><hr/></div></div><div class="row"><div class="col-sm-11"><button type="submit" class="btn btn-primary sbtns" ng-click="close(widget)">CLOSE</button></div></div></form></div>',controller:function(t){t.close=function(t){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1}}}}),app.directive("model",function(){return{restrict:"E",scope:{modelUrl:"=modelUrl",widget:"=widget",quaternion:"=quaternion"},controller:"SatelliteCtrl"}}),app.controller("SatelliteCtrl",["$scope","$element","$interval","dashboardService","solarService","datastatesService",function(t,e,n,r,i,o){var a,s,l,c,u,d,h,f,g=e.parent()[0],p=$(g).width(),v=$(g).height(),m=p/v,y=new THREE.AssimpJSONLoader,_=r.telemetry,w=Math.PI,b=w/180,x=o.colorValues.alarmcolor,M=o.colorValues.cautioncolor,k=o.colorValues.healthycolor,S=o.colorValues.stalecolor,A=o.colorValues.disconnectedcolor,C=o.colorValues.defaultcolor,E="",I="",T="",D="";t.statusIcons=r.icons;var L={};t.$watch("statusIcons",function(t,e){L=t},!0);var N=function(t,e){var n=new THREE.Vector3(1,1,0),r=new THREE.Vector3(0,0,0);n.normalize();var i=new THREE.ArrowHelper(n,r,6,e);return i.name=t,i.visible=!1,i};function B(e){y.load(e,function(e){e.scale.x=e.scale.y=e.scale.z=.8,e.updateMatrix(),a&&t.scene.remove(a),t.scene.add(e),a=e,t.cube=e})}var P,V=function(t,e,n){var r=new Date(_.time),o=(i.date2JulianDate(r)-2451545)/36525,a=(67310.54841+3164400184.812866*o+.093104*Math.pow(o,2)-6.2*Math.pow(10,-6)*Math.pow(o,3))%86400/240*Math.PI/180,s=[[Math.cos(-a),Math.sin(-a),0],[-Math.sin(-a),Math.cos(-a),0],[0,0,1]];return xECI=s[0][0]*t+s[0][1]*e+s[0][2]*n,yECI=s[1][0]*t+s[1][1]*e+s[1][2]*n,zECI=s[2][0]*t+s[2][1]*e+s[2][2]*n,[xECI,yECI,zECI]},z=function(){var e,n,o;if(requestAnimationFrame(z),j.update(),t.cube&&t.widget.settings.vehicle&&t.widget.settings.attitudeData&&t.widget.settings.positionData)if(_[t.widget.settings.vehicle]){s=r.getData(t.widget.settings.attitudeData[0].key),l=r.getData(t.widget.settings.attitudeData[1].key),c=r.getData(t.widget.settings.attitudeData[2].key),u=r.getData(t.widget.settings.attitudeData[3].key),t.cube.quaternion.x=s.value,t.cube.quaternion.y=l.value,t.cube.quaternion.z=c.value,t.cube.quaternion.w=u.value,"number"==typeof s.value?t.quaternion[t.widget.settings.attitudeData[0].id]=s.value.toFixed(4):"string"==typeof s.value&&(t.quaternion[t.widget.settings.attitudeData[0].id]=s.value),"number"==typeof l.value?t.quaternion[t.widget.settings.attitudeData[1].id]=l.value.toFixed(4):"string"==typeof l.value&&(t.quaternion[t.widget.settings.attitudeData[1].id]=l.value),"number"==typeof c.value?t.quaternion[t.widget.settings.attitudeData[2].id]=c.value.toFixed(4):"string"==typeof c.value&&(t.quaternion[t.widget.settings.attitudeData[2].id]=c.value),"number"==typeof u.value?t.quaternion[t.widget.settings.attitudeData[3].id]=u.value.toFixed(4):"string"==typeof u.value&&(t.quaternion[t.widget.settings.attitudeData[3].id]=u.value),d=r.getData(t.widget.settings.positionData[0].key),h=r.getData(t.widget.settings.positionData[1].key),f=r.getData(t.widget.settings.positionData[2].key),e=d.value,n=h.value,o=f.value;var a=V(e,n,o),g=new THREE.Vector3(-a[0],-a[1],-a[2]);g.normalize(),t.arrowEarth.visible=!0,t.arrowEarth.setDirection(g);var p=function(t){var e=i.solarPosition(t),n=e[0]*b,r=e[1]*b;return i.longLat2ECEF(n,r)}(new Date(_.time)),v=V(p[0],p[1],p[2]),m=new THREE.Vector3(v[0],v[1],v[2]);m.normalize(),t.arrowSun.visible=!0,t.arrowSun.setDirection(m)}else t.quaternion[t.widget.settings.attitudeData[0].id]="N/A",t.quaternion[t.widget.settings.attitudeData[1].id]="N/A",t.quaternion[t.widget.settings.attitudeData[2].id]="N/A",t.quaternion[t.widget.settings.attitudeData[3].id]="N/A";t.camera.fov=q*t.widget.settings.zoom,t.camera.updateProjectionMatrix(),t.renderer.render(t.scene,t.camera)};t.interval=n(function(){if(t.quaternion.color=[],t.widget.settings.vehicle&&t.cube&&_[t.widget.settings.vehicle]&&t.widget.settings.attitudeData&&t.widget.settings.positionData){var e=r.getData(t.widget.settings.attitudeData[0].key),n=r.getData(t.widget.settings.attitudeData[1].key),i=r.getData(t.widget.settings.attitudeData[2].key),a=r.getData(t.widget.settings.attitudeData[3].key),s=typeof e.value,l=typeof n.value,c=typeof i.value,u=typeof a.value,d=e,h=n,f=i,g=a;if(E===d.value)"green"===L.sIcon&&"green"===L.gIcon&&"green"===L.pIcon&&"green"===L.dIcon?t.quaternion.color[0]=k:t.quaternion.color[0]=S;else{var p=o.getDataColor(d.alarm_low,d.alarm_high,d.value,d.warn_low,d.warn_high,s);t.quaternion.color[0]="red"===p?x:"orange"===p?M:k,E=d.value}if(I===h.value)"green"===L.sIcon&&"green"===L.gIcon&&"green"===L.pIcon&&"green"===L.dIcon?t.quaternion.color[1]=k:t.quaternion.color[1]=S;else{var v=o.getDataColor(h.alarm_low,h.alarm_high,h.value,h.warn_low,h.warn_high,l);t.quaternion.color[1]="red"===v?x:"orange"===v?M:k,I=h.value}if(T===f.value)"green"===L.sIcon&&"green"===L.gIcon&&"green"===L.pIcon&&"green"===L.dIcon?t.quaternion.color[2]=k:t.quaternion.color[2]=S;else{var m=o.getDataColor(f.alarm_low,f.alarm_high,f.value,f.warn_low,f.warn_high,c);t.quaternion.color[2]="red"===m?x:"orange"===m?M:k,T=f.value}if(D===g.value)"green"===L.sIcon&&"green"===L.gIcon&&"green"===L.pIcon&&"green"===L.dIcon?t.quaternion.color[3]=k:t.quaternion.color[3]=S;else{var y=o.getDataColor(g.alarm_low,g.alarm_high,g.value,g.warn_low,g.warn_high,u);t.quaternion.color[3]="red"===y?x:"orange"===y?M:k,D=g.value}"red"===L.dIcon&&(t.quaternion.color[0]=A,t.quaternion[t.widget.settings.attitudeData[0].id]="-",t.quaternion.color[1]=A,t.quaternion[t.widget.settings.attitudeData[1].id]="-",t.quaternion.color[2]=A,t.quaternion[t.widget.settings.attitudeData[2].id]="-",t.quaternion.color[3]=A,t.quaternion[t.widget.settings.attitudeData[3].id]="-")}else t.quaternion.color[0]=C,t.quaternion.color[1]=C,t.quaternion.color[2]=C,t.quaternion.color[3]=C},1e3,0,!1),t.cube=new THREE.Object3D,t.scene=new THREE.Scene,t.camera=((P=new THREE.PerspectiveCamera(45,m,1,1e3)).position.set(8,8,8),P.up=new THREE.Vector3(0,0,1),P.lookAt(new THREE.Vector3(0,0,0)),P);var O,R,F,U,q=t.camera.fov;t.light=((O=new THREE.PointLight(12566463)).position.x=0,O.position.y=300,O.position.z=0,O),t.renderer=((R=new THREE.WebGLRenderer).setSize(p,v),R.setClearColor(16777215,1),R),t.grid=((F=new THREE.PolarGridHelper(100,16,50,64,new THREE.Color(10000536),new THREE.Color(12566463))).rotation.x=Math.PI/2,F),t.axis=((U=new THREE.AxisHelper(20)).material.linewidth=2,U),t.arrowEarth=N("Earth",1120592),t.arrowSun=N("Sun",16755456),t.scene.add(t.light),B(t.modelUrl),t.scene.add(t.cube),t.scene.add(t.axis),t.scene.add(t.grid),t.scene.add(t.arrowEarth),t.scene.add(t.arrowSun);var j=new THREE.OrbitControls(t.camera,t.renderer.domElement);j.enableZoom=!1,j.enablePan=!1,z(),g.appendChild(t.renderer.domElement),t.$watch(function(){return{width:e.parent()[0].clientWidth,height:e.parent()[0].clientHeight}},function(e){t.renderer.setSize(e.width,e.height),t.camera.aspect=e.width/e.height,t.camera.updateProjectionMatrix()},!0),t.$watch("modelUrl",function(t,e){t!=e&&B(t)}),t.$on("$destroy",function(e){n.cancel(t.interval),E="",I="",T="",D=""})}]),app.directive("satellite",function(){return{restrict:"E",templateUrl:"./directives/satellite/satellite.html",controller:"SatCtrl"}}),app.controller("SatCtrl",["$scope",function(t){t.widget.settings.hasOwnProperty("zoom")||(t.widget.settings.zoom=1),t.modelUrl="./directives/satellite/models/satellite.json",t.step=.01,t.min=.2,t.max=1.8,t.quaternion=new Object,t.colors=new Object}]),app.directive("satellitesettings",function(){return{restrict:"E",templateUrl:"./directives/satellite/satellitesettings.html",controller:"SatSettingsCtrl"}}),app.controller("SatSettingsCtrl",["$scope","dashboardService","sidebarService","$window","$mdSidenav","$uibModal",function(t,e,n,r,i,o){function a(t,e){for(var n=[],r=t.length,i=r-e;i<r;i++)n.push(t[i]);return n}function s(t){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}function l(t){for(var n=[],r=t.length,i=0;i<r;i++){var o=e.getData(t[i].key);o&&o.hasOwnProperty("value")&&n.push(t[i])}return n}function c(t){for(var e=t.length,n=0,r=1;r<e;r++)t[r].vehicle!==t[0].vehicle&&n++;return n>0}t.chosenCategory,t.attitudeBooleans=[!0,!0,!0,!0],t.positionBooleans=[!0,!0,!0,!0],function(){if(t.widget.settings.attitudeData&&t.widget.settings.positionData){var e=angular.copy(t.widget.settings);t.settings={attitudeData:e.attitudeData,positionData:e.positionData},t.vehicle=e.vehicle,t.widget.settings.totalPositionArray=angular.copy(t.widget.settings.positionData),t.widget.settings.totalAttitudeArray=angular.copy(t.widget.settings.attitudeData)}else t.widget.settings.attitudeData||t.widget.settings.positionData||(t.settings={attitudeData:[],positionData:[]},t.widget.settings.totalPositionArray=[],t.widget.settings.totalAttitudeArray=[],t.vehicle="")}(),t.attitudeInputStyles={},t.positionInputStyles={},t.attitudeBtnStyles={},t.positionBtnStyles={},t.attitudeparametersErrMsg="",t.positionparametersErrMsg="",t.closeSettings=function(n){n.main=!0,n.settings.active=!1,n.saveLoad=!1,n.delete=!1;var i=angular.copy(n.settings);i.attitudeData&&i.positionData?(t.settings.attitudeData=i.attitudeData,t.widget.settings.totalAttitudeArray=angular.copy(t.widget.settings.attitudeData),t.settings.positionData=i.positionData,t.widget.settings.totalPositionArray=angular.copy(t.widget.settings.positionData),t.vehicle=i.vehicle):!i.attitudeData&&i.positionData?(t.settings.positionData=i.positionData,t.widget.settings.totalPositionArray=angular.copy(t.widget.settings.positionData),t.vehicle=i.vehicle):i.attitudeData&&!i.positionData?(t.settings.attitudeData=i.attitudeData,t.widget.settings.totalAttitudeArray=angular.copy(t.widget.settings.attitudeData),t.vehicle=i.vehicle):(t.settings.attitudeData=[],t.settings.positionData=[],t.widget.settings.totalAttitudeArray=[],t.widget.settings.totalPositionArray=[]),r.innerWidth>1440&&(t.lock=e.getLock(),t.lock.lockLeft=!1,e.setLeftLock(t.lock.lockLeft)),t.attitudeBooleans=[!0,!0,!0,!0],t.positionBooleans=[!0,!0,!0,!0],t.attitudeInputStyles={},t.attitudeBtnStyles={},t.positionInputStyles={},t.positionBtnStyles={},t.attitudeparametersErrMsg="",t.positionparametersErrMsg=""},t.saveSettings=function(n){var i=function(e,n){for(var r=!0,i=e.length,o=n.length,a=0;a<i;a++)for(var s=0;s<o;s++)e[a].vehicle!==n[s].vehicle&&(r=!1,t.currentAttitudeVehicle=e[a].vehicle,t.currentPositionVehicle=n[s].vehicle);return r}(t.settings.attitudeData,t.settings.positionData);t.positionparametersErrMsg="",t.attitudeparametersErrMsg="",t.positionInputStyles={},t.positionBtnStyles={},t.attitudeInputStyles={},t.attitudeBtnStyles={},0===t.widget.settings.totalAttitudeArray.length?(t.attitudeparametersErrMsg="Please fill out this field.",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"},0===t.widget.settings.totalPositionArray.length?(t.positionparametersErrMsg="Please fill out this field.",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):t.positionBooleans[3]?t.positionBooleans[2]||(t.positionparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):(t.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"})):t.attitudeBooleans[3]?t.attitudeBooleans[2]?t.attitudeBooleans[0]?0===t.widget.settings.totalPositionArray.length?(t.positionparametersErrMsg="Please fill out this field.",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"},0===t.widget.settings.totalAttitudeArray.length?(t.attitudeparametersErrMsg="Please fill out this field.",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"}):t.attitudeBooleans[3]?t.attitudeBooleans[2]||(t.attitudeparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"}):(t.attitudeparametersErrMsg="Required: All position coordinates(x,y,z)!",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"})):t.positionBooleans[3]?t.positionBooleans[2]?t.positionBooleans[0]?4===t.widget.settings.totalAttitudeArray.length&&3===t.widget.settings.totalPositionArray.length&&!0===i?o.open({templateUrl:"./directives/satellite/confirmSettings.html",controller:"confirmCtrl",controllerAs:"$ctrl",bindToController:!0,scope:t,resolve:{dataLabel:function(){return"Did you select quaternion coordinates(q1,q2,q3,qc) and position coordinates(x,y,z)?"},dataItems:function(){return t.settings}}}).result.then(function(i){n.main=!0,n.settings.active=!1,n.saveLoad=!1,n.delete=!1,n.settings.attitudeData=s(i.attitudeData),n.settings.positionData=s(i.positionData),n.settings.vehicle=t.vehicle,t.widget.settings.totalAttitudeArray=a(t.widget.settings.totalAttitudeArray,4),t.widget.settings.totalPositionArray=a(t.widget.settings.totalPositionArray,3),n.settings.dataArray=[],r.innerWidth>1440&&(t.lock=e.getLock(),t.lock.lockLeft=!1,e.setLeftLock(t.lock.lockLeft)),t.attitudeBooleans=[!0,!0,!0,!0],t.positionBooleans=[!0,!0,!0,!0],t.attitudeInputStyles={},t.attitudeBtnStyles={},t.positionInputStyles={},t.positionBtnStyles={},t.attitudeparametersErrMsg="",t.positionparametersErrMsg=""},function(){t.attitudeBooleans=[!0,!0,!0,!0],t.positionBooleans=[!0,!0,!0,!0],t.attitudeInputStyles={},t.attitudeBtnStyles={},t.positionInputStyles={},t.positionBtnStyles={},t.attitudeparametersErrMsg="",t.positionparametersErrMsg=""}):!1===i&&(t.attitudeparametersErrMsg="Vehicles of both fields do not match! Selected from vehicle: "+t.currentAttitudeVehicle,t.positionparametersErrMsg="Vehicles of both fields do not match! Selected from vehicle: "+t.currentPositionVehicle,t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"},t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):(t.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"},0===t.widget.settings.totalAttitudeArray.length?(t.attitudeparametersErrMsg="Please fill out this field.",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"}):t.attitudeBooleans[3]?t.attitudeBooleans[2]||(t.attitudeparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"}):(t.attitudeparametersErrMsg="Required: All position coordinates(x,y,z)!",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"})):(t.positionparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"},0===t.widget.settings.totalAttitudeArray.length?(t.attitudeparametersErrMsg="Please fill out this field.",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"}):t.attitudeBooleans[3]?t.attitudeBooleans[2]||(t.attitudeparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"}):(t.attitudeparametersErrMsg="Required: All position coordinates(x,y,z)!",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"})):(t.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"},0===t.widget.settings.totalAttitudeArray.length?(t.attitudeparametersErrMsg="Please fill out this field.",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"}):t.attitudeBooleans[3]?t.attitudeBooleans[2]||(t.attitudeparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"}):(t.attitudeparametersErrMsg="Required: All position coordinates(x,y,z)!",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"})):(t.attitudeparametersErrMsg="Required: All attitude coordinates(q1,q2,q3,qc)!",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"},0===t.widget.settings.totalPositionArray.length?(t.positionparametersErrMsg="Please fill out this field.",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):t.positionBooleans[3]?t.positionBooleans[2]||(t.positionparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):(t.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"})):(t.attitudeparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"},0===t.widget.settings.totalPositionArray.length?(t.positionparametersErrMsg="Please fill out this field.",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):t.positionBooleans[3]?t.positionBooleans[2]||(t.positionparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):(t.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"})):(t.attitudeparametersErrMsg="Required: All attitude coordinates(q1,q2,q3,qc)!",t.attitudeInputStyles={"border-color":"#dd2c00"},t.attitudeBtnStyles={"border-left-color":"#dd2c00"},0===t.widget.settings.totalPositionArray.length?(t.positionparametersErrMsg="Please fill out this field.",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):t.positionBooleans[3]?t.positionBooleans[2]||(t.positionparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}):(t.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",t.positionInputStyles={"border-color":"#dd2c00"},t.positionBtnStyles={"border-left-color":"#dd2c00"}))},t.getTelemetrydata=function(o){t.chosenCategory=o,n.setTempWidget(t.widget,this),r.innerWidth<=1440?i("left").open():(t.lock=e.getLock(),t.lock.lockLeft=!0,e.setLeftLock(t.lock.lockLeft)),n.setMenuStatus(!0),n.setOpenLogo(!1)},t.readValues=function(e){var n=[];if(t.stringPositionData="",t.stringAttitudeData="","attitude"==e){t.widget.settings.totalAttitudeArray&&(n=a(t.widget.settings.totalAttitudeArray,4));for(var r=0;r<n.length;r++)n[r]&&(r==n.length-1?t.stringAttitudeData+=n[r].id:t.stringAttitudeData+=n[r].id+", ");return t.stringAttitudeData?t.stringAttitudeData:""}if("position"==e){t.widget.settings.totalPositionArray&&(n=a(t.widget.settings.totalPositionArray,3));for(r=0;r<n.length;r++)n[r]&&(r==n.length-1?t.stringPositionData+=n[r].id:t.stringPositionData+=n[r].id+", ");return t.stringPositionData?t.stringPositionData:""}},t.sortableOptionsAttitude={containment:"#scrollable-containerAttitude",scrollableContainer:"#scrollable-containerAttitude",accept:function(t,e){return t.itemScope.sortableScope.$id===e.$id}},t.sortableOptionsPosition={containment:"#scrollable-containerPosition",scrollableContainer:"#scrollable-containerPosition",accept:function(t,e){return t.itemScope.sortableScope.$id===e.$id}},t.getValue=function(e){angular.copy(t.widget.settings.dataArray).length;var n=t.widget.settings.dataArray[t.widget.settings.dataArray.length-1];if(!e&&n&&""!==n.id){"attitude"==t.chosenCategory?t.widget.settings.totalAttitudeArray.push(t.widget.settings.dataArray[t.widget.settings.dataArray.length-1]):"position"==t.chosenCategory&&t.widget.settings.totalPositionArray.push(t.widget.settings.dataArray[t.widget.settings.dataArray.length-1]);var r,i=[];if(4===(i=(r=angular.copy(t.widget.settings.totalAttitudeArray)).length>4?a(r,4):r).length){var o=l(i),s=c(o);!1===s&&4===o.length?4===o.length&&(t.settings.attitudeData=o,t.vehicle=o[0].vehicle,t.widget.settings.totalAttitudeArray=angular.copy(o),t.attitudeBooleans[0]=!0,t.attitudeBooleans[1]=!0,t.attitudeBooleans[2]=!0,t.attitudeBooleans[3]=!0):o.length<4?(t.attitudeBooleans[0]=!1,t.attitudeBooleans[1]=!0,t.attitudeBooleans[2]=!0,t.attitudeBooleans[3]=!0):!1===s?(t.attitudeBooleans[1]=!1,t.attitudeBooleans[0]=!0,t.attitudeBooleans[2]=!0,t.attitudeBooleans[3]=!0):!0===s&&4===o.length?(t.attitudeBooleans[2]=!1,t.attitudeBooleans[0]=!0,t.attitudeBooleans[1]=!0,t.attitudeBooleans[3]=!0):!0===s&&4!==o.length&&(t.attitudeBooleans[2]=!1,t.attitudeBooleans[0]=!0,t.attitudeBooleans[1]=!0,t.attitudeBooleans[3]=!0)}else t.attitudeBooleans[3]=!1,t.attitudeBooleans[0]=!0,t.attitudeBooleans[1]=!0,t.attitudeBooleans[2]=!0;var u,d=[];if(3===(d=(u=angular.copy(t.widget.settings.totalPositionArray)).length>3?a(u,3):u).length){var h=l(d),f=c(h);!1===f&&3===h.length?3===h.length&&(t.settings.positionData=h,t.vehicle=h[0].vehicle,t.widget.settings.totalPositionArray=angular.copy(h),t.positionBooleans[0]=!0,t.positionBooleans[1]=!0,t.positionBooleans[2]=!0,t.positionBooleans[3]=!0):h.length<3?(t.positionBooleans[0]=!1,t.positionBooleans[1]=!0,t.positionBooleans[2]=!0,t.positionBooleans[3]=!0):!1===f?(t.positionBooleans[1]=!1,t.positionBooleans[0]=!0,t.positionBooleans[2]=!0,t.positionBooleans[3]=!0):!0===f&&3===h.length?(t.positionBooleans[2]=!1,t.positionBooleans[0]=!0,t.positionBooleans[1]=!0,t.positionBooleans[3]=!0):!0===f&&3!==h.length&&(t.positionBooleans[2]=!1,t.positionBooleans[0]=!0,t.positionBooleans[1]=!0,t.positionBooleans[3]=!0)}else t.positionBooleans[3]=!1,t.positionBooleans[0]=!0,t.positionBooleans[1]=!0,t.positionBooleans[2]=!0}},t.openAttitudeList=function(){t.settings.tempAttitudes=angular.copy(a(t.widget.settings.totalAttitudeArray,4)),o.open({templateUrl:"./directives/satellite/quaternionList.html",controller:"attitudeListCtrl",controllerAs:"$ctrl",resolve:{attitudeItems:function(){return t.settings}}}).result.then(function(e){4===e.tempAttitudes.length&&(t.widget.settings.totalAttitudeArray=angular.copy(e.tempAttitudes),t.settings.attitudeData=angular.copy(t.widget.settings.totalAttitudeArray))},function(){})},t.openPositionList=function(){t.settings.tempPositions=angular.copy(a(t.widget.settings.totalPositionArray,3)),o.open({templateUrl:"./directives/satellite/positionList.html",controller:"positionListCtrl",controllerAs:"$ctrl",resolve:{positionItems:function(){return t.settings}}}).result.then(function(e){3===e.tempPositions.length&&(t.widget.settings.totalPositionArray=angular.copy(e.tempPositions),t.settings.positionData=angular.copy(t.widget.settings.totalPositionArray))},function(){})}}]),app.controller("positionListCtrl",["$scope","$uibModalInstance","positionItems","$uibModal",function(t,e,n,r){var i=this;i.data=n;var o=angular.copy(n);i.close=function(){i.data.tempPositions=o.tempPositions,e.dismiss("cancel")},i.save=function(){r.open({templateUrl:"./directives/satellite/confirmParameter.html",controller:"confirmCtrl",controllerAs:"$ctrl",resolve:{dataLabel:function(){return"Is the position coordinates selected order is:x,y,z?"},dataItems:function(){return i.data}}}).result.then(function(t){e.close(t)},function(){})}}]),app.controller("attitudeListCtrl",["$scope","$uibModalInstance","attitudeItems","$uibModal",function(t,e,n,r){var i=this;i.data=n;var o=angular.copy(n);i.close=function(){i.data.tempAttitudes=o.tempAttitudes,e.dismiss("cancel")},i.save=function(){r.open({templateUrl:"./directives/satellite/confirmParameter.html",controller:"confirmCtrl",controllerAs:"$ctrl",resolve:{dataLabel:function(){return"Is the quaternion coordinates selected order is:q1,q2,q3,qc?"},dataItems:function(){return i.data}}}).result.then(function(t){e.close(t)},function(){})}}]),app.controller("confirmCtrl",["$scope","$uibModalInstance","dataLabel","dataItems",function(t,e,n,r){var i=this;i.modalLabel=n,i.finalData=r,i.close=function(){e.dismiss("cancel")},i.save=function(){e.close(i.finalData)}}]),app.directive("systemmap",function(){return{restrict:"EA",controller:"SystemMapCtrl",templateUrl:"./directives/systemmap/systemmap.html"}}),app.controller("SystemMapCtrl",["$scope","dashboardService","$interval","datastatesService",function(t,e,n,r){r.colorValues.alarmcolor,r.colorValues.cautioncolor,r.colorValues.healthycolor,r.colorValues.stalecolor,r.colorValues.disconnectedcolor,r.colorValues.defaultcolor;t.dataStatus=e.icons;t.$watch("dataStatus",function(t,e){t},!0),t.widget.settings.imglocation="/media/systemmaps/sysmap.jpg"}]),app.directive("systemmapsettings",function(){return{restrict:"E",templateUrl:"./directives/systemmap/systemmapsettings.html",controller:"SystemSettingsCtrl"}}),app.controller("SystemSettingsCtrl",["$scope","gridService",function(t,e){e.loadMaps().then(function(e){200==e.status&&(t.images=e.data)}),t.isLoaded=!1,t.widget.settings.imageid?t.selected={imageid:t.widget.settings.imageid}:t.selected={},t.closeSettings=function(e){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,t.selected.imageid=e.settings.imageid},t.saveSettings=function(e){if(t.selected.imageid){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1;for(var n=0;n<t.images.length;n++)t.images[n].imageid===t.selected.imageid&&(e.settings.imageid=t.images[n].imageid,e.settings.imglocation="data:image/gif;base64,"+t.images[n].image,e.settings.contents=t.images[n].contents)}}}]),app.directive("timeline",function(){return{restrict:"EA",controller:"timelineCtrl",templateUrl:"./directives/timeline/timeline.html"}}),app.controller("timelineCtrl",["gridService","$scope","$interval","dashboardService","$element",function(t,e,n,r,i){var o=[],a=[],s=new vis.DataSet,l=new vis.DataSet,c=i[0].getElementsByTagName("div").visualization,u=new vis.Timeline(c);e.tztimeline=[],e.tzcontainer=[],e.tzgroups=[],e.tzoptions=[];i[0].getElementsByTagName("div").timeline;function d(n,r){var i=[];a=[],s=new vis.DataSet,l=new vis.DataSet;for(var c=0;c<r.items1.length;c++)for(var d=0;d<n.length;d++)!1===r.items1[c].groupstatus?r.items1[c].Label===n[d].label&&i.push({id:n[d].id,label:r.items1[c].Label,group:"Other"}):r.items1[c].Label===n[d].group&&i.push({id:n[d].id,label:n[d].label,group:n[d].group});a=function(t){for(var e=[],n=0;n<t.length;n++)e.push({ename:t[n].label,groupname:t[n].group});for(var r=0;r<e.length;r++)"Other"===e[r].groupname||"Nested"===e[r].groupname||!1===f(e[r].groupname,e)&&e.push({ename:e[r].groupname,groupname:"Nested"});return e}(i);var h=function(t,e,n){if(void 0!==n){for(var r=[],i=[],a=function(t){for(var e=!1,n=0,r=0;r<t.length;r++)"Other"===t[r].groupname&&n++;e=n===t.length;return e}(e),s=0;s<e.length;s++)"Nested"!==e[s].groupname&&"Other"!==e[s].groupname?r.push(e[s]):i.push(e[s]);for(var l=0;l<n.length;l++)for(var c=0;c<i.length;c++)n[l].Label===i[c].ename&&r.push({ename:n[l].Label,groupname:i[c].groupname});for(var u=0;u<r.length;u++)"Nested"===r[u].groupname?t.add({id:u,content:r[u].ename,nestedGroups:[],className:"groupheader"}):"Other"===r[u].groupname?!0===a?t.add({id:u,content:r[u].ename,className:"onlyotherevents"}):t.add({id:u,content:r[u].ename,className:"otherevent"}):t.add({id:u,content:r[u].ename});for(var d=0;d<r.length;d++)for(var h=0;h<t.length;h++)r[d].groupname===t._data[h].content&&(t._data[d].className="innerItem",t._data[h].nestedGroups.push(d))}else{for(var u=0;u<e.length;u++)"Nested"===e[u].groupname?t.add({id:u,content:e[u].ename,nestedGroups:[],className:"groupheader"}):"Other"===e[u].groupname?t.add({id:u,content:e[u].ename,className:"otherevent"}):t.add({id:u,content:e[u].ename});for(var d=0;d<e.length;d++)for(var h=0;h<t.length;h++)e[d].groupname===t._data[h].content&&(t._data[d].className="innerItem",t._data[h].nestedGroups.push(d))}return o=t,t}(s,a,r.items1),g=function(n,r,i){n=new vis.DataSet;var o=0;return t.loadTimelineEvents().then(function(t){if(e.timelinedata=t.data,e.timelinedata.length>0){for(var a=0;a<i.length;a++)for(var s=0;s<e.timelinedata.length;s++)i[a].label===e.timelinedata[s].eventname&&(i[a].eventdata=e.timelinedata[s].eventdata,i[a].eventinfo=e.timelinedata[s].eventinfo);for(var l=0;l<r.length;l++)for(var c=0;c<i.length;c++)if(r._data[l].content===i[c].label&&i[c].eventdata.length>0)for(var u=0;u<i[c].eventdata.length;u++)if(""!==i[c].eventdata[u].start&&""!==i[c].eventdata[u].end){var d=vis.moment.utc().format(i[c].eventdata[u].start),h=vis.moment.utc().format(i[c].eventdata[u].end),f="";i[c].eventdata[u].content&&(f=i[c].eventdata[u].content),""!==f?n.add({id:o,content:f,className:"event",group:r._data[l].id,start:d,end:h}):n.add({id:o,content:i[c].eventinfo,className:"event",group:r._data[l].id,start:d,end:h}),o++}else""===i[c].eventdata[u].start||i[c].eventdata[u].end||(d=vis.moment.utc().format(i[c].eventdata[u].start),n.add({id:o,content:i[c].eventinfo,className:"event",group:r._data[l].id,start:d}),o++)}}),n}(l,h,i);e.options=p(),u.setOptions(e.options),u.setOptions({orientation:{axis:"none"}}),u.setGroups(h),u.setItems(g),e.widget.settings.start||e.widget.settings.start?e.options=p():(e.options=p(),e.widget.settings.start=e.options.start,e.widget.settings.end=e.options.end)}function h(){e.timezones=new Array,e.tztimeline=[],e.tzcontainer=[],e.tzgroups=[],e.tzoptions=[];var t=i[0].getElementsByTagName("div").timeline;e.widget.settings.start&&e.widget.settings.end&&(e.options=p()),e.widget.settings.timezones&&0!==e.widget.settings.timezones.length||(e.widget.settings.timezones=[{name:"UTC",utcoffset:"+00:00",id:"utc",labeloffset:"+ 00"}]);for(var n=0;n<e.widget.settings.timezones.length;n++)e.timezones.push(e.widget.settings.timezones[n]);for(;t.firstChild;)t.removeChild(t.firstChild);for(var o=0;o<e.timezones.length;o++){e.tzcontainer[o]=document.createElement("div"),e.tzcontainer[o].className="tzgroup",t.insertBefore(e.tzcontainer[o],t.childNodes[t.childNodes.length]);var a=new vis.Timeline(e.tzcontainer[o]);e.tztimeline.push(a),e.widget.settings.start&&e.widget.settings.end?e.tzoptions.push({start:e.widget.settings.start,end:e.widget.settings.end,orientation:{axis:"top"},moveable:!1,zoomable:!1}):e.tzoptions.push({start:new Date(vis.moment(r.getTime("UTC").today).utcOffset(e.timezones[o].utcoffset)-36e5),end:new Date(vis.moment(r.getTime("UTC").today).utcOffset(e.timezones[o].utcoffset)+36e5),orientation:{axis:"top"},moveable:!1,zoomable:!1});var s=new vis.DataSet,l="",c=e.timezones[o].name;e.tzgroups.push(s),l="San Francisco"===c?{moment:function(t){return vis.moment(t).utcOffset("-08:00")}}:"Singapore"===c?{moment:function(t){return vis.moment(t).utcOffset("+08:00")}}:"UTC"===c?{moment:function(t){return vis.moment(t).utcOffset("+00:00")}}:"Luxembourg"===c?{moment:function(t){return vis.moment(t).utcOffset("+02:00")}}:{moment:function(t){return vis.moment(t).utcOffset("+00:00")}},e.tztimeline[o].setOptions(e.tzoptions[o]),e.tztimeline[o].setOptions(l),e.tzgroups[o].add({id:0,content:e.timezones[o].name+" (UTC "+e.timezones[o].labeloffset+")"}),e.tztimeline[o].setGroups(e.tzgroups[o])}}function f(t,e){return e.some(function(e){return e.ename===t})}function g(t,n){return{groupTemplate:function(t){var n,r,i,a,s,l,c,u,d,h,f,g,p,m,y,_,w,b,x=document.createElement("div"),M=document.createElement("span");return t.nestedInGroup?(M.innerHTML=t.content,x.insertAdjacentElement("beforeEnd",M),n=document.createElement("div"),r=document.createElement("button"),i=document.createElement("i"),a=document.createElement("div"),s=document.createElement("p"),l=document.createElement("p"),s.className="listItems",l.className="listItems",document.createElement("a"),document.createElement("a"),(d=document.createElement("p")).className="listItems",c=document.createElement("a"),u=document.createElement("a"),h=document.createElement("a"),n.className="dropdown",n.setAttribute("style","display:inline"),(f=n.appendChild(r)).className="btn btn-secondary dropdown-toggle",f.setAttribute("data-toggle","dropdown"),f.setAttribute("aria-haspopup","true"),f.setAttribute("aria-expanded","false"),f.setAttribute("style","padding:0px;margin-right:2px;margin-bottom:3px;background:none;"),f.appendChild(i).className="fa fa-chevron-right",(g=n.appendChild(a)).className="dropdown-menu",g.setAttribute("style","min-width:128px !important;border-radius:0px;background-color:#f1f2f4"),p=g.appendChild(s).appendChild(c),m=document.createTextNode("Hide"),p.className="dropdown-item",p.setAttribute("style","padding-left:10px;color:#333;text-decoration:none"),p.appendChild(m),y=g.appendChild(l).appendChild(u),_=document.createTextNode("Move Up"),y.className="dropdown-item",y.setAttribute("style","padding-left:10px;color:#333;text-decoration:none"),y.appendChild(_),w=g.appendChild(d).appendChild(h),b=document.createTextNode("Move Down"),w.className="dropdown-item",w.setAttribute("style","padding-left:10px;color:#333;text-decoration:none"),w.appendChild(b),p.addEventListener("click",function(){t.nestedInGroup&&o.update({id:t.id,visible:!1})}),y.addEventListener("click",function(){if(0!==t.id){for(var n,r,i=t.content.split("_"),a=[],s=0;s<o.length;s++)if(t.id===o._data[s].id){if(a=o._data[s-1].content.split("_"),i[0]===a[0]){n=o._data[s].content,r=o._data[s-1].content,e.rowOperationErrorMsg="",e.errMsgStyles={};break}e.rowOperationErrorMsg="This row cannot be moved further up!",e.errMsgStyles={padding:"5px","margin-bottom":"0px",opacity:"1","border-radius":"0px",position:"absolute",top:"35px",left:"0%",right:"0%","z-index":100};break}void 0!==n&&void 0!==r&&(o.update({id:t.id,content:r}),o.update({id:t.id-1,content:n}),v(n,r),e.rowOperationErrorMsg="",e.errMsgStyles={})}else 0===t.id&&(e.rowOperationErrorMsg="This row cannot be moved further up!",e.errMsgStyles={padding:"5px","margin-bottom":"0px",opacity:"1","border-radius":"0px",position:"absolute",top:"35px",left:"0%",right:"0%","z-index":100})}),w.addEventListener("click",function(){if(t.id!==o.length-1){for(var n,r,i=t.content.split("_"),a=[],s=0;s<o.length;s++)if(t.id===o._data[s].id){if(a=o._data[s+1].content.split("_"),i[0]===a[0]&&s!==o.length-2){n=o._data[s].content,r=o._data[s+1].content,e.rowOperationErrorMsg="",e.errMsgStyles={};break}e.rowOperationErrorMsg="This row cannot be moved down!",e.errMsgStyles={padding:"5px","margin-bottom":"0px",opacity:"1","border-radius":"0px",position:"absolute",top:"35px",left:"0%",right:"0%","z-index":100};break}void 0!==n&&void 0!==r&&(o.update({id:t.id,content:r}),o.update({id:t.id+1,content:n}),v(n,r),e.rowOperationErrorMsg="",e.errMsgStyles={})}else t.id===o.length-1&&(e.rowOperationErrorMsg="This row cannot be moved further down!",e.errMsgStyles={padding:"5px","margin-bottom":"0px",opacity:"1","border-radius":"0px",position:"absolute",top:"35px",left:"0%",right:"0%","z-index":100})}),x.insertAdjacentElement("afterbegin",n),x):(M.innerHTML=t.content,x.insertAdjacentElement("beforeEnd",M),x)},groupEditable:!0,moment:function(t){return vis.moment(t).utc()},start:t,end:n,orientation:{axis:"none"}}}function p(){if(e.widget.settings.start&&e.widget.settings.end){var t=g(e.widget.settings.start,e.widget.settings.end);e.options=t}else{t=g(new Date(vis.moment(r.getTime("UTC").today).utc()-36e5),new Date(vis.moment(r.getTime("UTC").today).utc()+36e5));e.options=t}return e.options}function v(t,n){for(var r="",i="",o="",a=[],s="",l="",c="",u="",d=[],h="",f=0;f<e.widget.settings.events.length;f++)e.widget.settings.events[f].label===t?(r=f,i=t,o=e.widget.settings.events[f].group,a=e.widget.settings.events[f].eventdata,s=e.widget.settings.events[f].eventinfo):e.widget.settings.events[f].label===n&&(l=f,c=n,u=e.widget.settings.events[f].group,d=e.widget.settings.events[f].eventdata,h=e.widget.settings.events[f].eventinfo);e.widget.settings.events[r].label=c,e.widget.settings.events[r].group=u,e.widget.settings.events[r].eventdata=d,e.widget.settings.events[r].eventinfo=h,e.widget.settings.events[l].label=i,e.widget.settings.events[l].group=o,e.widget.settings.events[l].eventdata=a,e.widget.settings.events[l].eventinfo=s}e.datetime="",e.rowOperationErrorMsg="",e.errMsgStyles={},e.datetime=e.widget.settings.datetime,e.realtimebutton={style:{background:"#12C700",float:"right"}},h(),t.loadTimelineEvents().then(function(t){0===t.data.length&&(c.setAttribute("style","display:none"),e.rowOperationErrorMsg="Please upload timeline data file to view timeline events!")}),e.$watch("widget.settings.timezones",function(t,n){h(),e.datetime&&e.datetime.length>0?e.changetime():e.realtime()},!0),e.$watch("widget.settings.events",function(t,n){t&&d(t,e.widget.settings.grouporder),e.datetime&&e.datetime.length>0?e.changetime():e.realtime()},!0),e.$watch("widget.settings.grouporder",function(t,n){t&&d(e.widget.settings.events,t),e.datetime&&e.datetime.length>0?e.changetime():e.realtime()},!0),u.on("rangechanged",function(t){for(var n=0;n<e.timezones.length;n++)try{e.tztimeline[n].setWindow(t.start,t.end)}catch(t){}e.widget.settings.start=t.start,e.widget.settings.end=t.end}),e.updateClock=function(){if(r.getTime("UTC").today){if(u.setCurrentTime(vis.moment(r.getTime("UTC").today).utc()),e.timezones.length>0)for(var t=0;t<e.timezones.length;t++)try{e.tztimeline[t].setCurrentTime(vis.moment(r.getTime("UTC").today).utcOffset(e.timezones[t].utcoffset))}catch(t){}""===e.widget.settings.datetime||void 0===e.widget.settings.datetime?e.realtimebutton={style:{background:"#12C700"}}:e.datetime=e.widget.settings.datetime}},e.interval=n(e.updateClock,1e3),e.changetime=function(){if(e.datetime){if(n.cancel(e.interval),u.setOptions({start:new Date(vis.moment(e.datetime).utc()-36e5),end:new Date(vis.moment(e.datetime).utc()+36e5)}),e.timezones.length>0)for(var t=0;t<e.timezones.length;t++)try{e.tztimeline[t].setOptions({start:new Date(vis.moment(e.datetime).utcOffset(e.timezones[t].utcoffset)-36e5),end:new Date(vis.moment(e.datetime).utcOffset(e.timezones[t].utcoffset)+36e5)})}catch(t){}e.realtimebutton.style={background:"#cccccc52"},e.widget.settings.datetime=e.datetime,e.dateTimeErrMsg="",e.dateTimeErrMsgStyles={}}else e.dateTimeErrMsg="Select a date and time and then set.",e.dateTimeErrMsgStyles={"border-color":"#dd2c00"}},e.realtime=function(){if(e.interval&&n.cancel(e.interval),e.clock=r.getTime("UTC"),u.setOptions({start:new Date(vis.moment(e.clock.today).utc()-36e5),end:new Date(vis.moment(e.clock.today).utc()+36e5)}),e.timezones.length>0)for(var t=0;t<e.timezones.length;t++)try{e.tztimeline[t].setOptions({start:new Date(vis.moment(e.clock.today).utcOffset(e.timezones[t].utcoffset)-36e5),end:new Date(vis.moment(e.clock.today).utcOffset(e.timezones[t].utcoffset)+36e5)})}catch(t){}e.datetime="",e.widget.settings.datetime="",e.interval=n(e.updateClock,1e3),e.realtimebutton={style:{background:"#12C700",float:"right"}},e.dateTimeErrMsg="",e.dateTimeErrMsgStyles={}},e.$on("$destroy",function(t){n.cancel(e.interval)})}]),app.directive("timelinesettings",function(){return{restrict:"E",templateUrl:"./directives/timeline/timelinesettings.html",controller:"timelineSettingsCtrl"}}),app.controller("timelineSettingsCtrl",["$scope","gridService",function(t,e){t.selectByGroupData=[];var n,r=!1,i=[];function o(t){var e,n,r,i=[],o=t.length;for(n=0;n<o;n++){for(e=void 0,r=0;r<i.length;r++)if(t[n].name===i[r].name){e=!0;break}e||i.push(t[n])}return i}function a(){r=!0,t.selectByGroupModel=[],t.itemsList={items1:[]};for(var e=[],n=0;n<t.widget.settings.grouporder.items1.length;n++)for(var i=0;i<t.widget.settings.events.length;i++)!1===t.widget.settings.grouporder.items1[n].groupstatus?t.widget.settings.grouporder.items1[n].Label===t.widget.settings.events[i].label&&e.push({id:t.widget.settings.events[i].id,label:t.widget.settings.grouporder.items1[n].Label,group:"Other"}):t.widget.settings.grouporder.items1[n].Label===t.widget.settings.events[i].group&&e.push({id:t.widget.settings.events[i].id,label:t.widget.settings.events[i].label,group:t.widget.settings.events[i].group});for(var o=0;o<t.selectByGroupData.length;o++)for(var a=0;a<e.length;a++)t.selectByGroupData[o].label===e[a].label&&t.selectByGroupModel.push(t.selectByGroupData[o]);s(t.selectByGroupModel,t.widget.settings.grouporder,r)}function s(e,n,r){if(void 0!==e){r=e.length===n.items1.length,t.itemsList={items1:[]};if(!0===r)for(var i=0;i<n.items1.length;i+=1)t.itemsList.items1.push({Id:n.items1[i].Id,Label:n.items1[i].Label,groupstatus:n.items1[i].groupstatus});else if(!1===r){for(var a=[],s=0;s<e.length;s++)"Other"===e[s].group?a.push({name:e[s].label,isgroup:!1}):a.push({name:e[s].group,isgroup:!0});var l=o(a);for(i=0;i<l.length;i+=1)t.itemsList.items1.push({Id:i,Label:l[i].name,groupstatus:l[i].isgroup})}}}n=[],t.selectByGroupData=[],e.loadTimelineEvents().then(function(e){if(e.data.length>0){for(var l=0;l<e.data.length;l++)t.selectByGroupData.push({id:l,label:e.data[l].eventname,group:e.data[l].eventgroup}),n.push({name:e.data[l].eventgroup});!function(e){if(void 0===t.widget.settings.events)if(t.selectByGroupData.length>0){t.widget.settings.events=[],r=!1,t.selectByGroupModel=[];for(var n=0;n<e.length;n++)t.selectByGroupModel.push(e[n]),t.widget.settings.events.push(e[n]);t.widget.settings.grouporder={items1:[]},s(t.selectByGroupModel,t.widget.settings.grouporder,r);for(var i=0;i<t.itemsList.items1.length;i++)t.widget.settings.grouporder.items1.push(t.itemsList.items1[i])}else 0===t.selectByGroupData.length&&(t.selectByGroupModel=[],t.widget.settings.events=[],t.widget.settings.grouporder=[]);else t.widget.settings.events.length>0&&t.widget.settings.grouporder.items1.length>0&&(t.selectByGroupModel=[],r=!0,a())}(t.selectByGroupData);for(var c=o(n),u=0;u<c.length;u++)i.push(c[u].name)}else t.selectByGroupData=[],t.selectByGroupModel=[]}),t.selectByGroupSettings={selectByGroups:i,groupByTextProvider:function(t){for(var e=0;e<i.length;e++)if(t===i[e])return i[e]},groupBy:"group",scrollableHeight:"200px",scrollable:!0,enableSearch:!0},t.customFilter="",t.selected={},t.isLoaded=!1,t.types=[{key:1,value:"Timezone"},{key:2,value:"Events"}],t.timezones=[{name:"Luxembourg",utcoffset:"+02:00",id:"lux",labeloffset:"+ 02"},{name:"San Francisco",utcoffset:"-08:00",id:"sfo",labeloffset:"- 08"},{name:"Singapore",utcoffset:"+08:00",id:"sgp",labeloffset:"+ 08"},{name:"UTC",utcoffset:"+00:00",id:"utc",labeloffset:"+ 00"}],t.sortableOptions={containment:"#scrollable-container",scrollableContainer:"#scrollable-container",accept:function(t,e){return t.itemScope.sortableScope.$id===e.$id}},t.timezoneErrMsg="",t.eventErrMsg="",t.closeSettings=function(e){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,a(),t.eventErrMsg="",t.timezoneErrMsg=""},t.saveSettings=function(e){if(t.selected.type)if("Timezone"===t.selected.type.value)t.selected.timezone&&(!0===function(t,e){for(var n=!1,r=0;r<t.length;r++)if(t[r].name===e){n=!0;break}return n}(e.settings.timezones,t.selected.timezone.name)?(t.timezoneErrMsg="This time axis already exists in the qwidget",t.eventErrMsg="",e.settings.timezones=e.settings.timezones,t.selected.timezone={}):(e.settings.timezones.push(t.selected.timezone),e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,t.selected={},t.eventErrMsg="",t.timezoneErrMsg=""));else if("Events"==t.selected.type.value)if(r=!1,t.selectByGroupModel.length>0){e.settings.events=[];for(var n=0;n<t.selectByGroupData.length;n++)for(var i=0;i<t.selectByGroupModel.length;i++)t.selectByGroupData[n].label===t.selectByGroupModel[i].label&&e.settings.events.push(t.selectByGroupModel[i]);e.settings.grouporder={items1:[]};for(var o=0;o<t.itemsList.items1.length;o++)e.settings.grouporder.items1.push(t.itemsList.items1[o]);e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1,t.eventErrMsg="",t.timezoneErrMsg=""}else 0===t.selectByGroupModel.length&&(t.eventErrMsg="Select atleast one event",t.timezoneErrMsg="")},t.$watch("selectByGroupModel",function(e,n){t.selectByGroupModel&&t.selectByGroupModel.length>0&&s(t.selectByGroupModel,t.widget.settings.grouporder,r)},!0)}]),angular.module("app").component("dashboard",{transclude:!0,scope:!0,bindToController:!0,templateUrl:"./components/dashboard/dashboard.html",controller:function(t,e,n,r,i,o,a,s,l,c){var u=this;u.clock={utc:"000.00.00.00 UTC"},u.locks=t.getLock(),u.telemetry=t.telemetry,u.name=a.getUserName(),u.email=a.getUserEmail(),u.role=a.userRole;var d=e.getDashboard();u.currentMission=t.getCurrentMission(),u.updateClock=function(){u.clock=t.getTime("UTC")},u.interval=r(u.updateClock,500),u.openLeftNav=function(){o.innerWidth<=1440?i("left").open():(u.locks.lockLeft=!u.locks.lockLeft,t.setLeftLock(u.locks.lockLeft)),n.setMenuStatus(!0),n.setOpenLogo(!0)},u.logout=function(t){c({title:"Do you want to save this layout?",input:!0,label:"Layout Name",value:d.current.name}).then(function(t){e.save(u.email,t).then(function(t){200==t.status&&(o.location.href="/logout")})},function(){o.location.href="/logout"}).catch(function(t){})},u.openRightNav=function(){o.innerWidth<=1440?i("right").open():(u.locks.lockRight=!u.locks.lockRight,t.setRightLock(u.locks.lockRight))},u.showSettings=function(){s.open({templateUrl:"./components/dashboard/roleModal.html",controller:"modalCtrl",controllerAs:"$ctrl",resolve:{mission:function(){return t.getCurrentMission()}}}).result.then(function(t){},function(){})}}}),app.controller("modalCtrl",["$uibModalInstance","userService","mission","$window","$mdDialog",function(t,e,n,r,i){var o=this;o.cRole={},e.getCurrentRole(n.missionName).then(function(t){200==t.status&&(o.cRole=angular.copy(t.data),o.role={currentRole:o.cRole})}),o.close=function(){t.dismiss("cancel")},e.getAllowedRoles(n.missionName).then(function(t){200==t.status&&(o.roles=t.data)}),o.updateRole=function(i){"MD"===o.cRole.callsign&&"Mission Director"!==o.role.currentRole.name?t.close(o.cRole):e.getRoles().then(function(i){if(200==i.status){for(var a in i.data.roles)if(i.data.roles[a].name===o.role.currentRole.name){o.role.currentRole.callsign=i.data.roles[a].callsign;break}e.setCurrentRole(o.role.currentRole,n.missionName).then(function(e){200==e.status?t.close(o.role.currentRole):r.alert("An error occurred.User's role not updated!")})}})}}]),app.controller("missionModalCtrl",["$uibModalInstance","dashboardService","$scope","$window",function(t,e,n,r){var i=this;n.missions=e.missions,i.currentMission={},i.missionName="",n.$watch("missions",function(t,e){i.missions=t},!0),i.setMission=function(){for(var r=n.missions.length,o=0;o<r;o++)if(i.missionName===n.missions[o].missionName&&(i.currentMission=angular.copy(n.missions[o]),!1===e.isEmpty(i.currentMission))){e.setCurrentMission(i.currentMission),t.close(i.currentMission);break}}}]),app.component("deleteMenu",{bindings:{widget:"="},templateUrl:"../components/deleteMenu/delete.html",controller:function(t){this.deleteWidget=function(e){t.remove(e)},this.closedeleteWidget=function(t){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1}}}),app.component("leftSidebar",{templateUrl:"./components/leftSidebar/left_sidebar.html",controller:function(t,e,n,r,i,o,a){var s=this;function l(t){words=t.split(" ");for(var e=0;e<words.length;e++){var n=words[e].split("");n[0]=n[0].toUpperCase(),words[e]=n.join("")}return words.join(" ")}s.searchID="",s.previousTree=[],s.noresultsmsg="",s.interval=n(function(){var n=e.getLock(),r=t.getMenuStatus();if((n.lockLeft||i("left").isOpen())&&r){if(s.telemetry=e.getTelemetryValues(),s.telemetry.hasOwnProperty("data")){var o=function t(e,n){var r=[];for(var i in e)if(e.hasOwnProperty(i)){var o=[],a=!0,s=n?n+"."+i:i,c={value:"",key:""};if("object"==typeof e[i]){for(var u in e[i])if(e[i].hasOwnProperty(u)&&"object"!=typeof e[i][u]){a=!1;break}a&&(o=t(e[i],s))}0!=o.length&&(i=l(i));var c={name:i,nodes:o,value:s,active:!1};r.push(c)}return r.sort(function(t,e){var n=t.name,r=e.name;return n<r?-1:n>r?1:0}),r}(s.telemetry.data);s.dataloading=!1,angular.equals(o,s.previousTree)||(s.previousTree=angular.copy(o),s.dataTree=angular.copy(o)),0===s.searchID.length&&s.noresultsmsg.includes("No results found")&&(s.noresultsmsg="",s.previousTree=angular.copy(o),s.dataTree=angular.copy(o),s.dataloading=!1)}else s.dataTree=[],s.previousTree=angular.copy(s.dataTree),s.noresultsmsg="No Data available",s.dataloading=!1,0===s.searchID.length&&s.noresultsmsg.includes("No results found")&&(s.noresultsmsg="",s.dataTree=[],s.previousTree=angular.copy(s.dataTree),s.dataloading=!1);t.setMenuStatus(!1)}},1e3),s.selectData=function(e){if(t.getOpenLogo())0!=e.nodes.length&&(e.active=!e.active);else if(0==e.nodes.length)t.setVehicleInfo(e.value);else{for(var n=e.nodes,r=0,i=0;i<n.length;i++)n[i].nodes.length>0&&(r+=1);0==r?t.setVehicleInfo(e.value):t.setVehicleInfo(""),e.active=!e.active}},s.filter=function(t){13!==t.which&&"click"!==t.type||(s.dataTree=angular.copy(s.previousTree),s.dataTree=s.dataTree.filter(function t(e){var n=e.name.toLowerCase(),r=s.searchID.toLowerCase();return!!n.includes(r)||(e.nodes?(e.nodes=e.nodes.filter(t),e.nodes.length&&(e.active=!e.active),e.nodes.length):void 0)}),0==s.dataTree.length&&(s.noresultsmsg="No results found for "+s.searchID+" !",s.searchID=""))}}}),angular.module("app").component("grid",{templateUrl:"../components/grid/grid.html",controller:function(t,e){var n=this;n.gridsterOptions=t.gridsterOptions,n.dashboard=t.getDashboard(),n.loadStatus=e.getLoadStatus(),n.loadLayoutloaders=t.getGridLoader(),n.remove=function(t){t.main=!1,t.settings.active=!1,t.saveLoad=!1,t.delete=!0},n.openSettings=function(t){t.main=!1,t.settings.active=!0,t.saveLoad=!1,t.delete=!1},n.openSaveLoadSettings=function(t){t.main=!1,t.settings.active=!1,t.saveLoad=!0,t.delete=!1}}}),app.component("saveMenu",{bindings:{widget:"="},templateUrl:"../components/saveMenu/save.html",controller:function(){this.closeSaveLoadSettings=function(t){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1}}}),angular.module("app").component("statusIcons",{templateUrl:"./components/statusIcons/status_icons.html",controller:function(t,e){var n=this;n.satstatusIconColor="#12C700",n.gsstatusIconColor="#12C700",n.proxystatusIconColor="#12C700",n.dbstatusIconColor="#12C700",e.statusIcons=t.icons;var r={};e.$watch("statusIcons",function(t,e){"grey"===(r=t).sIcon&&"grey"===r.gIcon&&"grey"===r.pIcon&&"red"===r.dIcon?(n.satstatusIconColor="#CFCFD5",n.gsstatusIconColor="#CFCFD5",n.proxystatusIconColor="#CFCFD5",n.dbstatusIconColor="#FF0000"):"grey"===r.sIcon&&"red"===r.gIcon&&"green"===r.pIcon&&"blue"===r.dIcon?(n.satstatusIconColor="#CFCFD5",n.gsstatusIconColor="#FF0000",n.proxystatusIconColor="#12C700",n.dbstatusIconColor="#71A5BC"):"red"===r.sIcon&&"green"===r.gIcon&&"green"===r.pIcon&&"green"===r.dIcon?(n.satstatusIconColor="#FF0000",n.gsstatusIconColor="#12C700",n.proxystatusIconColor="#12C700",n.dbstatusIconColor="#12C700"):"grey"===r.sIcon&&"grey"===r.gIcon&&"red"===r.pIcon&&"green"===r.dIcon?(n.satstatusIconColor="#CFCFD5",n.gsstatusIconColor="#CFCFD5",n.proxystatusIconColor="#FF0000",n.dbstatusIconColor="#12C700"):"green"===r.sIcon&&"green"===r.gIcon&&"green"===r.pIcon&&"green"===r.dIcon&&(n.satstatusIconColor="#12C700",n.gsstatusIconColor="#12C700",n.proxystatusIconColor="#12C700",n.dbstatusIconColor="#12C700")},!0)}}),app.component("rightSidebar",{templateUrl:"./components/rightSidebar/right_sidebar.html",controller:function(t,e,n,r,i,o,a,s){var l=this;l.name=o.getUserName(),l.email=o.getUserEmail();var c=t.getDashboard();function u(){if(r.innerWidth<=1440)i("right").close();else{var t=e.getLock();t.lockRight=!t.lockRight,e.setRightLock(t.lockRight)}}r.innerWidth<=768?l.userRole={cRole:{name:"Observer",callsign:"VIP"}}:l.userRole=o.userRole,l.addWidget=function(){t.addWidget()},l.clear=function(){t.clear()},l.addWidgets=function(e){t.addWidgets(e)},l.widgetDefinitions=t.widgetDefinitions,l.QwidgetMenu=!1,l.addMenu=!1,l.showQwidgetMenu=function(){l.QwidgetMenu=!l.QwidgetMenu},l.showAddMenu=function(){l.addMenu=!l.addMenu},l.save=function(e){n({title:"Save Layout",input:!0,label:"Layout Name",value:c.current.name}).then(function(e){t.save(l.email,e).then(function(t){200==t.status&&(r.document.title="Quindar - "+e)})}).catch(function(t){})},l.load=function(){t.load(l.email).then(function(t){l.layouts=t.data,l.layoutMenu=!l.layoutMenu},function(t){})},l.showLayout=function(n){t.setGridLoader(!0),e.setLoadStatus(!1),t.showLayout(l.layouts,n),r.document.title="Quindar - "+n.name,u()},l.showDoc=function(){l.Doc=!l.Doc},l.showReadme=function(){a.open({templateUrl:"./components/rightSidebar/documentation.html",controller:"docController"}).result.then(function(t){},function(){}),u()},l.showContributing=function(){a.open({templateUrl:"./components/rightSidebar/contributing.html",controller:"docController"}).result.then(function(t){},function(){}),u()},l.showAdminModal=function(){u(),a.open({templateUrl:"./components/rightSidebar/adminModal.html",controller:"adminCtrl",controllerAs:"$ctrl",resolve:{mission:function(){return e.getCurrentMission()}}}).result.then(function(t){},function(){})}}}),app.controller("docController",["$scope","$uibModalInstance",function(t,e){t.close=function(){e.dismiss("cancel")}}]),app.controller("adminCtrl",["$scope","$filter","$uibModalInstance","userService","mission","$window",function(t,e,n,r,i,o){var a=this;a.users=[],a.roles=[],a.mission=i.missionName,t.saveSuccess=!1,r.getRoles().then(function(t){if(200==t.status){var e=t.data.roles;for(var n in e)e.hasOwnProperty(n)&&(e[n].checked=!1,"MD"!=n&&a.roles.push(e[n]))}}),r.getUsers(a.mission).then(function(t){if(200==t.status)for(var e=t.data,n=0;n<e.length;n++)e[n].currentRole&&"MD"!=e[n].currentRole.callsign&&a.users.push(e[n])}),a.close=function(){n.dismiss("cancel")},a.save=function(){if(a.selected)if(e("filter")(a.roles,{checked:!0}).length){for(var n=[],i={},s=0;s<a.roles.length;s++)if(1==a.roles[s].checked){var l=new Object;l.name=a.roles[s].name,l.callsign=a.roles[s].callsign,n.push(l),i[a.roles[s].callsign]=1}a.selected.user.allowedRoles=i,r.setAllowedRoles(a.selected.user,n,a.mission).then(function(e){200==e.status&&(t.saveSuccess=!0,t.successMessage="Success! Roles updated for user: "+a.selected.user.google.name)})}else o.alert("Please choose at least one role");else o.alert("Please select the user from dropdown menu")},t.$watch("$ctrl.selected.user",function(t,e){for(var n=0;n<a.roles.length;n++)a.selected.user.allowedRoles&&(a.roles[n].callsign in a.selected.user.allowedRoles?a.roles[n].checked=!0:a.roles[n].checked=!1)}),a.resetSuccessMessage=function(){t.saveSuccess=!1,t.successMessage=""}}]);