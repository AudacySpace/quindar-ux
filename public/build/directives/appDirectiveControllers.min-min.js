app.directive("quindarwidget",["$compile",function(e){return{restrict:"AE",scope:{quindarwidget:"@",widget:"=widget"},replace:!0,controller:["$scope",function(e){e.$watch("quindarwidget",function(t){e.buildView(t)})}],link:function(t,a,o){t.buildView=function(o){var i=e("<"+o+"></"+o+">")(t);a.append(i)}}}}]),app.directive("alarmpanel",function(){return{restrict:"E",templateUrl:"./directives/alarmpanel/alarmpanel.html",controller:"AlarmPanelCtrl",controllerAs:"vm",bindToController:!0}}),app.controller("AlarmPanelCtrl",["$scope","$interval","dashboardService","datastatesService","userService","statusboardService",function(e,t,a,o,i,n){e.telemetry=a.telemetry;var s=100;e.alarmpanel=n.getStatusTable();var r,l="";e.name=i.getUserName(),e.role=i.userRole,e.contents=[],e.masteralarmstatus=n.getMasterAlarmColors(),e.class=[],e.vehicleColors=[],e.configInterval=t(function(){var t=a.telemetry;if(!a.isEmpty(t)){var o=a.sortObject(t.data);for(var i in o)if(o.hasOwnProperty(i)){var n=e.contents.findIndex(e=>e.vehicle===i);-1==n?(e.contents.push({vehicle:i,flexprop:"",categories:Object.keys(o[i]),vehicleColor:"",categoryColors:[],tableArray:[],subCategoryColors:[],ackStatus:!1}),e.vehicleColors.push({vehicle:i,status:!1})):e.contents[n].categories=Object.keys(o[i])}if(e.contents.length>0)for(var r=0;r<e.contents.length;r++)e.contents[r].flexprop=s/e.contents.length}},1e3),e.updateColors=function(){var t,i,s,c,d,u,g=[];r=a.getTime("UTC");for(var p=0;p<e.contents.length;p++){if(e.contents[p].tableArray=[],e.contents[p].subCategoryColors=[],e.contents[p].vehicle&&!1===a.isEmpty(e.telemetry)){var h=e.contents[p].vehicle;if(e.contents[p].categories.length>0)for(var v=e.contents[p].categories,m=0;m<v.length;m++)for(var y in e.telemetry[h][v[m]])if(e.telemetry[h][v[m]].hasOwnProperty(y))for(var f in e.telemetry[h][v[m]][y])if(e.telemetry[h][v[m]][y].hasOwnProperty(f)){var w=e.telemetry[h][v[m]][y][f];t=w.alarm_low,i=w.alarm_high,s=w.value,c=w.warn_low,d=w.warn_high,u=typeof w.value;var b=o.getDataColorBound(t,i,s,c,d,u);e.contents[p].subCategoryColors.push(b.color);var k=h+"."+v[m]+"."+y+"."+f,S=Math.round(r.today/1e3);l="","ALARM"!==b.alert&&"CAUTION"!==b.alert||(e.contents[p].ackStatus=!1,e.contents[p].tableArray.push({alert:b.alert,bound:b.bound,vehicle:h,time:r.utc,channel:k,ack:l,timestamp:S}))}g=g.concat(e.contents[p].tableArray)}e.vehicleColors[p].status=!1}g.length>0&&e.vehicleColors.length>0&&n.saveAlerts(g,e.vehicleColors),e.contents.length>0&&(n.setSubSystemColors(e.contents),n.setAlertsTable())},e.addtablerow=function(t,a,o){var i=[];l=e.name+" - "+e.role.cRole.callsign;var s=e.contents[a].tableArray.length;"#FF0000"!==o.background&&"#FFFF00"!==o.background||(e.contents[a].ackStatus=!0,e.class[a]="buttonNone");for(var r=0;r<e.contents.length;r++)r===a&&(e.vehicleColors[r].status=!0);for(var c=0;c<s;c++)e.contents[a].tableArray[c].ack=l,i.push(e.contents[a].tableArray[c]);n.saveAlerts(i,e.vehicleColors)},e.interval=t(e.updateColors,1e3,0,!1),e.$on("$destroy",function(a){t.cancel(e.interval),t.cancel(e.configInterval)})}]),app.directive("alarmpanelsettings",function(){return{restrict:"E",templateUrl:"./directives/alarmpanel/alarmpanelsettings.html",controller:"AlarmSettingsCtrl"}}),app.controller("AlarmSettingsCtrl",["$scope",function(e){e.statusboard=e.widget.settings.statusboard,e.saveAlarmPanelSettings=function(t){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,t.settings.statusboard=e.statusboard},e.closeAlarmPanelSettings=function(t){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,e.statusboard=t.settings.statusboard}}]),app.directive("clock",function(){return{restrict:"E",templateUrl:"./directives/clock/clock.html",controller:"ClockCtrl"}}),app.controller("ClockCtrl",["$scope","dashboardService","datastatesService","$interval",function(e,t,a,o){var i="",n={},s=a.colorValues.alarmcolor,r=a.colorValues.cautioncolor,l=a.colorValues.healthycolor,c=a.colorValues.stalecolor,d=a.colorValues.disconnectedcolor,u=a.colorValues.defaultcolor;e.statusIcons=t.icons,e.$watch("statusIcons",function(e,t){n=e},!0),e.checkForClockData=function(){e.widget.settings.clocks||(e.widget.settings.clocks=[{name:"UTC",timezone:"UTC"}]),e.clocks=new Array;for(var t=0;t<e.widget.settings.clocks.length;t++)e.clocks[t]={name:e.widget.settings.clocks[t].name,delta:"",time:{days:"000",minutes:"00",hours:"00",seconds:"00"},style:u}},e.checkForClockData(),e.updateClock=function(){for(var a=0;a<e.widget.settings.clocks.length;a++)"object"!=typeof e.clocks[a]&&(e.clocks[a]=new Object),e.widget.settings.clocks[a].hasOwnProperty("timezone")?(e.clocks[a].name=e.widget.settings.clocks[a].name,e.clocks[a].time=t.getTime(e.widget.settings.clocks[a].timezone),e.clocks[a].delta="","green"===n.sIcon&&"green"===n.gIcon&&"green"===n.pIcon&&"green"===n.dIcon?e.clocks[a].style=l:e.clocks[a].style=c):(i=t.countdown(e.widget.settings.clocks[a].reference),e.clocks[a].name=e.widget.settings.clocks[a].name,e.clocks[a].time=i,e.clocks[a].delta=i.sign,"green"===n.sIcon&&"green"===n.gIcon&&"green"===n.pIcon&&"green"===n.dIcon?"-"==i.sign&&"000"==i.days&&"00"==i.hours?(i.minutes<="59"&&i.minutes>"10"&&(e.clocks[a].style=r),i.minutes<="10"&&(e.clocks[a].style=s)):e.clocks[a].style=l:e.clocks[a].style=c),"red"===n.dIcon&&(e.clocks[a].style=d)},e.interval=o(e.updateClock,500),e.remove=function(t){e.widget.settings.clocks.splice(t,1),e.clocks.splice(t,1)},e.$on("$destroy",function(t){o.cancel(e.interval)})}]),app.directive("clocksettings",function(){return{restrict:"E",templateUrl:"./directives/clock/clocksettings.html",controller:"ClockSettingsCtrl"}}),app.controller("ClockSettingsCtrl",["$scope",function(e){e.closeSettings=function(t){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,e.selected={},e.reference="",e.name=""},e.saveSettings=function(t){e.selected.type&&("Clock"==e.selected.type.value?e.selected.timezone&&(t.settings.clocks.push({name:e.selected.timezone.value,timezone:e.selected.timezone.zone}),t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,e.selected={}):"Timer"==e.selected.type.value&&e.reference&&e.name&&(t.settings.clocks.push({name:e.name,reference:e.reference}),t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,e.selected={},e.name="",e.reference=""))},e.selected={},e.isLoaded=!1,e.types=[{key:1,value:"Clock"},{key:2,value:"Timer"}],e.timezones=[{key:1,value:"UTC",zone:"UTC"},{key:2,value:"San Francisco",zone:"America/Los_Angeles"},{key:3,value:"Singapore",zone:"Asia/Singapore"},{key:4,value:"Luxembourg",zone:"Europe/Luxembourg"}]}]),app.directive("command",function(){return{restrict:"E",templateUrl:"./directives/command/command.html",controller:"CommandCtrl"}}),app.controller("CommandCtrl",["$scope","userService","commandService","dashboardService","$interval","$window",function(e,t,a,o,i,n){function s(e,t){for(var a=[],o=e.length,i=0;i<o;i++){var n=moment(e[i][t]).tz("UTC");a.push(n.valueOf())}return Math.max.apply(null,a)}e.email=t.getUserEmail(),e.mission=o.getCurrentMission(),e.isLoaded=!1,e.sent=!1,e.initialise=function(){e.cmd="",e.arguments="",e.entered=!1,e.locked=!1,e.disableEnter=!1,e.disableInput=!1,e.disableLock=!0,e.command={name:"",arguments:"",sent_timestamp:"",time:""}},e.enter=function(){e.cmd&&e.arguments&&(e.command.name=e.cmd,e.command.arguments=e.arguments,e.entered=!0,e.disableEnter=!0)},e.lockCommand=function(){e.command.name&&e.entered?(e.locked=!0,e.disableInput=!0,e.disableLock=!0):n.alert("Please enter the commands before locking")},e.changeInput=function(){e.entered?(e.entered=!1,e.disableEnter=!1):(e.disableEnter=!1,e.disableLock=!1)},e.sendCommand=function(){var t=o.getTime("UTC"),i=(new Date).getTime();e.command.sent_timestamp=i,e.command.time=t.utc,a.saveCommand(e.email,e.command,e.mission.missionName).then(function(t){200==t.status&&(e.initialise(),e.commandForm.$setPristine(),e.commandForm.$setUntouched())})},e.updateCommandlog=function(){a.getCommandLog(e.mission.missionName).then(function(t){if(200==t.status){e.commandLog=t.data;for(var a=e.commandLog.length,o=0;o<a;o++)for(var i=s(e.commandLog[o].response,"gwp_timestamp"),n=e.commandLog[o].response.length,r=0;r<n;r++){moment(e.commandLog[o].response[r].gwp_timestamp).tz("UTC").valueOf()===i&&(e.commandLog[o].responseStatus=e.commandLog[o].response[r].status,e.commandLog[o].responseData=e.commandLog[o].response[r].metadata_data)}}})},e.initialise(),e.interval=i(e.updateCommandlog,1e3),e.$on("$destroy",function(t){i.cancel(e.interval)})}]),app.directive("commandsettings",function(){return{restrict:"E",templateUrl:"./directives/command/commandsettings.html",controller:"CommandSettingsCtrl"}}),app.controller("CommandSettingsCtrl",["$scope",function(e){e.commandlog=e.widget.settings.commandlog,e.closeSettings=function(t){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,e.commandlog=e.widget.settings.commandlog},e.saveSettings=function(t){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,e.widget.settings.commandlog=e.commandlog}}]),app.directive("datalog",function(){return{restrict:"E",templateUrl:"./directives/datalog/datalog.html",controller:"DataLogCtrl",controllerAs:"vm",bindToController:!0}}),app.controller("DataLogCtrl",["$scope","$interval","dashboardService","datastatesService","gridService",function(e,t,a,o,i){e.telemetry=a.telemetry;var n=o.colorValues.alarmcolor,s=o.colorValues.cautioncolor,r=o.colorValues.healthycolor,l=o.colorValues.stalecolor,c=o.colorValues.disconnectedcolor,d=(o.colorValues.defaultcolor,[]),u={};e.dataStatus=a.icons,e.logData=[];var g={key:""},p="",h=$("grid").find("div.box-content")[i.getDashboard().current.widgets.indexOf(e.widget)];e.boxReference=angular.element(h),e.box=e.boxReference[0],e.scrollToBottom=!0,e.$watch("dataStatus",function(e,t){u=e},!0),e.updateLog=function(){if(e.widget.settings.data&&""!==e.widget.settings.data.id&&""!==e.widget.settings.data.vehicle){if(g.key!==e.widget.settings.data.key)for(;e.logData.length>0;)e.logData.pop();if(function(){if(e.logData.length>999)for(;e.logData.length>0;)e.logData.pop();var t=a.getData(e.widget.settings.data.key);if(t){var i=typeof t.value;if("number"===i&&(t.value=parseFloat(t.value.toFixed(4))),d[d.length-1]===t.value)p="green"===u.sIcon&&"green"===u.gIcon&&"green"===u.pIcon&&"green"===u.dIcon?r:l;else{var c=o.getDataColor(t.alarm_low,t.alarm_high,t.value,t.warn_low,t.warn_high,i);p="red"===c?n:"orange"===c?s:r,d.push(t.value)}e.logData.push({parameter:e.widget.settings.data.id,value:t.value,timestamp:e.telemetry.time,style:p,vehicle:e.widget.settings.data.vehicle})}}(),"red"===u.dIcon)for(var t=0;t<=e.logData.length-1;t++)e.logData[t].style=c;g.key=e.widget.settings.data.key}},e.boxReference.scroll=function(){e.box.scrollHeight==Math.floor(e.box.scrollTop)+e.box.clientHeight?e.scrollToBottom=!0:e.scrollToBottom=!1,e.autoScroll()},e.autoScroll=function(){e.scrollToBottom&&(e.box.scrollTop=e.box.scrollHeight)},e.interval=t(e.updateLog,1e3,0,!1),e.$on("$destroy",function(a){t.cancel(e.interval)})}]),app.directive("datalogsettings",function(){return{restrict:"E",templateUrl:"./directives/datalog/datalogsettings.html",controller:"DataLogSettingsCtrl"}}),app.controller("DataLogSettingsCtrl",["$scope","$window","$mdSidenav","sidebarService","dashboardService",function(e,t,a,o,i){var n;e.tempParameterSelection=new Object,e.inputFieldStyles={},e.parametersErrMsg="",e.widget.settings.data?(e.data=angular.copy(e.widget.settings.data),e.widget.settings.dataArray=[e.widget.settings.data],e.tempParameterSelection=angular.copy(e.widget.settings.data),n=!0):(e.data={id:"",vehicle:"",key:""},e.tempParameterSelection=angular.copy(e.data)),e.saveDataLogSettings=function(a){e.parametersErrMsg="",e.inputFieldStyles={};var o=angular.copy(e.tempParameterSelection);if(o&&""!==o.vehicle&&""!==o.id&&n){e.data=angular.copy(o);var s=i.getData(o.key);if(s)if(s.hasOwnProperty("value")){a.main=!0,a.settings.active=!1,a.saveLoad=!1,a.delete=!1,t.innerWidth>1440&&(e.lock=i.getLock(),e.lock.lockLeft=!1,i.setLeftLock(e.lock.lockLeft)),e.widget.settings.data=angular.copy(e.data);var r=e.widget.settings.dataArray[e.widget.settings.dataArray.length-1];e.widget.settings.dataArray=[r],e.parametersErrMsg="",e.inputFieldStyles={}}else e.parametersErrMsg="Selected parameter has no data!",e.inputFieldStyles={"border-color":"#dd2c00"};else e.data=angular.copy(o),e.parametersErrMsg="Currently there is no data available for this parameter.",e.inputFieldStyles={"border-color":"#dd2c00"}}else e.parametersErrMsg="Please fill out this field.",e.inputFieldStyles={"border-color":"#dd2c00"}},e.closeDataLogSettings=function(a){e.lock=i.getLock(),e.lock.lockLeft=!1,i.setLeftLock(e.lock.lockLeft),a.main=!0,a.settings.active=!1,a.saveLoad=!1,a.delete=!1,e.data=angular.copy(e.widget.settings.data),e.widget.settings.dataArray=[e.data],e.tempParameterSelection=angular.copy(e.widget.settings.data),t.innerWidth>1440&&(e.lock=i.getLock(),e.lock.lockLeft=!1,i.setLeftLock(e.lock.lockLeft)),e.inputFieldStyles={},e.parametersErrMsg=""},e.getTelemetrydata=function(){o.setTempWidget(e.widget,this),t.innerWidth<=1440?a("left").open():(e.lock=i.getLock(),e.lock.lockLeft=!0,i.setLeftLock(e.lock.lockLeft)),o.setMenuStatus(!0),o.setOpenLogo(!1)},e.readValue=function(){var t=e.widget.settings.dataArray[e.widget.settings.dataArray.length-1];return t&&""!==t.id&&e.tempParameterSelection?e.tempParameterSelection.id:""},e.getValue=function(t){var a=e.widget.settings.dataArray[e.widget.settings.dataArray.length-1];a&&""!==a.vehicle&&""!==a.id?t?n=!1:(n=!0,e.tempParameterSelection=angular.copy(a)):n=!1}}]),app.directive("datatable",function(){return{restrict:"E",templateUrl:"./directives/datatable/datatable.html",controller:"DataTableCtrl",controllerAs:"vm",bindToController:!0}}),app.controller("DataTableCtrl",["$scope","$mdSidenav","$window","$interval","$timeout","dashboardService","sidebarService","datastatesService",function(e,t,a,o,i,n,s,r){e.checkedValues=e.widget.settings.checkedValues;var l=[],c=[];e.dataStatus=n.icons;var d={},u=r.colorValues.alarmcolor,g=r.colorValues.cautioncolor,p=r.colorValues.healthycolor,h=r.colorValues.stalecolor,v=r.colorValues.disconnectedcolor,m=(r.colorValues.defaultcolor,{"text-align":"left"}),y={"text-align":"right"},f={"background-color":"#CFCFD5",animation:"background-fade 0.5s forwards","-webkit-animation":"background-fade 0.5s forwards","-moz-animation":"background-fade 0.5s forwards"};e.arrow;function w(t,a){var o="";a&&(o=a.data),e.table.rows[t]={contents:[{datavalue:"",headervalue:{data:o},checked:"false",style:"text-align:right;background-color:#1072A4;",colshow:"true",colspan:"9",class:"header",placeholder:"Click here to edit",active:"true"}],disabled:!0},e.widget.settings.data[t].type="header",e.widget.settings.data[t].value=e.table.rows[t].contents[0].headervalue}function b(t){if(e.widget.settings.data[t])return e.widget.settings.data[t].hasOwnProperty("value")?(e.widget.settings.previous[t].type=e.widget.settings.data[t].type,e.widget.settings.previous[t].value=e.widget.settings.data[t].value,!1):(e.widget.settings.previous[t].type="",e.widget.settings.previous[t].value="",!0)}e.currentIndex,e.askedForGroup,e.$watch("dataStatus",function(e,t){d=e},!0),e.badSelectionErrMsg="",e.errMsgStyles={},function(){var t={contents:[{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedId",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:y,colshow:"checkedValues.checkedAlow",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:y,colshow:"checkedValues.checkedWlow",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:y,colshow:"checkedValues.checkedValue",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:y,colshow:"checkedValues.checkedWhigh",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:y,colshow:"checkedValues.checkedAhigh",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedUnits",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedNotes",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedChannel",active:"false",datacolor:"",headervalue:""}],disabled:!1};if(0===e.widget.settings.data.length)for(var a=0;a<120;a++)l.push(angular.copy(t)),e.widget.settings.data[a]=new Object,e.widget.settings.previous[a]=new Object;else for(var a=0;a<e.widget.settings.data.length;a++)e.widget.settings.data[a].hasOwnProperty("value")?(t.value=e.widget.settings.data[a].value,t.type=e.widget.settings.data[a].type,t.undone=e.widget.settings.data[a].undone,l.push(angular.copy(t))):l.push(angular.copy(t))}(),e.getTelemetrydata=function(o,i,r){s.setTempWidget(e.widget,this),e.arrow=o.target.parentElement.parentElement.parentElement.firstElementChild.firstElementChild,e.arrow.style.color="#07D1EA",e.currentIndex=i,e.askedForGroup=r,a.innerWidth<=1440?t("left").open():(e.lock=n.getLock(),e.lock.lockLeft=!0,n.setLeftLock(e.lock.lockLeft)),s.setMenuStatus(!0),s.setOpenLogo(!1)},e.getValue=function(t){t&&e.askedForGroup?(e.applyGroup(),e.arrow.style.color="#b3b3b3",e.errMsgStyles={},e.badSelectionErrMsg=""):t||e.askedForGroup?!t&&e.askedForGroup&&(e.arrow.style.color="#07D1EA",e.badSelectionErrMsg="Select a group from the data menu!",e.errMsgStyles={padding:"5px","margin-bottom":"0px",opacity:"1","border-radius":"0px",position:"absolute",top:"35px",left:"0%",right:"0%","z-index":100}):(e.applyValue(),e.arrow.style.color="#b3b3b3",e.errMsgStyles={},e.badSelectionErrMsg=""),e.widget.settings.dataArray=[]},e.applyValue=function(){var t=e.widget.settings.dataArray[e.widget.settings.dataArray.length-1];if(t&&t.key){var o=n.getData(t.key);o&&o.hasOwnProperty("value")&&(b(e.currentIndex)&&(e.widget.settings.data[e.currentIndex]=new Object),e.widget.settings.data[e.currentIndex].type="data",e.widget.settings.data[e.currentIndex].value=t.key,e.widget.settings.data[e.currentIndex].undone=!1,e.arrow.style.color="#b3b3b3",a.innerWidth>1440&&(e.lock=n.getLock(),e.lock.lockLeft=!1,n.setLeftLock(e.lock.lockLeft)))}},e.applyGroup=function(){var t=e.widget.settings.dataArray[e.widget.settings.dataArray.length-1];if(t&&t.key){var o=n.getData(t.key);if(o&&!o.hasOwnProperty("value")){var i=Object.keys(o);if(e.table.rows[e.currentIndex])for(var s=1;s<i.length;s++)e.table.rows[e.currentIndex+s]||e.addRowBelow(e.currentIndex);for(var r=0;r<i.length;r++)b(e.currentIndex+r)&&(e.widget.settings.data[e.currentIndex+r]=new Object),e.widget.settings.data[e.currentIndex+r].type="data",e.widget.settings.data[e.currentIndex+r].value=t.key+"."+i[r],e.widget.settings.data[e.currentIndex+r].undone=!1;e.arrow.style.color="#b3b3b3",a.innerWidth>1440&&(e.lock=n.getLock(),e.lock.lockLeft=!1,n.setLeftLock(e.lock.lockLeft))}}},e.addRowAbove=function(t){e.table.rows.splice(t,0,{contents:[{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedId",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:y,colshow:"checkedValues.checkedAlow",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:y,colshow:"checkedValues.checkedWlow",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:y,colshow:"checkedValues.checkedValue",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:y,colshow:"checkedValues.checkedWhigh",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:y,colshow:"checkedValues.checkedAhigh",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedUnits",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedNotes",active:"false"},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedChannel",active:"false",datacolor:"",headervalue:""}],disabled:!1}),e.widget.settings.data.splice(t,0,{}),e.widget.settings.previous.splice(t,0,{})},e.addRowBelow=function(t){e.table.rows.splice(t+1,0,{contents:[{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedId",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:y,colshow:"checkedValues.checkedAlow",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:y,colshow:"checkedValues.checkedWlow",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:y,colshow:"checkedValues.checkedValue",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:y,colshow:"checkedValues.checkedWhigh",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:y,colshow:"checkedValues.checkedAhigh",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedUnits",active:"false"},{datavalue:"",headervalue:"",checked:"true",style:m,colshow:"checkedValues.checkedNotes",active:"false"},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedChannel",active:"false",datacolor:"",headervalue:""}],disabled:!1}),e.widget.settings.data.splice(t+1,0,{}),e.widget.settings.previous.splice(t+1,0,{})},e.deleteRow=function(t){0===t&&1===e.table.rows.length?a.alert("Please do not delete this row!Add row above to delete this row."):(e.table.rows.splice(t,1),e.widget.settings.data.splice(t,1),e.widget.settings.previous.splice(t,1))},e.moveRowUp=function(t){t>0?(e.table.rows[t-1]=e.table.rows.splice(t,1,e.table.rows[t-1])[0],e.widget.settings.data[t-1]=e.widget.settings.data.splice(t,1,e.widget.settings.data[t-1])[0],e.table.rows[t-1].colorin=f,e.widget.settings.previous[t-1]=e.widget.settings.previous.splice(t,1,e.widget.settings.previous[t-1])[0],i(function(){e.table.rows[t-1].colorin=""},500)):a.alert("This row cannot be moved further up!")},e.moveRowDown=function(t){t<e.table.rows.length-1&&(e.table.rows[t+1]=e.table.rows.splice(t,1,e.table.rows[t+1])[0],e.widget.settings.data[t+1]=e.widget.settings.data.splice(t,1,e.widget.settings.data[t+1])[0],e.table.rows[t+1].colorin=f,e.widget.settings.previous[t+1]=e.widget.settings.previous.splice(t,1,e.widget.settings.previous[t+1])[0],i(function(){e.table.rows[t+1].colorin=""},500))},e.convertHeader=function(t,a){b(t)&&(e.widget.settings.data[t]=new Object),w(t,a),e.widget.settings.data[t].undone=!1},function(){if(e.table={rows:l},0!=e.widget.settings.data.length)for(var t=0;t<e.widget.settings.data.length;t++)e.widget.settings.data[t]&&"header"==e.widget.settings.data[t].type&&w(t,e.widget.settings.data[t].value)}(),e.undo=function(t){var a=e.widget.settings.previous[t].type,o=e.widget.settings.previous[t].value;e.widget.settings.previous[t]=new Object,e.widget.settings.previous[t].type=e.widget.settings.data[t].type,e.widget.settings.previous[t].value=e.widget.settings.data[t].value,e.widget.settings.data[t]=new Object,e.widget.settings.data[t].type=a,e.widget.settings.data[t].value=o;var i={contents:[{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedId",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:y,colshow:"checkedValues.checkedAlow",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:y,colshow:"checkedValues.checkedWlow",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:y,colshow:"checkedValues.checkedValue",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:y,colshow:"checkedValues.checkedWhigh",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:y,colshow:"checkedValues.checkedAhigh",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedUnits",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedNotes",active:"false",datacolor:"",headervalue:""},{datavalue:"",checked:"true",style:m,colshow:"checkedValues.checkedChannel",active:"false",datacolor:"",headervalue:""}],disabled:!1};"header"==a?w(t,o):e.table.rows[t]=angular.copy(i),e.widget.settings.data[t].undone=!0},e.updateRow=function(){for(var t=0;t<e.table.rows.length;t++){var a=e.table.rows[t],o=e.widget.settings.data[t];if(o){if("data"==o.type){var i=o.value;a.contents[8].datavalue=i;try{var s=i.split(".").slice(-1)[0],l=n.getData(i);if(l){var m=typeof l.value;if("number"===m&&(l.value=parseFloat(l.value.toFixed(4))),a.contents[0].datavalue=s,l.alarm_low?a.contents[1].datavalue=l.alarm_low:a.contents[1].datavalue="N/A",l.warn_low?a.contents[2].datavalue=l.warn_low:a.contents[2].datavalue="N/A",a.contents[3].datavalue=l.value,c[t]===l.value)"green"===d.sIcon&&"green"===d.gIcon&&"green"===d.pIcon&&"green"===d.dIcon?a.contents[3].datacolor=p:a.contents[3].datacolor=h;else{var y=r.getDataColor(l.alarm_low,l.alarm_high,l.value,l.warn_low,l.warn_high,m);a.contents[3].datacolor="red"===y?u:"orange"===y?g:p,c[t]=l.value}l.warn_high?a.contents[4].datavalue=l.warn_high:a.contents[4].datavalue="N/A",l.alarm_high?a.contents[5].datavalue=l.alarm_high:a.contents[5].datavalue="N/A",a.contents[6].datavalue=l.units,""!==l.notes?a.contents[7].datavalue=l.notes:a.contents[7].datavalue="N/A"}}catch(e){}}}else"red"===d.dIcon&&(a.contents[0].datacolor=v,a.contents[1].datacolor=v,a.contents[2].datacolor=v,a.contents[3].datacolor=v,a.contents[4].datacolor=v,a.contents[5].datacolor=v,a.contents[6].datacolor=v,a.contents[7].datacolor=v)}},e.interval=o(e.updateRow,1e3,0,!1),e.$on("$destroy",function(t){o.cancel(e.interval)})}]),app.directive("datatablesettings",function(){return{restrict:"E",templateUrl:"./directives/datatable/datatablesettings.html",controller:"DatatableSettingsCtrl"}}),app.controller("DatatableSettingsCtrl",["$scope","$window",function(e,t){e.checkedValues=angular.copy(e.widget.settings.checkedValues);var a=angular.copy(e.checkedValues);function o(e,t){e.settings.checkedValues.checkedId=t.checkedId,e.settings.checkedValues.checkedAlow=t.checkedAlow,e.settings.checkedValues.checkedWlow=t.checkedWlow,e.settings.checkedValues.checkedValue=t.checkedValue,e.settings.checkedValues.checkedWhigh=t.checkedWhigh,e.settings.checkedValues.checkedAhigh=t.checkedAhigh,e.settings.checkedValues.checkedUnits=t.checkedUnits,e.settings.checkedValues.checkedNotes=t.checkedNotes,e.settings.checkedValues.checkedChannel=t.checkedChannel}e.columnSelectionErrMsg="",e.saveDataTableSettings=function(t){var i=angular.copy(e.checkedValues),n=0;for(obj in i)i[obj]&&(n+=1);n>0?(t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,a=angular.copy(e.checkedValues),e.columnSelectionErrMsg="",o(t,a)):e.columnSelectionErrMsg="Please select atleast one column."},e.closeDataTableSettings=function(t){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,o(t,a),e.checkedValues.checkedId=a.checkedId,e.checkedValues.checkedAlow=a.checkedAlow,e.checkedValues.checkedWlow=a.checkedWlow,e.checkedValues.checkedValue=a.checkedValue,e.checkedValues.checkedWhigh=a.checkedWhigh,e.checkedValues.checkedAhigh=a.checkedAhigh,e.checkedValues.checkedUnits=a.checkedUnits,e.checkedValues.checkedNotes=a.checkedNotes,e.checkedValues.checkedChannel=a.checkedChannel,e.columnSelectionErrMsg=""}}]),app.directive("graph",function(){return{restrict:"EA",templateUrl:"./directives/line/line.html",controller:"LineCtrl"}}),app.controller("LineCtrl",["$scope","$element","$interval","$window","dashboardService","d3Service",function(e,t,a,o,i,n){var s,r=i.telemetry,l=n.timeParse("%Y-%m-%dT%H:%M:%S.%LZ"),c=70,d=t[0].children[0].children[1],u=t[0].children[0].children[0];o.innerWidth>=600&&o.innerWidth<=768?c=50:o.innerWidth<600&&(c=40),e.data=[[0]],e.opts={axes:{x:{drawGrid:!0},y:{drawAxis:!0}},legend:"always",xlabel:"timestamp",ylabel:"",axisLabelWidth:c,xLabelHeight:16,yLabelWidth:16,labelsDiv:d,labels:["time"]};var g=new Dygraph(u,e.data,e.opts);e.interval=a(function(){if(g.resize(),e.widget.settings.data&&""!==e.widget.settings.data.value&&e.widget.settings.data.vehicles.length>0){var t=e.widget.settings.data.value,a=e.widget.settings.data.vehicles,o=["time"],n={},d=!1;if(r.time){var u=l(r.time),p=[u];for(var h in JSON.stringify(s)!==JSON.stringify(e.widget.settings.data)&&(e.plotData?e.plotData=[]:e.plotData=new Array,e.stringDataErrMsg=""),a){var v=a[h];if(void 0!==r[v.name]){var m=i.getData(v.key);if(m){if("number"!=typeof m.value){d=!0;break}var y=parseFloat(m.value.toFixed(4)),f=m.units;p.push(y)}}e.plotData.push(p),o.push(v.name),n[v.name]={color:v.color},e.plotData.length>100&&e.plotData.shift()}if(t){if(f)var w=" [ "+f+" ] ";else var w="";var b=t+w}d?(g.updateOptions({file:[[0]],axes:{x:{drawGrid:!0},y:{drawAxis:!0}},legend:"always",xlabel:"timestamp",ylabel:"",axisLabelWidth:c,xLabelHeight:16,yLabelWidth:16,labels:o,series:n}),e.widget.settings.data={vehicles:[],value:"",key:""},e.stringDataErrMsg="'"+t+"' has no numeric data. Please select another ID from data menu."):g.updateOptions({file:e.plotData,ylabel:b,xlabel:"timestamp",labels:o,axes:{y:{drawGrid:!0,valueFormatter:function(e){return parseFloat(e.toFixed(4))},axisLabelFormatter:function(e){return parseFloat(e.toFixed(4))}},x:{valueFormatter:function(e){return i.getTime("UTC").utc}}},drawPoints:!0,series:n,axisLabelWidth:c})}s=angular.copy(e.widget.settings.data)}},1e3),e.plotData=[],e.$on("$destroy",function(t){a.cancel(e.interval)})}]),app.directive("linesettings",function(){return{restrict:"EA",templateUrl:"./directives/line/linesettings.html",controller:"LineSettingsCtrl"}}),app.controller("LineSettingsCtrl",["$scope","$mdSidenav","$window","dashboardService","sidebarService","$interval",function(e,t,a,o,i,n){var s,r=["#0AACCF","#FF9100","#64DD17","#07D1EA","#0D8DB8","#172168","#228B22","#12C700","#C6FF00"];function l(e,t){var a=t.split(".");return e===a[0]?t:e+"."+a.slice(1).join(".")}e.previousSettings,e.interval,e.settings={vehicles:[],data:{id:"",vehicle:"",key:""}},e.tempParameterSelection=new Object,e.inputFieldStyles={},e.parametersErrMsg="",e.vehicleMsg="",e.getTelemetrydata=function(){i.setTempWidget(e.widget,this),a.innerWidth<=1440?t("left").open():(e.lock=o.getLock(),e.lock.lockLeft=!0,o.setLeftLock(e.lock.lockLeft)),i.setMenuStatus(!0),i.setOpenLogo(!1)},e.readValue=function(){var t=e.widget.settings.dataArray[e.widget.settings.dataArray.length-1];return t&&""!==t.id&&e.tempParameterSelection?e.tempParameterSelection.id:""},e.getValue=function(t){var a=e.widget.settings.dataArray[e.widget.settings.dataArray.length-1];if(a&&""!==a.key&&!t){for(var o=0;o<e.settings.vehicles.length;o++)e.settings.vehicles[o].value===a.vehicle?(e.settings.vehicles[o].checked=!0,e.tempParameterSelection=angular.copy(a)):e.settings.vehicles[o].checked=!1;s=!0}else s=!1},e.saveWidget=function(t){e.vehicleMsg="",e.parametersErrMsg="";var i=angular.copy(e.tempParameterSelection);if(i&&""!==i.key&&s){e.settings.data=angular.copy(i);var n=o.getData(i.key);if(n)if(n.hasOwnProperty("value")){var r=0;if(e.settings.data.key){0!=t.settings.data.vehicles.length&&(t.settings.data.vehicles=[]),t.settings.data.value=e.settings.data.id,t.settings.data.key=e.settings.data.key;for(var c=e.settings.vehicles,d=0;d<c.length;d++)if(!0===c[d].checked){var u=l(c[d].value,e.settings.data.key),g={name:c[d].value,color:c[d].color,key:u};t.settings.data.vehicles.push(g),r++}if(a.innerWidth>1440&&(e.lock=o.getLock(),e.lock.lockLeft=!1,o.setLeftLock(e.lock.lockLeft)),0!=r){t.main=!0,t.settings.active=!1,e.previousSettings=angular.copy(e.settings);var p=e.widget.settings.dataArray[e.widget.settings.dataArray.length-1];e.widget.settings.dataArray=[p],e.inputFieldStyles={}}else e.vehicleMsg="Please choose the vehicle."}}else e.parametersErrMsg="Selected parameter has no data!",e.inputFieldStyles={"border-color":"#dd2c00"};else e.settings.data=angular.copy(i),e.parametersErrMsg="Currently there is no data available for this parameter.",e.inputFieldStyles={"border-color":"#dd2c00"}}else e.parametersErrMsg="Please fill out this field.",e.inputFieldStyles={"border-color":"#dd2c00"}},e.closeWidget=function(t){e.lock=o.getLock(),e.lock.lockLeft=!1,o.setLeftLock(e.lock.lockLeft),t.main=!0,t.settings.active=!1,e.settings=angular.copy(e.previousSettings),e.widget.settings.dataArray=[angular.copy(e.settings.data)],e.tempParameterSelection=angular.copy(e.settings.data),a.innerWidth>1440&&(e.lock=o.getLock(),e.lock.lockLeft=!1,o.setLeftLock(e.lock.lockLeft)),e.parametersErrMsg="",e.vehicleMsg="",e.inputFieldStyles={}},e.createVehicleData=function(t){e.interval||(e.interval=n(function(){var a=o.telemetry;if(!o.isEmpty(a)){var i=o.sortObject(a.data),s=e.settings.vehicles.length,l=!1;for(var c in i)if(i.hasOwnProperty(c)){for(var d=0;d<e.settings.vehicles.length;d++)if(c==e.settings.vehicles[d].value){l=!0;break}l&&0!=e.settings.vehicles.length||(s+=1,e.settings.vehicles.push({key:s,value:c,checked:!1,color:r[s-1]})),l=!1}n.cancel(e.interval),e.interval=null,t&&t(!0)}},1e3))},e.createVehicleData(function(t){if(t){if(e.widget.settings.data.vehicles.length>0){e.settings.data.id=e.widget.settings.data.value,e.settings.data.key=e.widget.settings.data.key;for(var a=0;a<e.settings.vehicles.length;a++)for(var o=0;o<e.widget.settings.data.vehicles.length;o++)e.settings.vehicles[a].value==e.widget.settings.data.vehicles[o].name&&(e.settings.vehicles[a].checked=!0,e.settings.vehicles[a].color=e.widget.settings.data.vehicles[o].color)}e.previousSettings=angular.copy(e.settings),e.tempParameterSelection=angular.copy(e.settings.data),e.widget.settings.dataArray=[angular.copy(e.settings.data)],s=!0}}),e.$on("$destroy",function(t){n.cancel(e.interval)})}]),app.directive("groundtrack",function(){return{restrict:"EA",templateUrl:"./directives/groundtrack/groundtrack.html",controller:"GroundTrackCtrl",controllerAs:"vm",bindToController:!0}}),app.controller("GroundTrackCtrl",["$scope","d3Service","$element","$interval","dashboardService","gridService","solarService","odeService",function(e,t,a,o,n,s,l,c){var d,u,g,p=n.telemetry,h=a[0].getElementsByTagName("div")[0].getElementsByTagName("div")[1],v={},m={},y={},f={},w={},b={},k={};e.dataStatus=n.icons,e.$watch("dataStatus",function(e,t){f=e},!0),e.timeObj={},e.checkboxModel={value1:!0};var S=6378.16,I=85,A=Math.PI,B=A/180,V=180/A,D=t.geoEquirectangular().precision(.1),E=t.geoPath().projection(D),M=t.geoGraticule(),C=t.geoCircle(),L=t.zoom().scaleExtent([1,10]).translateExtent([[0,0],[900,600]]).on("zoom",R),P=t.select(h).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","-20 10 1000 500").attr("width","100%").attr("height","100%").classed("gt-svg-content",!0),x=(t.zoomTransform(P.node()),P.append("g")),z=["GS1","GS2"],T=[[-122.4,37.7],[103.8,1.4]],O=["Ground Station 01 - San Francisco ","Ground Station 02 - Singapore"];function q(){var t;u=n.getTime("UTC"),g=u.today,e.night&&e.night.datum(C.center((t=l.solarPosition(g),[t[0]+180,-t[1]])).radius(90)).attr("d",E)}function U(e,t){covAng=function(e,t){return alpha=Math.asin(S*Math.sin((180-t)*B)/e),180-(180-t)-alpha*V}(t,I);P.select("#g").append("path").datum(C.center(e).radius(covAng)).attr("class","gslos").attr("d",E)}function _(e,t,a,o){if(e&&t&&a&&o){var i=Math.acos(S/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])),n=Math.acos(S/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]));if(Math.acos(F(e,t)/(G(e)*G(t)))<i+n)x.append("path").datum({type:"LineString",coordinates:[[a[0]+6,a[1]-2],[o[0]+6,o[1]-2]]}).attr("class","link").attr("d",E)}}function N(e,t,a,o){if(e&&t&&a&&o){var i=S*Math.sin(e[1]*B),n=S*Math.cos(e[1]*B),s=n*Math.sin(e[0]*B),r=[n*Math.cos(e[0]*B),s,i],l=[a[0]-r[0],a[1]-r[1],a[2]-r[2]];if(Math.acos(F(l,r)/(G(l)*G(r)))*V<o)x.append("path").datum({type:"LineString",coordinates:[[e[0],e[1]],[t[0]+6,t[1]-2]]}).attr("class","gslink").attr("d",E)}}function F(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function G(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function R(){x.attr("transform",t.event.transform)}function W(e){return D(e)}x.attr("id","g").attr("x",0).attr("y",0),P.call(L),$(window).width()>=screen.width&&(L=t.zoom().scaleExtent([1,10]).translateExtent([[0,0],[1300,1e3]]).on("zoom",R)),t.json("./directives/groundtrack/d3-maps/world-50m.json",function(t,a){if(t)throw t;for(x.append("path").datum(M).attr("d",E).attr("class","graticule"),x.append("path").datum(topojson.feature(a,a.objects.land)).attr("class","land").style("fill","#fff").attr("d",E),x.append("g").attr("class","boundary").selectAll("boundary").data(topojson.feature(a,a.objects.countries).features).enter().append("path").style("fill","#ccc").attr("name",function(e){return e.properties.name}).attr("id",function(e){return e.id}).attr("d",E),j=0;j<T.length;j++)o=T[j],i=O[j],void 0,void 0,n=W(o),P.select("#g").append("svg:image").attr("xlink:href","/icons/groundtrack-widget/aud_target_02_orange.svg").attr("id","gs").attr("x",n[0]-10).attr("y",n[1]-16).attr("width",30).attr("height",30).append("svg:title").text(i);var o,i,n;e.night=x.append("path").attr("class","night").attr("d",E),q()}),e.resetted=function(){P.transition().duration(500).call(L.transform,t.zoomIdentity)},e.zoomIn=function(){L.scaleBy(P,2)},e.zoomOut=function(){L.scaleBy(P,.5)},e.interval=o(function(){x.selectAll("path.route").remove(),x.selectAll("path.est_route").remove(),x.selectAll("#craft").remove(),x.selectAll("path.link").remove(),x.selectAll("line").remove(),x.selectAll("path.gslink").remove(),q();var t=e.widget.settings.vehicles;if(JSON.stringify(d)!==JSON.stringify(t))for(e.timeObj={},i=0;i<t.length;i++)m[i]=[],v[i]=[],y[i]=[],k[i]="",b[i]="",w[i]=!1;for(i=0;i<t.length;i++)if(null==p[t[i].name]);else if(!0===t[i].dataStatus){if(x.selectAll("path.gslos").remove(),e.timeObj[i]||(e.timeObj[i]=new Array),"green"===f.sIcon&&"green"===f.gIcon&&"green"===f.pIcon&&"green"===f.dIcon){t[i].pdata.length>0&&(n.getData(t[i].pdata[0].key).hasOwnProperty("value")&&(s=n.getData(t[i].pdata[0].key).value),n.getData(t[i].pdata[1].key).hasOwnProperty("value")&&(l=n.getData(t[i].pdata[1].key).value),n.getData(t[i].pdata[2].key).hasOwnProperty("value")&&(u=n.getData(t[i].pdata[2].key).value)),t[i].vdata.length>0&&(n.getData(t[i].vdata[0].key).hasOwnProperty("value")&&(g=n.getData(t[i].vdata[0].key).value),n.getData(t[i].vdata[1].key).hasOwnProperty("value")&&(h=n.getData(t[i].vdata[1].key).value),n.getData(t[i].vdata[2].key).hasOwnProperty("value")&&(S=n.getData(t[i].vdata[2].key).value));var a=new Date(p.time),o=a.getTime();w[i]=!1}else{if(""!=m[i])var s=m[i][m[i].length-1][0],l=m[i][m[i].length-1][1],u=m[i][m[i].length-1][2],g=m[i][m[i].length-1][3],h=m[i][m[i].length-1][4],S=m[i][m[i].length-1][5];else t[i].pdata.length>0&&(n.getData(t[i].pdata[0].key).hasOwnProperty("value")&&(s=n.getData(t[i].pdata[0].key).value),n.getData(t[i].pdata[1].key).hasOwnProperty("value")&&(l=n.getData(t[i].pdata[1].key).value),n.getData(t[i].pdata[2].key).hasOwnProperty("value")&&(u=n.getData(t[i].pdata[2].key).value)),t[i].vdata.length>0&&(n.getData(t[i].vdata[0].key).hasOwnProperty("value")&&(g=n.getData(t[i].vdata[0].key).value),n.getData(t[i].vdata[1].key).hasOwnProperty("value")&&(h=n.getData(t[i].vdata[1].key).value),n.getData(t[i].vdata[2].key).hasOwnProperty("value")&&(S=n.getData(t[i].vdata[2].key).value));for(var A=[s,l,u,g,h,S],B=c.IntegratorFactory(A,function(e,t,a){var o=398600.435436096;r=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)),e[0]=t[3],e[1]=t[4],e[2]=t[5],e[3]=-o/Math.pow(r,3)*t[0],e[4]=-o/Math.pow(r,3)*t[1],e[5]=-o/Math.pow(r,3)*t[2]},0,1e-10),V=[],D=[];B.step(1);)V.push(B.t),D.push(B.y);if(s=D.pop()[0],l=D.pop()[1],u=D.pop()[2],g=D.pop()[3],h=D.pop()[4],S=D.pop()[5],null!=e.timeObj[i][e.timeObj[i].length-1])var o=e.timeObj[i][e.timeObj[i].length-1].timestamp+1e3;else var o="";w[i]=!0}if(""!=o){var M={timestamp:o,est:w[i]};e.timeObj[i].push(M);var C=Math.round((e.timeObj[i][e.timeObj[i].length-1].timestamp-e.timeObj[i][0].timestamp)/6e4);if(C>=90){var L=e.timeObj[i].splice(0,1);L[0].est?(y[i][0].splice(0,1),0==y[i][0].length&&y[i].splice(0,1)):(v[i][0].splice(0,1),0==v[i][0].length&&v[i].splice(0,1))}r=Math.sqrt(Math.pow(s,2)+Math.pow(l,2)+Math.pow(u,2)),longitude=Math.atan2(l,s)/Math.PI*180,latitude=Math.asin(u/r)/Math.PI*180;var P=W([longitude,latitude]);for(j=0;j<z.length;j++)U(T[j],r);w[i]!==b[i]?flag=!0:flag=!1;var $=[longitude,latitude];k[i]=$,w[i]?(flag&&(y[i][y[i].length]=new Array),y[i][y[i].length-1].push($)):(flag&&(v[i][v[i].length]=new Array),v[i][v[i].length-1].push($));var O=[s,l,u,g,h,S];if(m[i].push(O),!0===t[i].orbitStatus)x.append("path").datum({type:"MultiLineString",coordinates:v[i]}).attr("class","route").attr("stroke",t[i].color).attr("d",E),x.append("path").datum({type:"MultiLineString",coordinates:y[i]}).attr("class","est_route").attr("stroke",t[i].color).attr("d",E);if(!0===t[i].iconStatus){x.append("svg:image").attr("xlink:href","/icons/groundtrack-widget/satellite.svg").attr("id","craft").attr("fill","#000000").attr("x",P[0]).attr("y",P[1]-15).attr("width",30).attr("height",30).append("svg:title").text(t[i].name);for(kk=i+1;kk<t.length;kk++)!0===t[kk].iconStatus&&_(m[i][m[i].length-1],m[kk][m[kk].length-1],k[i],k[kk]);for(kk=0;kk<z.length;kk++)N(T[kk],k[i],m[i][m[i].length-1],I)}b[i]=w[i]}}d=angular.copy(e.widget.settings.vehicles)},1e3),e.$on("$destroy",function(t){o.cancel(e.interval)})}]),app.directive("groundtracksettings",function(){return{restrict:"EA",templateUrl:"./directives/groundtrack/groundtracksettings.html",controller:"GroundSettingsCtrl"}}),app.controller("GroundSettingsCtrl",["$scope","dashboardService","$interval","$mdSidenav","$window","sidebarService","$uibModal",function(e,t,a,o,i,n,s){var r,l=["#07D1EA","#0D8DB8","#172168","#228B22","#12C700","#C6FF00"];function c(e,t){for(var a=[],o=e.length,i=o-t;i<o;i++)a.push(e[i]);return a}function d(e){for(var a=[],o=e.length,i=0;i<o;i++){var n=t.getData(e[i].key);n&&n.hasOwnProperty("value")&&a.push(e[i])}return a}function u(e,t){for(var a=e.length,o=0,i=0;i<a;i++)e[i].vehicle!==t&&o++;return o>0}e.settings=new Object,e.settings.vehicles=[],e.settings.pdata=[],e.settings.vdata=[],e.settings.orbitstatus=[],e.settings.iconstatus=[],e.firstScreen=!0,e.secondScreen=!1,e.positionData=[],e.velocityData=[],e.vehicle=[],e.iconstatus=[],e.orbitstatus=[],e.checkedValues=[],e.velocityBooleans=[!0,!0,!0,!0],e.positionBooleans=[!0,!0,!0,!0],e.totalVelocityArray=[],e.totalPositionArray=[],e.chosenCategory,e.vehicleMsg="",e.sortableOptionsPosition={containment:"#scrollable-containerPositionValues",scrollableContainer:"#scrollable-containerPositionValues",accept:function(e,t){return e.itemScope.sortableScope.$id===t.$id}},e.sortableOptionsVelocity={containment:"#scrollable-containerVelocityValues",scrollableContainer:"#scrollable-containerVelocityValues",accept:function(e,t){return e.itemScope.sortableScope.$id===t.$id}},e.positionInputStyles={},e.velocityInputStyles={},e.positionBtnStyles={},e.velocityBtnStyles={},e.positionparametersErrMsg="",e.velocityparametersErrMsg="",e.closeWidget=function(t){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,e.checkedValues=angular.copy(r);var a=angular.copy(e.settings);if(a.vehicles.length>0)for(var o=0;o<a.vehicles.length;o++)e.iconstatus[o]=a.iconstatus[o],e.orbitstatus[o]=a.orbitstatus[o],e.positionData[o]=angular.copy(a.pdata[o]),e.velocityData[o]=angular.copy(a.vdata[o]);e.vehicleMsg=""},e.saveWidget=function(t){t.saveLoad=!1,t.delete=!1,e.widget.settings.vehicles=[];for(var a=0,o=0,i=0;i<e.settings.vehicles.length;i++)if(!0===e.checkedValues[i].status){if(o++,e.settings.pdata&&e.settings.pdata[i]&&(a+=e.settings.pdata[i].length),e.settings.vdata&&e.settings.vdata[i]&&(a+=e.settings.vdata[i].length),a!==6*o){e.vehicleMsg="Please select all coordinates for selected vehicles.";break}var n={name:e.settings.vehicles[i].label,dataStatus:e.checkedValues[i].status,orbitStatus:e.settings.orbitstatus[i],iconStatus:e.settings.iconstatus[i],color:l[i],pdata:e.settings.pdata[i],vdata:e.settings.vdata[i]};e.widget.settings.vehicles.push(n)}else{n={name:e.settings.vehicles[i].label,dataStatus:e.checkedValues[i].status,orbitStatus:e.settings.orbitstatus[i],iconStatus:e.settings.iconstatus[i],color:l[i],pdata:e.settings.pdata[i],vdata:e.settings.vdata[i]};e.widget.settings.vehicles.push(n),e.vehicleMsg=""}o>0?a===6*o?(t.main=!0,t.settings.active=!1,e.vehicleMsg="",r=angular.copy(e.checkedValues)):(t.main=!1,t.settings.active=!0):(t.main=!0,t.settings.active=!1,e.vehicleMsg="",r=angular.copy(e.checkedValues))},e.createVehicles=function(o){e.interval||(e.interval=a(function(){var i=t.telemetry;if(!t.isEmpty(i)){var n=t.sortObject(i.data),s=!1;for(var r in n)if(n.hasOwnProperty(r)){for(var l=0;l<e.settings.vehicles.length;l++)if(r==e.settings.vehicles[l].label){s=!0;break}if(!s||0==e.settings.vehicles.length){var c=e.settings.vehicles.length;e.settings.vehicles[c]={id:c,label:r},e.iconstatus[c]=!0,e.orbitstatus[c]=!0,e.positionData[c]=[],e.velocityData[c]=[],e.settings.pdata[c]=[],e.settings.vdata[c]=[],e.settings.orbitstatus[c]=!0,e.settings.iconstatus[c]=!0,e.checkedValues[c]={status:!1},e.totalPositionArray[c]=[],e.totalVelocityArray[c]=[]}s=!1}a.cancel(e.interval),e.interval=null,o&&o(!0)}},1e3))},e.createVehicles(function(t){if(t){if(e.widget.settings.vehicles.length>0)for(var a=0;a<e.settings.vehicles.length;a++)for(var o=0;o<e.widget.settings.vehicles.length;o++)e.settings.vehicles[a].label==e.widget.settings.vehicles[o].name&&(e.checkedValues[a]={status:e.widget.settings.vehicles[o].dataStatus},e.orbitstatus[a]=e.widget.settings.vehicles[o].orbitStatus,e.settings.orbitstatus[a]=e.widget.settings.vehicles[o].orbitStatus,e.iconstatus[a]=e.widget.settings.vehicles[o].iconStatus,e.settings.iconstatus[a]=e.widget.settings.vehicles[o].iconStatus,e.positionData[a]=angular.copy(e.widget.settings.vehicles[o].pdata),e.settings.pdata[a]=angular.copy(e.widget.settings.vehicles[o].pdata),e.totalPositionArray[o]=angular.copy(e.widget.settings.vehicles[o].pdata),e.velocityData[a]=angular.copy(e.widget.settings.vehicles[o].vdata),e.settings.vdata[a]=angular.copy(e.widget.settings.vehicles[o].vdata),e.totalVelocityArray[o]=angular.copy(e.widget.settings.vehicles[o].vdata));var i=e.checkedValues.findIndex(e=>!0===e.status);e.vehicleSelected=-1!=i,r=angular.copy(e.checkedValues)}}),e.alertUser=function(t,a,o,i){if(!0===i)t.stopPropagation(),e.firstScreen=!1,e.secondScreen=!0,e.currentScreenVehicle=a,e.currentVehicleId=o,e.vehicleSelected=!0;else{var n=0;e.checkedValues[o].status=!1;for(var s=0;s<e.settings.vehicles.length;s++)!0===e.checkedValues[s].status&&n++;e.vehicleSelected=n>0}},e.getValue=function(t){angular.copy(e.widget.settings.dataArray).length;var a=e.widget.settings.dataArray[e.widget.settings.dataArray.length-1];if(!t&&a&&""!==a.id){"velocity"==e.chosenCategory?e.totalVelocityArray[e.currentVehicleId].push(e.widget.settings.dataArray[e.widget.settings.dataArray.length-1]):"position"==e.chosenCategory&&e.totalPositionArray[e.currentVehicleId].push(e.widget.settings.dataArray[e.widget.settings.dataArray.length-1]);var o,i=[];if(3===(i=(o=angular.copy(e.totalPositionArray[e.currentVehicleId])).length>3?c(o,3):o).length){var n=d(i),s=u(n,e.currentScreenVehicle);!1===s&&3===n.length?3===n.length&&(e.positionData[e.currentVehicleId]=angular.copy(n),e.vehicle[e.currentVehicleId]=n[0].vehicle,e.totalPositionArray[e.currentVehicleId]=angular.copy(n),e.positionBooleans[0]=!0,e.positionBooleans[1]=!0,e.positionBooleans[2]=!0,e.positionBooleans[3]=!0):n.length<3?(e.vehicle[e.currentVehicleId]="",e.positionData[e.currentVehicleId]=[],e.positionBooleans[0]=!1,e.positionBooleans[1]=!0,e.positionBooleans[2]=!0,e.positionBooleans[3]=!0):!1===s?(e.vehicle[e.currentVehicleId]="",e.positionData[e.currentVehicleId]=[],e.positionBooleans[1]=!1,e.positionBooleans[0]=!0,e.positionBooleans[2]=!0,e.positionBooleans[3]=!0):!0===s&&3===n.length?(e.vehicle[e.currentVehicleId]="",e.positionData[e.currentVehicleId]=[],e.positionBooleans[2]=!1,e.positionBooleans[0]=!0,e.positionBooleans[1]=!0,e.positionBooleans[3]=!0):!0===s&&3!==n.length&&(e.vehicle[e.currentVehicleId]="",e.positionData[e.currentVehicleId]=[],e.positionBooleans[2]=!1,e.positionBooleans[0]=!0,e.positionBooleans[1]=!0,e.positionBooleans[3]=!0)}else e.vehicle[e.currentVehicleId]="",e.positionData[e.currentVehicleId]=[],e.positionBooleans[3]=!1,e.positionBooleans[0]=!0,e.positionBooleans[1]=!0,e.positionBooleans[2]=!0;var r,l=[];if(3===(l=(r=angular.copy(e.totalVelocityArray[e.currentVehicleId])).length>3?c(r,3):r).length){var g=d(l),p=u(g,e.currentScreenVehicle);!1===p&&3===g.length?3===g.length&&(e.velocityData[e.currentVehicleId]=angular.copy(g),e.vehicle[e.currentVehicleId]=g[0].vehicle,e.totalVelocityArray[e.currentVehicleId]=angular.copy(g),e.velocityBooleans[0]=!0,e.velocityBooleans[1]=!0,e.velocityBooleans[2]=!0,e.velocityBooleans[3]=!0):g.length<3?(e.vehicle[e.currentVehicleId]="",e.velocityData[e.currentVehicleId]=[],e.velocityBooleans[0]=!1,e.velocityBooleans[1]=!0,e.velocityBooleans[2]=!0,e.velocityBooleans[3]=!0):!1===p?(e.vehicle[e.currentVehicleId]="",e.velocityData[e.currentVehicleId]=[],e.velocityBooleans[1]=!1,e.velocityBooleans[0]=!0,e.velocityBooleans[2]=!0,e.velocityBooleans[3]=!0):!0===p&&3===g.length?(e.vehicle[e.currentVehicleId]="",e.velocityData[e.currentVehicleId]=[],e.velocityBooleans[2]=!1,e.velocityBooleans[0]=!0,e.velocityBooleans[1]=!0,e.velocityBooleans[3]=!0):!0===p&&3!==g.length&&(e.vehicle[e.currentVehicleId]="",e.velocityData[e.currentVehicleId]=[],e.velocityBooleans[2]=!1,e.velocityBooleans[0]=!0,e.velocityBooleans[1]=!0,e.velocityBooleans[3]=!0)}else e.vehicle[e.currentVehicleId]="",e.velocityData[e.currentVehicleId]=[],e.velocityBooleans[3]=!1,e.velocityBooleans[0]=!0,e.velocityBooleans[1]=!0,e.velocityBooleans[2]=!0}else e.velocityData[e.currentVehicleId]=null,e.positionData[e.currentVehicleId]=null},e.getTelemetrydata=function(a,s){e.chosenCategory=a,e.currentVehicleId=s,n.setTempWidget(e.widget,this),i.innerWidth<=1440?o("left").open():(e.lock=t.getLock(),e.lock.lockLeft=!0,t.setLeftLock(e.lock.lockLeft)),n.setMenuStatus(!0),n.setOpenLogo(!1)},e.readValues=function(t){var a=[];if(e.stringPositionData="",e.stringVelocityData="","velocity"==t){e.totalVelocityArray[e.currentVehicleId]&&(a=c(e.totalVelocityArray[e.currentVehicleId],3));for(var o=0;o<a.length;o++)a[o]&&(o==a.length-1?e.stringVelocityData+=a[o].id:e.stringVelocityData+=a[o].id+", ");return e.stringVelocityData?e.stringVelocityData:""}if("position"==t){e.totalPositionArray[e.currentVehicleId]&&(a=c(e.totalPositionArray[e.currentVehicleId],3));for(o=0;o<a.length;o++)a[o]&&(o==a.length-1?e.stringPositionData+=a[o].id:e.stringPositionData+=a[o].id+", ");return e.stringPositionData?e.stringPositionData:""}},e.saveParameters=function(a){e.vehicleMsg="",e.positionparametersErrMsg="",e.velocityparametersErrMsg="",e.positionInputStyles={},e.positionBtnStyles={},e.velocityInputStyles={},e.velocityBtnStyles={},0===e.totalPositionArray[e.currentVehicleId].length?(e.positionparametersErrMsg="Please fill out this field.",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"},0===e.totalVelocityArray[e.currentVehicleId].length?(e.velocityparametersErrMsg="Please fill out this field.",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"}):e.velocityBooleans[3]?e.velocityBooleans[2]||(e.velocityparametersErrMsg="Select velocity coordinates from vehicle: "+e.currentScreenVehicle+"!",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"}):(e.velocityparametersErrMsg="Required: All velocity coordinates(x,y,z)!",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"})):e.positionBooleans[3]?e.positionBooleans[2]?e.positionBooleans[0]?0===e.totalVelocityArray[e.currentVehicleId].length?(e.velocityparametersErrMsg="Please fill out this field.",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"},0===e.totalPositionArray[e.currentVehicleId].length?(e.positionparametersErrMsg="Please fill out this field.",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):e.positionBooleans[3]?e.positionBooleans[2]||(e.positionparametersErrMsg="Select position coordinates from vehicle: "+e.currentScreenVehicle+"!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):(e.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"})):e.velocityBooleans[3]?e.velocityBooleans[2]?e.velocityBooleans[0]?3===e.positionData[e.currentVehicleId].length&&3===e.velocityData[e.currentVehicleId].length&&s.open({templateUrl:"./directives/groundtrack/confirmParameter.html",controller:"confirmParametersCtrl",controllerAs:"$ctrl",bindToController:!0,scope:e,resolve:{dataLabel:function(){return"Did you select position coordinates(x,y,z) and velocity coordinates(x,y,z)?"},dataItems:function(){return e.settings}}}).result.then(function(a){e.secondScreen=!1,e.firstScreen=!0,e.settings.pdata[e.currentVehicleId]=angular.copy(e.positionData[e.currentVehicleId]),e.settings.vdata[e.currentVehicleId]=angular.copy(e.velocityData[e.currentVehicleId]),e.settings.iconstatus[e.currentVehicleId]=angular.copy(e.iconstatus[e.currentVehicleId]),e.settings.orbitstatus[e.currentVehicleId]=angular.copy(e.orbitstatus[e.currentVehicleId]),e.totalVelocityArray[e.currentVehicleId]=c(e.totalVelocityArray[e.currentVehicleId],3),e.totalPositionArray[e.currentVehicleId]=c(e.totalPositionArray[e.currentVehicleId],3),e.widget.settings.dataArray=[],i.innerWidth>1440&&(e.lock=t.getLock(),e.lock.lockLeft=!1,t.setLeftLock(e.lock.lockLeft)),e.velocityBooleans=[!0,!0,!0,!0],e.positionBooleans=[!0,!0,!0,!0],e.velocityInputStyles={},e.velocityBtnStyles={},e.positionInputStyles={},e.positionBtnStyles={},e.velocityparametersErrMsg="",e.positionparametersErrMsg=""},function(){e.firstScreen=!1,e.secondScreen=!0,e.velocityBooleans=[!0,!0,!0,!0],e.positionBooleans=[!0,!0,!0,!0],e.velocityInputStyles={},e.velocityBtnStyles={},e.positionInputStyles={},e.positionBtnStyles={},e.velocityparametersErrMsg="",e.positionparametersErrMsg=""}):(e.velocityparametersErrMsg="Required: All velocity values(x,y,z)!",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"},0===e.totalPositionArray[e.currentVehicleId].length?(e.positionparametersErrMsg="Please fill out this field.",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):e.positionBooleans[3]?e.positionBooleans[2]||(e.positionparametersErrMsg="Select position coordinates from vehicle: "+e.currentScreenVehicle+"!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):(e.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"})):(e.velocityparametersErrMsg="Select velocity coordinates from vehicle: "+e.currentScreenVehicle+"!",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"},0===e.totalPositionArray[e.currentVehicleId].length?(e.positionparametersErrMsg="Please fill out this field.",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):e.positionBooleans[3]?e.positionBooleans[2]||(e.positionparametersErrMsg="Select position coordinates from vehicle: "+e.currentScreenVehicle+"!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):(e.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"})):(e.velocityparametersErrMsg="Required: All velocity values(x,y,z)!",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"},0===e.totalPositionArray[e.currentVehicleId].length?(e.positionparametersErrMsg="Please fill out this field.",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):e.positionBooleans[3]?e.positionBooleans[2]||(e.positionparametersErrMsg="Select position coordinates from vehicle: "+e.currentScreenVehicle+"!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):(e.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"})):(e.positionparametersErrMsg="Required: All position values(x,y,z)!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"},0===e.totalVelocityArray[e.currentVehicleId].length?(e.velocityparametersErrMsg="Please fill out this field.",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"}):e.velocityBooleans[3]?e.velocityBooleans[2]||(e.velocityparametersErrMsg="Select velocity coordinates from vehicle: "+e.currentScreenVehicle+"!",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"}):(e.velocityparametersErrMsg="Required: All velocity coordinates(x,y,z)!",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"})):(e.positionparametersErrMsg="Select position coordinates from vehicle: "+e.currentScreenVehicle+"!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"},0===e.totalVelocityArray[e.currentVehicleId].length?(e.velocityparametersErrMsg="Please fill out this field.",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"}):e.velocityBooleans[3]?e.velocityBooleans[2]||(e.velocityparametersErrMsg="Select velocity coordinates from vehicle: "+e.currentScreenVehicle+"!",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"}):(e.velocityparametersErrMsg="Required: All velocity coordinates(x,y,z)!",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"})):(e.positionparametersErrMsg="Required: All position values(x,y,z)!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"},0===e.totalVelocityArray[e.currentVehicleId].length?(e.velocityparametersErrMsg="Please fill out this field.",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"}):e.velocityBooleans[3]?e.velocityBooleans[2]||(e.velocityparametersErrMsg="Select velocity coordinates from vehicle: "+e.currentScreenVehicle+"!",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"}):(e.velocityparametersErrMsg="Required: All velocity coordinates(x,y,z)!",e.velocityInputStyles={"border-color":"#dd2c00"},e.velocityBtnStyles={"border-left-color":"#dd2c00"}))},e.closeParameters=function(a){e.secondScreen=!1,e.firstScreen=!0,e.positionData[e.currentVehicleId]=angular.copy(e.settings.pdata[e.currentVehicleId]),e.totalPositionArray[e.currentVehicleId]=e.positionData[e.currentVehicleId],e.iconstatus[e.currentVehicleId]=angular.copy(e.settings.iconstatus[e.currentVehicleId]),e.orbitstatus[e.currentVehicleId]=angular.copy(e.settings.orbitstatus[e.currentVehicleId]),e.velocityData[e.currentVehicleId]=angular.copy(e.settings.vdata[e.currentVehicleId]),e.totalVelocityArray[e.currentVehicleId]=e.velocityData[e.currentVehicleId],e.positionparametersErrMsg="",e.velocityparametersErrMsg="",0===e.settings.pdata[e.currentVehicleId].length&&0===e.settings.vdata[e.currentVehicleId].length&&(e.orbitstatus[e.currentVehicleId]=!0,e.iconstatus[e.currentVehicleId]=!0),i.innerWidth>1440&&(e.lock=t.getLock(),e.lock.lockLeft=!1,t.setLeftLock(e.lock.lockLeft)),e.vehicleMsg="",e.velocityBooleans=[!0,!0,!0,!0],e.positionBooleans=[!0,!0,!0,!0],e.velocityInputStyles={},e.velocityBtnStyles={},e.positionInputStyles={},e.positionBtnStyles={},e.velocityparametersErrMsg="",e.positionparametersErrMsg=""},e.openPositionList=function(t){e.settings.tempPositions=angular.copy(e.totalPositionArray),e.settings.tempPositions[t]=angular.copy(c(e.totalPositionArray[t],3)),s.open({templateUrl:"./directives/groundtrack/positionList.html",controller:"positionParametersCtrl",controllerAs:"$ctrl",resolve:{positionItems:function(){return e.settings},vehicleId:function(){return e.currentVehicleId}}}).result.then(function(a){3===a.tempPositions[t].length&&(e.positionData[t]=angular.copy(a.tempPositions[t]),e.totalPositionArray[t]=angular.copy(a.tempPositions[t]))},function(){})},e.openVelocityList=function(t){e.settings.tempVelocities=angular.copy(e.totalVelocityArray),e.settings.tempVelocities[t]=angular.copy(c(e.totalVelocityArray[t],3)),s.open({templateUrl:"./directives/groundtrack/velocityList.html",controller:"velocityParametersCtrl",controllerAs:"$ctrl",resolve:{velocityItems:function(){return e.settings},vehicleId:function(){return e.currentVehicleId}}}).result.then(function(a){3===a.tempVelocities[t].length&&(e.velocityData[t]=angular.copy(a.tempVelocities[t]),e.totalVelocityArray[t]=angular.copy(a.tempVelocities[t]))},function(){})},e.$on("$destroy",function(t){a.cancel(e.interval)})}]),app.controller("positionParametersCtrl",["$scope","$uibModalInstance","positionItems","$uibModal","vehicleId",function(e,t,a,o,i){var n=this;n.data=a,n.currentVehicleId=i;var s=angular.copy(a);n.close=function(){n.data.tempPositions=s.tempPositions,t.dismiss("cancel")},n.save=function(){o.open({templateUrl:"./directives/groundtrack/confirmParameter.html",controller:"confirmParametersCtrl",controllerAs:"$ctrl",resolve:{dataLabel:function(){return"Is the position coordinates selected order is:x,y,z?"},dataItems:function(){return n.data}}}).result.then(function(e){t.close(e)},function(){})}}]),app.controller("velocityParametersCtrl",["$scope","$uibModalInstance","velocityItems","$uibModal","vehicleId",function(e,t,a,o,i){var n=this;n.data=a,n.currentVehicleId=i;var s=angular.copy(a);n.close=function(){n.data.tempVelocities=s.tempVelocities,t.dismiss("cancel")},n.save=function(){o.open({templateUrl:"./directives/groundtrack/confirmParameter.html",controller:"confirmParametersCtrl",controllerAs:"$ctrl",resolve:{dataLabel:function(){return"Is the velocity coordinates selected order is:x,y,z?"},dataItems:function(){return n.data}}}).result.then(function(e){t.close(e)},function(){})}}]),app.controller("confirmParametersCtrl",["$scope","$uibModalInstance","dataLabel","dataItems",function(e,t,a,o){var i=this;i.modalLabel=a,i.finalData=o,i.close=function(){t.dismiss("cancel")},i.save=function(){t.close(i.finalData)}}]),app.directive("sample",function(){return{restrict:"E",template:"<p>This is a Sample Widget</p>"}}),app.directive("samplesettings",function(){return{restrict:"EA",template:'<div class="savestyles"><form class="form-inline"><div class="row"><div class="col-sm-5"><label for="SampleSettings">This is a Sample Settings Page.</label></div></div><div class="row"><div class="col-sm-11"><hr/></div></div><div class="row"><div class="col-sm-11"><button type="submit" class="btn btn-primary sbtns" ng-click="close(widget)">CLOSE</button></div></div></form></div>',controller:function(e){e.close=function(e){e.main=!0,e.settings.active=!1,e.saveLoad=!1,e.delete=!1}}}}),app.directive("model",function(){return{restrict:"E",scope:{modelUrl:"=modelUrl",widget:"=widget",quaternion:"=quaternion"},controller:"SatelliteCtrl"}}),app.controller("SatelliteCtrl",["$scope","$element","$interval","dashboardService","solarService","datastatesService",function(e,t,a,o,i,n){var s,r,l,c,d,u,g,p,h=t.parent()[0],v=$(h).width(),m=$(h).height(),y=v/m,f=new THREE.AssimpJSONLoader,w=o.telemetry,b=Math.PI,k=b/180,S=n.colorValues.alarmcolor,I=n.colorValues.cautioncolor,A=n.colorValues.healthycolor,B=n.colorValues.stalecolor,V=n.colorValues.disconnectedcolor,D=n.colorValues.defaultcolor,E="",M="",C="",L="";e.statusIcons=o.icons;var P={};e.$watch("statusIcons",function(e,t){P=e},!0);var x=function(e,t){var a=new THREE.Vector3(1,1,0),o=new THREE.Vector3(0,0,0);a.normalize();var i=new THREE.ArrowHelper(a,o,6,t);return i.name=e,i.visible=!1,i};function z(t){f.load(t,function(t){t.scale.x=t.scale.y=t.scale.z=.8,t.updateMatrix(),s&&e.scene.remove(s),e.scene.add(t),s=t,e.cube=t})}var T,O=function(e,t,a){var o=new Date(w.time),n=(i.date2JulianDate(o)-2451545)/36525,s=(67310.54841+3164400184.812866*n+.093104*Math.pow(n,2)-6.2*Math.pow(10,-6)*Math.pow(n,3))%86400/240*Math.PI/180,r=[[Math.cos(-s),Math.sin(-s),0],[-Math.sin(-s),Math.cos(-s),0],[0,0,1]];return xECI=r[0][0]*e+r[0][1]*t+r[0][2]*a,yECI=r[1][0]*e+r[1][1]*t+r[1][2]*a,zECI=r[2][0]*e+r[2][1]*t+r[2][2]*a,[xECI,yECI,zECI]},q=function(){var t,a,n;if(requestAnimationFrame(q),j.update(),e.cube&&e.widget.settings.vehicle&&e.widget.settings.attitudeData&&e.widget.settings.positionData)if(w[e.widget.settings.vehicle]){r=o.getData(e.widget.settings.attitudeData[0].key),l=o.getData(e.widget.settings.attitudeData[1].key),c=o.getData(e.widget.settings.attitudeData[2].key),d=o.getData(e.widget.settings.attitudeData[3].key),e.cube.quaternion.x=r.value,e.cube.quaternion.y=l.value,e.cube.quaternion.z=c.value,e.cube.quaternion.w=d.value,"number"==typeof r.value?e.quaternion[e.widget.settings.attitudeData[0].id]=r.value.toFixed(4):"string"==typeof r.value&&(e.quaternion[e.widget.settings.attitudeData[0].id]=r.value),"number"==typeof l.value?e.quaternion[e.widget.settings.attitudeData[1].id]=l.value.toFixed(4):"string"==typeof l.value&&(e.quaternion[e.widget.settings.attitudeData[1].id]=l.value),"number"==typeof c.value?e.quaternion[e.widget.settings.attitudeData[2].id]=c.value.toFixed(4):"string"==typeof c.value&&(e.quaternion[e.widget.settings.attitudeData[2].id]=c.value),"number"==typeof d.value?e.quaternion[e.widget.settings.attitudeData[3].id]=d.value.toFixed(4):"string"==typeof d.value&&(e.quaternion[e.widget.settings.attitudeData[3].id]=d.value),u=o.getData(e.widget.settings.positionData[0].key),g=o.getData(e.widget.settings.positionData[1].key),p=o.getData(e.widget.settings.positionData[2].key),t=u.value,a=g.value,n=p.value;var s=O(t,a,n),h=new THREE.Vector3(-s[0],-s[1],-s[2]);h.normalize(),e.arrowEarth.visible=!0,e.arrowEarth.setDirection(h);var v=function(e){var t=i.solarPosition(e),a=t[0]*k,o=t[1]*k;return i.longLat2ECEF(a,o)}(new Date(w.time)),m=O(v[0],v[1],v[2]),y=new THREE.Vector3(m[0],m[1],m[2]);y.normalize(),e.arrowSun.visible=!0,e.arrowSun.setDirection(y)}else e.quaternion[e.widget.settings.attitudeData[0].id]="N/A",e.quaternion[e.widget.settings.attitudeData[1].id]="N/A",e.quaternion[e.widget.settings.attitudeData[2].id]="N/A",e.quaternion[e.widget.settings.attitudeData[3].id]="N/A";e.camera.fov=G*e.widget.settings.zoom,e.camera.updateProjectionMatrix(),e.renderer.render(e.scene,e.camera)};e.interval=a(function(){if(e.quaternion.color=[],e.widget.settings.vehicle&&e.cube&&w[e.widget.settings.vehicle]&&e.widget.settings.attitudeData&&e.widget.settings.positionData){var t=o.getData(e.widget.settings.attitudeData[0].key),a=o.getData(e.widget.settings.attitudeData[1].key),i=o.getData(e.widget.settings.attitudeData[2].key),s=o.getData(e.widget.settings.attitudeData[3].key),r=typeof t.value,l=typeof a.value,c=typeof i.value,d=typeof s.value,u=t,g=a,p=i,h=s;if(E===u.value)"green"===P.sIcon&&"green"===P.gIcon&&"green"===P.pIcon&&"green"===P.dIcon?e.quaternion.color[0]=A:e.quaternion.color[0]=B;else{var v=n.getDataColor(u.alarm_low,u.alarm_high,u.value,u.warn_low,u.warn_high,r);e.quaternion.color[0]="red"===v?S:"orange"===v?I:A,E=u.value}if(M===g.value)"green"===P.sIcon&&"green"===P.gIcon&&"green"===P.pIcon&&"green"===P.dIcon?e.quaternion.color[1]=A:e.quaternion.color[1]=B;else{var m=n.getDataColor(g.alarm_low,g.alarm_high,g.value,g.warn_low,g.warn_high,l);e.quaternion.color[1]="red"===m?S:"orange"===m?I:A,M=g.value}if(C===p.value)"green"===P.sIcon&&"green"===P.gIcon&&"green"===P.pIcon&&"green"===P.dIcon?e.quaternion.color[2]=A:e.quaternion.color[2]=B;else{var y=n.getDataColor(p.alarm_low,p.alarm_high,p.value,p.warn_low,p.warn_high,c);e.quaternion.color[2]="red"===y?S:"orange"===y?I:A,C=p.value}if(L===h.value)"green"===P.sIcon&&"green"===P.gIcon&&"green"===P.pIcon&&"green"===P.dIcon?e.quaternion.color[3]=A:e.quaternion.color[3]=B;else{var f=n.getDataColor(h.alarm_low,h.alarm_high,h.value,h.warn_low,h.warn_high,d);e.quaternion.color[3]="red"===f?S:"orange"===f?I:A,L=h.value}"red"===P.dIcon&&(e.quaternion.color[0]=V,e.quaternion[e.widget.settings.attitudeData[0].id]="-",e.quaternion.color[1]=V,e.quaternion[e.widget.settings.attitudeData[1].id]="-",e.quaternion.color[2]=V,e.quaternion[e.widget.settings.attitudeData[2].id]="-",e.quaternion.color[3]=V,e.quaternion[e.widget.settings.attitudeData[3].id]="-")}else e.quaternion.color[0]=D,e.quaternion.color[1]=D,e.quaternion.color[2]=D,e.quaternion.color[3]=D},1e3,0,!1),e.cube=new THREE.Object3D,e.scene=new THREE.Scene,e.camera=((T=new THREE.PerspectiveCamera(45,y,1,1e3)).position.set(8,8,8),T.up=new THREE.Vector3(0,0,1),T.lookAt(new THREE.Vector3(0,0,0)),T);var U,_,N,F,G=e.camera.fov;e.light=((U=new THREE.PointLight(12566463)).position.x=0,U.position.y=300,U.position.z=0,U),e.renderer=((_=new THREE.WebGLRenderer).setSize(v,m),_.setClearColor(16777215,1),_),e.grid=((N=new THREE.PolarGridHelper(100,16,50,64,new THREE.Color(10000536),new THREE.Color(12566463))).rotation.x=Math.PI/2,N),e.axis=((F=new THREE.AxisHelper(20)).material.linewidth=2,F),e.arrowEarth=x("Earth",1120592),e.arrowSun=x("Sun",16755456),e.scene.add(e.light),z(e.modelUrl),e.scene.add(e.cube),e.scene.add(e.axis),e.scene.add(e.grid),e.scene.add(e.arrowEarth),e.scene.add(e.arrowSun);var j=new THREE.OrbitControls(e.camera,e.renderer.domElement);j.enableZoom=!1,j.enablePan=!1,q(),h.appendChild(e.renderer.domElement),e.$watch(function(){return{width:t.parent()[0].clientWidth,height:t.parent()[0].clientHeight}},function(t){e.renderer.setSize(t.width,t.height),e.camera.aspect=t.width/t.height,e.camera.updateProjectionMatrix()},!0),e.$watch("modelUrl",function(e,t){e!=t&&z(e)}),e.$on("$destroy",function(t){a.cancel(e.interval),E="",M="",C="",L=""})}]),app.directive("satellite",function(){return{restrict:"E",templateUrl:"./directives/satellite/satellite.html",controller:"SatCtrl"}}),app.controller("SatCtrl",["$scope",function(e){e.widget.settings.hasOwnProperty("zoom")||(e.widget.settings.zoom=1),e.modelUrl="./directives/satellite/models/satellite.json",e.step=.01,e.min=.2,e.max=1.8,e.quaternion=new Object,e.colors=new Object}]),app.directive("satellitesettings",function(){return{restrict:"E",templateUrl:"./directives/satellite/satellitesettings.html",controller:"SatSettingsCtrl"}}),app.controller("SatSettingsCtrl",["$scope","dashboardService","sidebarService","$window","$mdSidenav","$uibModal",function(e,t,a,o,i,n){function s(e,t){for(var a=[],o=e.length,i=o-t;i<o;i++)a.push(e[i]);return a}function r(e){for(var t=[],a=e.length,o=0;o<a;o++)t.push(e[o]);return t}function l(e){for(var a=[],o=e.length,i=0;i<o;i++){var n=t.getData(e[i].key);n&&n.hasOwnProperty("value")&&a.push(e[i])}return a}function c(e){for(var t=e.length,a=0,o=1;o<t;o++)e[o].vehicle!==e[0].vehicle&&a++;return a>0}e.chosenCategory,e.attitudeBooleans=[!0,!0,!0,!0],e.positionBooleans=[!0,!0,!0,!0],function(){if(e.widget.settings.attitudeData&&e.widget.settings.positionData){var t=angular.copy(e.widget.settings);e.settings={attitudeData:t.attitudeData,positionData:t.positionData},e.vehicle=t.vehicle,e.widget.settings.totalPositionArray=angular.copy(e.widget.settings.positionData),e.widget.settings.totalAttitudeArray=angular.copy(e.widget.settings.attitudeData)}else e.widget.settings.attitudeData||e.widget.settings.positionData||(e.settings={attitudeData:[],positionData:[]},e.widget.settings.totalPositionArray=[],e.widget.settings.totalAttitudeArray=[],e.vehicle="")}(),e.attitudeInputStyles={},e.positionInputStyles={},e.attitudeBtnStyles={},e.positionBtnStyles={},e.attitudeparametersErrMsg="",e.positionparametersErrMsg="",e.closeSettings=function(a){a.main=!0,a.settings.active=!1,a.saveLoad=!1,a.delete=!1;var i=angular.copy(a.settings);i.attitudeData&&i.positionData?(e.settings.attitudeData=i.attitudeData,e.widget.settings.totalAttitudeArray=angular.copy(e.widget.settings.attitudeData),e.settings.positionData=i.positionData,e.widget.settings.totalPositionArray=angular.copy(e.widget.settings.positionData),e.vehicle=i.vehicle):!i.attitudeData&&i.positionData?(e.settings.positionData=i.positionData,e.widget.settings.totalPositionArray=angular.copy(e.widget.settings.positionData),e.vehicle=i.vehicle):i.attitudeData&&!i.positionData?(e.settings.attitudeData=i.attitudeData,e.widget.settings.totalAttitudeArray=angular.copy(e.widget.settings.attitudeData),e.vehicle=i.vehicle):(e.settings.attitudeData=[],e.settings.positionData=[],e.widget.settings.totalAttitudeArray=[],e.widget.settings.totalPositionArray=[]),o.innerWidth>1440&&(e.lock=t.getLock(),e.lock.lockLeft=!1,t.setLeftLock(e.lock.lockLeft)),e.attitudeBooleans=[!0,!0,!0,!0],e.positionBooleans=[!0,!0,!0,!0],e.attitudeInputStyles={},e.attitudeBtnStyles={},e.positionInputStyles={},e.positionBtnStyles={},e.attitudeparametersErrMsg="",e.positionparametersErrMsg=""},e.saveSettings=function(a){var i=function(t,a){for(var o=!0,i=t.length,n=a.length,s=0;s<i;s++)for(var r=0;r<n;r++)t[s].vehicle!==a[r].vehicle&&(o=!1,e.currentAttitudeVehicle=t[s].vehicle,e.currentPositionVehicle=a[r].vehicle);return o}(e.settings.attitudeData,e.settings.positionData);e.positionparametersErrMsg="",e.attitudeparametersErrMsg="",e.positionInputStyles={},e.positionBtnStyles={},e.attitudeInputStyles={},e.attitudeBtnStyles={},0===e.widget.settings.totalAttitudeArray.length?(e.attitudeparametersErrMsg="Please fill out this field.",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"},0===e.widget.settings.totalPositionArray.length?(e.positionparametersErrMsg="Please fill out this field.",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):e.positionBooleans[3]?e.positionBooleans[2]||(e.positionparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):(e.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"})):e.attitudeBooleans[3]?e.attitudeBooleans[2]?e.attitudeBooleans[0]?0===e.widget.settings.totalPositionArray.length?(e.positionparametersErrMsg="Please fill out this field.",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"},0===e.widget.settings.totalAttitudeArray.length?(e.attitudeparametersErrMsg="Please fill out this field.",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"}):e.attitudeBooleans[3]?e.attitudeBooleans[2]||(e.attitudeparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"}):(e.attitudeparametersErrMsg="Required: All position coordinates(x,y,z)!",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"})):e.positionBooleans[3]?e.positionBooleans[2]?e.positionBooleans[0]?4===e.widget.settings.totalAttitudeArray.length&&3===e.widget.settings.totalPositionArray.length&&!0===i?n.open({templateUrl:"./directives/satellite/confirmSettings.html",controller:"confirmCtrl",controllerAs:"$ctrl",bindToController:!0,scope:e,resolve:{dataLabel:function(){return"Did you select quaternion coordinates(q1,q2,q3,qc) and position coordinates(x,y,z)?"},dataItems:function(){return e.settings}}}).result.then(function(i){a.main=!0,a.settings.active=!1,a.saveLoad=!1,a.delete=!1,a.settings.attitudeData=r(i.attitudeData),a.settings.positionData=r(i.positionData),a.settings.vehicle=e.vehicle,e.widget.settings.totalAttitudeArray=s(e.widget.settings.totalAttitudeArray,4),e.widget.settings.totalPositionArray=s(e.widget.settings.totalPositionArray,3),a.settings.dataArray=[],o.innerWidth>1440&&(e.lock=t.getLock(),e.lock.lockLeft=!1,t.setLeftLock(e.lock.lockLeft)),e.attitudeBooleans=[!0,!0,!0,!0],e.positionBooleans=[!0,!0,!0,!0],e.attitudeInputStyles={},e.attitudeBtnStyles={},e.positionInputStyles={},e.positionBtnStyles={},e.attitudeparametersErrMsg="",e.positionparametersErrMsg=""},function(){e.attitudeBooleans=[!0,!0,!0,!0],e.positionBooleans=[!0,!0,!0,!0],e.attitudeInputStyles={},e.attitudeBtnStyles={},e.positionInputStyles={},e.positionBtnStyles={},e.attitudeparametersErrMsg="",e.positionparametersErrMsg=""}):!1===i&&(e.attitudeparametersErrMsg="Vehicles of both fields do not match! Selected from vehicle: "+e.currentAttitudeVehicle,e.positionparametersErrMsg="Vehicles of both fields do not match! Selected from vehicle: "+e.currentPositionVehicle,e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"},e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):(e.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"},0===e.widget.settings.totalAttitudeArray.length?(e.attitudeparametersErrMsg="Please fill out this field.",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"}):e.attitudeBooleans[3]?e.attitudeBooleans[2]||(e.attitudeparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"}):(e.attitudeparametersErrMsg="Required: All position coordinates(x,y,z)!",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"})):(e.positionparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"},0===e.widget.settings.totalAttitudeArray.length?(e.attitudeparametersErrMsg="Please fill out this field.",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"}):e.attitudeBooleans[3]?e.attitudeBooleans[2]||(e.attitudeparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"}):(e.attitudeparametersErrMsg="Required: All position coordinates(x,y,z)!",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"})):(e.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"},0===e.widget.settings.totalAttitudeArray.length?(e.attitudeparametersErrMsg="Please fill out this field.",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"}):e.attitudeBooleans[3]?e.attitudeBooleans[2]||(e.attitudeparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"}):(e.attitudeparametersErrMsg="Required: All position coordinates(x,y,z)!",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"})):(e.attitudeparametersErrMsg="Required: All attitude coordinates(q1,q2,q3,qc)!",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"},0===e.widget.settings.totalPositionArray.length?(e.positionparametersErrMsg="Please fill out this field.",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):e.positionBooleans[3]?e.positionBooleans[2]||(e.positionparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):(e.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"})):(e.attitudeparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"},0===e.widget.settings.totalPositionArray.length?(e.positionparametersErrMsg="Please fill out this field.",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):e.positionBooleans[3]?e.positionBooleans[2]||(e.positionparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):(e.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"})):(e.attitudeparametersErrMsg="Required: All attitude coordinates(q1,q2,q3,qc)!",e.attitudeInputStyles={"border-color":"#dd2c00"},e.attitudeBtnStyles={"border-left-color":"#dd2c00"},0===e.widget.settings.totalPositionArray.length?(e.positionparametersErrMsg="Please fill out this field.",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):e.positionBooleans[3]?e.positionBooleans[2]||(e.positionparametersErrMsg="Coordinates selected from different vehicles.Select from single vehicle!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}):(e.positionparametersErrMsg="Required: All position coordinates(x,y,z)!",e.positionInputStyles={"border-color":"#dd2c00"},e.positionBtnStyles={"border-left-color":"#dd2c00"}))},e.getTelemetrydata=function(n){e.chosenCategory=n,a.setTempWidget(e.widget,this),o.innerWidth<=1440?i("left").open():(e.lock=t.getLock(),e.lock.lockLeft=!0,t.setLeftLock(e.lock.lockLeft)),a.setMenuStatus(!0),a.setOpenLogo(!1)},e.readValues=function(t){var a=[];if(e.stringPositionData="",e.stringAttitudeData="","attitude"==t){e.widget.settings.totalAttitudeArray&&(a=s(e.widget.settings.totalAttitudeArray,4));for(var o=0;o<a.length;o++)a[o]&&(o==a.length-1?e.stringAttitudeData+=a[o].id:e.stringAttitudeData+=a[o].id+", ");return e.stringAttitudeData?e.stringAttitudeData:""}if("position"==t){e.widget.settings.totalPositionArray&&(a=s(e.widget.settings.totalPositionArray,3));for(o=0;o<a.length;o++)a[o]&&(o==a.length-1?e.stringPositionData+=a[o].id:e.stringPositionData+=a[o].id+", ");return e.stringPositionData?e.stringPositionData:""}},e.sortableOptionsAttitude={containment:"#scrollable-containerAttitude",scrollableContainer:"#scrollable-containerAttitude",accept:function(e,t){return e.itemScope.sortableScope.$id===t.$id}},e.sortableOptionsPosition={containment:"#scrollable-containerPosition",scrollableContainer:"#scrollable-containerPosition",accept:function(e,t){return e.itemScope.sortableScope.$id===t.$id}},e.getValue=function(t){angular.copy(e.widget.settings.dataArray).length;var a=e.widget.settings.dataArray[e.widget.settings.dataArray.length-1];if(!t&&a&&""!==a.id){"attitude"==e.chosenCategory?e.widget.settings.totalAttitudeArray.push(e.widget.settings.dataArray[e.widget.settings.dataArray.length-1]):"position"==e.chosenCategory&&e.widget.settings.totalPositionArray.push(e.widget.settings.dataArray[e.widget.settings.dataArray.length-1]);var o,i=[];if(4===(i=(o=angular.copy(e.widget.settings.totalAttitudeArray)).length>4?s(o,4):o).length){var n=l(i),r=c(n);!1===r&&4===n.length?4===n.length&&(e.settings.attitudeData=n,e.vehicle=n[0].vehicle,e.widget.settings.totalAttitudeArray=angular.copy(n),e.attitudeBooleans[0]=!0,e.attitudeBooleans[1]=!0,e.attitudeBooleans[2]=!0,e.attitudeBooleans[3]=!0):n.length<4?(e.attitudeBooleans[0]=!1,e.attitudeBooleans[1]=!0,e.attitudeBooleans[2]=!0,e.attitudeBooleans[3]=!0):!1===r?(e.attitudeBooleans[1]=!1,e.attitudeBooleans[0]=!0,e.attitudeBooleans[2]=!0,e.attitudeBooleans[3]=!0):!0===r&&4===n.length?(e.attitudeBooleans[2]=!1,e.attitudeBooleans[0]=!0,e.attitudeBooleans[1]=!0,e.attitudeBooleans[3]=!0):!0===r&&4!==n.length&&(e.attitudeBooleans[2]=!1,e.attitudeBooleans[0]=!0,e.attitudeBooleans[1]=!0,e.attitudeBooleans[3]=!0)}else e.attitudeBooleans[3]=!1,e.attitudeBooleans[0]=!0,e.attitudeBooleans[1]=!0,e.attitudeBooleans[2]=!0;var d,u=[];if(3===(u=(d=angular.copy(e.widget.settings.totalPositionArray)).length>3?s(d,3):d).length){var g=l(u),p=c(g);!1===p&&3===g.length?3===g.length&&(e.settings.positionData=g,e.vehicle=g[0].vehicle,e.widget.settings.totalPositionArray=angular.copy(g),e.positionBooleans[0]=!0,e.positionBooleans[1]=!0,e.positionBooleans[2]=!0,e.positionBooleans[3]=!0):g.length<3?(e.positionBooleans[0]=!1,e.positionBooleans[1]=!0,e.positionBooleans[2]=!0,e.positionBooleans[3]=!0):!1===p?(e.positionBooleans[1]=!1,e.positionBooleans[0]=!0,e.positionBooleans[2]=!0,e.positionBooleans[3]=!0):!0===p&&3===g.length?(e.positionBooleans[2]=!1,e.positionBooleans[0]=!0,e.positionBooleans[1]=!0,e.positionBooleans[3]=!0):!0===p&&3!==g.length&&(e.positionBooleans[2]=!1,e.positionBooleans[0]=!0,e.positionBooleans[1]=!0,e.positionBooleans[3]=!0)}else e.positionBooleans[3]=!1,e.positionBooleans[0]=!0,e.positionBooleans[1]=!0,e.positionBooleans[2]=!0}},e.openAttitudeList=function(){e.settings.tempAttitudes=angular.copy(s(e.widget.settings.totalAttitudeArray,4)),n.open({templateUrl:"./directives/satellite/quaternionList.html",controller:"attitudeListCtrl",controllerAs:"$ctrl",resolve:{attitudeItems:function(){return e.settings}}}).result.then(function(t){4===t.tempAttitudes.length&&(e.widget.settings.totalAttitudeArray=angular.copy(t.tempAttitudes),e.settings.attitudeData=angular.copy(e.widget.settings.totalAttitudeArray))},function(){})},e.openPositionList=function(){e.settings.tempPositions=angular.copy(s(e.widget.settings.totalPositionArray,3)),n.open({templateUrl:"./directives/satellite/positionList.html",controller:"positionListCtrl",controllerAs:"$ctrl",resolve:{positionItems:function(){return e.settings}}}).result.then(function(t){3===t.tempPositions.length&&(e.widget.settings.totalPositionArray=angular.copy(t.tempPositions),e.settings.positionData=angular.copy(e.widget.settings.totalPositionArray))},function(){})}}]),app.controller("positionListCtrl",["$scope","$uibModalInstance","positionItems","$uibModal",function(e,t,a,o){var i=this;i.data=a;var n=angular.copy(a);i.close=function(){i.data.tempPositions=n.tempPositions,t.dismiss("cancel")},i.save=function(){o.open({templateUrl:"./directives/satellite/confirmParameter.html",controller:"confirmCtrl",controllerAs:"$ctrl",resolve:{dataLabel:function(){return"Is the position coordinates selected order is:x,y,z?"},dataItems:function(){return i.data}}}).result.then(function(e){t.close(e)},function(){})}}]),app.controller("attitudeListCtrl",["$scope","$uibModalInstance","attitudeItems","$uibModal",function(e,t,a,o){var i=this;i.data=a;var n=angular.copy(a);i.close=function(){i.data.tempAttitudes=n.tempAttitudes,t.dismiss("cancel")},i.save=function(){o.open({templateUrl:"./directives/satellite/confirmParameter.html",controller:"confirmCtrl",controllerAs:"$ctrl",resolve:{dataLabel:function(){return"Is the quaternion coordinates selected order is:q1,q2,q3,qc?"},dataItems:function(){return i.data}}}).result.then(function(e){t.close(e)},function(){})}}]),app.controller("confirmCtrl",["$scope","$uibModalInstance","dataLabel","dataItems",function(e,t,a,o){var i=this;i.modalLabel=a,i.finalData=o,i.close=function(){t.dismiss("cancel")},i.save=function(){t.close(i.finalData)}}]),app.directive("systemmap",function(){return{restrict:"EA",controller:"SystemMapCtrl",templateUrl:"./directives/systemmap/systemmap.html"}}),app.controller("SystemMapCtrl",["$scope","dashboardService","$interval","datastatesService",function(e,t,a,o){o.colorValues.alarmcolor,o.colorValues.cautioncolor,o.colorValues.healthycolor,o.colorValues.stalecolor,o.colorValues.disconnectedcolor,o.colorValues.defaultcolor;e.dataStatus=t.icons;e.$watch("dataStatus",function(e,t){e},!0),e.widget.settings.imglocation="/media/systemmaps/sysmap.jpg"}]),app.directive("systemmapsettings",function(){return{restrict:"E",templateUrl:"./directives/systemmap/systemmapsettings.html",controller:"SystemSettingsCtrl"}}),app.controller("SystemSettingsCtrl",["$scope","gridService",function(e,t){t.loadMaps().then(function(t){200==t.status&&(e.images=t.data)}),e.isLoaded=!1,e.widget.settings.imageid?e.selected={imageid:e.widget.settings.imageid}:e.selected={},e.closeSettings=function(t){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,e.selected.imageid=t.settings.imageid},e.saveSettings=function(t){if(e.selected.imageid){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1;for(var a=0;a<e.images.length;a++)e.images[a].imageid===e.selected.imageid&&(t.settings.imageid=e.images[a].imageid,t.settings.imglocation="data:image/gif;base64,"+e.images[a].image,t.settings.contents=e.images[a].contents)}}}]),app.directive("timeline",function(){return{restrict:"EA",controller:"timelineCtrl",templateUrl:"./directives/timeline/timeline.html"}}),app.controller("timelineCtrl",["gridService","$scope","$interval","dashboardService","$element",function(e,t,a,o,i){var n=[],s=[],r=new vis.DataSet,l=new vis.DataSet,c=i[0].getElementsByTagName("div").visualization,d=new vis.Timeline(c);t.tztimeline=[],t.tzcontainer=[],t.tzgroups=[],t.tzoptions=[];i[0].getElementsByTagName("div").timeline;function u(a,o){var i=[];s=[],r=new vis.DataSet,l=new vis.DataSet;for(var c=0;c<o.items1.length;c++)for(var u=0;u<a.length;u++)!1===o.items1[c].groupstatus?o.items1[c].Label===a[u].label&&i.push({id:a[u].id,label:o.items1[c].Label,group:"Other"}):o.items1[c].Label===a[u].group&&i.push({id:a[u].id,label:a[u].label,group:a[u].group});s=function(e){for(var t=[],a=0;a<e.length;a++)t.push({ename:e[a].label,groupname:e[a].group});for(var o=0;o<t.length;o++)"Other"===t[o].groupname||"Nested"===t[o].groupname||!1===p(t[o].groupname,t)&&t.push({ename:t[o].groupname,groupname:"Nested"});return t}(i);var g=function(e,t,a){if(void 0!==a){for(var o=[],i=[],s=function(e){for(var t=!1,a=0,o=0;o<e.length;o++)"Other"===e[o].groupname&&a++;t=a===e.length;return t}(t),r=0;r<t.length;r++)"Nested"!==t[r].groupname&&"Other"!==t[r].groupname?o.push(t[r]):i.push(t[r]);for(var l=0;l<a.length;l++)for(var c=0;c<i.length;c++)a[l].Label===i[c].ename&&o.push({ename:a[l].Label,groupname:i[c].groupname});for(var d=0;d<o.length;d++)"Nested"===o[d].groupname?e.add({id:d,content:o[d].ename,nestedGroups:[],className:"groupheader"}):"Other"===o[d].groupname?!0===s?e.add({id:d,content:o[d].ename,className:"onlyotherevents"}):e.add({id:d,content:o[d].ename,className:"otherevent"}):e.add({id:d,content:o[d].ename});for(var u=0;u<o.length;u++)for(var g=0;g<e.length;g++)o[u].groupname===e._data[g].content&&(e._data[u].className="innerItem",e._data[g].nestedGroups.push(u))}else{for(var d=0;d<t.length;d++)"Nested"===t[d].groupname?e.add({id:d,content:t[d].ename,nestedGroups:[],className:"groupheader"}):"Other"===t[d].groupname?e.add({id:d,content:t[d].ename,className:"otherevent"}):e.add({id:d,content:t[d].ename});for(var u=0;u<t.length;u++)for(var g=0;g<e.length;g++)t[u].groupname===e._data[g].content&&(e._data[u].className="innerItem",e._data[g].nestedGroups.push(u))}return n=e,e}(r,s,o.items1),h=function(a,o,i){a=new vis.DataSet;var n=0;return e.loadTimelineEvents().then(function(e){if(t.timelinedata=e.data,t.timelinedata.length>0){for(var s=0;s<i.length;s++)for(var r=0;r<t.timelinedata.length;r++)i[s].label===t.timelinedata[r].eventname&&(i[s].eventdata=t.timelinedata[r].eventdata,i[s].eventinfo=t.timelinedata[r].eventinfo);for(var l=0;l<o.length;l++)for(var c=0;c<i.length;c++)if(o._data[l].content===i[c].label&&i[c].eventdata.length>0)for(var d=0;d<i[c].eventdata.length;d++)if(""!==i[c].eventdata[d].start&&""!==i[c].eventdata[d].end){var u=vis.moment.utc().format(i[c].eventdata[d].start),g=vis.moment.utc().format(i[c].eventdata[d].end),p="";i[c].eventdata[d].content&&(p=i[c].eventdata[d].content),""!==p?a.add({id:n,content:p,className:"event",group:o._data[l].id,start:u,end:g}):a.add({id:n,content:i[c].eventinfo,className:"event",group:o._data[l].id,start:u,end:g}),n++}else""===i[c].eventdata[d].start||i[c].eventdata[d].end||(u=vis.moment.utc().format(i[c].eventdata[d].start),a.add({id:n,content:i[c].eventinfo,className:"event",group:o._data[l].id,start:u}),n++)}}),a}(l,g,i);t.options=v(),d.setOptions(t.options),d.setOptions({orientation:{axis:"none"}}),d.setGroups(g),d.setItems(h),t.widget.settings.start||t.widget.settings.start?t.options=v():(t.options=v(),t.widget.settings.start=t.options.start,t.widget.settings.end=t.options.end)}function g(){t.timezones=new Array,t.tztimeline=[],t.tzcontainer=[],t.tzgroups=[],t.tzoptions=[];var e=i[0].getElementsByTagName("div").timeline;t.widget.settings.start&&t.widget.settings.end&&(t.options=v()),t.widget.settings.timezones&&0!==t.widget.settings.timezones.length||(t.widget.settings.timezones=[{name:"UTC",utcoffset:"+00:00",id:"utc",labeloffset:"+ 00"}]);for(var a=0;a<t.widget.settings.timezones.length;a++)t.timezones.push(t.widget.settings.timezones[a]);for(;e.firstChild;)e.removeChild(e.firstChild);for(var n=0;n<t.timezones.length;n++){t.tzcontainer[n]=document.createElement("div"),t.tzcontainer[n].className="tzgroup",e.insertBefore(t.tzcontainer[n],e.childNodes[e.childNodes.length]);var s=new vis.Timeline(t.tzcontainer[n]);t.tztimeline.push(s),t.widget.settings.start&&t.widget.settings.end?t.tzoptions.push({start:t.widget.settings.start,end:t.widget.settings.end,orientation:{axis:"top"},moveable:!1,zoomable:!1}):t.tzoptions.push({start:new Date(vis.moment(o.getTime("UTC").today).utcOffset(t.timezones[n].utcoffset)-36e5),end:new Date(vis.moment(o.getTime("UTC").today).utcOffset(t.timezones[n].utcoffset)+36e5),orientation:{axis:"top"},moveable:!1,zoomable:!1});var r=new vis.DataSet,l="",c=t.timezones[n].name;t.tzgroups.push(r),l="San Francisco"===c?{moment:function(e){return vis.moment(e).utcOffset("-08:00")}}:"Singapore"===c?{moment:function(e){return vis.moment(e).utcOffset("+08:00")}}:"UTC"===c?{moment:function(e){return vis.moment(e).utcOffset("+00:00")}}:"Luxembourg"===c?{moment:function(e){return vis.moment(e).utcOffset("+02:00")}}:{moment:function(e){return vis.moment(e).utcOffset("+00:00")}},t.tztimeline[n].setOptions(t.tzoptions[n]),t.tztimeline[n].setOptions(l),t.tzgroups[n].add({id:0,content:t.timezones[n].name+" (UTC "+t.timezones[n].labeloffset+")"}),t.tztimeline[n].setGroups(t.tzgroups[n])}}function p(e,t){return t.some(function(t){return t.ename===e})}function h(e,a){return{groupTemplate:function(e){var a,o,i,s,r,l,c,d,u,g,p,h,v,y,f,w,b,k,S=document.createElement("div"),I=document.createElement("span");return e.nestedInGroup?(I.innerHTML=e.content,S.insertAdjacentElement("beforeEnd",I),a=document.createElement("div"),o=document.createElement("button"),i=document.createElement("i"),s=document.createElement("div"),r=document.createElement("p"),l=document.createElement("p"),r.className="listItems",l.className="listItems",document.createElement("a"),document.createElement("a"),(u=document.createElement("p")).className="listItems",c=document.createElement("a"),d=document.createElement("a"),g=document.createElement("a"),a.className="dropdown",a.setAttribute("style","display:inline"),(p=a.appendChild(o)).className="btn btn-secondary dropdown-toggle",p.setAttribute("data-toggle","dropdown"),p.setAttribute("aria-haspopup","true"),p.setAttribute("aria-expanded","false"),p.setAttribute("style","padding:0px;margin-right:2px;margin-bottom:3px;background:none;"),p.appendChild(i).className="fa fa-chevron-right",(h=a.appendChild(s)).className="dropdown-menu",h.setAttribute("style","min-width:128px !important;border-radius:0px;background-color:#f1f2f4"),v=h.appendChild(r).appendChild(c),y=document.createTextNode("Hide"),v.className="dropdown-item",v.setAttribute("style","padding-left:10px;color:#333;text-decoration:none"),v.appendChild(y),f=h.appendChild(l).appendChild(d),w=document.createTextNode("Move Up"),f.className="dropdown-item",f.setAttribute("style","padding-left:10px;color:#333;text-decoration:none"),f.appendChild(w),b=h.appendChild(u).appendChild(g),k=document.createTextNode("Move Down"),b.className="dropdown-item",b.setAttribute("style","padding-left:10px;color:#333;text-decoration:none"),b.appendChild(k),v.addEventListener("click",function(){e.nestedInGroup&&n.update({id:e.id,visible:!1})}),f.addEventListener("click",function(){if(0!==e.id){for(var a,o,i=e.content.split("_"),s=[],r=0;r<n.length;r++)if(e.id===n._data[r].id){if(s=n._data[r-1].content.split("_"),i[0]===s[0]){a=n._data[r].content,o=n._data[r-1].content,t.rowOperationErrorMsg="",t.errMsgStyles={};break}t.rowOperationErrorMsg="This row cannot be moved further up!",t.errMsgStyles={padding:"5px","margin-bottom":"0px",opacity:"1","border-radius":"0px",position:"absolute",top:"35px",left:"0%",right:"0%","z-index":100};break}void 0!==a&&void 0!==o&&(n.update({id:e.id,content:o}),n.update({id:e.id-1,content:a}),m(a,o),t.rowOperationErrorMsg="",t.errMsgStyles={})}else 0===e.id&&(t.rowOperationErrorMsg="This row cannot be moved further up!",t.errMsgStyles={padding:"5px","margin-bottom":"0px",opacity:"1","border-radius":"0px",position:"absolute",top:"35px",left:"0%",right:"0%","z-index":100})}),b.addEventListener("click",function(){if(e.id!==n.length-1){for(var a,o,i=e.content.split("_"),s=[],r=0;r<n.length;r++)if(e.id===n._data[r].id){if(s=n._data[r+1].content.split("_"),i[0]===s[0]&&r!==n.length-2){a=n._data[r].content,o=n._data[r+1].content,t.rowOperationErrorMsg="",t.errMsgStyles={};break}t.rowOperationErrorMsg="This row cannot be moved down!",t.errMsgStyles={padding:"5px","margin-bottom":"0px",opacity:"1","border-radius":"0px",position:"absolute",top:"35px",left:"0%",right:"0%","z-index":100};break}void 0!==a&&void 0!==o&&(n.update({id:e.id,content:o}),n.update({id:e.id+1,content:a}),m(a,o),t.rowOperationErrorMsg="",t.errMsgStyles={})}else e.id===n.length-1&&(t.rowOperationErrorMsg="This row cannot be moved further down!",t.errMsgStyles={padding:"5px","margin-bottom":"0px",opacity:"1","border-radius":"0px",position:"absolute",top:"35px",left:"0%",right:"0%","z-index":100})}),S.insertAdjacentElement("afterbegin",a),S):(I.innerHTML=e.content,S.insertAdjacentElement("beforeEnd",I),S)},groupEditable:!0,moment:function(e){return vis.moment(e).utc()},start:e,end:a,orientation:{axis:"none"}}}function v(){if(t.widget.settings.start&&t.widget.settings.end){var e=h(t.widget.settings.start,t.widget.settings.end);t.options=e}else{e=h(new Date(vis.moment(o.getTime("UTC").today).utc()-36e5),new Date(vis.moment(o.getTime("UTC").today).utc()+36e5));t.options=e}return t.options}function m(e,a){for(var o="",i="",n="",s=[],r="",l="",c="",d="",u=[],g="",p=0;p<t.widget.settings.events.length;p++)t.widget.settings.events[p].label===e?(o=p,i=e,n=t.widget.settings.events[p].group,s=t.widget.settings.events[p].eventdata,r=t.widget.settings.events[p].eventinfo):t.widget.settings.events[p].label===a&&(l=p,c=a,d=t.widget.settings.events[p].group,u=t.widget.settings.events[p].eventdata,g=t.widget.settings.events[p].eventinfo);t.widget.settings.events[o].label=c,t.widget.settings.events[o].group=d,t.widget.settings.events[o].eventdata=u,t.widget.settings.events[o].eventinfo=g,t.widget.settings.events[l].label=i,t.widget.settings.events[l].group=n,t.widget.settings.events[l].eventdata=s,t.widget.settings.events[l].eventinfo=r}t.datetime="",t.rowOperationErrorMsg="",t.errMsgStyles={},t.datetime=t.widget.settings.datetime,t.realtimebutton={style:{background:"#12C700",float:"right"}},g(),e.loadTimelineEvents().then(function(e){0===e.data.length&&(c.setAttribute("style","display:none"),t.rowOperationErrorMsg="Please upload timeline data file to view timeline events!")}),t.$watch("widget.settings.timezones",function(e,a){g(),t.datetime&&t.datetime.length>0?t.changetime():t.realtime()},!0),t.$watch("widget.settings.events",function(e,a){e&&u(e,t.widget.settings.grouporder),t.datetime&&t.datetime.length>0?t.changetime():t.realtime()},!0),t.$watch("widget.settings.grouporder",function(e,a){e&&u(t.widget.settings.events,e),t.datetime&&t.datetime.length>0?t.changetime():t.realtime()},!0),d.on("rangechanged",function(e){for(var a=0;a<t.timezones.length;a++)try{t.tztimeline[a].setWindow(e.start,e.end)}catch(e){}t.widget.settings.start=e.start,t.widget.settings.end=e.end}),t.updateClock=function(){if(o.getTime("UTC").today){if(d.setCurrentTime(vis.moment(o.getTime("UTC").today).utc()),t.timezones.length>0)for(var e=0;e<t.timezones.length;e++)try{t.tztimeline[e].setCurrentTime(vis.moment(o.getTime("UTC").today).utcOffset(t.timezones[e].utcoffset))}catch(e){}""===t.widget.settings.datetime||void 0===t.widget.settings.datetime?t.realtimebutton={style:{background:"#12C700"}}:t.datetime=t.widget.settings.datetime}},t.interval=a(t.updateClock,1e3),t.changetime=function(){if(t.datetime){if(a.cancel(t.interval),d.setOptions({start:new Date(vis.moment(t.datetime).utc()-36e5),end:new Date(vis.moment(t.datetime).utc()+36e5)}),t.timezones.length>0)for(var e=0;e<t.timezones.length;e++)try{t.tztimeline[e].setOptions({start:new Date(vis.moment(t.datetime).utcOffset(t.timezones[e].utcoffset)-36e5),end:new Date(vis.moment(t.datetime).utcOffset(t.timezones[e].utcoffset)+36e5)})}catch(e){}t.realtimebutton.style={background:"#cccccc52"},t.widget.settings.datetime=t.datetime,t.dateTimeErrMsg="",t.dateTimeErrMsgStyles={}}else t.dateTimeErrMsg="Select a date and time and then set.",t.dateTimeErrMsgStyles={"border-color":"#dd2c00"}},t.realtime=function(){if(t.interval&&a.cancel(t.interval),t.clock=o.getTime("UTC"),d.setOptions({start:new Date(vis.moment(t.clock.today).utc()-36e5),end:new Date(vis.moment(t.clock.today).utc()+36e5)}),t.timezones.length>0)for(var e=0;e<t.timezones.length;e++)try{t.tztimeline[e].setOptions({start:new Date(vis.moment(t.clock.today).utcOffset(t.timezones[e].utcoffset)-36e5),end:new Date(vis.moment(t.clock.today).utcOffset(t.timezones[e].utcoffset)+36e5)})}catch(e){}t.datetime="",t.widget.settings.datetime="",t.interval=a(t.updateClock,1e3),t.realtimebutton={style:{background:"#12C700",float:"right"}},t.dateTimeErrMsg="",t.dateTimeErrMsgStyles={}},t.$on("$destroy",function(e){a.cancel(t.interval)})}]),app.directive("timelinesettings",function(){return{restrict:"E",templateUrl:"./directives/timeline/timelinesettings.html",controller:"timelineSettingsCtrl"}}),app.controller("timelineSettingsCtrl",["$scope","gridService",function(e,t){e.selectByGroupData=[];var a,o=!1,i=[];function n(e){var t,a,o,i=[],n=e.length;for(a=0;a<n;a++){for(t=void 0,o=0;o<i.length;o++)if(e[a].name===i[o].name){t=!0;break}t||i.push(e[a])}return i}function s(){o=!0,e.selectByGroupModel=[],e.itemsList={items1:[]};for(var t=[],a=0;a<e.widget.settings.grouporder.items1.length;a++)for(var i=0;i<e.widget.settings.events.length;i++)!1===e.widget.settings.grouporder.items1[a].groupstatus?e.widget.settings.grouporder.items1[a].Label===e.widget.settings.events[i].label&&t.push({id:e.widget.settings.events[i].id,label:e.widget.settings.grouporder.items1[a].Label,group:"Other"}):e.widget.settings.grouporder.items1[a].Label===e.widget.settings.events[i].group&&t.push({id:e.widget.settings.events[i].id,label:e.widget.settings.events[i].label,group:e.widget.settings.events[i].group});for(var n=0;n<e.selectByGroupData.length;n++)for(var s=0;s<t.length;s++)e.selectByGroupData[n].label===t[s].label&&e.selectByGroupModel.push(e.selectByGroupData[n]);r(e.selectByGroupModel,e.widget.settings.grouporder,o)}function r(t,a,o){if(void 0!==t){o=t.length===a.items1.length,e.itemsList={items1:[]};if(!0===o)for(var i=0;i<a.items1.length;i+=1)e.itemsList.items1.push({Id:a.items1[i].Id,Label:a.items1[i].Label,groupstatus:a.items1[i].groupstatus});else if(!1===o){for(var s=[],r=0;r<t.length;r++)"Other"===t[r].group?s.push({name:t[r].label,isgroup:!1}):s.push({name:t[r].group,isgroup:!0});var l=n(s);for(i=0;i<l.length;i+=1)e.itemsList.items1.push({Id:i,Label:l[i].name,groupstatus:l[i].isgroup})}}}a=[],e.selectByGroupData=[],t.loadTimelineEvents().then(function(t){if(t.data.length>0){for(var l=0;l<t.data.length;l++)e.selectByGroupData.push({id:l,label:t.data[l].eventname,group:t.data[l].eventgroup}),a.push({name:t.data[l].eventgroup});!function(t){if(void 0===e.widget.settings.events)if(e.selectByGroupData.length>0){e.widget.settings.events=[],o=!1,e.selectByGroupModel=[];for(var a=0;a<t.length;a++)e.selectByGroupModel.push(t[a]),e.widget.settings.events.push(t[a]);e.widget.settings.grouporder={items1:[]},r(e.selectByGroupModel,e.widget.settings.grouporder,o);for(var i=0;i<e.itemsList.items1.length;i++)e.widget.settings.grouporder.items1.push(e.itemsList.items1[i])}else 0===e.selectByGroupData.length&&(e.selectByGroupModel=[],e.widget.settings.events=[],e.widget.settings.grouporder=[]);else e.widget.settings.events.length>0&&e.widget.settings.grouporder.items1.length>0&&(e.selectByGroupModel=[],o=!0,s())}(e.selectByGroupData);for(var c=n(a),d=0;d<c.length;d++)i.push(c[d].name)}else e.selectByGroupData=[],e.selectByGroupModel=[]}),e.selectByGroupSettings={selectByGroups:i,groupByTextProvider:function(e){for(var t=0;t<i.length;t++)if(e===i[t])return i[t]},groupBy:"group",scrollableHeight:"200px",scrollable:!0,enableSearch:!0},e.customFilter="",e.selected={},e.isLoaded=!1,e.types=[{key:1,value:"Timezone"},{key:2,value:"Events"}],e.timezones=[{name:"Luxembourg",utcoffset:"+02:00",id:"lux",labeloffset:"+ 02"},{name:"San Francisco",utcoffset:"-08:00",id:"sfo",labeloffset:"- 08"},{name:"Singapore",utcoffset:"+08:00",id:"sgp",labeloffset:"+ 08"},{name:"UTC",utcoffset:"+00:00",id:"utc",labeloffset:"+ 00"}],e.sortableOptions={containment:"#scrollable-container",scrollableContainer:"#scrollable-container",accept:function(e,t){return e.itemScope.sortableScope.$id===t.$id}},e.timezoneErrMsg="",e.eventErrMsg="",e.closeSettings=function(t){t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,s(),e.eventErrMsg="",e.timezoneErrMsg=""},e.saveSettings=function(t){if(e.selected.type)if("Timezone"===e.selected.type.value)e.selected.timezone&&(!0===function(e,t){for(var a=!1,o=0;o<e.length;o++)if(e[o].name===t){a=!0;break}return a}(t.settings.timezones,e.selected.timezone.name)?(e.timezoneErrMsg="This time axis already exists in the qwidget",e.eventErrMsg="",t.settings.timezones=t.settings.timezones,e.selected.timezone={}):(t.settings.timezones.push(e.selected.timezone),t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,e.selected={},e.eventErrMsg="",e.timezoneErrMsg=""));else if("Events"==e.selected.type.value)if(o=!1,e.selectByGroupModel.length>0){t.settings.events=[];for(var a=0;a<e.selectByGroupData.length;a++)for(var i=0;i<e.selectByGroupModel.length;i++)e.selectByGroupData[a].label===e.selectByGroupModel[i].label&&t.settings.events.push(e.selectByGroupModel[i]);t.settings.grouporder={items1:[]};for(var n=0;n<e.itemsList.items1.length;n++)t.settings.grouporder.items1.push(e.itemsList.items1[n]);t.main=!0,t.settings.active=!1,t.saveLoad=!1,t.delete=!1,e.eventErrMsg="",e.timezoneErrMsg=""}else 0===e.selectByGroupModel.length&&(e.eventErrMsg="Select atleast one event",e.timezoneErrMsg="")},e.$watch("selectByGroupModel",function(t,a){e.selectByGroupModel&&e.selectByGroupModel.length>0&&r(e.selectByGroupModel,e.widget.settings.grouporder,o)},!0)}]);